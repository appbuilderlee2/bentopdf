import{c as v,i as y}from"./style-BMqLG_Qf.js";import"./lucide-init-Css57rKe.js";import"./simple-mode-footer-WbVs9YeG.js";import"./version-Cc_uNslJ.js";import{h as m,d as C,a as f,b as x,f as T}from"./main-DSprMeGA.js";import{isCpdfAvailable as E}from"./cpdf-helper-cd-X1XO3.js";import{s as b,W as L}from"./wasm-provider-BDZaM2k5.js";import"./mobileMenu-BoMunYmR.js";const h=new Worker("/workers/edit-attachments.worker.js"),n={file:null,allAttachments:[],attachmentsToRemove:new Set};function w(){n.file=null,n.allAttachments=[],n.attachmentsToRemove.clear();const t=document.getElementById("file-display-area");t&&(t.innerHTML="");const e=document.getElementById("tool-options");e&&e.classList.add("hidden");const c=document.getElementById("attachments-list");c&&(c.innerHTML="");const i=document.getElementById("process-btn");i&&i.classList.add("hidden");const a=document.getElementById("file-input");a&&(a.value="")}h.onmessage=function(t){const e=t.data;if(e.status==="success"&&e.attachments!==void 0)n.allAttachments=e.attachments.map(function(c){return{...c,data:new Uint8Array(c.data)}}),N(e.attachments),m();else if(e.status==="success"&&e.modifiedPDF!==void 0){m();const c=n.file?.name.replace(/\.pdf$/i,"")||"document";C(new Blob([new Uint8Array(e.modifiedPDF)],{type:"application/pdf"}),`${c}_edited.pdf`),f("Success","Attachments updated successfully!","success",function(){w()})}else e.status==="error"&&(m(),f("Error",e.message||"Unknown error occurred."))};h.onerror=function(t){m(),console.error("Worker error:",t),f("Error","Worker error occurred. Check console for details.")};function N(t){const e=document.getElementById("attachments-list"),c=document.getElementById("process-btn");if(!e)return;if(e.innerHTML="",t.length===0){const s=document.createElement("p");s.className="text-gray-400 text-center py-4",s.textContent="No attachments found in this PDF.",e.appendChild(s);return}const i=document.createElement("div");i.className="attachments-controls mb-4 flex justify-end";const a=document.createElement("button");a.className="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded text-sm",a.textContent="Remove All Attachments",a.onclick=function(){if(n.allAttachments.length===0)return;n.allAttachments.every(function(o){return n.attachmentsToRemove.has(o.index)})?(n.allAttachments.forEach(function(o){n.attachmentsToRemove.delete(o.index);const r=document.querySelector(`[data-attachment-index="${o.index}"]`);if(r){r.classList.remove("opacity-50","line-through");const l=r.querySelector("button");l&&(l.classList.remove("bg-gray-600"),l.classList.add("bg-red-600"))}}),a.textContent="Remove All Attachments"):(n.allAttachments.forEach(function(o){n.attachmentsToRemove.add(o.index);const r=document.querySelector(`[data-attachment-index="${o.index}"]`);if(r){r.classList.add("opacity-50","line-through");const l=r.querySelector("button");l&&(l.classList.add("bg-gray-600"),l.classList.remove("bg-red-600"))}}),a.textContent="Deselect All")},i.appendChild(a),e.appendChild(i);for(const s of t){const o=document.createElement("div");o.className="flex items-center justify-between p-3 bg-gray-800 rounded-lg border border-gray-700",o.dataset.attachmentIndex=s.index.toString();const r=document.createElement("div");r.className="flex-1";const l=document.createElement("span");l.className="text-white font-medium block",l.textContent=s.name;const u=document.createElement("span");u.className="text-gray-400 text-sm block",s.page===0?u.textContent="Document-level attachment":u.textContent=`Page ${s.page} attachment`,r.append(l,u);const p=document.createElement("div");p.className="flex items-center gap-2";const d=document.createElement("button");d.className=`${n.attachmentsToRemove.has(s.index)?"bg-gray-600":"bg-red-600"} hover:bg-red-700 text-white px-3 py-1 rounded text-sm`,d.innerHTML='<i data-lucide="trash-2" class="w-4 h-4"></i>',d.title="Remove attachment",d.onclick=function(){n.attachmentsToRemove.has(s.index)?(n.attachmentsToRemove.delete(s.index),o.classList.remove("opacity-50","line-through"),d.classList.remove("bg-gray-600"),d.classList.add("bg-red-600")):(n.attachmentsToRemove.add(s.index),o.classList.add("opacity-50","line-through"),d.classList.add("bg-gray-600"),d.classList.remove("bg-red-600"));const A=n.allAttachments.every(function(B){return n.attachmentsToRemove.has(B.index)});a.textContent=A?"Deselect All":"Remove All Attachments"},p.append(d),o.append(r,p),e.appendChild(o)}v({icons:y}),c&&c.classList.remove("hidden")}async function D(){if(n.file){if(x("Loading attachments..."),!E()){b("cpdf"),m();return}try{const t=await n.file.arrayBuffer(),e={command:"get-attachments",fileBuffer:t,fileName:n.file.name,cpdfUrl:L.getUrl("cpdf")+"coherentpdf.browser.min.js"};h.postMessage(e,[t])}catch(t){console.error("Error loading attachments:",t),m(),f("Error","Failed to load attachments from PDF.")}}}async function k(){if(!n.file){f("Error","No PDF file loaded.");return}if(n.attachmentsToRemove.size===0){f("No Changes","No attachments selected for removal.");return}if(x("Processing attachments..."),!E()){b("cpdf"),m();return}try{const t=await n.file.arrayBuffer(),e={command:"edit-attachments",fileBuffer:t,fileName:n.file.name,attachmentsToRemove:Array.from(n.attachmentsToRemove),cpdfUrl:L.getUrl("cpdf")+"coherentpdf.browser.min.js"};h.postMessage(e,[t])}catch(t){console.error("Error editing attachments:",t),m(),f("Error","Failed to edit attachments.")}}async function I(){const t=document.getElementById("file-display-area"),e=document.getElementById("tool-options");if(t)if(t.innerHTML="",n.file){const c=document.createElement("div");c.className="flex items-center justify-between bg-gray-700 p-3 rounded-lg text-sm";const i=document.createElement("div");i.className="flex flex-col overflow-hidden";const a=document.createElement("div");a.className="truncate font-medium text-gray-200 text-sm mb-1",a.textContent=n.file.name;const s=document.createElement("div");s.className="text-xs text-gray-400",s.textContent=T(n.file.size),i.append(a,s);const o=document.createElement("button");o.className="ml-4 text-red-400 hover:text-red-300 flex-shrink-0",o.innerHTML='<i data-lucide="trash-2" class="w-4 h-4"></i>',o.onclick=function(){w()},c.append(i,o),t.appendChild(c),v({icons:y}),e&&e.classList.remove("hidden"),await D()}else e&&e.classList.add("hidden")}function g(t){if(t&&t.length>0){const e=t[0];(e.type==="application/pdf"||e.name.toLowerCase().endsWith(".pdf"))&&(n.file=e,I())}}document.addEventListener("DOMContentLoaded",function(){const t=document.getElementById("file-input"),e=document.getElementById("drop-zone"),c=document.getElementById("process-btn"),i=document.getElementById("back-to-tools");i&&i.addEventListener("click",function(){window.location.href="/"}),t&&e&&(t.addEventListener("change",function(a){g(a.target.files)}),e.addEventListener("dragover",function(a){a.preventDefault(),e.classList.add("bg-gray-700")}),e.addEventListener("dragleave",function(a){a.preventDefault(),e.classList.remove("bg-gray-700")}),e.addEventListener("drop",function(a){a.preventDefault(),e.classList.remove("bg-gray-700");const s=a.dataTransfer?.files;if(s&&s.length>0){const o=Array.from(s).filter(function(r){return r.type==="application/pdf"||r.name.toLowerCase().endsWith(".pdf")});if(o.length>0){const r=new DataTransfer;r.items.add(o[0]),g(r.files)}}}),t.addEventListener("click",function(){t.value=""})),c&&c.addEventListener("click",k)});
