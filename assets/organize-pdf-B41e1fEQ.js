import{c as v,i as E}from"./style-DHqpffR4.js";import"./lucide-init-b51_Izr7.js";import"./simple-mode-footer-CTXl6sKe.js";import"./version-Cc_uNslJ.js";import{G as N,a as l,b as w,r as S,c as C,h as y,f as F,j as T,d as k}from"./main-X9THBjap.js";import{P as x}from"./PDFButton-B7ekbw-1.js";import"./mobileMenu-BoMunYmR.js";import"./index-YkV0U4e7.js";N.workerSrc=new URL("/bentopdf/assets/pdf.worker.min-LyOxJPrg.mjs",import.meta.url).toString();const a={file:null,pdfDoc:null,pdfJsDoc:null,totalPages:0,sortableInstance:null};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",I):I();function I(){v({icons:E});const e=document.getElementById("file-input"),t=document.getElementById("drop-zone"),o=document.getElementById("process-btn");e&&e.addEventListener("change",j),t&&(t.addEventListener("dragover",r=>{r.preventDefault(),t.classList.add("bg-gray-700")}),t.addEventListener("dragleave",()=>{t.classList.remove("bg-gray-700")}),t.addEventListener("drop",r=>{r.preventDefault(),t.classList.remove("bg-gray-700");const s=r.dataTransfer?.files;s&&s.length>0&&L(s[0])}),e?.addEventListener("click",()=>{e&&(e.value="")})),o&&o.addEventListener("click",z),document.getElementById("back-to-tools")?.addEventListener("click",()=>{window.location.href="/bentopdf/"});const n=document.getElementById("apply-order-btn");n&&n.addEventListener("click",O)}function O(){const e=document.getElementById("page-order-input"),t=document.getElementById("page-grid");if(!e||!t)return;const o=e.value;if(!o){l("Invalid Order","Please enter a page order.");return}const n=o.split(",").map(i=>parseInt(i.trim(),10)),r=t.children.length;if(!n.every(i=>!isNaN(i)&&i>0)){l("Invalid Page Numbers","Please enter positive numbers.");return}if(n.length!==r){l("Incorrect Page Count",`The number of pages specified (${n.length}) does not match the current number of pages in the document (${r}). Please provide a complete ordering for all pages.`);return}if(new Set(n).size!==n.length){l("Duplicate Page Numbers","Please ensure all page numbers in the order are unique.");return}const d=Array.from(t.children),c=[],m=new Set;for(const i of n){const p=i-1,g=d.find(f=>f.dataset.originalPageIndex===p.toString());g&&(c.push(g),m.add(p.toString()))}const h=d.every(i=>m.has(i.dataset.originalPageIndex));if(c.length!==r||!h){l("Invalid Page Order","The specified page order is incomplete or contains invalid page numbers. Please ensure you provide a new position for every original page.");return}t.innerHTML="",c.forEach(i=>t.appendChild(i)),b(),l("Success","Pages have been reordered.","success")}function j(e){const t=e.target;t.files&&t.files.length>0&&L(t.files[0])}async function L(e){if(e.type!=="application/pdf"&&!e.name.toLowerCase().endsWith(".pdf")){l("Invalid File","Please select a PDF file.");return}w("Loading PDF..."),a.file=e;try{const t=await S(e);a.pdfDoc=await x.load(t,{ignoreEncryption:!0,throwOnInvalidObject:!1}),a.pdfJsDoc=await C({data:t.slice(0)}).promise,a.totalPages=a.pdfDoc.getPageCount(),A(),await M(),y()}catch(t){console.error("Error loading PDF:",t),y(),l("Error","Failed to load PDF file.")}}function A(){const e=document.getElementById("file-display-area");if(!e||!a.file)return;e.innerHTML="";const t=document.createElement("div");t.className="flex items-center justify-between bg-gray-700 p-3 rounded-lg";const o=document.createElement("div");o.className="flex flex-col flex-1 min-w-0";const n=document.createElement("div");n.className="truncate font-medium text-gray-200 text-sm mb-1",n.textContent=a.file.name;const r=document.createElement("div");r.className="text-xs text-gray-400",r.textContent=`${F(a.file.size)} â€¢ ${a.totalPages} pages`,o.append(n,r);const s=document.createElement("button");s.className="ml-4 text-red-400 hover:text-red-300 flex-shrink-0",s.innerHTML='<i data-lucide="trash-2" class="w-4 h-4"></i>',s.onclick=()=>D(),t.append(o,s),e.appendChild(t),v({icons:E})}function P(){const e=document.getElementById("page-grid");if(!e)return;e.querySelectorAll(".page-number").forEach((o,n)=>{o.textContent=(n+1).toString()})}function B(e){const t=e.querySelector(".duplicate-btn"),o=e.querySelector(".delete-btn");t?.addEventListener("click",n=>{n.stopPropagation();const r=e.cloneNode(!0);e.after(r),B(r),P(),v({icons:E}),b()}),o?.addEventListener("click",n=>{n.stopPropagation();const r=document.getElementById("page-grid");r&&r.children.length>1?(e.remove(),P(),b()):l("Cannot Delete","You cannot delete the last page of the document.")})}async function M(){const e=document.getElementById("page-grid"),t=document.getElementById("process-btn"),o=document.getElementById("advanced-settings");if(!(!e||!t||!o)){e.innerHTML="",e.classList.remove("hidden"),t.classList.remove("hidden"),o.classList.remove("hidden");for(let n=1;n<=a.totalPages;n++){const r=await a.pdfJsDoc.getPage(n),s=r.getViewport({scale:.5}),u=document.createElement("canvas");u.width=s.width,u.height=s.height;const d=u.getContext("2d");await r.render({canvasContext:d,viewport:s}).promise;const c=document.createElement("div");c.className="page-thumbnail relative cursor-move flex flex-col items-center gap-2",c.dataset.originalPageIndex=(n-1).toString();const m=document.createElement("div");m.className="w-full h-36 bg-gray-900 rounded-lg flex items-center justify-center overflow-hidden border-2 border-gray-600";const h=document.createElement("img");h.src=u.toDataURL(),h.className="max-w-full max-h-full object-contain",m.appendChild(h);const i=document.createElement("span");i.className="page-number absolute top-1 left-1 bg-gray-900 bg-opacity-75 text-white text-xs rounded-full px-2 py-1",i.textContent=n.toString();const p=document.createElement("div");p.className="flex items-center justify-center gap-4";const g=document.createElement("button");g.className="duplicate-btn bg-green-600 hover:bg-green-700 text-white rounded-full w-8 h-8 flex items-center justify-center",g.title="Duplicate Page",g.innerHTML='<i data-lucide="copy-plus" class="w-5 h-5"></i>';const f=document.createElement("button");f.className="delete-btn bg-red-600 hover:bg-red-700 text-white rounded-full w-8 h-8 flex items-center justify-center",f.title="Delete Page",f.innerHTML='<i data-lucide="x-circle" class="w-5 h-5"></i>',p.append(g,f),c.append(m,i,p),e.appendChild(c),B(c)}v({icons:E}),b()}}function b(){const e=document.getElementById("page-grid");e&&(a.sortableInstance&&a.sortableInstance.destroy(),a.sortableInstance=T.create(e,{animation:150,ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",filter:".duplicate-btn, .delete-btn",preventOnFilter:!0,onStart:t=>{t.item&&(t.item.style.opacity="0.5")},onEnd:t=>{t.item&&(t.item.style.opacity="1")}}))}async function z(){w("Building new PDF...");try{const e=document.getElementById("page-grid");if(!e)return;const t=e.querySelectorAll(".page-thumbnail"),o=Array.from(t).map(d=>parseInt(d.dataset.originalPageIndex||"",10)).filter(d=>!isNaN(d)&&d>=0);if(o.length===0){l("Error","No valid pages to save.");return}const n=await x.create();(await n.copyPages(a.pdfDoc,o)).forEach(d=>n.addPage(d));const s=await n.save(),u=a.file?.name.replace(".pdf","")||"document";k(new Blob([s],{type:"application/pdf"}),`${u}_organized.pdf`),y(),l("Success","PDF organized successfully!","success",()=>D())}catch(e){console.error("Error saving changes:",e),y(),l("Error","Failed to save changes.")}}function D(){a.sortableInstance&&(a.sortableInstance.destroy(),a.sortableInstance=null),a.file=null,a.pdfDoc=null,a.pdfJsDoc=null,a.totalPages=0;const e=document.getElementById("page-grid");e&&(e.innerHTML="",e.classList.add("hidden")),document.getElementById("process-btn")?.classList.add("hidden"),document.getElementById("advanced-settings")?.classList.add("hidden");const t=document.getElementById("file-display-area");t&&(t.innerHTML="")}
