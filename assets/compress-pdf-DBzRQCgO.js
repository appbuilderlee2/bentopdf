const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/jszip.min-CX_3d3rd.js","assets/main-X9THBjap.js","assets/style-DHqpffR4.js","assets/style-Bksgp8bg.css","assets/_commonjs-dynamic-modules-TDtrdbi3.js"])))=>i.map(i=>d[i]);
import{c as J,i as Q}from"./style-DHqpffR4.js";import"./lucide-init-b51_Izr7.js";import"./simple-mode-footer-CTXl6sKe.js";import"./version-Cc_uNslJ.js";import{G as U,s as o,a as C,h as $,b as z,r as O,f as x,d as A,_ as V,c as W}from"./main-X9THBjap.js";import{P as Z}from"./PDFButton-B7ekbw-1.js";import{s as K}from"./wasm-provider-C9fvsoLq.js";import{i as X,l as Y}from"./pymupdf-loader-DSwOn04P.js";import"./mobileMenu-BoMunYmR.js";import"./index-YkV0U4e7.js";U.workerSrc=new URL("/bentopdf/assets/pdf.worker.min-LyOxJPrg.mjs",import.meta.url).toString();const N={light:{images:{quality:90,dpiTarget:150,dpiThreshold:200},scrub:{metadata:!1,thumbnails:!0},subsetFonts:!0},balanced:{images:{quality:75,dpiTarget:96,dpiThreshold:150},scrub:{metadata:!0,thumbnails:!0},subsetFonts:!0},aggressive:{images:{quality:50,dpiTarget:72,dpiThreshold:100},scrub:{metadata:!0,thumbnails:!0,xmlMetadata:!0},subsetFonts:!0},extreme:{images:{quality:30,dpiTarget:60,dpiThreshold:96},scrub:{metadata:!0,thumbnails:!0,xmlMetadata:!0},subsetFonts:!0}},j={light:{scale:2,quality:.85},balanced:{scale:1.5,quality:.65},aggressive:{scale:1.2,quality:.45},extreme:{scale:1,quality:.25}};async function R(h,g,c){const b=await Y(),m=N[g]||N.balanced,E=c?.dpiTarget??m.images.dpiTarget,T=c?.dpiThreshold??m.images.dpiThreshold,i=Math.max(T,E+10),r={images:{enabled:!0,quality:c?.imageQuality??m.images.quality,dpiTarget:E,dpiThreshold:i,convertToGray:c?.convertToGrayscale??!1},scrub:{metadata:c?.removeMetadata??m.scrub.metadata,thumbnails:c?.removeThumbnails??m.scrub.thumbnails,xmlMetadata:m.scrub.xmlMetadata??!1},subsetFonts:c?.subsetFonts??m.subsetFonts,save:{garbage:4,deflate:!0,clean:!0,useObjstms:!0}};try{return await b.compressPdf(h,r)}catch(p){const w=p?.message||String(p);if(w.includes("PatternType")||w.includes("pattern")){console.warn("[CompressPDF] Pattern error detected, retrying without image rewriting:",w);const y={...r,images:{...r.images,enabled:!1}};return{...await b.compressPdf(h,y),usedFallback:!0}}throw new Error(`PDF compression failed: ${w}`)}}async function G(h,g){const c=await W({data:h}).promise,b=await Z.create(),m=j[g]||j.balanced;for(let E=1;E<=c.numPages;E++){const T=await c.getPage(E),i=T.getViewport({scale:m.scale}),r=document.createElement("canvas"),p=r.getContext("2d");r.height=i.height,r.width=i.width,await T.render({canvasContext:p,viewport:i,canvas:r}).promise;const y=await(await new Promise(D=>r.toBlob(P=>D(P),"image/jpeg",m.quality))).arrayBuffer(),L=await b.embedJpg(y);b.addPage([i.width,i.height]).drawImage(L,{x:0,y:0,width:i.width,height:i.height})}return await b.save()}document.addEventListener("DOMContentLoaded",()=>{const h=document.getElementById("file-input"),g=document.getElementById("drop-zone"),c=document.getElementById("compress-options"),b=document.getElementById("add-more-btn"),m=document.getElementById("clear-files-btn"),E=document.getElementById("process-btn"),T=document.getElementById("back-to-tools"),i=document.getElementById("compression-algorithm"),r=document.getElementById("condense-info"),p=document.getElementById("photon-info"),w=document.getElementById("toggle-custom-settings"),y=document.getElementById("custom-settings-panel"),L=document.getElementById("custom-settings-chevron");let S=!1;T&&T.addEventListener("click",()=>{window.location.href="/bentopdf/"}),i&&r&&p&&i.addEventListener("change",()=>{i.value==="condense"?(r.classList.remove("hidden"),p.classList.add("hidden")):(r.classList.add("hidden"),p.classList.remove("hidden"))}),w&&y&&L&&w.addEventListener("click",()=>{y.classList.toggle("hidden"),L.style.transform=y.classList.contains("hidden")?"rotate(0deg)":"rotate(180deg)",y.classList.contains("hidden")||(S=!0)});const D=async()=>{if(c)if(o.files.length>0){const e=document.getElementById("file-display-area");if(e){e.innerHTML="";for(let l=0;l<o.files.length;l++){const u=o.files[l],t=document.createElement("div");t.className="flex items-center justify-between bg-gray-700 p-3 rounded-lg text-sm";const n=document.createElement("div");n.className="flex flex-col overflow-hidden";const d=document.createElement("div");d.className="truncate font-medium text-gray-200 text-sm mb-1",d.textContent=u.name;const a=document.createElement("div");a.className="text-xs text-gray-400",a.textContent=x(u.size),n.append(d,a);const s=document.createElement("button");s.className="ml-4 text-red-400 hover:text-red-300 flex-shrink-0",s.innerHTML='<i data-lucide="trash-2" class="w-4 h-4"></i>',s.onclick=()=>{o.files=o.files.filter((F,B)=>B!==l),D()},t.append(n,s),e.appendChild(t)}J({icons:Q})}c.classList.remove("hidden")}else{c.classList.add("hidden");const e=document.getElementById("file-display-area");e&&(e.innerHTML="")}},P=()=>{o.files=[],o.pdfDoc=null;const e=document.getElementById("compression-level");e&&(e.value="balanced"),i&&(i.value="condense"),S=!1,y&&y.classList.add("hidden"),L&&(L.style.transform="rotate(0deg)");const l=document.getElementById("image-quality"),u=document.getElementById("dpi-target"),t=document.getElementById("dpi-threshold"),n=document.getElementById("remove-metadata"),d=document.getElementById("subset-fonts"),a=document.getElementById("convert-to-grayscale"),s=document.getElementById("remove-thumbnails");l&&(l.value="75"),u&&(u.value="96"),t&&(t.value="150"),n&&(n.checked=!0),d&&(d.checked=!0),a&&(a.checked=!1),s&&(s.checked=!0),r&&r.classList.remove("hidden"),p&&p.classList.add("hidden"),D()},H=async()=>{const e=document.getElementById("compression-level").value;document.getElementById("compression-algorithm").value;const l=document.getElementById("convert-to-grayscale")?.checked??!1;let u;if(S){const t=parseInt(document.getElementById("image-quality")?.value)||75,n=parseInt(document.getElementById("dpi-target")?.value)||96,d=parseInt(document.getElementById("dpi-threshold")?.value)||150,a=document.getElementById("remove-metadata")?.checked??!0,s=document.getElementById("subset-fonts")?.checked??!0,F=document.getElementById("remove-thumbnails")?.checked??!0;u={imageQuality:t,dpiTarget:n,dpiThreshold:d,removeMetadata:a,subsetFonts:s,convertToGrayscale:l,removeThumbnails:F}}else u=l?{convertToGrayscale:l}:void 0;try{if(o.files.length===0){C("No Files","Please select at least one PDF file."),$();return}const t=document.getElementById("compression-algorithm").value;if(t==="condense"&&!X()){K("pymupdf");return}if(o.files.length===1){const n=o.files[0];let d,a,s;if(t==="condense"){z("Running Condense compression...");const f=await R(n,e,u);d=f.blob,a=f.compressedSize,s="Condense",f.usedFallback&&(s+=" (without image optimization due to unsupported patterns)")}else{z("Running Photon compression...");const f=await O(n),v=await G(f,e),M=v.buffer.slice(v.byteOffset,v.byteOffset+v.byteLength);d=new Blob([M],{type:"application/pdf"}),a=v.length,s="Photon"}const F=x(n.size),B=x(a),k=n.size-a,I=k>0?(k/n.size*100).toFixed(1):0;A(d,n.name.replace(/\.pdf$/i,"")+"_compressed.pdf"),$(),k>0?C("Compression Complete",`Method: ${s}. File size reduced from ${F} to ${B} (Saved ${I}%).`,"success",()=>P()):C("Compression Finished",`Method: ${s}. Could not reduce file size further. Original: ${F}, New: ${B}.`,"warning",()=>P())}else{z("Compressing multiple PDFs...");const n=(await V(async()=>{const{default:I}=await import("./jszip.min-CX_3d3rd.js").then(f=>f.j);return{default:I}},__vite__mapDeps([0,1,2,3,4]))).default,d=new n;let a=0,s=0;for(let I=0;I<o.files.length;I++){const f=o.files[I];z(`Compressing ${I+1}/${o.files.length}: ${f.name}...`),a+=f.size;let v;if(t==="condense"){const _=await R(f,e,u);v=new Uint8Array(await _.blob.arrayBuffer())}else{const _=await O(f);v=await G(_,e)}s+=v.length;const M=f.name.replace(/\.pdf$/i,"");d.file(`${M}_compressed.pdf`,v)}const F=await d.generateAsync({type:"blob"}),B=a-s,k=B>0?(B/a*100).toFixed(1):0;A(F,"compressed-pdfs.zip"),$(),B>0?C("Compression Complete",`Compressed ${o.files.length} PDF(s). Total size reduced from ${x(a)} to ${x(s)} (Saved ${k}%).`,"success",()=>P()):C("Compression Finished",`Compressed ${o.files.length} PDF(s). Total size: ${x(s)}.`,"info",()=>P())}}catch(t){$(),console.error("[CompressPDF] Error:",t),C("Error",`An error occurred during compression. Error: ${t.message}`)}},q=e=>{e&&e.length>0&&(o.files=[...o.files,...Array.from(e)],D())};h&&g&&(h.addEventListener("change",e=>{q(e.target.files)}),g.addEventListener("dragover",e=>{e.preventDefault(),g.classList.add("bg-gray-700")}),g.addEventListener("dragleave",e=>{e.preventDefault(),g.classList.remove("bg-gray-700")}),g.addEventListener("drop",e=>{e.preventDefault(),g.classList.remove("bg-gray-700");const l=e.dataTransfer?.files;if(l&&l.length>0){const u=Array.from(l).filter(t=>t.type==="application/pdf");if(u.length>0){const t=new DataTransfer;u.forEach(n=>t.items.add(n)),q(t.files)}}}),h.addEventListener("click",()=>{h.value=""})),b&&b.addEventListener("click",()=>{h.click()}),m&&m.addEventListener("click",()=>{P()}),E&&E.addEventListener("click",H)});
