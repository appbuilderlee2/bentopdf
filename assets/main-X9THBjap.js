var ma=a=>{throw TypeError(a)};var Fr=(a,t,e)=>t.has(a)||ma("Cannot "+e);var $t=(a,t,e)=>(Fr(a,t,"read from private field"),e?e.call(a):t.get(a)),fi=(a,t,e)=>t.has(a)?ma("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(a):t.set(a,e),Oe=(a,t,e,i)=>(Fr(a,t,"write to private field"),i?i.call(a,e):t.set(a,e),e),pi=(a,t,e)=>(Fr(a,t,"access private method"),e);var ba=(a,t,e,i)=>({set _(n){Oe(a,t,n,e)},get _(){return $t(a,t,i)}});import{c as Mr,i as Ir}from"./style-DHqpffR4.js";const Pn=[{name:"Popular Tools",tools:[{href:"/bentopdf/pdf-workflow.html",name:"PDF Workflow Builder",icon:"ph-tree-structure",subtitle:"Build custom PDF processing pipelines with a visual node editor."},{href:"/bentopdf/pdf-multi-tool.html",name:"PDF Multi Tool",icon:"ph-pencil-ruler",subtitle:"Merge, Split, Organize, Delete, Rotate, Add Blank Pages, Extract and Duplicate in an unified interface."},{href:"/bentopdf/merge-pdf.html",name:"Merge PDF",icon:"ph-browsers",subtitle:"Combine multiple PDFs into one file. Preserves Bookmarks."},{href:"/bentopdf/split-pdf.html",name:"Split PDF",icon:"ph-scissors",subtitle:"Extract a range of pages into a new PDF."},{href:"/bentopdf/compress-pdf.html",name:"Compress PDF",icon:"ph-lightning",subtitle:"Reduce the file size of your PDF."},{href:"/bentopdf/edit-pdf.html",name:"PDF Editor",icon:"ph-pencil-simple",subtitle:"Annotate, highlight, redact, comment, add shapes/images, search, and view PDFs"},{href:"/bentopdf/jpg-to-pdf.html",name:"JPG to PDF",icon:"ph-file-jpg",subtitle:"Create a PDF from one or more JPG images."},{href:"/bentopdf/sign-pdf.html",name:"Sign PDF",icon:"ph-pen-nib",subtitle:"Draw, type, or upload your signature."},{href:"/bentopdf/crop-pdf.html",name:"Crop PDF",icon:"ph-crop",subtitle:"Trim the margins of every page in your PDF."},{href:"/bentopdf/extract-pages.html",name:"Extract Pages",icon:"ph-squares-four",subtitle:"Save a selection of pages as new files."},{href:"/bentopdf/organize-pdf.html",name:"Duplicate & Organize",icon:"ph-files",subtitle:"Duplicate, reorder, and delete pages."},{href:"/bentopdf/delete-pages.html",name:"Delete Pages",icon:"ph-trash",subtitle:"Remove specific pages from your document."}]},{name:"Edit & Annotate",tools:[{href:"/bentopdf/edit-pdf.html",name:"PDF Editor",icon:"ph-pencil-simple",subtitle:"Annotate, highlight, redact, comment, add shapes/images, search, and view PDFs."},{href:"/bentopdf/bookmark.html",name:"Edit Bookmarks",icon:"ph-bookmark",subtitle:"Add, edit, import, delete and extract PDF bookmarks."},{href:"/bentopdf/table-of-contents.html",name:"Table of Contents",icon:"ph-list",subtitle:"Generate a table of contents page from PDF bookmarks."},{href:"/bentopdf/page-numbers.html",name:"Page Numbers",icon:"ph-list-numbers",subtitle:"Insert page numbers into your document."},{href:"/bentopdf/add-watermark.html",name:"Add Watermark",icon:"ph-drop",subtitle:"Stamp text or an image over your PDF pages."},{href:"/bentopdf/header-footer.html",name:"Header & Footer",icon:"ph-paragraph",subtitle:"Add text to the top and bottom of pages."},{href:"/bentopdf/invert-colors.html",name:"Invert Colors",icon:"ph-circle-half",subtitle:'Create a "dark mode" version of your PDF.'},{href:"/bentopdf/scanner-effect.html",name:"Scanner Effect",icon:"ph-scan",subtitle:"Make your PDF look like a scanned document."},{href:"/bentopdf/adjust-colors.html",name:"Adjust Colors",icon:"ph-sliders-horizontal",subtitle:"Fine-tune brightness, contrast, saturation and more."},{href:"/bentopdf/background-color.html",name:"Background Color",icon:"ph-palette",subtitle:"Change the background color of your PDF."},{href:"/bentopdf/text-color.html",name:"Change Text Color",icon:"ph-eyedropper",subtitle:"Change the color of text in your PDF."},{href:"/bentopdf/sign-pdf.html",name:"Sign PDF",icon:"ph-pen-nib",subtitle:"Draw, type, or upload your signature."},{href:"/bentopdf/add-stamps.html",name:"Add Stamps",icon:"ph-stamp",subtitle:"Add image stamps to your PDF using the annotation toolbar."},{href:"/bentopdf/remove-annotations.html",name:"Remove Annotations",icon:"ph-eraser",subtitle:"Strip comments, highlights, and links."},{href:"/bentopdf/crop-pdf.html",name:"Crop PDF",icon:"ph-crop",subtitle:"Trim the margins of every page in your PDF."},{href:"/bentopdf/form-filler.html",name:"PDF Form Filler",icon:"ph-pencil-line",subtitle:"Fill in forms directly in the browser. Also supports XFA forms."},{href:"/bentopdf/form-creator.html",name:"Create PDF Form",icon:"ph-file-plus",subtitle:"Create fillable PDF forms with drag-and-drop text fields."},{href:"/bentopdf/remove-blank-pages.html",name:"Remove Blank Pages",icon:"ph-file-minus",subtitle:"Automatically detect and delete blank pages."}]},{name:"Convert to PDF",tools:[{href:"/bentopdf/image-to-pdf.html",name:"Images to PDF",icon:"ph-images",subtitle:"Convert JPG, PNG, BMP, GIF, TIFF, PNM, PGM, PBM, PPM, PAM, JXR, JPX, JP2, PSD, SVG, HEIC, WebP to PDF."},{href:"/bentopdf/jpg-to-pdf.html",name:"JPG to PDF",icon:"ph-file-jpg",subtitle:"Create a PDF from one or more JPG images."},{href:"/bentopdf/png-to-pdf.html",name:"PNG to PDF",icon:"ph-file-png",subtitle:"Create a PDF from one or more PNG images."},{href:"/bentopdf/webp-to-pdf.html",name:"WebP to PDF",icon:"ph-image",subtitle:"Create a PDF from one or more WebP images."},{href:"/bentopdf/svg-to-pdf.html",name:"SVG to PDF",icon:"ph-file-svg",subtitle:"Create a PDF from one or more SVG images."},{href:"/bentopdf/bmp-to-pdf.html",name:"BMP to PDF",icon:"ph-image",subtitle:"Create a PDF from one or more BMP images."},{href:"/bentopdf/heic-to-pdf.html",name:"HEIC to PDF",icon:"ph-device-mobile",subtitle:"Create a PDF from one or more HEIC images."},{href:"/bentopdf/tiff-to-pdf.html",name:"TIFF to PDF",icon:"ph-image",subtitle:"Create a PDF from one or more TIFF images."},{href:"/bentopdf/txt-to-pdf.html",name:"Text to PDF",icon:"ph-text-t",subtitle:"Convert a plain text file into a PDF."},{href:"/bentopdf/markdown-to-pdf.html",name:"Markdown to PDF",icon:"ph-markdown-logo",subtitle:"Convert Markdown to PDF with live preview and syntax highlighting."},{href:"/bentopdf/json-to-pdf.html",name:"JSON to PDF",icon:"ph-file-code",subtitle:"Convert JSON files to PDF format."},{href:"/bentopdf/odt-to-pdf.html",name:"ODT to PDF",icon:"ph-file",subtitle:"Convert ODT (OpenDocument Text) files to PDF."},{href:"/bentopdf/csv-to-pdf.html",name:"CSV to PDF",icon:"ph-file-csv",subtitle:"Convert CSV (Comma-Separated Values) spreadsheets to PDF."},{href:"/bentopdf/rtf-to-pdf.html",name:"RTF to PDF",icon:"ph-file-text",subtitle:"Convert RTF (Rich Text Format) documents to PDF."},{href:"/bentopdf/word-to-pdf.html",name:"Word to PDF",icon:"ph-microsoft-word-logo",subtitle:"Convert Word documents (DOCX, DOC, ODT) to PDF."},{href:"/bentopdf/excel-to-pdf.html",name:"Excel to PDF",icon:"ph-microsoft-excel-logo",subtitle:"Convert Excel spreadsheets (XLSX, XLS, ODS) to PDF."},{href:"/bentopdf/powerpoint-to-pdf.html",name:"PowerPoint to PDF",icon:"ph-microsoft-powerpoint-logo",subtitle:"Convert PowerPoint presentations (PPTX, PPT, ODP) to PDF."},{href:"/bentopdf/xps-to-pdf.html",name:"XPS to PDF",icon:"ph-scan",subtitle:"Convert XPS/OXPS documents to PDF."},{href:"/bentopdf/mobi-to-pdf.html",name:"MOBI to PDF",icon:"ph-book-open-text",subtitle:"Convert MOBI e-books to PDF."},{href:"/bentopdf/epub-to-pdf.html",name:"EPUB to PDF",icon:"ph-book-open-text",subtitle:"Convert EPUB e-books to PDF."},{href:"/bentopdf/fb2-to-pdf.html",name:"FB2 to PDF",icon:"ph-book-bookmark",subtitle:"Convert FictionBook (FB2) e-books to PDF."},{href:"/bentopdf/cbz-to-pdf.html",name:"CBZ to PDF",icon:"ph-book-open",subtitle:"Convert comic book archives (CBZ/CBR) to PDF."},{href:"/bentopdf/wpd-to-pdf.html",name:"WPD to PDF",icon:"ph-file-text",subtitle:"Convert WordPerfect documents (WPD) to PDF."},{href:"/bentopdf/wps-to-pdf.html",name:"WPS to PDF",icon:"ph-file-text",subtitle:"Convert WPS Office documents to PDF."},{href:"/bentopdf/xml-to-pdf.html",name:"XML to PDF",icon:"ph-file-code",subtitle:"Convert XML documents to PDF."},{href:"/bentopdf/pages-to-pdf.html",name:"Pages to PDF",icon:"ph-file-text",subtitle:"Convert Apple Pages documents to PDF."},{href:"/bentopdf/odg-to-pdf.html",name:"ODG to PDF",icon:"ph-image",subtitle:"Convert OpenDocument Graphics (ODG) to PDF."},{href:"/bentopdf/ods-to-pdf.html",name:"ODS to PDF",icon:"ph-table",subtitle:"Convert OpenDocument Spreadsheet (ODS) to PDF."},{href:"/bentopdf/odp-to-pdf.html",name:"ODP to PDF",icon:"ph-presentation",subtitle:"Convert OpenDocument Presentation (ODP) to PDF."},{href:"/bentopdf/pub-to-pdf.html",name:"PUB to PDF",icon:"ph-book-open",subtitle:"Convert Microsoft Publisher (PUB) to PDF."},{href:"/bentopdf/vsd-to-pdf.html",name:"VSD to PDF",icon:"ph-git-branch",subtitle:"Convert Microsoft Visio (VSD, VSDX) to PDF."},{href:"/bentopdf/psd-to-pdf.html",name:"PSD to PDF",icon:"ph-image",subtitle:"Convert Adobe Photoshop (PSD) files to PDF. Multiple files supported."},{href:"/bentopdf/email-to-pdf.html",name:"Email to PDF",icon:"ph-envelope",subtitle:"Convert email files (EML, MSG) to PDF format."}]},{name:"Convert from PDF",tools:[{href:"/bentopdf/pdf-to-jpg.html",name:"PDF to JPG",icon:"ph-file-image",subtitle:"Convert each PDF page into a JPG image."},{href:"/bentopdf/pdf-to-png.html",name:"PDF to PNG",icon:"ph-file-image",subtitle:"Convert each PDF page into a PNG image."},{href:"/bentopdf/pdf-to-webp.html",name:"PDF to WebP",icon:"ph-file-image",subtitle:"Convert each PDF page into a WebP image."},{href:"/bentopdf/pdf-to-bmp.html",name:"PDF to BMP",icon:"ph-file-image",subtitle:"Convert each PDF page into a BMP image."},{href:"/bentopdf/pdf-to-tiff.html",name:"PDF to TIFF",icon:"ph-file-image",subtitle:"Convert each PDF page into a TIFF image."},{href:"/bentopdf/pdf-to-svg.html",name:"PDF to SVG",icon:"ph-file-code",subtitle:"Convert each PDF page into a scalable vector graphic."},{href:"/bentopdf/pdf-to-csv.html",name:"PDF to CSV",icon:"ph-file-csv",subtitle:"Extract tables from PDF and convert to CSV format."},{href:"/bentopdf/pdf-to-excel.html",name:"PDF to Excel",icon:"ph-microsoft-excel-logo",subtitle:"Extract tables from PDF and convert to Excel (XLSX)."},{href:"/bentopdf/pdf-to-greyscale.html",name:"PDF to Greyscale",icon:"ph-palette",subtitle:"Convert all colors to black and white."},{href:"/bentopdf/pdf-to-json.html",name:"PDF to JSON",icon:"ph-file-code",subtitle:"Convert PDF files to JSON format."},{href:"/bentopdf/pdf-to-docx.html",name:"PDF to Word",icon:"ph-microsoft-word-logo",subtitle:"Convert PDF files to editable Word documents."},{href:"/bentopdf/extract-images.html",name:"Extract Images",icon:"ph-download-simple",subtitle:"Extract all embedded images from your PDF files."},{href:"/bentopdf/pdf-to-markdown.html",name:"PDF to Markdown",icon:"ph-markdown-logo",subtitle:"Convert PDF text and tables to Markdown format."},{href:"/bentopdf/prepare-pdf-for-ai.html",name:"Prepare PDF for AI",icon:"ph-sparkle",subtitle:"Extract PDF content as LlamaIndex JSON for RAG/LLM pipelines."},{href:"/bentopdf/pdf-to-text.html",name:"PDF to Text",icon:"ph-text-aa",subtitle:"Extract text from PDF files and save as plain text (.txt)."}]},{name:"Organize & Manage",tools:[{href:"/bentopdf/ocr-pdf.html",name:"OCR PDF",icon:"ph-barcode",subtitle:"Make a PDF searchable and copyable."},{href:"/bentopdf/merge-pdf.html",name:"Merge PDF",icon:"ph-browsers",subtitle:"Combine multiple PDFs into one file."},{href:"/bentopdf/alternate-merge.html",name:"Alternate & Mix Pages",icon:"ph-shuffle",subtitle:"Merge PDFs by alternating pages from each PDF. Preserves Bookmarks"},{href:"/bentopdf/organize-pdf.html",name:"Organize & Duplicate",icon:"ph-files",subtitle:"Duplicate, reorder, and delete pages."},{href:"/bentopdf/add-attachments.html",name:"Add Attachments",icon:"ph-paperclip",subtitle:"Embed one or more files into your PDF."},{href:"/bentopdf/extract-attachments.html",name:"Extract Attachments",icon:"ph-download",subtitle:"Extract all embedded files from PDF(s) as a ZIP."},{href:"/bentopdf/edit-attachments.html",name:"Edit Attachments",icon:"ph-paperclip-horizontal",subtitle:"View or remove attachments in your PDF."},{href:"/bentopdf/pdf-multi-tool.html",name:"PDF Multi Tool",icon:"ph-pencil-ruler",subtitle:"Full-featured PDF editor with page management."},{href:"/bentopdf/pdf-layers.html",name:"PDF OCG",icon:"ph-stack-simple",subtitle:"View, toggle, add, and delete OCG layers in your PDF."},{href:"/bentopdf/extract-tables.html",name:"Extract Tables",icon:"ph-table",subtitle:"Extract tables from PDFs as CSV, JSON, or Markdown."},{href:"/bentopdf/split-pdf.html",name:"Split PDF",icon:"ph-scissors",subtitle:"Extract a range of pages into a new PDF."},{href:"/bentopdf/divide-pages.html",name:"Divide Pages",icon:"ph-columns",subtitle:"Divide pages horizontally or vertically."},{href:"/bentopdf/extract-pages.html",name:"Extract Pages",icon:"ph-squares-four",subtitle:"Save a selection of pages as new files."},{href:"/bentopdf/delete-pages.html",name:"Delete Pages",icon:"ph-trash",subtitle:"Remove specific pages from your document."},{href:"/bentopdf/add-blank-page.html",name:"Add Blank Page",icon:"ph-file-plus",subtitle:"Insert an empty page anywhere in your PDF."},{href:"/bentopdf/reverse-pages.html",name:"Reverse Pages",icon:"ph-sort-descending",subtitle:"Flip the order of all pages in your document."},{href:"/bentopdf/rotate-pdf.html",name:"Rotate PDF",icon:"ph-arrow-clockwise",subtitle:"Turn pages in 90-degree increments."},{href:"/bentopdf/rotate-custom.html",name:"Rotate by Custom Degrees",icon:"ph-arrows-clockwise",subtitle:"Rotate pages by any custom angle."},{href:"/bentopdf/n-up-pdf.html",name:"N-Up PDF",icon:"ph-squares-four",subtitle:"Arrange multiple pages onto a single sheet."},{href:"/bentopdf/pdf-booklet.html",name:"PDF Booklet",icon:"ph-book-open",subtitle:"Rearrange pages for double-sided booklet printing."},{href:"/bentopdf/combine-single-page.html",name:"Combine to Single Page",icon:"ph-arrows-out-line-vertical",subtitle:"Stitch all pages into one continuous scroll."},{href:"/bentopdf/view-metadata.html",name:"View Metadata",icon:"ph-info",subtitle:"Inspect the hidden properties of your PDF."},{href:"/bentopdf/edit-metadata.html",name:"Edit Metadata",icon:"ph-file-code",subtitle:"Change the author, title, and other properties."},{href:"/bentopdf/pdf-to-zip.html",name:"PDFs to ZIP",icon:"ph-file-zip",subtitle:"Package multiple PDF files into a ZIP archive."},{href:"/bentopdf/compare-pdfs.html",name:"Compare PDFs",icon:"ph-git-diff",subtitle:"Compare two PDFs side by side."},{href:"/bentopdf/posterize-pdf.html",name:"Posterize PDF",icon:"ph-notepad",subtitle:"Split a large page into multiple smaller pages."}]},{name:"Optimize & Repair",tools:[{href:"/bentopdf/compress-pdf.html",name:"Compress PDF",icon:"ph-lightning",subtitle:"Reduce the file size of your PDF."},{href:"/bentopdf/pdf-to-pdfa.html",name:"PDF to PDF/A",icon:"ph-archive",subtitle:"Convert PDF to PDF/A for long-term archiving."},{href:"/bentopdf/fix-page-size.html",name:"Fix Page Size",icon:"ph-ruler",subtitle:"Standardize all pages to a uniform size."},{href:"/bentopdf/linearize-pdf.html",name:"Linearize PDF",icon:"ph-gauge",subtitle:"Optimize PDF for fast web viewing."},{href:"/bentopdf/page-dimensions.html",name:"Page Dimensions",icon:"ph-ruler",subtitle:"Analyze page size, orientation, and units."},{href:"/bentopdf/remove-restrictions.html",name:"Remove Restrictions",icon:"ph-link-break",subtitle:"Remove password protection and security restrictions associated with digitally signed PDF files."},{href:"/bentopdf/repair-pdf.html",name:"Repair PDF",icon:"ph-wrench",subtitle:"Recover data from corrupted or damaged PDF files."},{href:"/bentopdf/rasterize-pdf.html",name:"Rasterize PDF",icon:"ph-image",subtitle:"Convert PDF to image-based PDF. Flatten layers and remove selectable text."},{href:"/bentopdf/deskew-pdf.html",name:"Deskew PDF",icon:"ph-perspective",subtitle:"Automatically straighten tilted scanned pages using OpenCV."},{href:"/bentopdf/font-to-outline.html",name:"Font to Outline",icon:"ph-text-outdent",subtitle:"Convert all fonts to vector outlines for consistent rendering."}]},{name:"Secure PDF",tools:[{href:"/bentopdf/encrypt-pdf.html",name:"Encrypt PDF",icon:"ph-lock",subtitle:"Lock your PDF by adding a password."},{href:"/bentopdf/sanitize-pdf.html",name:"Sanitize PDF",icon:"ph-broom",subtitle:"Remove metadata, annotations, scripts, and more."},{href:"/bentopdf/decrypt-pdf.html",name:"Decrypt PDF",icon:"ph-lock-open",subtitle:"Unlock PDF by removing password protection."},{href:"/bentopdf/flatten-pdf.html",name:"Flatten PDF",icon:"ph-stack",subtitle:"Make form fields and annotations non-editable."},{href:"/bentopdf/remove-metadata.html",name:"Remove Metadata",icon:"ph-file-x",subtitle:"Strip hidden data from your PDF."},{href:"/bentopdf/change-permissions.html",name:"Change Permissions",icon:"ph-shield-check",subtitle:"Set or change user permissions on a PDF."},{href:"/bentopdf/digital-sign-pdf.html",name:"Digital Signature",icon:"ph-certificate",subtitle:"Add a cryptographic digital signature using X.509 certificates."},{href:"/bentopdf/validate-signature-pdf.html",name:"Validate Signature",icon:"ph-seal-check",subtitle:"Verify digital signatures and view certificate details."}]}],Hn={activeTool:null,files:[],pdfDoc:null,pdfPages:[],currentPdfUrl:null};function fc(){Hn.activeTool=null,Hn.files=[],Hn.pdfDoc=null,Hn.pdfPages=[],Hn.currentPdfUrl=null,document.getElementById("tool-content").innerHTML=""}var np=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function pc(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}function gc(a){if(Object.prototype.hasOwnProperty.call(a,"__esModule"))return a;var t=a.default;if(typeof t=="function"){var e=function i(){var n=!1;try{n=this instanceof i}catch{}return n?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};e.prototype=t.prototype}else e={};return Object.defineProperty(e,"__esModule",{value:!0}),Object.keys(a).forEach(function(i){var n=Object.getOwnPropertyDescriptor(a,i);Object.defineProperty(e,i,n.get?n:{enumerable:!0,get:function(){return a[i]}})}),e}function mc(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}var Sl={exports:{}},ne=Sl.exports={},yi,wi;function so(){throw new Error("setTimeout has not been defined")}function ro(){throw new Error("clearTimeout has not been defined")}(function(){try{typeof setTimeout=="function"?yi=setTimeout:yi=so}catch{yi=so}try{typeof clearTimeout=="function"?wi=clearTimeout:wi=ro}catch{wi=ro}})();function xl(a){if(yi===setTimeout)return setTimeout(a,0);if((yi===so||!yi)&&setTimeout)return yi=setTimeout,setTimeout(a,0);try{return yi(a,0)}catch{try{return yi.call(null,a,0)}catch{return yi.call(this,a,0)}}}function bc(a){if(wi===clearTimeout)return clearTimeout(a);if((wi===ro||!wi)&&clearTimeout)return wi=clearTimeout,clearTimeout(a);try{return wi(a)}catch{try{return wi.call(null,a)}catch{return wi.call(this,a)}}}var Fi=[],Tn=!1,tn,Vs=-1;function yc(){!Tn||!tn||(Tn=!1,tn.length?Fi=tn.concat(Fi):Vs=-1,Fi.length&&Cl())}function Cl(){if(!Tn){var a=xl(yc);Tn=!0;for(var t=Fi.length;t;){for(tn=Fi,Fi=[];++Vs<t;)tn&&tn[Vs].run();Vs=-1,t=Fi.length}tn=null,Tn=!1,bc(a)}}ne.nextTick=function(a){var t=new Array(arguments.length-1);if(arguments.length>1)for(var e=1;e<arguments.length;e++)t[e-1]=arguments[e];Fi.push(new _l(a,t)),Fi.length===1&&!Tn&&xl(Cl)};function _l(a,t){this.fun=a,this.array=t}_l.prototype.run=function(){this.fun.apply(null,this.array)};ne.title="browser";ne.browser=!0;ne.env={};ne.argv=[];ne.version="";ne.versions={};function Li(){}ne.on=Li;ne.addListener=Li;ne.once=Li;ne.off=Li;ne.removeListener=Li;ne.removeAllListeners=Li;ne.emit=Li;ne.prependListener=Li;ne.prependOnceListener=Li;ne.listeners=function(a){return[]};ne.binding=function(a){throw new Error("process.binding is not supported")};ne.cwd=function(){return"/"};ne.chdir=function(a){throw new Error("process.chdir is not supported")};ne.umask=function(){return 0};var wc=Sl.exports;const Qt=mc(wc);var Pl={},fr={};fr.byteLength=Ec;fr.toByteArray=xc;fr.fromByteArray=Pc;var Ai=[],ei=[],vc=typeof Uint8Array<"u"?Uint8Array:Array,Lr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var pn=0,Ac=Lr.length;pn<Ac;++pn)Ai[pn]=Lr[pn],ei[Lr.charCodeAt(pn)]=pn;ei[45]=62;ei[95]=63;function Tl(a){var t=a.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var e=a.indexOf("=");e===-1&&(e=t);var i=e===t?0:4-e%4;return[e,i]}function Ec(a){var t=Tl(a),e=t[0],i=t[1];return(e+i)*3/4-i}function Sc(a,t,e){return(t+e)*3/4-e}function xc(a){var t,e=Tl(a),i=e[0],n=e[1],s=new vc(Sc(a,i,n)),r=0,o=n>0?i-4:i,l;for(l=0;l<o;l+=4)t=ei[a.charCodeAt(l)]<<18|ei[a.charCodeAt(l+1)]<<12|ei[a.charCodeAt(l+2)]<<6|ei[a.charCodeAt(l+3)],s[r++]=t>>16&255,s[r++]=t>>8&255,s[r++]=t&255;return n===2&&(t=ei[a.charCodeAt(l)]<<2|ei[a.charCodeAt(l+1)]>>4,s[r++]=t&255),n===1&&(t=ei[a.charCodeAt(l)]<<10|ei[a.charCodeAt(l+1)]<<4|ei[a.charCodeAt(l+2)]>>2,s[r++]=t>>8&255,s[r++]=t&255),s}function Cc(a){return Ai[a>>18&63]+Ai[a>>12&63]+Ai[a>>6&63]+Ai[a&63]}function _c(a,t,e){for(var i,n=[],s=t;s<e;s+=3)i=(a[s]<<16&16711680)+(a[s+1]<<8&65280)+(a[s+2]&255),n.push(Cc(i));return n.join("")}function Pc(a){for(var t,e=a.length,i=e%3,n=[],s=16383,r=0,o=e-i;r<o;r+=s)n.push(_c(a,r,r+s>o?o:r+s));return i===1?(t=a[e-1],n.push(Ai[t>>2]+Ai[t<<4&63]+"==")):i===2&&(t=(a[e-2]<<8)+a[e-1],n.push(Ai[t>>10]+Ai[t>>4&63]+Ai[t<<2&63]+"=")),n.join("")}var ko={};ko.read=function(a,t,e,i,n){var s,r,o=n*8-i-1,l=(1<<o)-1,h=l>>1,c=-7,u=e?n-1:0,p=e?-1:1,b=a[t+u];for(u+=p,s=b&(1<<-c)-1,b>>=-c,c+=o;c>0;s=s*256+a[t+u],u+=p,c-=8);for(r=s&(1<<-c)-1,s>>=-c,c+=i;c>0;r=r*256+a[t+u],u+=p,c-=8);if(s===0)s=1-h;else{if(s===l)return r?NaN:(b?-1:1)*(1/0);r=r+Math.pow(2,i),s=s-h}return(b?-1:1)*r*Math.pow(2,s-i)};ko.write=function(a,t,e,i,n,s){var r,o,l,h=s*8-n-1,c=(1<<h)-1,u=c>>1,p=n===23?Math.pow(2,-24)-Math.pow(2,-77):0,b=i?0:s-1,w=i?1:-1,v=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(o=isNaN(t)?1:0,r=c):(r=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-r))<1&&(r--,l*=2),r+u>=1?t+=p/l:t+=p*Math.pow(2,1-u),t*l>=2&&(r++,l/=2),r+u>=c?(o=0,r=c):r+u>=1?(o=(t*l-1)*Math.pow(2,n),r=r+u):(o=t*Math.pow(2,u-1)*Math.pow(2,n),r=0));n>=8;a[e+b]=o&255,b+=w,o/=256,n-=8);for(r=r<<n|o,h+=n;h>0;a[e+b]=r&255,b+=w,r/=256,h-=8);a[e+b-w]|=v*128};(function(a){const t=fr,e=ko,i=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;a.Buffer=c,a.SlowBuffer=F,a.INSPECT_MAX_BYTES=50;const n=2147483647;a.kMaxLength=n;const{Uint8Array:s,ArrayBuffer:r,SharedArrayBuffer:o}=globalThis;c.TYPED_ARRAY_SUPPORT=l(),!c.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function l(){try{const S=new s(1),g={foo:function(){return 42}};return Object.setPrototypeOf(g,s.prototype),Object.setPrototypeOf(S,g),S.foo()===42}catch{return!1}}Object.defineProperty(c.prototype,"parent",{enumerable:!0,get:function(){if(c.isBuffer(this))return this.buffer}}),Object.defineProperty(c.prototype,"offset",{enumerable:!0,get:function(){if(c.isBuffer(this))return this.byteOffset}});function h(S){if(S>n)throw new RangeError('The value "'+S+'" is invalid for option "size"');const g=new s(S);return Object.setPrototypeOf(g,c.prototype),g}function c(S,g,m){if(typeof S=="number"){if(typeof g=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return w(S)}return u(S,g,m)}c.poolSize=8192;function u(S,g,m){if(typeof S=="string")return v(S,g);if(r.isView(S))return E(S);if(S==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof S);if(Je(S,r)||S&&Je(S.buffer,r)||typeof o<"u"&&(Je(S,o)||S&&Je(S.buffer,o)))return D(S,g,m);if(typeof S=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const P=S.valueOf&&S.valueOf();if(P!=null&&P!==S)return c.from(P,g,m);const I=T(S);if(I)return I;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof S[Symbol.toPrimitive]=="function")return c.from(S[Symbol.toPrimitive]("string"),g,m);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof S)}c.from=function(S,g,m){return u(S,g,m)},Object.setPrototypeOf(c.prototype,s.prototype),Object.setPrototypeOf(c,s);function p(S){if(typeof S!="number")throw new TypeError('"size" argument must be of type number');if(S<0)throw new RangeError('The value "'+S+'" is invalid for option "size"')}function b(S,g,m){return p(S),S<=0?h(S):g!==void 0?typeof m=="string"?h(S).fill(g,m):h(S).fill(g):h(S)}c.alloc=function(S,g,m){return b(S,g,m)};function w(S){return p(S),h(S<0?0:k(S)|0)}c.allocUnsafe=function(S){return w(S)},c.allocUnsafeSlow=function(S){return w(S)};function v(S,g){if((typeof g!="string"||g==="")&&(g="utf8"),!c.isEncoding(g))throw new TypeError("Unknown encoding: "+g);const m=M(S,g)|0;let P=h(m);const I=P.write(S,g);return I!==m&&(P=P.slice(0,I)),P}function x(S){const g=S.length<0?0:k(S.length)|0,m=h(g);for(let P=0;P<g;P+=1)m[P]=S[P]&255;return m}function E(S){if(Je(S,s)){const g=new s(S);return D(g.buffer,g.byteOffset,g.byteLength)}return x(S)}function D(S,g,m){if(g<0||S.byteLength<g)throw new RangeError('"offset" is outside of buffer bounds');if(S.byteLength<g+(m||0))throw new RangeError('"length" is outside of buffer bounds');let P;return g===void 0&&m===void 0?P=new s(S):m===void 0?P=new s(S,g):P=new s(S,g,m),Object.setPrototypeOf(P,c.prototype),P}function T(S){if(c.isBuffer(S)){const g=k(S.length)|0,m=h(g);return m.length===0||S.copy(m,0,0,g),m}if(S.length!==void 0)return typeof S.length!="number"||_i(S.length)?h(0):x(S);if(S.type==="Buffer"&&Array.isArray(S.data))return x(S.data)}function k(S){if(S>=n)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+n.toString(16)+" bytes");return S|0}function F(S){return+S!=S&&(S=0),c.alloc(+S)}c.isBuffer=function(g){return g!=null&&g._isBuffer===!0&&g!==c.prototype},c.compare=function(g,m){if(Je(g,s)&&(g=c.from(g,g.offset,g.byteLength)),Je(m,s)&&(m=c.from(m,m.offset,m.byteLength)),!c.isBuffer(g)||!c.isBuffer(m))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(g===m)return 0;let P=g.length,I=m.length;for(let B=0,j=Math.min(P,I);B<j;++B)if(g[B]!==m[B]){P=g[B],I=m[B];break}return P<I?-1:I<P?1:0},c.isEncoding=function(g){switch(String(g).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},c.concat=function(g,m){if(!Array.isArray(g))throw new TypeError('"list" argument must be an Array of Buffers');if(g.length===0)return c.alloc(0);let P;if(m===void 0)for(m=0,P=0;P<g.length;++P)m+=g[P].length;const I=c.allocUnsafe(m);let B=0;for(P=0;P<g.length;++P){let j=g[P];if(Je(j,s))B+j.length>I.length?(c.isBuffer(j)||(j=c.from(j)),j.copy(I,B)):s.prototype.set.call(I,j,B);else if(c.isBuffer(j))j.copy(I,B);else throw new TypeError('"list" argument must be an Array of Buffers');B+=j.length}return I};function M(S,g){if(c.isBuffer(S))return S.length;if(r.isView(S)||Je(S,r))return S.byteLength;if(typeof S!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof S);const m=S.length,P=arguments.length>2&&arguments[2]===!0;if(!P&&m===0)return 0;let I=!1;for(;;)switch(g){case"ascii":case"latin1":case"binary":return m;case"utf8":case"utf-8":return De(S).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return m*2;case"hex":return m>>>1;case"base64":return Yi(S).length;default:if(I)return P?-1:De(S).length;g=(""+g).toLowerCase(),I=!0}}c.byteLength=M;function O(S,g,m){let P=!1;if((g===void 0||g<0)&&(g=0),g>this.length||((m===void 0||m>this.length)&&(m=this.length),m<=0)||(m>>>=0,g>>>=0,m<=g))return"";for(S||(S="utf8");;)switch(S){case"hex":return ot(this,g,m);case"utf8":case"utf-8":return W(this,g,m);case"ascii":return Ft(this,g,m);case"latin1":case"binary":return it(this,g,m);case"base64":return G(this,g,m);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return mt(this,g,m);default:if(P)throw new TypeError("Unknown encoding: "+S);S=(S+"").toLowerCase(),P=!0}}c.prototype._isBuffer=!0;function N(S,g,m){const P=S[g];S[g]=S[m],S[m]=P}c.prototype.swap16=function(){const g=this.length;if(g%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let m=0;m<g;m+=2)N(this,m,m+1);return this},c.prototype.swap32=function(){const g=this.length;if(g%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let m=0;m<g;m+=4)N(this,m,m+3),N(this,m+1,m+2);return this},c.prototype.swap64=function(){const g=this.length;if(g%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let m=0;m<g;m+=8)N(this,m,m+7),N(this,m+1,m+6),N(this,m+2,m+5),N(this,m+3,m+4);return this},c.prototype.toString=function(){const g=this.length;return g===0?"":arguments.length===0?W(this,0,g):O.apply(this,arguments)},c.prototype.toLocaleString=c.prototype.toString,c.prototype.equals=function(g){if(!c.isBuffer(g))throw new TypeError("Argument must be a Buffer");return this===g?!0:c.compare(this,g)===0},c.prototype.inspect=function(){let g="";const m=a.INSPECT_MAX_BYTES;return g=this.toString("hex",0,m).replace(/(.{2})/g,"$1 ").trim(),this.length>m&&(g+=" ... "),"<Buffer "+g+">"},i&&(c.prototype[i]=c.prototype.inspect),c.prototype.compare=function(g,m,P,I,B){if(Je(g,s)&&(g=c.from(g,g.offset,g.byteLength)),!c.isBuffer(g))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof g);if(m===void 0&&(m=0),P===void 0&&(P=g?g.length:0),I===void 0&&(I=0),B===void 0&&(B=this.length),m<0||P>g.length||I<0||B>this.length)throw new RangeError("out of range index");if(I>=B&&m>=P)return 0;if(I>=B)return-1;if(m>=P)return 1;if(m>>>=0,P>>>=0,I>>>=0,B>>>=0,this===g)return 0;let j=B-I,wt=P-m;const Ut=Math.min(j,wt),Ot=this.slice(I,B),Nt=g.slice(m,P);for(let K=0;K<Ut;++K)if(Ot[K]!==Nt[K]){j=Ot[K],wt=Nt[K];break}return j<wt?-1:wt<j?1:0};function R(S,g,m,P,I){if(S.length===0)return-1;if(typeof m=="string"?(P=m,m=0):m>2147483647?m=2147483647:m<-2147483648&&(m=-2147483648),m=+m,_i(m)&&(m=I?0:S.length-1),m<0&&(m=S.length+m),m>=S.length){if(I)return-1;m=S.length-1}else if(m<0)if(I)m=0;else return-1;if(typeof g=="string"&&(g=c.from(g,P)),c.isBuffer(g))return g.length===0?-1:$(S,g,m,P,I);if(typeof g=="number")return g=g&255,typeof s.prototype.indexOf=="function"?I?s.prototype.indexOf.call(S,g,m):s.prototype.lastIndexOf.call(S,g,m):$(S,[g],m,P,I);throw new TypeError("val must be string, number or Buffer")}function $(S,g,m,P,I){let B=1,j=S.length,wt=g.length;if(P!==void 0&&(P=String(P).toLowerCase(),P==="ucs2"||P==="ucs-2"||P==="utf16le"||P==="utf-16le")){if(S.length<2||g.length<2)return-1;B=2,j/=2,wt/=2,m/=2}function Ut(Nt,K){return B===1?Nt[K]:Nt.readUInt16BE(K*B)}let Ot;if(I){let Nt=-1;for(Ot=m;Ot<j;Ot++)if(Ut(S,Ot)===Ut(g,Nt===-1?0:Ot-Nt)){if(Nt===-1&&(Nt=Ot),Ot-Nt+1===wt)return Nt*B}else Nt!==-1&&(Ot-=Ot-Nt),Nt=-1}else for(m+wt>j&&(m=j-wt),Ot=m;Ot>=0;Ot--){let Nt=!0;for(let K=0;K<wt;K++)if(Ut(S,Ot+K)!==Ut(g,K)){Nt=!1;break}if(Nt)return Ot}return-1}c.prototype.includes=function(g,m,P){return this.indexOf(g,m,P)!==-1},c.prototype.indexOf=function(g,m,P){return R(this,g,m,P,!0)},c.prototype.lastIndexOf=function(g,m,P){return R(this,g,m,P,!1)};function U(S,g,m,P){m=Number(m)||0;const I=S.length-m;P?(P=Number(P),P>I&&(P=I)):P=I;const B=g.length;P>B/2&&(P=B/2);let j;for(j=0;j<P;++j){const wt=parseInt(g.substr(j*2,2),16);if(_i(wt))return j;S[m+j]=wt}return j}function Q(S,g,m,P){return Ke(De(g,S.length-m),S,m,P)}function V(S,g,m,P){return Ke(dn(g),S,m,P)}function z(S,g,m,P){return Ke(Yi(g),S,m,P)}function st(S,g,m,P){return Ke(ri(g,S.length-m),S,m,P)}c.prototype.write=function(g,m,P,I){if(m===void 0)I="utf8",P=this.length,m=0;else if(P===void 0&&typeof m=="string")I=m,P=this.length,m=0;else if(isFinite(m))m=m>>>0,isFinite(P)?(P=P>>>0,I===void 0&&(I="utf8")):(I=P,P=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const B=this.length-m;if((P===void 0||P>B)&&(P=B),g.length>0&&(P<0||m<0)||m>this.length)throw new RangeError("Attempt to write outside buffer bounds");I||(I="utf8");let j=!1;for(;;)switch(I){case"hex":return U(this,g,m,P);case"utf8":case"utf-8":return Q(this,g,m,P);case"ascii":case"latin1":case"binary":return V(this,g,m,P);case"base64":return z(this,g,m,P);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return st(this,g,m,P);default:if(j)throw new TypeError("Unknown encoding: "+I);I=(""+I).toLowerCase(),j=!0}},c.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function G(S,g,m){return g===0&&m===S.length?t.fromByteArray(S):t.fromByteArray(S.slice(g,m))}function W(S,g,m){m=Math.min(S.length,m);const P=[];let I=g;for(;I<m;){const B=S[I];let j=null,wt=B>239?4:B>223?3:B>191?2:1;if(I+wt<=m){let Ut,Ot,Nt,K;switch(wt){case 1:B<128&&(j=B);break;case 2:Ut=S[I+1],(Ut&192)===128&&(K=(B&31)<<6|Ut&63,K>127&&(j=K));break;case 3:Ut=S[I+1],Ot=S[I+2],(Ut&192)===128&&(Ot&192)===128&&(K=(B&15)<<12|(Ut&63)<<6|Ot&63,K>2047&&(K<55296||K>57343)&&(j=K));break;case 4:Ut=S[I+1],Ot=S[I+2],Nt=S[I+3],(Ut&192)===128&&(Ot&192)===128&&(Nt&192)===128&&(K=(B&15)<<18|(Ut&63)<<12|(Ot&63)<<6|Nt&63,K>65535&&K<1114112&&(j=K))}}j===null?(j=65533,wt=1):j>65535&&(j-=65536,P.push(j>>>10&1023|55296),j=56320|j&1023),P.push(j),I+=wt}return xt(P)}const Z=4096;function xt(S){const g=S.length;if(g<=Z)return String.fromCharCode.apply(String,S);let m="",P=0;for(;P<g;)m+=String.fromCharCode.apply(String,S.slice(P,P+=Z));return m}function Ft(S,g,m){let P="";m=Math.min(S.length,m);for(let I=g;I<m;++I)P+=String.fromCharCode(S[I]&127);return P}function it(S,g,m){let P="";m=Math.min(S.length,m);for(let I=g;I<m;++I)P+=String.fromCharCode(S[I]);return P}function ot(S,g,m){const P=S.length;(!g||g<0)&&(g=0),(!m||m<0||m>P)&&(m=P);let I="";for(let B=g;B<m;++B)I+=Sr[S[B]];return I}function mt(S,g,m){const P=S.slice(g,m);let I="";for(let B=0;B<P.length-1;B+=2)I+=String.fromCharCode(P[B]+P[B+1]*256);return I}c.prototype.slice=function(g,m){const P=this.length;g=~~g,m=m===void 0?P:~~m,g<0?(g+=P,g<0&&(g=0)):g>P&&(g=P),m<0?(m+=P,m<0&&(m=0)):m>P&&(m=P),m<g&&(m=g);const I=this.subarray(g,m);return Object.setPrototypeOf(I,c.prototype),I};function dt(S,g,m){if(S%1!==0||S<0)throw new RangeError("offset is not uint");if(S+g>m)throw new RangeError("Trying to access beyond buffer length")}c.prototype.readUintLE=c.prototype.readUIntLE=function(g,m,P){g=g>>>0,m=m>>>0,P||dt(g,m,this.length);let I=this[g],B=1,j=0;for(;++j<m&&(B*=256);)I+=this[g+j]*B;return I},c.prototype.readUintBE=c.prototype.readUIntBE=function(g,m,P){g=g>>>0,m=m>>>0,P||dt(g,m,this.length);let I=this[g+--m],B=1;for(;m>0&&(B*=256);)I+=this[g+--m]*B;return I},c.prototype.readUint8=c.prototype.readUInt8=function(g,m){return g=g>>>0,m||dt(g,1,this.length),this[g]},c.prototype.readUint16LE=c.prototype.readUInt16LE=function(g,m){return g=g>>>0,m||dt(g,2,this.length),this[g]|this[g+1]<<8},c.prototype.readUint16BE=c.prototype.readUInt16BE=function(g,m){return g=g>>>0,m||dt(g,2,this.length),this[g]<<8|this[g+1]},c.prototype.readUint32LE=c.prototype.readUInt32LE=function(g,m){return g=g>>>0,m||dt(g,4,this.length),(this[g]|this[g+1]<<8|this[g+2]<<16)+this[g+3]*16777216},c.prototype.readUint32BE=c.prototype.readUInt32BE=function(g,m){return g=g>>>0,m||dt(g,4,this.length),this[g]*16777216+(this[g+1]<<16|this[g+2]<<8|this[g+3])},c.prototype.readBigUInt64LE=oi(function(g){g=g>>>0,me(g,"offset");const m=this[g],P=this[g+7];(m===void 0||P===void 0)&&be(g,this.length-8);const I=m+this[++g]*2**8+this[++g]*2**16+this[++g]*2**24,B=this[++g]+this[++g]*2**8+this[++g]*2**16+P*2**24;return BigInt(I)+(BigInt(B)<<BigInt(32))}),c.prototype.readBigUInt64BE=oi(function(g){g=g>>>0,me(g,"offset");const m=this[g],P=this[g+7];(m===void 0||P===void 0)&&be(g,this.length-8);const I=m*2**24+this[++g]*2**16+this[++g]*2**8+this[++g],B=this[++g]*2**24+this[++g]*2**16+this[++g]*2**8+P;return(BigInt(I)<<BigInt(32))+BigInt(B)}),c.prototype.readIntLE=function(g,m,P){g=g>>>0,m=m>>>0,P||dt(g,m,this.length);let I=this[g],B=1,j=0;for(;++j<m&&(B*=256);)I+=this[g+j]*B;return B*=128,I>=B&&(I-=Math.pow(2,8*m)),I},c.prototype.readIntBE=function(g,m,P){g=g>>>0,m=m>>>0,P||dt(g,m,this.length);let I=m,B=1,j=this[g+--I];for(;I>0&&(B*=256);)j+=this[g+--I]*B;return B*=128,j>=B&&(j-=Math.pow(2,8*m)),j},c.prototype.readInt8=function(g,m){return g=g>>>0,m||dt(g,1,this.length),this[g]&128?(255-this[g]+1)*-1:this[g]},c.prototype.readInt16LE=function(g,m){g=g>>>0,m||dt(g,2,this.length);const P=this[g]|this[g+1]<<8;return P&32768?P|4294901760:P},c.prototype.readInt16BE=function(g,m){g=g>>>0,m||dt(g,2,this.length);const P=this[g+1]|this[g]<<8;return P&32768?P|4294901760:P},c.prototype.readInt32LE=function(g,m){return g=g>>>0,m||dt(g,4,this.length),this[g]|this[g+1]<<8|this[g+2]<<16|this[g+3]<<24},c.prototype.readInt32BE=function(g,m){return g=g>>>0,m||dt(g,4,this.length),this[g]<<24|this[g+1]<<16|this[g+2]<<8|this[g+3]},c.prototype.readBigInt64LE=oi(function(g){g=g>>>0,me(g,"offset");const m=this[g],P=this[g+7];(m===void 0||P===void 0)&&be(g,this.length-8);const I=this[g+4]+this[g+5]*2**8+this[g+6]*2**16+(P<<24);return(BigInt(I)<<BigInt(32))+BigInt(m+this[++g]*2**8+this[++g]*2**16+this[++g]*2**24)}),c.prototype.readBigInt64BE=oi(function(g){g=g>>>0,me(g,"offset");const m=this[g],P=this[g+7];(m===void 0||P===void 0)&&be(g,this.length-8);const I=(m<<24)+this[++g]*2**16+this[++g]*2**8+this[++g];return(BigInt(I)<<BigInt(32))+BigInt(this[++g]*2**24+this[++g]*2**16+this[++g]*2**8+P)}),c.prototype.readFloatLE=function(g,m){return g=g>>>0,m||dt(g,4,this.length),e.read(this,g,!0,23,4)},c.prototype.readFloatBE=function(g,m){return g=g>>>0,m||dt(g,4,this.length),e.read(this,g,!1,23,4)},c.prototype.readDoubleLE=function(g,m){return g=g>>>0,m||dt(g,8,this.length),e.read(this,g,!0,52,8)},c.prototype.readDoubleBE=function(g,m){return g=g>>>0,m||dt(g,8,this.length),e.read(this,g,!1,52,8)};function Ct(S,g,m,P,I,B){if(!c.isBuffer(S))throw new TypeError('"buffer" argument must be a Buffer instance');if(g>I||g<B)throw new RangeError('"value" argument is out of bounds');if(m+P>S.length)throw new RangeError("Index out of range")}c.prototype.writeUintLE=c.prototype.writeUIntLE=function(g,m,P,I){if(g=+g,m=m>>>0,P=P>>>0,!I){const wt=Math.pow(2,8*P)-1;Ct(this,g,m,P,wt,0)}let B=1,j=0;for(this[m]=g&255;++j<P&&(B*=256);)this[m+j]=g/B&255;return m+P},c.prototype.writeUintBE=c.prototype.writeUIntBE=function(g,m,P,I){if(g=+g,m=m>>>0,P=P>>>0,!I){const wt=Math.pow(2,8*P)-1;Ct(this,g,m,P,wt,0)}let B=P-1,j=1;for(this[m+B]=g&255;--B>=0&&(j*=256);)this[m+B]=g/j&255;return m+P},c.prototype.writeUint8=c.prototype.writeUInt8=function(g,m,P){return g=+g,m=m>>>0,P||Ct(this,g,m,1,255,0),this[m]=g&255,m+1},c.prototype.writeUint16LE=c.prototype.writeUInt16LE=function(g,m,P){return g=+g,m=m>>>0,P||Ct(this,g,m,2,65535,0),this[m]=g&255,this[m+1]=g>>>8,m+2},c.prototype.writeUint16BE=c.prototype.writeUInt16BE=function(g,m,P){return g=+g,m=m>>>0,P||Ct(this,g,m,2,65535,0),this[m]=g>>>8,this[m+1]=g&255,m+2},c.prototype.writeUint32LE=c.prototype.writeUInt32LE=function(g,m,P){return g=+g,m=m>>>0,P||Ct(this,g,m,4,4294967295,0),this[m+3]=g>>>24,this[m+2]=g>>>16,this[m+1]=g>>>8,this[m]=g&255,m+4},c.prototype.writeUint32BE=c.prototype.writeUInt32BE=function(g,m,P){return g=+g,m=m>>>0,P||Ct(this,g,m,4,4294967295,0),this[m]=g>>>24,this[m+1]=g>>>16,this[m+2]=g>>>8,this[m+3]=g&255,m+4};function yt(S,g,m,P,I){di(g,P,I,S,m,7);let B=Number(g&BigInt(4294967295));S[m++]=B,B=B>>8,S[m++]=B,B=B>>8,S[m++]=B,B=B>>8,S[m++]=B;let j=Number(g>>BigInt(32)&BigInt(4294967295));return S[m++]=j,j=j>>8,S[m++]=j,j=j>>8,S[m++]=j,j=j>>8,S[m++]=j,m}function Pt(S,g,m,P,I){di(g,P,I,S,m,7);let B=Number(g&BigInt(4294967295));S[m+7]=B,B=B>>8,S[m+6]=B,B=B>>8,S[m+5]=B,B=B>>8,S[m+4]=B;let j=Number(g>>BigInt(32)&BigInt(4294967295));return S[m+3]=j,j=j>>8,S[m+2]=j,j=j>>8,S[m+1]=j,j=j>>8,S[m]=j,m+8}c.prototype.writeBigUInt64LE=oi(function(g,m=0){return yt(this,g,m,BigInt(0),BigInt("0xffffffffffffffff"))}),c.prototype.writeBigUInt64BE=oi(function(g,m=0){return Pt(this,g,m,BigInt(0),BigInt("0xffffffffffffffff"))}),c.prototype.writeIntLE=function(g,m,P,I){if(g=+g,m=m>>>0,!I){const Ut=Math.pow(2,8*P-1);Ct(this,g,m,P,Ut-1,-Ut)}let B=0,j=1,wt=0;for(this[m]=g&255;++B<P&&(j*=256);)g<0&&wt===0&&this[m+B-1]!==0&&(wt=1),this[m+B]=(g/j>>0)-wt&255;return m+P},c.prototype.writeIntBE=function(g,m,P,I){if(g=+g,m=m>>>0,!I){const Ut=Math.pow(2,8*P-1);Ct(this,g,m,P,Ut-1,-Ut)}let B=P-1,j=1,wt=0;for(this[m+B]=g&255;--B>=0&&(j*=256);)g<0&&wt===0&&this[m+B+1]!==0&&(wt=1),this[m+B]=(g/j>>0)-wt&255;return m+P},c.prototype.writeInt8=function(g,m,P){return g=+g,m=m>>>0,P||Ct(this,g,m,1,127,-128),g<0&&(g=255+g+1),this[m]=g&255,m+1},c.prototype.writeInt16LE=function(g,m,P){return g=+g,m=m>>>0,P||Ct(this,g,m,2,32767,-32768),this[m]=g&255,this[m+1]=g>>>8,m+2},c.prototype.writeInt16BE=function(g,m,P){return g=+g,m=m>>>0,P||Ct(this,g,m,2,32767,-32768),this[m]=g>>>8,this[m+1]=g&255,m+2},c.prototype.writeInt32LE=function(g,m,P){return g=+g,m=m>>>0,P||Ct(this,g,m,4,2147483647,-2147483648),this[m]=g&255,this[m+1]=g>>>8,this[m+2]=g>>>16,this[m+3]=g>>>24,m+4},c.prototype.writeInt32BE=function(g,m,P){return g=+g,m=m>>>0,P||Ct(this,g,m,4,2147483647,-2147483648),g<0&&(g=4294967295+g+1),this[m]=g>>>24,this[m+1]=g>>>16,this[m+2]=g>>>8,this[m+3]=g&255,m+4},c.prototype.writeBigInt64LE=oi(function(g,m=0){return yt(this,g,m,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),c.prototype.writeBigInt64BE=oi(function(g,m=0){return Pt(this,g,m,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function _t(S,g,m,P,I,B){if(m+P>S.length)throw new RangeError("Index out of range");if(m<0)throw new RangeError("Index out of range")}function se(S,g,m,P,I){return g=+g,m=m>>>0,I||_t(S,g,m,4),e.write(S,g,m,P,23,4),m+4}c.prototype.writeFloatLE=function(g,m,P){return se(this,g,m,!0,P)},c.prototype.writeFloatBE=function(g,m,P){return se(this,g,m,!1,P)};function je(S,g,m,P,I){return g=+g,m=m>>>0,I||_t(S,g,m,8),e.write(S,g,m,P,52,8),m+8}c.prototype.writeDoubleLE=function(g,m,P){return je(this,g,m,!0,P)},c.prototype.writeDoubleBE=function(g,m,P){return je(this,g,m,!1,P)},c.prototype.copy=function(g,m,P,I){if(!c.isBuffer(g))throw new TypeError("argument should be a Buffer");if(P||(P=0),!I&&I!==0&&(I=this.length),m>=g.length&&(m=g.length),m||(m=0),I>0&&I<P&&(I=P),I===P||g.length===0||this.length===0)return 0;if(m<0)throw new RangeError("targetStart out of bounds");if(P<0||P>=this.length)throw new RangeError("Index out of range");if(I<0)throw new RangeError("sourceEnd out of bounds");I>this.length&&(I=this.length),g.length-m<I-P&&(I=g.length-m+P);const B=I-P;return this===g&&typeof s.prototype.copyWithin=="function"?this.copyWithin(m,P,I):s.prototype.set.call(g,this.subarray(P,I),m),B},c.prototype.fill=function(g,m,P,I){if(typeof g=="string"){if(typeof m=="string"?(I=m,m=0,P=this.length):typeof P=="string"&&(I=P,P=this.length),I!==void 0&&typeof I!="string")throw new TypeError("encoding must be a string");if(typeof I=="string"&&!c.isEncoding(I))throw new TypeError("Unknown encoding: "+I);if(g.length===1){const j=g.charCodeAt(0);(I==="utf8"&&j<128||I==="latin1")&&(g=j)}}else typeof g=="number"?g=g&255:typeof g=="boolean"&&(g=Number(g));if(m<0||this.length<m||this.length<P)throw new RangeError("Out of range index");if(P<=m)return this;m=m>>>0,P=P===void 0?this.length:P>>>0,g||(g=0);let B;if(typeof g=="number")for(B=m;B<P;++B)this[B]=g;else{const j=c.isBuffer(g)?g:c.from(g,I),wt=j.length;if(wt===0)throw new TypeError('The value "'+g+'" is invalid for argument "value"');for(B=0;B<P-m;++B)this[B+m]=j[B%wt]}return this};const Se={};function ze(S,g,m){Se[S]=class extends m{constructor(){super(),Object.defineProperty(this,"message",{value:g.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${S}]`,this.stack,delete this.name}get code(){return S}set code(I){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:I,writable:!0})}toString(){return`${this.name} [${S}]: ${this.message}`}}}ze("ERR_BUFFER_OUT_OF_BOUNDS",function(S){return S?`${S} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),ze("ERR_INVALID_ARG_TYPE",function(S,g){return`The "${S}" argument must be of type number. Received type ${typeof g}`},TypeError),ze("ERR_OUT_OF_RANGE",function(S,g,m){let P=`The value of "${S}" is out of range.`,I=m;return Number.isInteger(m)&&Math.abs(m)>2**32?I=Te(String(m)):typeof m=="bigint"&&(I=String(m),(m>BigInt(2)**BigInt(32)||m<-(BigInt(2)**BigInt(32)))&&(I=Te(I)),I+="n"),P+=` It must be ${g}. Received ${I}`,P},RangeError);function Te(S){let g="",m=S.length;const P=S[0]==="-"?1:0;for(;m>=P+4;m-=3)g=`_${S.slice(m-3,m)}${g}`;return`${S.slice(0,m)}${g}`}function qt(S,g,m){me(g,"offset"),(S[g]===void 0||S[g+m]===void 0)&&be(g,S.length-(m+1))}function di(S,g,m,P,I,B){if(S>m||S<g){const j=typeof g=="bigint"?"n":"";let wt;throw g===0||g===BigInt(0)?wt=`>= 0${j} and < 2${j} ** ${(B+1)*8}${j}`:wt=`>= -(2${j} ** ${(B+1)*8-1}${j}) and < 2 ** ${(B+1)*8-1}${j}`,new Se.ERR_OUT_OF_RANGE("value",wt,S)}qt(P,I,B)}function me(S,g){if(typeof S!="number")throw new Se.ERR_INVALID_ARG_TYPE(g,"number",S)}function be(S,g,m){throw Math.floor(S)!==S?(me(S,m),new Se.ERR_OUT_OF_RANGE("offset","an integer",S)):g<0?new Se.ERR_BUFFER_OUT_OF_BOUNDS:new Se.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${g}`,S)}const Xi=/[^+/0-9A-Za-z-_]/g;function Oi(S){if(S=S.split("=")[0],S=S.trim().replace(Xi,""),S.length<2)return"";for(;S.length%4!==0;)S=S+"=";return S}function De(S,g){g=g||1/0;let m;const P=S.length;let I=null;const B=[];for(let j=0;j<P;++j){if(m=S.charCodeAt(j),m>55295&&m<57344){if(!I){if(m>56319){(g-=3)>-1&&B.push(239,191,189);continue}else if(j+1===P){(g-=3)>-1&&B.push(239,191,189);continue}I=m;continue}if(m<56320){(g-=3)>-1&&B.push(239,191,189),I=m;continue}m=(I-55296<<10|m-56320)+65536}else I&&(g-=3)>-1&&B.push(239,191,189);if(I=null,m<128){if((g-=1)<0)break;B.push(m)}else if(m<2048){if((g-=2)<0)break;B.push(m>>6|192,m&63|128)}else if(m<65536){if((g-=3)<0)break;B.push(m>>12|224,m>>6&63|128,m&63|128)}else if(m<1114112){if((g-=4)<0)break;B.push(m>>18|240,m>>12&63|128,m>>6&63|128,m&63|128)}else throw new Error("Invalid code point")}return B}function dn(S){const g=[];for(let m=0;m<S.length;++m)g.push(S.charCodeAt(m)&255);return g}function ri(S,g){let m,P,I;const B=[];for(let j=0;j<S.length&&!((g-=2)<0);++j)m=S.charCodeAt(j),P=m>>8,I=m%256,B.push(I),B.push(P);return B}function Yi(S){return t.toByteArray(Oi(S))}function Ke(S,g,m,P){let I;for(I=0;I<P&&!(I+m>=g.length||I>=S.length);++I)g[I+m]=S[I];return I}function Je(S,g){return S instanceof g||S!=null&&S.constructor!=null&&S.constructor.name!=null&&S.constructor.name===g.name}function _i(S){return S!==S}const Sr=(function(){const S="0123456789abcdef",g=new Array(256);for(let m=0;m<16;++m){const P=m*16;for(let I=0;I<16;++I)g[P+I]=S[m]+S[I]}return g})();function oi(S){return typeof BigInt>"u"?un:S}function un(){throw new Error("BigInt not supported")}})(Pl);const oo=Pl.Buffer;var Rr={exports:{}};const Tc={},Dc=Object.freeze(Object.defineProperty({__proto__:null,default:Tc},Symbol.toStringTag,{value:"Module"})),ya=gc(Dc);var wa;function kc(){return wa||(wa=1,(function(a,t){var e=(()=>{var i=typeof document<"u"?document.currentScript?.src:void 0;return typeof __filename<"u"&&(i=i||__filename),(function(n={}){var s,r=n,o,l,h=new Promise((d,f)=>{o=d,l=f}),c=typeof window=="object",u=typeof WorkerGlobalScope<"u",p=typeof Qt=="object"&&typeof Qt.versions=="object"&&typeof Qt.versions.node=="string"&&Qt.type!="renderer";r.noInitialRun=!0;var b=Object.assign({},r),w=[],v="./this.program",x=(d,f)=>{throw f},E="",D,T;if(p){var k=ya;E=__dirname+"/",T=d=>(d=yt(d)?new URL(d):d,k.readFileSync(d)),D=async d=>(d=yt(d)?new URL(d):d,k.readFileSync(d,void 0)),!r.thisProgram&&1<Qt.argv.length&&(v=Qt.argv[1].replace(/\\/g,"/")),w=Qt.argv.slice(2),x=(d,f)=>{throw Qt.exitCode=d,f}}else(c||u)&&(u?E=self.location.href:typeof document<"u"&&document.currentScript&&(E=document.currentScript.src),i&&(E=i),E.startsWith("blob:")?E="":E=E.substr(0,E.replace(/[?#].*/,"").lastIndexOf("/")+1),u&&(T=d=>{var f=new XMLHttpRequest;return f.open("GET",d,!1),f.responseType="arraybuffer",f.send(null),new Uint8Array(f.response)}),D=async d=>{if(yt(d))return new Promise((y,A)=>{var C=new XMLHttpRequest;C.open("GET",d,!0),C.responseType="arraybuffer",C.onload=()=>{C.status==200||C.status==0&&C.response?y(C.response):A(C.status)},C.onerror=A,C.send(null)});var f=await fetch(d,{credentials:"same-origin"});if(f.ok)return f.arrayBuffer();throw Error(f.status+" : "+f.url)});var F=console.log.bind(console),M=console.error.bind(console);Object.assign(r,b),b=null;var O,N=!1,R,$,U,Q,V,z,st;function G(){var d=O.buffer;r.HEAP8=$=new Int8Array(d),r.HEAP16=Q=new Int16Array(d),r.HEAPU8=U=new Uint8Array(d),r.HEAPU16=new Uint16Array(d),r.HEAP32=V=new Int32Array(d),r.HEAPU32=z=new Uint32Array(d),r.HEAPF32=new Float32Array(d),r.HEAPF64=new Float64Array(d),r.HEAP64=st=new BigInt64Array(d),r.HEAPU64=new BigUint64Array(d)}var W=[],Z=[],xt=[],Ft=[],it=0,ot=null;function mt(){if(it--,it==0&&ot){var d=ot;ot=null,d()}}function dt(d){throw d="Aborted("+d+")",M(d),N=!0,d=new WebAssembly.RuntimeError(d+". Build with -sASSERTIONS for more info."),l(d),d}var Ct=d=>d.startsWith("data:application/octet-stream;base64,"),yt=d=>d.startsWith("file://"),Pt;async function _t(d){try{var f=await D(d);return new Uint8Array(f)}catch{}if(T)d=T(d);else throw"both async and sync fetching of the wasm failed";return d}async function se(d,f){try{var y=await _t(d);return await WebAssembly.instantiate(y,f)}catch(A){M(`failed to asynchronously prepare wasm: ${A}`),dt(A)}}async function je(d){var f=Pt;if(!(typeof WebAssembly.instantiateStreaming!="function"||Ct(f)||yt(f)||p)&&typeof fetch=="function")try{var y=fetch(f,{credentials:"same-origin"});return await WebAssembly.instantiateStreaming(y,d)}catch(A){M(`wasm streaming compile failed: ${A}`),M("falling back to ArrayBuffer instantiation")}return se(f,d)}class Se{name="ExitStatus";constructor(f){this.message=`Program terminated with exit(${f})`,this.status=f}}var ze=d=>{for(;0<d.length;)d.shift()(r)},Te=typeof TextDecoder<"u"?new TextDecoder:void 0,qt=(d,f=0)=>{for(var y=f+NaN,A=f;d[A]&&!(A>=y);)++A;if(16<A-f&&d.buffer&&Te)return Te.decode(d.subarray(f,A));for(y="";f<A;){var C=d[f++];if(C&128){var L=d[f++]&63;if((C&224)==192)y+=String.fromCharCode((C&31)<<6|L);else{var H=d[f++]&63;C=(C&240)==224?(C&15)<<12|L<<6|H:(C&7)<<18|L<<12|H<<6|d[f++]&63,65536>C?y+=String.fromCharCode(C):(C-=65536,y+=String.fromCharCode(55296|C>>10,56320|C&1023))}}else y+=String.fromCharCode(C)}return y},di=[],me=0,be=0;class Xi{constructor(f){this.nb=f,this.wa=f-24}Pa(f,y){z[this.wa+16>>2]=0,z[this.wa+4>>2]=f,z[this.wa+8>>2]=y}}var Oi=d=>{var f=be;if(!f)return $n(0),0;var y=new Xi(f);z[y.wa+16>>2]=f;var A=z[y.wa+4>>2];if(!A)return $n(0),f;for(var C of d){if(C===0||C===A)break;if(da(C,A,y.wa+16))return $n(C),f}return $n(A),f},De=()=>{var d=V[+Bn>>2];return Bn+=4,d},dn=(d,f)=>{for(var y=0,A=d.length-1;0<=A;A--){var C=d[A];C==="."?d.splice(A,1):C===".."?(d.splice(A,1),y++):y&&(d.splice(A,1),y--)}if(f)for(;y;y--)d.unshift("..");return d},ri=d=>{var f=d.charAt(0)==="/",y=d.substr(-1)==="/";return(d=dn(d.split("/").filter(A=>!!A),!f).join("/"))||f||(d="."),d&&y&&(d+="/"),(f?"/":"")+d},Yi=d=>{var f=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/.exec(d).slice(1);return d=f[0],f=f[1],!d&&!f?".":(f&&=f.substr(0,f.length-1),d+f)},Ke=d=>{if(d==="/")return"/";d=ri(d),d=d.replace(/\/$/,"");var f=d.lastIndexOf("/");return f===-1?d:d.substr(f+1)},Je=(...d)=>ri(d.join("/")),_i=(d,f)=>ri(d+"/"+f),Sr=()=>{if(typeof crypto=="object"&&typeof crypto.getRandomValues=="function")return y=>crypto.getRandomValues(y);if(p)try{var d=ya;if(d.randomFillSync)return y=>d.randomFillSync(y);var f=d.randomBytes;return y=>(y.set(f(y.byteLength)),y)}catch{}dt("initRandomDevice")},oi=d=>(oi=Sr())(d),un=(...d)=>{for(var f="",y=!1,A=d.length-1;-1<=A&&!y;A--){if(y=0<=A?d[A]:_.cwd(),typeof y!="string")throw new TypeError("Arguments to path.resolve must be strings");if(!y)return"";f=y+"/"+f,y=y.charAt(0)==="/"}return f=dn(f.split("/").filter(C=>!!C),!y).join("/"),(y?"/":"")+f||"."},S=(d,f)=>{function y(H){for(var q=0;q<H.length&&H[q]==="";q++);for(var et=H.length-1;0<=et&&H[et]==="";et--);return q>et?[]:H.slice(q,et-q+1)}d=un(d).substr(1),f=un(f).substr(1),d=y(d.split("/")),f=y(f.split("/"));for(var A=Math.min(d.length,f.length),C=A,L=0;L<A;L++)if(d[L]!==f[L]){C=L;break}for(A=[],L=C;L<d.length;L++)A.push("..");return A=A.concat(f.slice(C)),A.join("/")},g=[],m=d=>{for(var f=0,y=0;y<d.length;++y){var A=d.charCodeAt(y);127>=A?f++:2047>=A?f+=2:55296<=A&&57343>=A?(f+=4,++y):f+=3}return f},P=(d,f,y,A)=>{if(!(0<A))return 0;var C=y;A=y+A-1;for(var L=0;L<d.length;++L){var H=d.charCodeAt(L);if(55296<=H&&57343>=H){var q=d.charCodeAt(++L);H=65536+((H&1023)<<10)|q&1023}if(127>=H){if(y>=A)break;f[y++]=H}else{if(2047>=H){if(y+1>=A)break;f[y++]=192|H>>6}else{if(65535>=H){if(y+2>=A)break;f[y++]=224|H>>12}else{if(y+3>=A)break;f[y++]=240|H>>18,f[y++]=128|H>>12&63}f[y++]=128|H>>6&63}f[y++]=128|H&63}}return f[y]=0,y-C};function I(d){var f=Array(m(d)+1);return d=P(d,f,0,f.length),f.length=d,f}var B=[];function j(d,f){B[d]={input:[],output:[],Ea:f},Cr(d,wt)}var wt={open(d){var f=B[d.node.rdev];if(!f)throw new _.oa(43);d.tty=f,d.seekable=!1},close(d){d.tty.Ea.fsync(d.tty)},fsync(d){d.tty.Ea.fsync(d.tty)},read(d,f,y,A){if(!d.tty||!d.tty.Ea.pb)throw new _.oa(60);for(var C=0,L=0;L<A;L++){try{var H=d.tty.Ea.pb(d.tty)}catch{throw new _.oa(29)}if(H===void 0&&C===0)throw new _.oa(6);if(H==null)break;C++,f[y+L]=H}return C&&(d.node.atime=Date.now()),C},write(d,f,y,A){if(!d.tty||!d.tty.Ea.eb)throw new _.oa(60);try{for(var C=0;C<A;C++)d.tty.Ea.eb(d.tty,f[y+C])}catch{throw new _.oa(29)}return A&&(d.node.mtime=d.node.ctime=Date.now()),C}},Ut={pb(){t:{if(!g.length){var d=null;if(p){var f=oo.alloc(256),y=0,A=Qt.stdin.fd;try{y=k.readSync(A,f,0,256)}catch(C){if(C.toString().includes("EOF"))y=0;else throw C}0<y&&(d=f.slice(0,y).toString("utf-8"))}else typeof window<"u"&&typeof window.prompt=="function"&&(d=window.prompt("Input: "),d!==null&&(d+=`
`));if(!d){d=null;break t}g=I(d)}d=g.shift()}return d},eb(d,f){f===null||f===10?(F(qt(d.output)),d.output=[]):f!=0&&d.output.push(f)},fsync(d){d.output&&0<d.output.length&&(F(qt(d.output)),d.output=[])},Lb(){return{Yb:25856,$b:5,Xb:191,Zb:35387,Wb:[3,28,127,21,4,0,1,0,17,19,26,0,18,15,23,22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}},Mb(){return 0},Nb(){return[24,80]}},Ot={eb(d,f){f===null||f===10?(M(qt(d.output)),d.output=[]):f!=0&&d.output.push(f)},fsync(d){d.output&&0<d.output.length&&(M(qt(d.output)),d.output=[])}};function Nt(d,f){var y=d.ra?d.ra.length:0;y>=f||(f=Math.max(f,y*(1048576>y?2:1.125)>>>0),y!=0&&(f=Math.max(f,256)),y=d.ra,d.ra=new Uint8Array(f),0<d.ta&&d.ra.set(y.subarray(0,d.ta),0))}var K={Da:null,sa(){return K.createNode(null,"/",16895,0)},createNode(d,f,y,A){if((y&61440)===24576||_.isFIFO(y))throw new _.oa(63);return K.Da||(K.Da={dir:{node:{ya:K.pa.ya,ua:K.pa.ua,lookup:K.pa.lookup,Aa:K.pa.Aa,rename:K.pa.rename,unlink:K.pa.unlink,rmdir:K.pa.rmdir,readdir:K.pa.readdir,symlink:K.pa.symlink},stream:{va:K.qa.va}},file:{node:{ya:K.pa.ya,ua:K.pa.ua},stream:{va:K.qa.va,read:K.qa.read,write:K.qa.write,Oa:K.qa.Oa,Ia:K.qa.Ia,La:K.qa.La}},link:{node:{ya:K.pa.ya,ua:K.pa.ua,readlink:K.pa.readlink},stream:{}},jb:{node:{ya:K.pa.ya,ua:K.pa.ua},stream:_.Db}}),y=_.createNode(d,f,y,A),ce(y.mode)?(y.pa=K.Da.dir.node,y.qa=K.Da.dir.stream,y.ra={}):_.isFile(y.mode)?(y.pa=K.Da.file.node,y.qa=K.Da.file.stream,y.ta=0,y.ra=null):(y.mode&61440)===40960?(y.pa=K.Da.link.node,y.qa=K.Da.link.stream):(y.mode&61440)===8192&&(y.pa=K.Da.jb.node,y.qa=K.Da.jb.stream),y.atime=y.mtime=y.ctime=Date.now(),d&&(d.ra[f]=y,d.atime=d.mtime=d.ctime=y.atime),y},hc(d){return d.ra?d.ra.subarray?d.ra.subarray(0,d.ta):new Uint8Array(d.ra):new Uint8Array(0)},pa:{ya(d){var f={};return f.dev=(d.mode&61440)===8192?d.id:1,f.ino=d.id,f.mode=d.mode,f.nlink=1,f.uid=0,f.gid=0,f.rdev=d.rdev,ce(d.mode)?f.size=4096:_.isFile(d.mode)?f.size=d.ta:(d.mode&61440)===40960?f.size=d.link.length:f.size=0,f.atime=new Date(d.atime),f.mtime=new Date(d.mtime),f.ctime=new Date(d.ctime),f.Fa=4096,f.blocks=Math.ceil(f.size/f.Fa),f},ua(d,f){for(var y of["mode","atime","mtime","ctime"])f[y]&&(d[y]=f[y]);f.size!==void 0&&(f=f.size,d.ta!=f&&(f==0?(d.ra=null,d.ta=0):(y=d.ra,d.ra=new Uint8Array(f),y&&d.ra.set(y.subarray(0,Math.min(f,d.ta))),d.ta=f)))},lookup(){throw K.mb},Aa(d,f,y,A){return K.createNode(d,f,y,A)},rename(d,f,y){try{var A=Pi(f,y)}catch{}if(A){if(ce(d.mode))for(var C in A.ra)throw new _.oa(55);Nn(A)}delete d.parent.ra[d.name],f.ra[y]=d,d.name=y,f.ctime=f.mtime=d.parent.ctime=d.parent.mtime=Date.now()},unlink(d,f){delete d.ra[f],d.ctime=d.mtime=Date.now()},rmdir(d,f){var y=Pi(d,f),A;for(A in y.ra)throw new _.oa(55);delete d.ra[f],d.ctime=d.mtime=Date.now()},readdir(d){return[".","..",...Object.keys(d.ra)]},symlink(d,f,y){return d=K.createNode(d,f,41471,0),d.link=y,d},readlink(d){if((d.mode&61440)!==40960)throw new _.oa(28);return d.link}},qa:{read(d,f,y,A,C){var L=d.node.ra;if(C>=d.node.ta)return 0;if(d=Math.min(d.node.ta-C,A),8<d&&L.subarray)f.set(L.subarray(C,C+d),y);else for(A=0;A<d;A++)f[y+A]=L[C+A];return d},write(d,f,y,A,C,L){if(f.buffer===$.buffer&&(L=!1),!A)return 0;if(d=d.node,d.mtime=d.ctime=Date.now(),f.subarray&&(!d.ra||d.ra.subarray)){if(L)return d.ra=f.subarray(y,y+A),d.ta=A;if(d.ta===0&&C===0)return d.ra=f.slice(y,y+A),d.ta=A;if(C+A<=d.ta)return d.ra.set(f.subarray(y,y+A),C),A}if(Nt(d,C+A),d.ra.subarray&&f.subarray)d.ra.set(f.subarray(y,y+A),C);else for(L=0;L<A;L++)d.ra[C+L]=f[y+L];return d.ta=Math.max(d.ta,C+A),A},va(d,f,y){if(y===1?f+=d.position:y===2&&_.isFile(d.node.mode)&&(f+=d.node.ta),0>f)throw new _.oa(28);return f},Oa(d,f,y){Nt(d.node,f+y),d.node.ta=Math.max(d.node.ta,f+y)},Ia(d,f,y,A,C){if(!_.isFile(d.node.mode))throw new _.oa(43);if(d=d.node.ra,C&2||!d||d.buffer!==$.buffer){if(A=!0,dt(),C=void 0,!C)throw new _.oa(48);d&&((0<y||y+f<d.length)&&(d.subarray?d=d.subarray(y,y+f):d=Array.prototype.slice.call(d,y,y+f)),$.set(d,C))}else A=!1,C=d.byteOffset;return{wa:C,Ab:A}},La(d,f,y,A){return K.qa.write(d,f,0,A,y,!1),0}}},Ih=async d=>(d=await D(d),new Uint8Array(d)),Lh=[],Rh=(d,f,y,A)=>{typeof Browser<"u"&&Browser.Pa();var C=!1;return Lh.forEach(L=>{!C&&L.canHandle(f)&&(L.handle(d,f,y,A),C=!0)}),C},xr=(d,f)=>{var y=0;return d&&(y|=365),f&&(y|=146),y},Oh={EPERM:63,ENOENT:44,ESRCH:71,EINTR:27,EIO:29,ENXIO:60,E2BIG:1,ENOEXEC:45,EBADF:8,ECHILD:12,EAGAIN:6,EWOULDBLOCK:6,ENOMEM:48,EACCES:2,EFAULT:21,ENOTBLK:105,EBUSY:10,EEXIST:20,EXDEV:75,ENODEV:43,ENOTDIR:54,EISDIR:31,EINVAL:28,ENFILE:41,EMFILE:33,ENOTTY:59,ETXTBSY:74,EFBIG:22,ENOSPC:51,ESPIPE:70,EROFS:69,EMLINK:34,EPIPE:64,EDOM:18,ERANGE:68,ENOMSG:49,EIDRM:24,ECHRNG:106,EL2NSYNC:156,EL3HLT:107,EL3RST:108,ELNRNG:109,EUNATCH:110,ENOCSI:111,EL2HLT:112,EDEADLK:16,ENOLCK:46,EBADE:113,EBADR:114,EXFULL:115,ENOANO:104,EBADRQC:103,EBADSLT:102,EDEADLOCK:16,EBFONT:101,ENOSTR:100,ENODATA:116,ETIME:117,ENOSR:118,ENONET:119,ENOPKG:120,EREMOTE:121,ENOLINK:47,EADV:122,ESRMNT:123,ECOMM:124,EPROTO:65,EMULTIHOP:36,EDOTDOT:125,EBADMSG:9,ENOTUNIQ:126,EBADFD:127,EREMCHG:128,ELIBACC:129,ELIBBAD:130,ELIBSCN:131,ELIBMAX:132,ELIBEXEC:133,ENOSYS:52,ENOTEMPTY:55,ENAMETOOLONG:37,ELOOP:32,EOPNOTSUPP:138,EPFNOSUPPORT:139,ECONNRESET:15,ENOBUFS:42,EAFNOSUPPORT:5,EPROTOTYPE:67,ENOTSOCK:57,ENOPROTOOPT:50,ESHUTDOWN:140,ECONNREFUSED:14,EADDRINUSE:3,ECONNABORTED:13,ENETUNREACH:40,ENETDOWN:38,ETIMEDOUT:73,EHOSTDOWN:142,EHOSTUNREACH:23,EINPROGRESS:26,EALREADY:7,EDESTADDRREQ:17,EMSGSIZE:35,EPROTONOSUPPORT:66,ESOCKTNOSUPPORT:137,EADDRNOTAVAIL:4,ENETRESET:39,EISCONN:30,ENOTCONN:53,ETOOMANYREFS:141,EUSERS:136,EDQUOT:19,ESTALE:72,ENOTSUP:138,ENOMEDIUM:148,EILSEQ:25,EOVERFLOW:61,ECANCELED:11,ENOTRECOVERABLE:56,EOWNERDEAD:62,ESTRPIPE:135};function xe(d){try{return d()}catch(f){throw f.code?f.code==="UNKNOWN"?new _.oa(28):new _.oa(Oh[f.code]):f}}function Qo(d){return xe(()=>{var f=k.lstatSync(d).mode;return ye.Ta&&(f|=(f&292)>>2),f})}function Qe(d){for(var f=[];d.parent!==d;)f.push(d.name),d=d.parent;return f.push(d.sa.Ma.root),f.reverse(),Je(...f)}var ye={Ta:!1,ib(){ye.Ta=!!Qt.platform.match(/^win/);var d=Qt.binding("constants");d.fs&&(d=d.fs),ye.ob={1024:d.O_APPEND,64:d.O_CREAT,128:d.O_EXCL,256:d.O_NOCTTY,0:d.O_RDONLY,2:d.O_RDWR,4096:d.O_SYNC,512:d.O_TRUNC,1:d.O_WRONLY,131072:d.O_NOFOLLOW}},sa(d){return ye.createNode(null,"/",Qo(d.Ma.root),0)},createNode(d,f,y){if(!ce(y)&&!_.isFile(y)&&(y&61440)!==40960)throw new _.oa(28);return d=_.createNode(d,f,y),d.pa=ye.pa,d.qa=ye.qa,d},pa:{ya(d){var f=Qe(d),y;return xe(()=>y=k.lstatSync(f)),ye.Ta&&(y.Fa||(y.Fa=4096),y.blocks||(y.blocks=(y.size+y.Fa-1)/y.Fa|0),y.mode|=(y.mode&292)>>2),{dev:y.dev,ino:y.ino,mode:y.mode,nlink:y.nlink,uid:y.uid,gid:y.gid,rdev:y.rdev,size:y.size,atime:y.atime,mtime:y.mtime,ctime:y.ctime,Fa:y.Fa,blocks:y.blocks}},ua(d,f){var y=Qe(d);xe(()=>{if(f.mode!==void 0){var A=f.mode;ye.Ta&&(A&=384),k.chmodSync(y,A),d.mode=f.mode}f.size!==void 0&&k.truncateSync(y,f.size)})},lookup(d,f){var y=Qe(d);return y=ri(y+"/"+f),y=Qo(y),ye.createNode(d,f,y)},Aa(d,f,y,A){var C=ye.createNode(d,f,y,A),L=Qe(C);return xe(()=>{ce(C.mode)?k.mkdirSync(L,C.mode):k.writeFileSync(L,"",{mode:C.mode})}),C},rename(d,f,y){var A=Qe(d),C=_i(Qe(f),y);try{_.unlink(C)}catch{}xe(()=>k.renameSync(A,C)),d.name=y},unlink(d,f){var y=_i(Qe(d),f);xe(()=>k.unlinkSync(y))},rmdir(d,f){var y=_i(Qe(d),f);xe(()=>k.rmdirSync(y))},readdir(d){var f=Qe(d);return xe(()=>k.readdirSync(f))},symlink(d,f,y){var A=_i(Qe(d),f);xe(()=>k.symlinkSync(y,A))},readlink(d){var f=Qe(d);return xe(()=>k.readlinkSync(f))},hb(d){var f=xe(()=>k.mc(d));return f.Ib=f.Bb,f}},qa:{open(d){var f=Qe(d.node);xe(()=>{if(_.isFile(d.node.mode)){d.Ka.tb=1;var y=k,A=y.openSync,C=d.flags;C&=-2721793;var L=0,H;for(H in ye.ob)C&H&&(L|=ye.ob[H],C^=H);if(C)throw new _.oa(28);d.Ra=A.call(y,f,L)}})},close(d){xe(()=>{_.isFile(d.node.mode)&&d.Ra&&--d.Ka.tb===0&&k.closeSync(d.Ra)})},Fb(d){d.Ka.tb++},read(d,f,y,A,C){return A===0?0:xe(()=>k.readSync(d.Ra,new Int8Array(f.buffer,y,A),0,A,C))},write(d,f,y,A,C){return xe(()=>k.writeSync(d.Ra,new Int8Array(f.buffer,y,A),0,A,C))},va(d,f,y){var A=f;if(y===1?A+=d.position:y===2&&_.isFile(d.node.mode)&&xe(()=>{A+=k.fstatSync(d.Ra).size}),0>A)throw new _.oa(28);return A},Ia(d,f,y){if(!_.isFile(d.node.mode))throw new _.oa(43);return dt(),ye.qa.read(d,$,void 0,f,y),{wa:void 0,Ab:!0}},La(d,f,y,A){return ye.qa.write(d,f,0,A,y,!1),0}}},re={Wa:16895,Na:33279,gb:null,sa(d){function f(L){L=L.split("/");for(var H=A,q=0;q<L.length-1;q++){var et=L.slice(0,q+1).join("/");let rt,bt;(rt=C)[bt=et]||(rt[bt]=re.createNode(H,L[q],re.Wa,0)),H=C[et]}return H}function y(L){return L=L.split("/"),L[L.length-1]}u||dt(),re.gb??(re.gb=new FileReaderSync);var A=re.createNode(null,"/",re.Wa,0),C={};return Array.prototype.forEach.call(d.Ma.files||[],function(L){re.createNode(f(L.name),y(L.name),re.Na,0,L,L.lastModifiedDate)}),(d.Ma.blobs||[]).forEach(L=>{re.createNode(f(L.name),y(L.name),re.Na,0,L.data)}),(d.Ma.packages||[]).forEach(L=>{L.metadata.files.forEach(H=>{var q=H.filename.substr(1);re.createNode(f(q),y(q),re.Na,0,L.blob.slice(H.start,H.end))})}),A},createNode(d,f,y,A,C,L){return A=_.createNode(d,f,y),A.mode=y,A.pa=re.pa,A.qa=re.qa,A.atime=A.mtime=A.ctime=(L||new Date).getTime(),re.Na!==re.Wa||dt(),y===re.Na?(A.size=C.size,A.ra=C):(A.size=4096,A.ra={}),d&&(d.ra[f]=A),A},pa:{ya(d){return{dev:1,ino:d.id,mode:d.mode,nlink:1,uid:0,gid:0,rdev:0,size:d.size,atime:new Date(d.atime),mtime:new Date(d.mtime),ctime:new Date(d.ctime),Fa:4096,blocks:Math.ceil(d.size/4096)}},ua(d,f){for(const y of["mode","atime","mtime","ctime"])f[y]&&(d[y]=f[y])},lookup(){throw new _.oa(44)},Aa(){throw new _.oa(63)},rename(){throw new _.oa(63)},unlink(){throw new _.oa(63)},rmdir(){throw new _.oa(63)},readdir(d){var f=[".",".."],y;for(y of Object.keys(d.ra))f.push(y);return f},symlink(){throw new _.oa(63)}},qa:{read(d,f,y,A,C){return C>=d.node.size?0:(d=d.node.ra.slice(C,C+A),A=re.gb.readAsArrayBuffer(d),f.set(new Uint8Array(A),y),d.size)},write(){throw new _.oa(29)},va(d,f,y){if(y===1?f+=d.position:y===2&&_.isFile(d.node.mode)&&(f+=d.node.size),0>f)throw new _.oa(28);return f}}};function Cr(d,f){_.lb[d]={qa:f}}function ce(d){return(d&61440)===16384}function Pi(d,f){var y=ce(d.mode)?(y=Ki(d,"x"))?y:d.pa.lookup?0:2:54;if(y)throw new _.oa(y);for(y=_.Ca[_r(d.id,f)];y;y=y.Ja){var A=y.name;if(y.parent.id===d.id&&A===f)return y}return _.lookup(d,f)}function Nn(d){var f=_r(d.parent.id,d.name);if(_.Ca[f]===d)_.Ca[f]=d.Ja;else for(f=_.Ca[f];f;){if(f.Ja===d){f.Ja=d.Ja;break}f=f.Ja}}function te(d,f={}){if(!d)return{path:"",node:null};f.Sa??(f.Sa=!0),d.charAt(0)==="/"||(d=_.cwd()+"/"+d);var y=0;t:for(;40>y;y++){d=d.split("/").filter(q=>!!q&&q!==".");for(var A=_.root,C="/",L=0;L<d.length;L++){var H=L===d.length-1;if(H&&f.parent)break;if(d[L]==="..")C=Yi(C),A=A.parent;else{C=ri(C+"/"+d[L]);try{A=Pi(A,d[L])}catch(q){if(q?.xa===44&&H&&f.Qb)return{path:C};throw q}if(!A.Ba||H&&!f.Sa||(A=A.Ba.root),(A.mode&61440)===40960&&(!H||f.za)){if(!A.pa.readlink)throw new _.oa(52);A=A.pa.readlink(A),A.charAt(0)==="/"||(A=Yi(C)+"/"+A),d=A+"/"+d.slice(L+1).join("/");continue t}}}return{path:C,node:A}}throw new _.oa(32)}function fn(d){for(var f;;){if(_.qb(d))return d=d.sa.rb,f?d[d.length-1]!=="/"?`${d}/${f}`:d+f:d;f=f?`${d.name}/${f}`:d.name,d=d.parent}}function _r(d,f){for(var y=0,A=0;A<f.length;A++)y=(y<<5)-y+f.charCodeAt(A)|0;return(d+y>>>0)%_.Ca.length}function Zo(d){var f=_r(d.parent.id,d.name);d.Ja=_.Ca[f],_.Ca[f]=d}function ta(d){var f=["r","w","rw"][d&3];return d&512&&(f+="w"),f}function Ki(d,f){if(_.Ya)return 0;if(!f.includes("r")||d.mode&292){if(f.includes("w")&&!(d.mode&146)||f.includes("x")&&!(d.mode&73))return 2}else return 2;return 0}function Pr(d,f){if(!ce(d.mode))return 54;try{return Pi(d,f),20}catch{}return Ki(d,"wx")}function Cs(d,f,y){try{var A=Pi(d,f)}catch(C){return C.xa}if(d=Ki(d,"wx"))return d;if(y){if(!ce(A.mode))return 54;if(_.qb(A)||fn(A)===_.cwd())return 10}else if(ce(A.mode))return 31;return 0}function ai(d){if(d=_.Kb(d),!d)throw new _.oa(8);return d}function ea(d,f=-1){if(d=Object.assign(new _.yb,d),f==-1)t:{for(f=0;f<=_.zb;f++)if(!_.streams[f])break t;throw new _.oa(33)}return d.fd=f,_.streams[f]=d}function Nh(d,f=-1){return d=ea(d,f),d.qa?.Fb?.(d),d}function ia(d){var f=[];for(d=[d];d.length;){var y=d.pop();f.push(y),d.push(...y.Qa)}return f}function _s(d,f,y){return typeof y>"u"&&(y=f,f=438),_.Aa(d,f|8192,y)}function Bh(){_.mkdir("/dev"),Cr(_.Ha(1,3),{read:()=>0,write:(A,C,L,H)=>H,va:()=>0}),_s("/dev/null",_.Ha(1,3)),j(_.Ha(5,0),Ut),j(_.Ha(6,0),Ot),_s("/dev/tty",_.Ha(5,0)),_s("/dev/tty1",_.Ha(6,0));var d=new Uint8Array(1024),f=0,y=()=>(f===0&&(f=oi(d).byteLength),d[--f]);_.Ga("/dev","random",y),_.Ga("/dev","urandom",y),_.mkdir("/dev/shm"),_.mkdir("/dev/shm/tmp")}function Uh(){_.mkdir("/proc");var d=_.mkdir("/proc/self");_.mkdir("/proc/self/fd"),_.sa({sa(){var f=_.createNode(d,"fd",16895,73);return f.qa={va:K.qa.va},f.pa={lookup(y,A){y=+A;var C=ai(y);return y={parent:null,sa:{rb:"fake"},pa:{readlink:()=>C.path},id:y+1},y.parent=y},readdir(){return Array.from(_.streams.entries()).filter(([,y])=>y).map(([y])=>y.toString())}},f}},{},"/proc/self/fd")}function $h(d,f,y,A){return d=typeof d=="string"?d:fn(d),f=ri(d+"/"+f),_.create(f,xr(y,A))}function Tr(d){if(!(d.Ob||d.Pb||d.link||d.ra)){if(typeof XMLHttpRequest<"u")throw Error("Lazy loading should have been performed (contents set) in createLazyFile, but it was not. Lazy loading only works in web workers. Use --embed-file or --preload-file in emcc on the main thread.");try{d.ra=T(d.url),d.ta=d.ra.length}catch{throw new _.oa(29)}}}var _={root:null,Qa:[],lb:{},streams:[],bb:1,Ca:null,kb:"/",Za:!1,Ya:!0,oa:class{name="ErrnoError";constructor(d){this.xa=d}},Hb:null,Va:0,yb:class{Ka={};node=null;get object(){return this.node}set object(d){this.node=d}get flags(){return this.Ka.flags}set flags(d){this.Ka.flags=d}get position(){return this.Ka.position}set position(d){this.Ka.position=d}},xb:class{pa={};qa={};Ba=null;constructor(d,f,y,A){d||=this,this.parent=d,this.sa=d.sa,this.id=_.bb++,this.name=f,this.mode=y,this.rdev=A,this.atime=this.mtime=this.ctime=Date.now()}get read(){return(this.mode&365)===365}set read(d){d?this.mode|=365:this.mode&=-366}get write(){return(this.mode&146)===146}set write(d){d?this.mode|=146:this.mode&=-147}get Pb(){return ce(this.mode)}get Ob(){return(this.mode&61440)===8192}},createNode(d,f,y,A){return d=new _.xb(d,f,y,A),Zo(d),d},qb(d){return d===d.parent},isFile(d){return(d&61440)===32768},isFIFO(d){return(d&61440)===4096},isSocket(d){return(d&49152)===49152},zb:4096,Kb:d=>_.streams[d],Db:{open(d){d.qa=_.Jb(d.node.rdev).qa,d.qa.open?.(d)},va(){throw new _.oa(70)}},ab:d=>d>>8,ic:d=>d&255,Ha:(d,f)=>d<<8|f,Jb:d=>_.lb[d],vb(d,f){function y(H){return _.Va--,f(H)}function A(H){if(H){if(!A.Gb)return A.Gb=!0,y(H)}else++L>=C.length&&y(null)}typeof d=="function"&&(f=d,d=!1),_.Va++,1<_.Va&&M(`warning: ${_.Va} FS.syncfs operations in flight at once, probably just doing extra work`);var C=ia(_.root.sa),L=0;C.forEach(H=>{if(!H.type.vb)return A(null);H.type.vb(H,d,A)})},sa(d,f,y){var A=y==="/";if(A&&_.root)throw new _.oa(10);if(!A&&y){var C=te(y,{Sa:!1});if(y=C.path,C=C.node,C.Ba)throw new _.oa(10);if(!ce(C.mode))throw new _.oa(54)}return f={type:d,Ma:f,rb:y,Qa:[]},d=d.sa(f),d.sa=f,f.root=d,A?_.root=d:C&&(C.Ba=f,C.sa&&C.sa.Qa.push(f)),d},Tb(d){if(d=te(d,{Sa:!1}),!d.node.Ba)throw new _.oa(28);d=d.node;var f=d.Ba,y=ia(f);Object.keys(_.Ca).forEach(A=>{for(A=_.Ca[A];A;){var C=A.Ja;y.includes(A.sa)&&Nn(A),A=C}}),d.Ba=null,d.sa.Qa.splice(d.sa.Qa.indexOf(f),1)},lookup(d,f){return d.pa.lookup(d,f)},Aa(d,f,y){var A=te(d,{parent:!0}).node;if(d=Ke(d),!d||d==="."||d==="..")throw new _.oa(28);var C=Pr(A,d);if(C)throw new _.oa(C);if(!A.pa.Aa)throw new _.oa(63);return A.pa.Aa(A,d,f,y)},hb(d){var f={Bb:4096,Ib:4096,blocks:1e6,Vb:5e5,Ub:5e5,files:_.bb,cc:_.bb-1,ec:42,flags:2,kc:255};return d=te(d,{za:!0}).node,d?.pa.hb&&Object.assign(f,d.pa.hb(d.sa.Ma.root)),f},create(d,f=438){return _.Aa(d,f&4095|32768,0)},mkdir(d,f=511){return _.Aa(d,f&1023|16384,0)},jc(d,f){d=d.split("/");for(var y="",A=0;A<d.length;++A)if(d[A]){y+="/"+d[A];try{_.mkdir(y,f)}catch(C){if(C.xa!=20)throw C}}},symlink(d,f){if(!un(d))throw new _.oa(44);var y=te(f,{parent:!0}).node;if(!y)throw new _.oa(44);f=Ke(f);var A=Pr(y,f);if(A)throw new _.oa(A);if(!y.pa.symlink)throw new _.oa(63);return y.pa.symlink(y,f,d)},rename(d,f){var y=Yi(d),A=Yi(f),C=Ke(d),L=Ke(f),H=te(d,{parent:!0}),q=H.node;if(H=te(f,{parent:!0}),H=H.node,!q||!H)throw new _.oa(44);if(q.sa!==H.sa)throw new _.oa(75);var et=Pi(q,C);if(d=S(d,A),d.charAt(0)!==".")throw new _.oa(28);if(d=S(f,y),d.charAt(0)!==".")throw new _.oa(55);try{var rt=Pi(H,L)}catch{}if(et!==rt){if(f=ce(et.mode),C=Cs(q,C,f))throw new _.oa(C);if(C=rt?Cs(H,L,f):Pr(H,L))throw new _.oa(C);if(!q.pa.rename)throw new _.oa(63);if(et.Ba||rt&&rt.Ba)throw new _.oa(10);if(H!==q&&(C=Ki(q,"w")))throw new _.oa(C);Nn(et);try{q.pa.rename(et,H,L),et.parent=H}catch(bt){throw bt}finally{Zo(et)}}},rmdir(d){var f=te(d,{parent:!0}).node;d=Ke(d);var y=Pi(f,d),A=Cs(f,d,!0);if(A)throw new _.oa(A);if(!f.pa.rmdir)throw new _.oa(63);if(y.Ba)throw new _.oa(10);f.pa.rmdir(f,d),Nn(y)},readdir(d){if(d=te(d,{za:!0}).node,!d.pa.readdir)throw new _.oa(54);return d.pa.readdir(d)},unlink(d){var f=te(d,{parent:!0}).node;if(!f)throw new _.oa(44);d=Ke(d);var y=Pi(f,d),A=Cs(f,d,!1);if(A)throw new _.oa(A);if(!f.pa.unlink)throw new _.oa(63);if(y.Ba)throw new _.oa(10);f.pa.unlink(f,d),Nn(y)},readlink(d){if(d=te(d).node,!d)throw new _.oa(44);if(!d.pa.readlink)throw new _.oa(28);return d.pa.readlink(d)},stat(d,f){if(d=te(d,{za:!f}).node,!d)throw new _.oa(44);if(!d.pa.ya)throw new _.oa(63);return d.pa.ya(d)},lstat(d){return _.stat(d,!0)},chmod(d,f,y){if(d=typeof d=="string"?te(d,{za:!y}).node:d,!d.pa.ua)throw new _.oa(63);d.pa.ua(d,{mode:f&4095|d.mode&-4096,ctime:Date.now()})},lchmod(d,f){_.chmod(d,f,!0)},fchmod(d,f){d=ai(d),_.chmod(d.node,f)},chown(d,f,y,A){if(d=typeof d=="string"?te(d,{za:!A}).node:d,!d.pa.ua)throw new _.oa(63);d.pa.ua(d,{timestamp:Date.now()})},lchown(d,f,y){_.chown(d,f,y,!0)},fchown(d,f,y){d=ai(d),_.chown(d.node,f,y)},truncate(d,f){if(0>f)throw new _.oa(28);if(d=typeof d=="string"?te(d,{za:!0}).node:d,!d.pa.ua)throw new _.oa(63);if(ce(d.mode))throw new _.oa(31);if(!_.isFile(d.mode))throw new _.oa(28);var y=Ki(d,"w");if(y)throw new _.oa(y);d.pa.ua(d,{size:f,timestamp:Date.now()})},fc(d,f){if(d=ai(d),(d.flags&2097155)===0)throw new _.oa(28);_.truncate(d.node,f)},oc(d,f,y){d=te(d,{za:!0}).node,d.pa.ua(d,{atime:f,mtime:y})},open(d,f,y=438){if(d==="")throw new _.oa(44);if(typeof f=="string"){var A={r:0,"r+":2,w:577,"w+":578,a:1089,"a+":1090}[f];if(typeof A>"u")throw Error(`Unknown file open mode: ${f}`);f=A}y=f&64?y&4095|32768:0,typeof d=="object"?A=d:(d=te(d,{za:!(f&131072),Qb:!0}),A=d.node,d=d.path);var C=!1;if(f&64)if(A){if(f&128)throw new _.oa(20)}else A=_.Aa(d,y,0),C=!0;if(!A)throw new _.oa(44);if((A.mode&61440)===8192&&(f&=-513),f&65536&&!ce(A.mode))throw new _.oa(54);if(!C&&(y=A?(A.mode&61440)===40960?32:ce(A.mode)&&(ta(f)!=="r"||f&512)?31:Ki(A,ta(f)):44))throw new _.oa(y);return f&512&&!C&&_.truncate(A,0),f&=-131713,f=ea({node:A,path:fn(A),flags:f,seekable:!0,position:0,qa:A.qa,Sb:[],error:!1}),f.qa.open&&f.qa.open(f),f},close(d){if(d.fd===null)throw new _.oa(8);d.Xa&&(d.Xa=null);try{d.qa.close&&d.qa.close(d)}catch(f){throw f}finally{_.streams[d.fd]=null}d.fd=null},va(d,f,y){if(d.fd===null)throw new _.oa(8);if(!d.seekable||!d.qa.va)throw new _.oa(70);if(y!=0&&y!=1&&y!=2)throw new _.oa(28);return d.position=d.qa.va(d,f,y),d.Sb=[],d.position},read(d,f,y,A,C){if(0>A||0>C)throw new _.oa(28);if(d.fd===null)throw new _.oa(8);if((d.flags&2097155)===1)throw new _.oa(8);if(ce(d.node.mode))throw new _.oa(31);if(!d.qa.read)throw new _.oa(28);var L=typeof C<"u";if(!L)C=d.position;else if(!d.seekable)throw new _.oa(70);return f=d.qa.read(d,f,y,A,C),L||(d.position+=f),f},write(d,f,y,A,C,L){if(0>A||0>C)throw new _.oa(28);if(d.fd===null)throw new _.oa(8);if((d.flags&2097155)===0)throw new _.oa(8);if(ce(d.node.mode))throw new _.oa(31);if(!d.qa.write)throw new _.oa(28);d.seekable&&d.flags&1024&&_.va(d,0,2);var H=typeof C<"u";if(!H)C=d.position;else if(!d.seekable)throw new _.oa(70);return f=d.qa.write(d,f,y,A,C,L),H||(d.position+=f),f},Oa(d,f,y){if(d.fd===null)throw new _.oa(8);if(0>f||0>=y)throw new _.oa(28);if((d.flags&2097155)===0)throw new _.oa(8);if(!_.isFile(d.node.mode)&&!ce(d.node.mode))throw new _.oa(43);if(!d.qa.Oa)throw new _.oa(138);d.qa.Oa(d,f,y)},Ia(d,f,y,A,C){if((A&2)!==0&&(C&2)===0&&(d.flags&2097155)!==2)throw new _.oa(2);if((d.flags&2097155)===1)throw new _.oa(2);if(!d.qa.Ia)throw new _.oa(43);if(!f)throw new _.oa(28);return d.qa.Ia(d,f,y,A,C)},La(d,f,y,A,C){return d.qa.La?d.qa.La(d,f,y,A,C):0},$a(d,f,y){if(!d.qa.$a)throw new _.oa(59);return d.qa.$a(d,f,y)},readFile(d,f={}){if(f.flags=f.flags||0,f.encoding=f.encoding||"binary",f.encoding!=="utf8"&&f.encoding!=="binary")throw Error(`Invalid encoding type "${f.encoding}"`);var y,A=_.open(d,f.flags);d=_.stat(d).size;var C=new Uint8Array(d);return _.read(A,C,0,d,0),f.encoding==="utf8"?y=qt(C):f.encoding==="binary"&&(y=C),_.close(A),y},writeFile(d,f,y={}){if(y.flags=y.flags||577,d=_.open(d,y.flags,y.mode),typeof f=="string"){var A=new Uint8Array(m(f)+1);f=P(f,A,0,A.length),_.write(d,A,0,f,void 0,y.Cb)}else if(ArrayBuffer.isView(f))_.write(d,f,0,f.byteLength,void 0,y.Cb);else throw Error("Unsupported data type");_.close(d)},cwd:()=>_.kb,chdir(d){if(d=te(d,{za:!0}),d.node===null)throw new _.oa(44);if(!ce(d.node.mode))throw new _.oa(54);var f=Ki(d.node,"x");if(f)throw new _.oa(f);_.kb=d.path},ib(){_.Ca=Array(4096),_.sa(K,{},"/"),_.mkdir("/tmp"),_.mkdir("/home"),_.mkdir("/home/web_user"),Bh(),Uh(),_.Hb={MEMFS:K,NODEFS:ye,WORKERFS:re}},Pa(d,f,y){_.Za=!0,d?_.Ga("/dev","stdin",d):_.symlink("/dev/tty","/dev/stdin"),f?_.Ga("/dev","stdout",null,f):_.symlink("/dev/tty","/dev/stdout"),y?_.Ga("/dev","stderr",null,y):_.symlink("/dev/tty1","/dev/stderr"),_.open("/dev/stdin",0),_.open("/dev/stdout",1),_.open("/dev/stderr",1)},lc(){_.Za=!1;for(var d=0;d<_.streams.length;d++){var f=_.streams[d];f&&_.close(f)}},dc(d,f){try{var y=te(d,{za:!f});d=y.path}catch{}var A=!1,C=null;try{y=te(d,{parent:!0}),Ke(d),y=te(d,{za:!f}),A=!0,C=y.node}catch{}return A?C:null},ac(d,f){for(d=typeof d=="string"?d:fn(d),f=f.split("/").reverse();f.length;){var y=f.pop();if(y){var A=ri(d+"/"+y);try{_.mkdir(A)}catch{}d=A}}return A},Ga(d,f,y,A){d=_i(typeof d=="string"?d:fn(d),f),f=xr(!!y,!!A);var C;return(C=_.Ga).ab??(C.ab=64),C=_.Ha(_.Ga.ab++,0),Cr(C,{open(L){L.seekable=!1},close(){A?.buffer?.length&&A(10)},read(L,H,q,et){for(var rt=0,bt=0;bt<et;bt++){try{var lt=y()}catch{throw new _.oa(29)}if(lt===void 0&&rt===0)throw new _.oa(6);if(lt==null)break;rt++,H[q+bt]=lt}return rt&&(L.node.atime=Date.now()),rt},write(L,H,q,et){for(var rt=0;rt<et;rt++)try{A(H[q+rt])}catch{throw new _.oa(29)}return et&&(L.node.mtime=L.node.ctime=Date.now()),rt}}),_s(d,f,C)},Eb(d,f,y,A,C){class L{fb=!1;Ua=[];cb=void 0;ub=0;sb=0;get(lt){if(!(lt>this.length-1||0>lt)){var Mt=lt%this.chunkSize;return this.cb(lt/this.chunkSize|0)[Mt]}}Rb(lt){this.cb=lt}wb(){var lt=new XMLHttpRequest;if(lt.open("HEAD",y,!1),lt.send(null),!(200<=lt.status&&300>lt.status||lt.status===304))throw Error("Couldn't load "+y+". Status: "+lt.status);var Mt=Number(lt.getResponseHeader("Content-length")),de,we=(de=lt.getResponseHeader("Accept-Ranges"))&&de==="bytes";lt=(de=lt.getResponseHeader("Content-Encoding"))&&de==="gzip";var Tt=1048576;we||(Tt=Mt);var Re=this;Re.Rb(Ce=>{var ui=Ce*Tt,Ni=(Ce+1)*Tt-1;if(Ni=Math.min(Ni,Mt-1),typeof Re.Ua[Ce]>"u"){var uc=Re.Ua;if(ui>Ni)throw Error("invalid range ("+ui+", "+Ni+") or no bytes requested!");if(Ni>Mt-1)throw Error("only "+Mt+" bytes available! programmer error!");var Ge=new XMLHttpRequest;if(Ge.open("GET",y,!1),Mt!==Tt&&Ge.setRequestHeader("Range","bytes="+ui+"-"+Ni),Ge.responseType="arraybuffer",Ge.overrideMimeType&&Ge.overrideMimeType("text/plain; charset=x-user-defined"),Ge.send(null),!(200<=Ge.status&&300>Ge.status||Ge.status===304))throw Error("Couldn't load "+y+". Status: "+Ge.status);ui=Ge.response!==void 0?new Uint8Array(Ge.response||[]):I(Ge.responseText||""),uc[Ce]=ui}if(typeof Re.Ua[Ce]>"u")throw Error("doXHR failed!");return Re.Ua[Ce]}),(lt||!Mt)&&(Tt=Mt=1,Tt=Mt=this.cb(0).length,F("LazyFiles on gzip forces download of the whole file when length is accessed")),this.ub=Mt,this.sb=Tt,this.fb=!0}get length(){return this.fb||this.wb(),this.ub}get chunkSize(){return this.fb||this.wb(),this.sb}}if(typeof XMLHttpRequest<"u"){if(!u)throw"Cannot do synchronous binary XHRs outside webworkers in modern browsers. Use --embed-file or --preload-file in emcc";var H=new L,q=void 0}else q=y,H=void 0;var et=$h(d,f,A,C);H?et.ra=H:q&&(et.ra=null,et.url=q),Object.defineProperties(et,{ta:{get:function(){return this.ra.length}}});var rt={};return Object.keys(et.qa).forEach(bt=>{var lt=et.qa[bt];rt[bt]=(...Mt)=>(Tr(et),lt(...Mt))}),rt.read=(bt,lt,Mt,de,we)=>{if(Tr(et),bt=bt.node.ra,we>=bt.length)lt=0;else{if(de=Math.min(bt.length-we,de),bt.slice)for(var Tt=0;Tt<de;Tt++)lt[Mt+Tt]=bt[we+Tt];else for(Tt=0;Tt<de;Tt++)lt[Mt+Tt]=bt.get(we+Tt);lt=de}return lt},rt.Ia=()=>{throw Tr(et),dt(),new _.oa(48)},et.qa=rt,et}};function Ps(d,f){if(f.charAt(0)==="/")return f;if(d=d===-100?_.cwd():ai(d).path,f.length==0)throw new _.oa(44);return d+"/"+f}var Bn=void 0,Hh=[0,31,60,91,121,152,182,213,244,274,305,335],jh=[0,31,59,90,120,151,181,212,243,273,304,334],Un={},na=d=>{if(d instanceof Se||d=="unwind")return R;x(1,d)},sa=d=>{R=d,x(d,new Se(d))},ra=d=>{R=d,sa(d)},zh=d=>{if(!N)try{d()}catch(f){na(f)}},Ts={},oa=()=>{if(!Dr){var d={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:v||"./this.program"},f;for(f in Ts)Ts[f]===void 0?delete d[f]:d[f]=Ts[f];var y=[];for(f in d)y.push(`${f}=${d[f]}`);Dr=y}return Dr},Dr,Xt;_.bc=(d,f,y,A,C,L,H,q,et,rt)=>{function bt(Mt){function de(we){if(rt?.(),!q){var Tt=d,Re=f;if(Tt&&(Tt=typeof Tt=="string"?Tt:fn(Tt),Re=f?ri(Tt+"/"+f):Tt),Tt=xr(A,C),Re=_.create(Re,Tt),we){if(typeof we=="string"){for(var Ce=Array(we.length),ui=0,Ni=we.length;ui<Ni;++ui)Ce[ui]=we.charCodeAt(ui);we=Ce}_.chmod(Re,Tt|146),Ce=_.open(Re,577),_.write(Ce,we,0,we.length,0,et),_.close(Ce),_.chmod(Re,Tt)}}L?.(),mt()}Rh(Mt,lt,de,()=>{H?.(),mt()})||de(Mt)}var lt=f?un(ri(d+"/"+f)):d;it++,typeof y=="string"?Ih(y).then(bt,H):bt(y)},_.ib(),K.mb=new _.oa(44),K.mb.stack="<generic error, no stack>",p&&ye.ib();var Gh={o:(d,f,y,A)=>dt(`Assertion failed: ${d?qt(U,d):""}, at: `+[f?f?qt(U,f):"":"unknown filename",y,A?A?qt(U,A):"":"unknown function"]),n:d=>{var f=new Xi(d);return $[f.wa+12]==0&&($[f.wa+12]=1,me--),$[f.wa+13]=0,di.push(f),ca(d),ua(d)},q:()=>{zt(0,0);var d=di.pop();ha(d.nb),be=0},d:()=>Oi([]),j:d=>Oi([d]),K:(d,f)=>Oi([d,f]),B:()=>{var d=di.pop();d||dt("no exception to throw");var f=d.nb;throw $[d.wa+13]==0&&(di.push(d),$[d.wa+13]=1,$[d.wa+12]=0,me++),be=f,be},a:(d,f,y)=>{throw new Xi(d).Pa(f,y),be=d,me++,be},R:()=>me,g:d=>{throw be||=d,be},w:function(d,f,y){Bn=y;try{var A=ai(d);switch(f){case 0:var C=De();if(0>C)break;for(;_.streams[C];)C++;return Nh(A,C).fd;case 1:case 2:return 0;case 3:return A.flags;case 4:return C=De(),A.flags|=C,0;case 12:return C=De(),Q[C+0>>1]=2,0;case 13:case 14:return 0}return-28}catch(L){if(typeof _>"u"||L.name!=="ErrnoError")throw L;return-L.xa}},D:function(d,f,y){Bn=y;try{var A=ai(d);switch(f){case 21509:return A.tty?0:-59;case 21505:if(!A.tty)return-59;if(A.tty.Ea.Lb){d=[3,28,127,21,4,0,1,0,17,19,26,0,18,15,23,22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];var C=De();V[C>>2]=25856,V[C+4>>2]=5,V[C+8>>2]=191,V[C+12>>2]=35387;for(var L=0;32>L;L++)$[C+L+17]=d[L]||0}return 0;case 21510:case 21511:case 21512:return A.tty?0:-59;case 21506:case 21507:case 21508:if(!A.tty)return-59;if(A.tty.Ea.Mb)for(C=De(),d=[],L=0;32>L;L++)d.push($[C+L+17]);return 0;case 21519:return A.tty?(C=De(),V[C>>2]=0):-59;case 21520:return A.tty?-28:-59;case 21531:return C=De(),_.$a(A,f,C);case 21523:return A.tty?(A.tty.Ea.Nb&&(L=[24,80],C=De(),Q[C>>1]=L[0],Q[C+2>>1]=L[1]),0):-59;case 21524:return A.tty?0:-59;case 21515:return A.tty?0:-59;default:return-28}}catch(H){if(typeof _>"u"||H.name!=="ErrnoError")throw H;return-H.xa}},E:function(d,f,y,A){Bn=A;try{f=f?qt(U,f):"",f=Ps(d,f);var C=A?De():0;return _.open(f,y,C).fd}catch(L){if(typeof _>"u"||L.name!=="ErrnoError")throw L;return-L.xa}},V:function(d,f,y,A){try{return f=f?qt(U,f):"",A=A?qt(U,A):"",f=Ps(d,f),A=Ps(y,A),_.rename(f,A),0}catch(C){if(typeof _>"u"||C.name!=="ErrnoError")throw C;return-C.xa}},U:function(d,f){try{d=d?qt(U,d):"";var y=_.stat,A=y(d);V[f>>2]=A.dev,V[f+4>>2]=A.mode,z[f+8>>2]=A.nlink,V[f+12>>2]=A.uid,V[f+16>>2]=A.gid,V[f+20>>2]=A.rdev,st[f+24>>3]=BigInt(A.size),V[f+32>>2]=4096,V[f+36>>2]=A.blocks;var C=A.atime.getTime(),L=A.mtime.getTime(),H=A.ctime.getTime();return st[f+40>>3]=BigInt(Math.floor(C/1e3)),z[f+48>>2]=C%1e3*1e6,st[f+56>>3]=BigInt(Math.floor(L/1e3)),z[f+64>>2]=L%1e3*1e6,st[f+72>>3]=BigInt(Math.floor(H/1e3)),z[f+80>>2]=H%1e3*1e6,st[f+88>>3]=BigInt(A.ino),0}catch(q){if(typeof _>"u"||q.name!=="ErrnoError")throw q;return-q.xa}},T:function(d,f,y){try{return f=f?qt(U,f):"",f=Ps(d,f),y===0?_.unlink(f):y===512?_.rmdir(f):dt("Invalid flags passed to unlinkat"),0}catch(A){if(typeof _>"u"||A.name!=="ErrnoError")throw A;return-A.xa}},Q:()=>dt(""),O:()=>{},M:()=>{throw 1/0},W:function(d,f){d=-9007199254740992>d||9007199254740992<d?NaN:Number(d),d=new Date(1e3*d),V[f>>2]=d.getSeconds(),V[f+4>>2]=d.getMinutes(),V[f+8>>2]=d.getHours(),V[f+12>>2]=d.getDate(),V[f+16>>2]=d.getMonth(),V[f+20>>2]=d.getFullYear()-1900,V[f+24>>2]=d.getDay();var y=d.getFullYear();V[f+28>>2]=(y%4!==0||y%100===0&&y%400!==0?jh:Hh)[d.getMonth()]+d.getDate()-1|0,V[f+36>>2]=-(60*d.getTimezoneOffset()),y=new Date(d.getFullYear(),6,1).getTimezoneOffset();var A=new Date(d.getFullYear(),0,1).getTimezoneOffset();V[f+32>>2]=(y!=A&&d.getTimezoneOffset()==Math.min(A,y))|0},P:(d,f)=>{if(Un[d]&&(clearTimeout(Un[d].id),delete Un[d]),!f)return 0;var y=setTimeout(()=>{delete Un[d],zh(()=>la(d,performance.now()))},f);return Un[d]={id:y,nc:f},0},H:(d,f,y,A)=>{var C=new Date().getFullYear(),L=new Date(C,0,1).getTimezoneOffset();C=new Date(C,6,1).getTimezoneOffset(),z[d>>2]=60*Math.max(L,C),V[f>>2]=+(L!=C),f=H=>{var q=Math.abs(H);return`UTC${0<=H?"-":"+"}${String(Math.floor(q/60)).padStart(2,"0")}${String(q%60).padStart(2,"0")}`},d=f(L),f=f(C),C<L?(P(d,U,y,17),P(f,U,A,17)):(P(d,U,A,17),P(f,U,y,17))},F:()=>Date.now(),S:d=>{var f=U.length;if(d>>>=0,2147483648<d)return!1;for(var y=1;4>=y;y*=2){var A=f*(1+.2/y);A=Math.min(A,d+100663296);t:{A=(Math.min(2147483648,65536*Math.ceil(Math.max(d,A)/65536))-O.buffer.byteLength+65535)/65536|0;try{O.grow(A),G();var C=1;break t}catch{}C=void 0}if(C)return!0}return!1},Y:(d,f)=>{var y=0;return oa().forEach((A,C)=>{var L=f+y;for(C=z[d+4*C>>2]=L,L=0;L<A.length;++L)$[C++]=A.charCodeAt(L);$[C]=0,y+=A.length+1}),0},Z:(d,f)=>{var y=oa();z[d>>2]=y.length;var A=0;return y.forEach(C=>A+=C.length+1),z[f>>2]=A,0},t:ra,C:function(d){try{var f=ai(d);return _.close(f),0}catch(y){if(typeof _>"u"||y.name!=="ErrnoError")throw y;return y.xa}},$:function(d,f,y,A){try{t:{var C=ai(d);d=f;for(var L,H=f=0;H<y;H++){var q=z[d>>2],et=z[d+4>>2];d+=8;var rt=_.read(C,$,q,et,L);if(0>rt){var bt=-1;break t}if(f+=rt,rt<et)break;typeof L<"u"&&(L+=rt)}bt=f}return z[A>>2]=bt,0}catch(lt){if(typeof _>"u"||lt.name!=="ErrnoError")throw lt;return lt.xa}},X:function(d,f,y,A){f=-9007199254740992>f||9007199254740992<f?NaN:Number(f);try{if(isNaN(f))return 61;var C=ai(d);return _.va(C,f,y),st[A>>3]=BigInt(C.position),C.Xa&&f===0&&y===0&&(C.Xa=null),0}catch(L){if(typeof _>"u"||L.name!=="ErrnoError")throw L;return L.xa}},_:function(d,f,y,A){try{t:{var C=ai(d);d=f;for(var L,H=f=0;H<y;H++){var q=z[d>>2],et=z[d+4>>2];d+=8;var rt=_.write(C,$,q,et,L);if(0>rt){var bt=-1;break t}if(f+=rt,rt<et)break;typeof L<"u"&&(L+=rt)}bt=f}return z[A>>2]=bt,0}catch(lt){if(typeof _>"u"||lt.name!=="ErrnoError")throw lt;return lt.xa}},G:dc,b:Wh,c:Vh,h:Jh,m:tc,J:sc,z:ic,p:qh,x:oc,v:lc,y:nc,I:rc,i:Kh,e:Yh,f:Xh,k:Zh,l:ec,L:Qh,r:ac,s:hc,u:cc,A:d=>d,N:sa},ke;(async function(){it++;var d={a:Gh};Pt??=Ct("qpdf.wasm")?"qpdf.wasm":r.locateFile?r.locateFile("qpdf.wasm",E):E+"qpdf.wasm";try{var f=await je(d);return ke=f.instance.exports,O=ke.aa,G(),Xt=ke.da,Z.unshift(ke.ba),mt(),f}catch(y){l(y)}})();var aa=r._main=(d,f)=>(aa=r._main=ke.ca)(d,f),la=(d,f)=>(la=ke.ea)(d,f),zt=(d,f)=>(zt=ke.fa)(d,f),$n=d=>($n=ke.ga)(d),Yt=d=>(Yt=ke.ha)(d),kr=d=>(kr=ke.ia)(d),Kt=()=>(Kt=ke.ja)(),ha=d=>(ha=ke.ka)(d),ca=d=>(ca=ke.la)(d),da=(d,f,y)=>(da=ke.ma)(d,f,y),ua=d=>(ua=ke.na)(d);function Vh(d,f,y){var A=Kt();try{return Xt.get(d)(f,y)}catch(C){if(Yt(A),C!==C+0)throw C;zt(1,0)}}function Wh(d,f){var y=Kt();try{return Xt.get(d)(f)}catch(A){if(Yt(y),A!==A+0)throw A;zt(1,0)}}function qh(d,f,y,A,C,L,H){var q=Kt();try{return Xt.get(d)(f,y,A,C,L,H)}catch(et){if(Yt(q),et!==et+0)throw et;zt(1,0)}}function Xh(d,f,y){var A=Kt();try{Xt.get(d)(f,y)}catch(C){if(Yt(A),C!==C+0)throw C;zt(1,0)}}function Yh(d,f){var y=Kt();try{Xt.get(d)(f)}catch(A){if(Yt(y),A!==A+0)throw A;zt(1,0)}}function Kh(d){var f=Kt();try{Xt.get(d)()}catch(y){if(Yt(f),y!==y+0)throw y;zt(1,0)}}function Jh(d,f,y,A){var C=Kt();try{return Xt.get(d)(f,y,A)}catch(L){if(Yt(C),L!==L+0)throw L;zt(1,0)}}function Qh(d,f,y,A,C,L){var H=Kt();try{Xt.get(d)(f,y,A,C,L)}catch(q){if(Yt(H),q!==q+0)throw q;zt(1,0)}}function Zh(d,f,y,A){var C=Kt();try{Xt.get(d)(f,y,A)}catch(L){if(Yt(C),L!==L+0)throw L;zt(1,0)}}function tc(d,f,y,A,C){var L=Kt();try{return Xt.get(d)(f,y,A,C)}catch(H){if(Yt(L),H!==H+0)throw H;zt(1,0)}}function ec(d,f,y,A,C){var L=Kt();try{Xt.get(d)(f,y,A,C)}catch(H){if(Yt(L),H!==H+0)throw H;zt(1,0)}}function ic(d,f,y,A,C,L){var H=Kt();try{return Xt.get(d)(f,y,A,C,L)}catch(q){if(Yt(H),q!==q+0)throw q;zt(1,0)}}function nc(d,f,y,A,C,L){var H=Kt();try{return Xt.get(d)(f,y,A,C,L)}catch(q){if(Yt(H),q!==q+0)throw q;zt(1,0)}}function sc(d,f,y,A,C,L){var H=Kt();try{return Xt.get(d)(f,y,A,C,L)}catch(q){if(Yt(H),q!==q+0)throw q;zt(1,0)}}function rc(d,f,y){var A=Kt();try{return Xt.get(d)(f,y)}catch(C){if(Yt(A),C!==C+0)throw C;zt(1,0)}}function oc(d,f,y,A,C,L,H,q){var et=Kt();try{return Xt.get(d)(f,y,A,C,L,H,q)}catch(rt){if(Yt(et),rt!==rt+0)throw rt;zt(1,0)}}function ac(d,f,y,A,C,L,H,q){var et=Kt();try{Xt.get(d)(f,y,A,C,L,H,q)}catch(rt){if(Yt(et),rt!==rt+0)throw rt;zt(1,0)}}function lc(d,f,y,A,C,L,H,q,et,rt,bt,lt){var Mt=Kt();try{return Xt.get(d)(f,y,A,C,L,H,q,et,rt,bt,lt)}catch(de){if(Yt(Mt),de!==de+0)throw de;zt(1,0)}}function hc(d,f,y,A,C,L,H,q,et,rt,bt){var lt=Kt();try{Xt.get(d)(f,y,A,C,L,H,q,et,rt,bt)}catch(Mt){if(Yt(lt),Mt!==Mt+0)throw Mt;zt(1,0)}}function cc(d,f,y,A,C,L,H,q,et,rt,bt,lt,Mt,de,we,Tt){var Re=Kt();try{Xt.get(d)(f,y,A,C,L,H,q,et,rt,bt,lt,Mt,de,we,Tt)}catch(Ce){if(Yt(Re),Ce!==Ce+0)throw Ce;zt(1,0)}}function dc(d,f,y){var A=Kt();try{return Xt.get(d)(f,y)}catch(C){if(Yt(A),C!==C+0)throw C;zt(1,0)}}r.callMain=fa,r.ENV=Ts,r.FS=_,r.NODEFS=ye,r.WORKERFS=re;var Ds;ot=function d(){Ds||pa(),Ds||(ot=d)};function fa(d=[]){var f=aa;d.unshift(v);var y=d.length,A=kr(4*(y+1)),C=A;d.forEach(H=>{var q=z,et=C>>2,rt=m(H)+1,bt=kr(rt);P(H,U,bt,rt),q[et]=bt,C+=4}),z[C>>2]=0;try{var L=f(y,A);return ra(L,!0),L}catch(H){return na(H)}}function pa(){var d=w;if(!(0<it)){if(r.preRun)for(typeof r.preRun=="function"&&(r.preRun=[r.preRun]);r.preRun.length;){var f=r.preRun.shift();W.unshift(f)}ze(W),0<it||Ds||(Ds=!0,r.calledRun=!0,N||(r.noFSInit||_.Za||_.Pa(),_.Ya=!1,ze(Z),ze(xt),o(r),ga&&fa(d),ze(Ft)))}}var ga=!0;return r.noInitialRun&&(ga=!1),pa(),Object.assign(_,{init:_.Pa,mkdir:_.mkdir,mount:_.sa,unlink:_.unlink,unmount:_.Tb,chdir:_.chdir,writeFile:_.writeFile,readFile:_.readFile,createLazyFile:_.Eb,setIgnorePermissions:function(d){_.Ya=d}}),s=h,s})})();a.exports=e,a.exports.default=e})(Rr)),Rr.exports}var Fc=kc();const Mc=pc(Fc),Me=typeof Qt=="object"&&Qt+""=="[object process]"&&!Qt.versions.nw&&!(Qt.versions.electron&&Qt.type&&Qt.type!=="browser"),ao=[.001,0,0,.001,0,0],Or=1.35,qe={ANY:1,DISPLAY:2,PRINT:4,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,IS_EDITING:128,OPLIST:256},$i={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3},ls="pdfjs_internal_editor_",gt={DISABLE:-1,NONE:0,FREETEXT:3,HIGHLIGHT:9,STAMP:13,INK:15,POPUP:16,SIGNATURE:101,COMMENT:102},Et={RESIZE:1,CREATE:2,FREETEXT_SIZE:11,FREETEXT_COLOR:12,FREETEXT_OPACITY:13,INK_COLOR:21,INK_THICKNESS:22,INK_OPACITY:23,HIGHLIGHT_COLOR:31,HIGHLIGHT_THICKNESS:32,HIGHLIGHT_FREE:33,HIGHLIGHT_SHOW_ALL:34,DRAW_STEP:41},Ic={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048},lo={TRIANGLES:1,LATTICE:2},ue={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4},Ws={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3},ae={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26},wn={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5},pr={ERRORS:0,WARNINGS:1,INFOS:5},hs={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91,setStrokeTransparent:92,setFillTransparent:93,rawFillPath:94},jn={moveTo:0,lineTo:1,curveTo:2,quadraticCurveTo:3,closePath:4},Lc={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};let gr=pr.WARNINGS;function Rc(a){Number.isInteger(a)&&(gr=a)}function Oc(){return gr}function mr(a){gr>=pr.INFOS&&console.info(`Info: ${a}`)}function ft(a){gr>=pr.WARNINGS&&console.warn(`Warning: ${a}`)}function Rt(a){throw new Error(a)}function St(a,t){a||Rt(t)}function Nc(a){switch(a?.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}function Dl(a,t=null,e=null){if(!a)return null;if(e&&typeof a=="string"&&(e.addDefaultProtocol&&a.startsWith("www.")&&a.match(/\./g)?.length>=2&&(a=`http://${a}`),e.tryConvertEncoding))try{a=jc(a)}catch{}const i=t?URL.parse(a,t):URL.parse(a);return Nc(i)?i:null}function kl(a,t,e=!1){const i=URL.parse(a);return i?(i.hash=t,i.href):e&&Dl(a,"http://example.com")?a.split("#",1)[0]+`${t?`#${t}`:""}`:""}function pt(a,t,e,i=!1){return Object.defineProperty(a,t,{value:e,enumerable:!i,configurable:!0,writable:!1}),e}const hn=(function(){function t(e,i){this.message=e,this.name=i}return t.prototype=new Error,t.constructor=t,t})();class va extends hn{constructor(t,e){super(t,"PasswordException"),this.code=e}}class Nr extends hn{constructor(t,e){super(t,"UnknownErrorException"),this.details=e}}class ho extends hn{constructor(t){super(t,"InvalidPDFException")}}class tr extends hn{constructor(t,e,i){super(t,"ResponseException"),this.status=e,this.missing=i}}class Bc extends hn{constructor(t){super(t,"FormatError")}}class Vi extends hn{constructor(t){super(t,"AbortException")}}function Fl(a){(typeof a!="object"||a?.length===void 0)&&Rt("Invalid argument for bytesToString");const t=a.length,e=8192;if(t<e)return String.fromCharCode.apply(null,a);const i=[];for(let n=0;n<t;n+=e){const s=Math.min(n+e,t),r=a.subarray(n,s);i.push(String.fromCharCode.apply(null,r))}return i.join("")}function ms(a){typeof a!="string"&&Rt("Invalid argument for stringToBytes");const t=a.length,e=new Uint8Array(t);for(let i=0;i<t;++i)e[i]=a.charCodeAt(i)&255;return e}function Uc(a){return String.fromCharCode(a>>24&255,a>>16&255,a>>8&255,a&255)}function $c(){const a=new Uint8Array(4);return a[0]=1,new Uint32Array(a.buffer,0,1)[0]===1}function Hc(){try{return new Function(""),!0}catch{return!1}}class fe{static get isLittleEndian(){return pt(this,"isLittleEndian",$c())}static get isEvalSupported(){return pt(this,"isEvalSupported",Hc())}static get isOffscreenCanvasSupported(){return pt(this,"isOffscreenCanvasSupported",typeof OffscreenCanvas<"u")}static get isImageDecoderSupported(){return pt(this,"isImageDecoderSupported",typeof ImageDecoder<"u")}static get isFloat16ArraySupported(){return pt(this,"isFloat16ArraySupported",typeof Float16Array<"u")}static get isSanitizerSupported(){return pt(this,"isSanitizerSupported",typeof Sanitizer<"u")}static get platform(){const{platform:t,userAgent:e}=navigator;return pt(this,"platform",{isAndroid:e.includes("Android"),isLinux:t.includes("Linux"),isMac:t.includes("Mac"),isWindows:t.includes("Win"),isFirefox:e.includes("Firefox")})}static get isCSSRoundSupported(){return pt(this,"isCSSRoundSupported",globalThis.CSS?.supports?.("width: round(1.5px, 1px)"))}}const Br=Array.from(Array(256).keys(),a=>a.toString(16).padStart(2,"0"));class J{static makeHexColor(t,e,i){return`#${Br[t]}${Br[e]}${Br[i]}`}static domMatrixToTransform(t){return[t.a,t.b,t.c,t.d,t.e,t.f]}static scaleMinMax(t,e){let i;t[0]?(t[0]<0&&(i=e[0],e[0]=e[2],e[2]=i),e[0]*=t[0],e[2]*=t[0],t[3]<0&&(i=e[1],e[1]=e[3],e[3]=i),e[1]*=t[3],e[3]*=t[3]):(i=e[0],e[0]=e[1],e[1]=i,i=e[2],e[2]=e[3],e[3]=i,t[1]<0&&(i=e[1],e[1]=e[3],e[3]=i),e[1]*=t[1],e[3]*=t[1],t[2]<0&&(i=e[0],e[0]=e[2],e[2]=i),e[0]*=t[2],e[2]*=t[2]),e[0]+=t[4],e[1]+=t[5],e[2]+=t[4],e[3]+=t[5]}static transform(t,e){return[t[0]*e[0]+t[2]*e[1],t[1]*e[0]+t[3]*e[1],t[0]*e[2]+t[2]*e[3],t[1]*e[2]+t[3]*e[3],t[0]*e[4]+t[2]*e[5]+t[4],t[1]*e[4]+t[3]*e[5]+t[5]]}static multiplyByDOMMatrix(t,e){return[t[0]*e.a+t[2]*e.b,t[1]*e.a+t[3]*e.b,t[0]*e.c+t[2]*e.d,t[1]*e.c+t[3]*e.d,t[0]*e.e+t[2]*e.f+t[4],t[1]*e.e+t[3]*e.f+t[5]]}static applyTransform(t,e,i=0){const n=t[i],s=t[i+1];t[i]=n*e[0]+s*e[2]+e[4],t[i+1]=n*e[1]+s*e[3]+e[5]}static applyTransformToBezier(t,e,i=0){const n=e[0],s=e[1],r=e[2],o=e[3],l=e[4],h=e[5];for(let c=0;c<6;c+=2){const u=t[i+c],p=t[i+c+1];t[i+c]=u*n+p*r+l,t[i+c+1]=u*s+p*o+h}}static applyInverseTransform(t,e){const i=t[0],n=t[1],s=e[0]*e[3]-e[1]*e[2];t[0]=(i*e[3]-n*e[2]+e[2]*e[5]-e[4]*e[3])/s,t[1]=(-i*e[1]+n*e[0]+e[4]*e[1]-e[5]*e[0])/s}static axialAlignedBoundingBox(t,e,i){const n=e[0],s=e[1],r=e[2],o=e[3],l=e[4],h=e[5],c=t[0],u=t[1],p=t[2],b=t[3];let w=n*c+l,v=w,x=n*p+l,E=x,D=o*u+h,T=D,k=o*b+h,F=k;if(s!==0||r!==0){const M=s*c,O=s*p,N=r*u,R=r*b;w+=N,E+=N,x+=R,v+=R,D+=M,F+=M,k+=O,T+=O}i[0]=Math.min(i[0],w,x,v,E),i[1]=Math.min(i[1],D,k,T,F),i[2]=Math.max(i[2],w,x,v,E),i[3]=Math.max(i[3],D,k,T,F)}static inverseTransform(t){const e=t[0]*t[3]-t[1]*t[2];return[t[3]/e,-t[1]/e,-t[2]/e,t[0]/e,(t[2]*t[5]-t[4]*t[3])/e,(t[4]*t[1]-t[5]*t[0])/e]}static singularValueDecompose2dScale(t,e){const i=t[0],n=t[1],s=t[2],r=t[3],o=i**2+n**2,l=i*s+n*r,h=s**2+r**2,c=(o+h)/2,u=Math.sqrt(c**2-(o*h-l**2));e[0]=Math.sqrt(c+u||1),e[1]=Math.sqrt(c-u||1)}static normalizeRect(t){const e=t.slice(0);return t[0]>t[2]&&(e[0]=t[2],e[2]=t[0]),t[1]>t[3]&&(e[1]=t[3],e[3]=t[1]),e}static intersect(t,e){const i=Math.max(Math.min(t[0],t[2]),Math.min(e[0],e[2])),n=Math.min(Math.max(t[0],t[2]),Math.max(e[0],e[2]));if(i>n)return null;const s=Math.max(Math.min(t[1],t[3]),Math.min(e[1],e[3])),r=Math.min(Math.max(t[1],t[3]),Math.max(e[1],e[3]));return s>r?null:[i,s,n,r]}static pointBoundingBox(t,e,i){i[0]=Math.min(i[0],t),i[1]=Math.min(i[1],e),i[2]=Math.max(i[2],t),i[3]=Math.max(i[3],e)}static rectBoundingBox(t,e,i,n,s){s[0]=Math.min(s[0],t,i),s[1]=Math.min(s[1],e,n),s[2]=Math.max(s[2],t,i),s[3]=Math.max(s[3],e,n)}static#t(t,e,i,n,s,r,o,l,h,c){if(h<=0||h>=1)return;const u=1-h,p=h*h,b=p*h,w=u*(u*(u*t+3*h*e)+3*p*i)+b*n,v=u*(u*(u*s+3*h*r)+3*p*o)+b*l;c[0]=Math.min(c[0],w),c[1]=Math.min(c[1],v),c[2]=Math.max(c[2],w),c[3]=Math.max(c[3],v)}static#e(t,e,i,n,s,r,o,l,h,c,u,p){if(Math.abs(h)<1e-12){Math.abs(c)>=1e-12&&this.#t(t,e,i,n,s,r,o,l,-u/c,p);return}const b=c**2-4*u*h;if(b<0)return;const w=Math.sqrt(b),v=2*h;this.#t(t,e,i,n,s,r,o,l,(-c+w)/v,p),this.#t(t,e,i,n,s,r,o,l,(-c-w)/v,p)}static bezierBoundingBox(t,e,i,n,s,r,o,l,h){h[0]=Math.min(h[0],t,o),h[1]=Math.min(h[1],e,l),h[2]=Math.max(h[2],t,o),h[3]=Math.max(h[3],e,l),this.#e(t,i,s,o,e,n,r,l,3*(-t+3*(i-s)+o),6*(t-2*i+s),3*(i-t),h),this.#e(t,i,s,o,e,n,r,l,3*(-e+3*(n-r)+l),6*(e-2*n+r),3*(n-e),h)}}function jc(a){return decodeURIComponent(escape(a))}let Ur=null,Aa=null;function zc(a){return Ur||(Ur=/([\u00a0\u00b5\u037e\u0eb3\u2000-\u200a\u202f\u2126\ufb00-\ufb04\ufb06\ufb20-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufba1\ufba4-\ufba9\ufbae-\ufbb1\ufbd3-\ufbdc\ufbde-\ufbe7\ufbea-\ufbf8\ufbfc-\ufbfd\ufc00-\ufc5d\ufc64-\ufcf1\ufcf5-\ufd3d\ufd88\ufdf4\ufdfa-\ufdfb\ufe71\ufe77\ufe79\ufe7b\ufe7d]+)|(\ufb05+)/gu,Aa=new Map([["","t"]])),a.replaceAll(Ur,(t,e,i)=>e?e.normalize("NFKC"):Aa.get(i))}function Ml(){if(typeof crypto.randomUUID=="function")return crypto.randomUUID();const a=new Uint8Array(32);return crypto.getRandomValues(a),Fl(a)}const Sn="pdfjs_internal_id_";function Gc(a,t,e){if(!Array.isArray(e)||e.length<2)return!1;const[i,n,...s]=e;if(!a(i)&&!Number.isInteger(i)||!t(n))return!1;const r=s.length;let o=!0;switch(n.name){case"XYZ":if(r<2||r>3)return!1;break;case"Fit":case"FitB":return r===0;case"FitH":case"FitBH":case"FitV":case"FitBV":if(r>1)return!1;break;case"FitR":if(r!==4)return!1;o=!1;break;default:return!1}for(const l of s)if(!(typeof l=="number"||o&&l===null))return!1;return!0}function Ie(a,t,e){return Math.min(Math.max(a,t),e)}function Il(a){return Uint8Array.prototype.toBase64?a.toBase64():btoa(Fl(a))}function Vc(a){return Uint8Array.fromBase64?Uint8Array.fromBase64(a):ms(atob(a))}typeof Promise.try!="function"&&(Promise.try=function(a,...t){return new Promise(e=>{e(a(...t))})});typeof Math.sumPrecise!="function"&&(Math.sumPrecise=function(a){return a.reduce((t,e)=>t+e,0)});class cs{static textContent(t){const e=[],i={items:e,styles:Object.create(null)};function n(s){if(!s)return;let r=null;const o=s.name;if(o==="#text")r=s.value;else if(cs.shouldBuildText(o))s?.attributes?.textContent?r=s.attributes.textContent:s.value&&(r=s.value);else return;if(r!==null&&e.push({str:r}),!!s.children)for(const l of s.children)n(l)}return n(t),i}static shouldBuildText(t){return!(t==="textarea"||t==="input"||t==="option"||t==="select")}}class Ll{static setupStorage(t,e,i,n,s){const r=n.getValue(e,{value:null});switch(i.name){case"textarea":if(r.value!==null&&(t.textContent=r.value),s==="print")break;t.addEventListener("input",o=>{n.setValue(e,{value:o.target.value})});break;case"input":if(i.attributes.type==="radio"||i.attributes.type==="checkbox"){if(r.value===i.attributes.xfaOn?t.setAttribute("checked",!0):r.value===i.attributes.xfaOff&&t.removeAttribute("checked"),s==="print")break;t.addEventListener("change",o=>{n.setValue(e,{value:o.target.checked?o.target.getAttribute("xfaOn"):o.target.getAttribute("xfaOff")})})}else{if(r.value!==null&&t.setAttribute("value",r.value),s==="print")break;t.addEventListener("input",o=>{n.setValue(e,{value:o.target.value})})}break;case"select":if(r.value!==null){t.setAttribute("value",r.value);for(const o of i.children)o.attributes.value===r.value?o.attributes.selected=!0:o.attributes.hasOwnProperty("selected")&&delete o.attributes.selected}t.addEventListener("input",o=>{const l=o.target.options,h=l.selectedIndex===-1?"":l[l.selectedIndex].value;n.setValue(e,{value:h})});break}}static setAttributes({html:t,element:e,storage:i=null,intent:n,linkService:s}){const{attributes:r}=e,o=t instanceof HTMLAnchorElement;r.type==="radio"&&(r.name=`${r.name}-${n}`);for(const[l,h]of Object.entries(r))if(h!=null)switch(l){case"class":h.length&&t.setAttribute(l,h.join(" "));break;case"dataId":break;case"id":t.setAttribute("data-element-id",h);break;case"style":Object.assign(t.style,h);break;case"textContent":t.textContent=h;break;default:(!o||l!=="href"&&l!=="newWindow")&&t.setAttribute(l,h)}o&&s.addLinkAttributes(t,r.href,r.newWindow),i&&r.dataId&&this.setupStorage(t,r.dataId,e,i)}static render(t){const e=t.annotationStorage,i=t.linkService,n=t.xfaHtml,s=t.intent||"display",r=document.createElement(n.name);n.attributes&&this.setAttributes({html:r,element:n,intent:s,linkService:i});const o=s!=="richText",l=t.div;if(l.append(r),t.viewport){const u=`matrix(${t.viewport.transform.join(",")})`;l.style.transform=u}o&&l.setAttribute("class","xfaLayer xfaFont");const h=[];if(n.children.length===0){if(n.value){const u=document.createTextNode(n.value);r.append(u),o&&cs.shouldBuildText(n.name)&&h.push(u)}return{textDivs:h}}const c=[[n,-1,r]];for(;c.length>0;){const[u,p,b]=c.at(-1);if(p+1===u.children.length){c.pop();continue}const w=u.children[++c.at(-1)[1]];if(w===null)continue;const{name:v}=w;if(v==="#text"){const E=document.createTextNode(w.value);h.push(E),b.append(E);continue}const x=w?.attributes?.xmlns?document.createElementNS(w.attributes.xmlns,v):document.createElement(v);if(b.append(x),w.attributes&&this.setAttributes({html:x,element:w,storage:e,intent:s,linkService:i}),w.children?.length>0)c.push([w,-1,x]);else if(w.value){const E=document.createTextNode(w.value);o&&cs.shouldBuildText(v)&&h.push(E),x.append(E)}}for(const u of l.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))u.setAttribute("readOnly",!0);return{textDivs:h}}static update(t){const e=`matrix(${t.viewport.transform.join(",")})`;t.div.style.transform=e,t.div.hidden=!1}}const Ti="http://www.w3.org/2000/svg";class Ln{static CSS=96;static PDF=72;static PDF_TO_CSS_UNITS=this.CSS/this.PDF}async function bs(a,t="text"){if(Xn(a,document.baseURI)){const e=await fetch(a);if(!e.ok)throw new Error(e.statusText);switch(t){case"arraybuffer":return e.arrayBuffer();case"blob":return e.blob();case"json":return e.json()}return e.text()}return new Promise((e,i)=>{const n=new XMLHttpRequest;n.open("GET",a,!0),n.responseType=t,n.onreadystatechange=()=>{if(n.readyState===XMLHttpRequest.DONE){if(n.status===200||n.status===0){switch(t){case"arraybuffer":case"blob":case"json":e(n.response);return}e(n.responseText);return}i(new Error(n.statusText))}},n.send(null)})}class ys{constructor({viewBox:t,userUnit:e,scale:i,rotation:n,offsetX:s=0,offsetY:r=0,dontFlip:o=!1}){this.viewBox=t,this.userUnit=e,this.scale=i,this.rotation=n,this.offsetX=s,this.offsetY=r,i*=e;const l=(t[2]+t[0])/2,h=(t[3]+t[1])/2;let c,u,p,b;switch(n%=360,n<0&&(n+=360),n){case 180:c=-1,u=0,p=0,b=1;break;case 90:c=0,u=1,p=1,b=0;break;case 270:c=0,u=-1,p=-1,b=0;break;case 0:c=1,u=0,p=0,b=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}o&&(p=-p,b=-b);let w,v,x,E;c===0?(w=Math.abs(h-t[1])*i+s,v=Math.abs(l-t[0])*i+r,x=(t[3]-t[1])*i,E=(t[2]-t[0])*i):(w=Math.abs(l-t[0])*i+s,v=Math.abs(h-t[1])*i+r,x=(t[2]-t[0])*i,E=(t[3]-t[1])*i),this.transform=[c*i,u*i,p*i,b*i,w-c*i*l-p*i*h,v-u*i*l-b*i*h],this.width=x,this.height=E}get rawDims(){const t=this.viewBox;return pt(this,"rawDims",{pageWidth:t[2]-t[0],pageHeight:t[3]-t[1],pageX:t[0],pageY:t[1]})}clone({scale:t=this.scale,rotation:e=this.rotation,offsetX:i=this.offsetX,offsetY:n=this.offsetY,dontFlip:s=!1}={}){return new ys({viewBox:this.viewBox.slice(),userUnit:this.userUnit,scale:t,rotation:e,offsetX:i,offsetY:n,dontFlip:s})}convertToViewportPoint(t,e){const i=[t,e];return J.applyTransform(i,this.transform),i}convertToViewportRectangle(t){const e=[t[0],t[1]];J.applyTransform(e,this.transform);const i=[t[2],t[3]];return J.applyTransform(i,this.transform),[e[0],e[1],i[0],i[1]]}convertToPdfPoint(t,e){const i=[t,e];return J.applyInverseTransform(i,this.transform),i}}class Fo extends hn{constructor(t,e=0){super(t,"RenderingCancelledException"),this.extraDelay=e}}function br(a){const t=a.length;let e=0;for(;e<t&&a[e].trim()==="";)e++;return a.substring(e,e+5).toLowerCase()==="data:"}function Mo(a){return typeof a=="string"&&/\.pdf$/i.test(a)}function Wc(a){return[a]=a.split(/[#?]/,1),a.substring(a.lastIndexOf("/")+1)}function qc(a,t="document.pdf"){if(typeof a!="string")return t;if(br(a))return ft('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),t;const i=(o=>{try{return new URL(o)}catch{try{return new URL(decodeURIComponent(o))}catch{try{return new URL(o,"https://foo.bar")}catch{try{return new URL(decodeURIComponent(o),"https://foo.bar")}catch{return null}}}}})(a);if(!i)return t;const n=o=>{try{let l=decodeURIComponent(o);return l.includes("/")?(l=l.split("/").at(-1),l.test(/^\.pdf$/i)?l:o):l}catch{return o}},s=/\.pdf$/i,r=i.pathname.split("/").at(-1);if(s.test(r))return n(r);if(i.searchParams.size>0){const o=Array.from(i.searchParams.values()).reverse();for(const h of o)if(s.test(h))return n(h);const l=Array.from(i.searchParams.keys()).reverse();for(const h of l)if(s.test(h))return n(h)}if(i.hash){const l=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i.exec(i.hash);if(l)return n(l[0])}return t}class Ea{started=Object.create(null);times=[];time(t){t in this.started&&ft(`Timer is already running for ${t}`),this.started[t]=Date.now()}timeEnd(t){t in this.started||ft(`Timer has not been started for ${t}`),this.times.push({name:t,start:this.started[t],end:Date.now()}),delete this.started[t]}toString(){const t=[];let e=0;for(const{name:i}of this.times)e=Math.max(i.length,e);for(const{name:i,start:n,end:s}of this.times)t.push(`${i.padEnd(e)} ${s-n}ms
`);return t.join("")}}function Xn(a,t){const e=t?URL.parse(a,t):URL.parse(a);return e?.protocol==="http:"||e?.protocol==="https:"}function si(a){a.preventDefault()}function Zt(a){a.preventDefault(),a.stopPropagation()}function Xc(a){console.log("Deprecated API usage: "+a)}class co{static#t;static toDateObject(t){if(t instanceof Date)return t;if(!t||typeof t!="string")return null;this.#t||=new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?");const e=this.#t.exec(t);if(!e)return null;const i=parseInt(e[1],10);let n=parseInt(e[2],10);n=n>=1&&n<=12?n-1:0;let s=parseInt(e[3],10);s=s>=1&&s<=31?s:1;let r=parseInt(e[4],10);r=r>=0&&r<=23?r:0;let o=parseInt(e[5],10);o=o>=0&&o<=59?o:0;let l=parseInt(e[6],10);l=l>=0&&l<=59?l:0;const h=e[7]||"Z";let c=parseInt(e[8],10);c=c>=0&&c<=23?c:0;let u=parseInt(e[9],10)||0;return u=u>=0&&u<=59?u:0,h==="-"?(r+=c,o+=u):h==="+"&&(r-=c,o-=u),new Date(Date.UTC(i,n,s,r,o,l))}}function Yc(a,{scale:t=1,rotation:e=0}){const{width:i,height:n}=a.attributes.style,s=[0,0,parseInt(i),parseInt(n)];return new ys({viewBox:s,userUnit:1,scale:t,rotation:e})}function ws(a){if(a.startsWith("#")){const t=parseInt(a.slice(1),16);return[(t&16711680)>>16,(t&65280)>>8,t&255]}return a.startsWith("rgb(")?a.slice(4,-1).split(",").map(t=>parseInt(t)):a.startsWith("rgba(")?a.slice(5,-1).split(",").map(t=>parseInt(t)).slice(0,3):(ft(`Not a valid color format: "${a}"`),[0,0,0])}function Kc(a){const t=document.createElement("span");t.style.visibility="hidden",t.style.colorScheme="only light",document.body.append(t);for(const e of a.keys()){t.style.color=e;const i=window.getComputedStyle(t).color;a.set(e,ws(i))}t.remove()}function Vt(a){const{a:t,b:e,c:i,d:n,e:s,f:r}=a.getTransform();return[t,e,i,n,s,r]}function gi(a){const{a:t,b:e,c:i,d:n,e:s,f:r}=a.getTransform().invertSelf();return[t,e,i,n,s,r]}function on(a,t,e=!1,i=!0){if(t instanceof ys){const{pageWidth:n,pageHeight:s}=t.rawDims,{style:r}=a,o=fe.isCSSRoundSupported,l=`var(--total-scale-factor) * ${n}px`,h=`var(--total-scale-factor) * ${s}px`,c=o?`round(down, ${l}, var(--scale-round-x))`:`calc(${l})`,u=o?`round(down, ${h}, var(--scale-round-y))`:`calc(${h})`;!e||t.rotation%180===0?(r.width=c,r.height=u):(r.width=u,r.height=c)}i&&a.setAttribute("data-main-rotation",t.rotation)}class xi{constructor(){const{pixelRatio:t}=xi;this.sx=t,this.sy=t}get scaled(){return this.sx!==1||this.sy!==1}get symmetric(){return this.sx===this.sy}limitCanvas(t,e,i,n,s=-1){let r=1/0,o=1/0,l=1/0;i=xi.capPixels(i,s),i>0&&(r=Math.sqrt(i/(t*e))),n!==-1&&(o=n/t,l=n/e);const h=Math.min(r,o,l);return this.sx>h||this.sy>h?(this.sx=h,this.sy=h,!0):!1}static get pixelRatio(){return globalThis.devicePixelRatio||1}static capPixels(t,e){if(e>=0){const i=Math.ceil(window.screen.availWidth*window.screen.availHeight*this.pixelRatio**2*(1+e/100));return t>0?Math.min(t,i):i}return t}}const uo=["image/apng","image/avif","image/bmp","image/gif","image/jpeg","image/png","image/svg+xml","image/webp","image/x-icon"];class Jc{static get isDarkMode(){return pt(this,"isDarkMode",!!window?.matchMedia?.("(prefers-color-scheme: dark)").matches)}}class Qc{static get commentForegroundColor(){const t=document.createElement("span");t.classList.add("comment","sidebar");const{style:e}=t;e.width=e.height="0",e.display="none",e.color="var(--comment-fg-color)",document.body.append(t);const{color:i}=window.getComputedStyle(t);return t.remove(),pt(this,"commentForegroundColor",ws(i))}}function Zc(a,t,e,i){i=Math.min(Math.max(i??1,0),1);const n=255*(1-i);return a=Math.round(a*i+n),t=Math.round(t*i+n),e=Math.round(e*i+n),[a,t,e]}function Sa(a,t){const e=a[0]/255,i=a[1]/255,n=a[2]/255,s=Math.max(e,i,n),r=Math.min(e,i,n),o=(s+r)/2;if(s===r)t[0]=t[1]=0;else{const l=s-r;switch(t[1]=o<.5?l/(s+r):l/(2-s-r),s){case e:t[0]=((i-n)/l+(i<n?6:0))*60;break;case i:t[0]=((n-e)/l+2)*60;break;case n:t[0]=((e-i)/l+4)*60;break}}t[2]=o}function fo(a,t){const e=a[0],i=a[1],n=a[2],s=(1-Math.abs(2*n-1))*i,r=s*(1-Math.abs(e/60%2-1)),o=n-s/2;switch(Math.floor(e/60)){case 0:t[0]=s+o,t[1]=r+o,t[2]=o;break;case 1:t[0]=r+o,t[1]=s+o,t[2]=o;break;case 2:t[0]=o,t[1]=s+o,t[2]=r+o;break;case 3:t[0]=o,t[1]=r+o,t[2]=s+o;break;case 4:t[0]=r+o,t[1]=o,t[2]=s+o;break;case 5:case 6:t[0]=s+o,t[1]=o,t[2]=r+o;break}}function xa(a){return a<=.03928?a/12.92:((a+.055)/1.055)**2.4}function Ca(a,t,e){fo(a,e),e.map(xa);const i=.2126*e[0]+.7152*e[1]+.0722*e[2];fo(t,e),e.map(xa);const n=.2126*e[0]+.7152*e[1]+.0722*e[2];return i>n?(i+.05)/(n+.05):(n+.05)/(i+.05)}const _a=new Map;function td(a,t){const e=a[0]+a[1]*256+a[2]*65536+t[0]*16777216+t[1]*4294967296+t[2]*1099511627776;let i=_a.get(e);if(i)return i;const n=new Float32Array(9),s=n.subarray(0,3),r=n.subarray(3,6);Sa(a,r);const o=n.subarray(6,9);Sa(t,o);const l=o[2]<.5,h=l?12:4.5;if(r[2]=l?Math.sqrt(r[2]):1-Math.sqrt(1-r[2]),Ca(r,o,s)<h){let c,u;l?(c=r[2],u=1):(c=0,u=r[2]);const p=.005;for(;u-c>p;){const b=r[2]=(c+u)/2;l===Ca(r,o,s)<h?c=b:u=b}r[2]=l?u:c}return fo(r,s),i=J.makeHexColor(Math.round(s[0]*255),Math.round(s[1]*255),Math.round(s[2]*255)),_a.set(e,i),i}function Rl({html:a,dir:t,className:e},i){const n=document.createDocumentFragment();if(typeof a=="string"){const s=document.createElement("p");s.dir=t||"auto";const r=a.split(/(?:\r\n?|\n)/);for(let o=0,l=r.length;o<l;++o){const h=r[o];s.append(document.createTextNode(h)),o<l-1&&s.append(document.createElement("br"))}n.append(s)}else Ll.render({xfaHtml:a,div:n,intent:"richText"});n.firstElementChild.classList.add("richText",e),i.append(n)}function Ol(a){const t=new Path2D;if(!a)return t;for(let e=0,i=a.length;e<i;)switch(a[e++]){case jn.moveTo:t.moveTo(a[e++],a[e++]);break;case jn.lineTo:t.lineTo(a[e++],a[e++]);break;case jn.curveTo:t.bezierCurveTo(a[e++],a[e++],a[e++],a[e++],a[e++],a[e++]);break;case jn.quadraticCurveTo:t.quadraticCurveTo(a[e++],a[e++],a[e++],a[e++]);break;case jn.closePath:t.closePath();break;default:ft(`Unrecognized drawing path operator: ${a[e-1]}`);break}return t}class ts{#t=null;#e=null;#n;#i=null;#o=null;#r=null;#s=null;#a=null;static#h=null;constructor(t){this.#n=t,ts.#h||=Object.freeze({freetext:"pdfjs-editor-remove-freetext-button",highlight:"pdfjs-editor-remove-highlight-button",ink:"pdfjs-editor-remove-ink-button",stamp:"pdfjs-editor-remove-stamp-button",signature:"pdfjs-editor-remove-signature-button"})}render(){const t=this.#t=document.createElement("div");t.classList.add("editToolbar","hidden"),t.setAttribute("role","toolbar");const e=this.#n._uiManager._signal;e instanceof AbortSignal&&!e.aborted&&(t.addEventListener("contextmenu",si,{signal:e}),t.addEventListener("pointerdown",ts.#l,{signal:e}));const i=this.#i=document.createElement("div");i.className="buttons",t.append(i);const n=this.#n.toolbarPosition;if(n){const{style:s}=t,r=this.#n._uiManager.direction==="ltr"?1-n[0]:n[0];s.insetInlineEnd=`${100*r}%`,s.top=`calc(${100*n[1]}% + var(--editor-toolbar-vert-offset))`}return t}get div(){return this.#t}static#l(t){t.stopPropagation()}#u(t){this.#n._focusEventsAllowed=!1,Zt(t)}#d(t){this.#n._focusEventsAllowed=!0,Zt(t)}#f(t){const e=this.#n._uiManager._signal;return!(e instanceof AbortSignal)||e.aborted?!1:(t.addEventListener("focusin",this.#u.bind(this),{capture:!0,signal:e}),t.addEventListener("focusout",this.#d.bind(this),{capture:!0,signal:e}),t.addEventListener("contextmenu",si,{signal:e}),!0)}hide(){this.#t.classList.add("hidden"),this.#e?.hideDropdown()}show(){this.#t.classList.remove("hidden"),this.#o?.shown(),this.#r?.shown()}addDeleteButton(){const{editorType:t,_uiManager:e}=this.#n,i=document.createElement("button");i.classList.add("basic","deleteButton"),i.tabIndex=0,i.setAttribute("data-l10n-id",ts.#h[t]),this.#f(i)&&i.addEventListener("click",n=>{e.delete()},{signal:e._signal}),this.#i.append(i)}get#m(){const t=document.createElement("div");return t.className="divider",t}async addAltText(t){const e=await t.render();this.#f(e),this.#i.append(e,this.#m),this.#o=t}addComment(t,e=null){if(this.#r)return;const i=t.renderForToolbar();if(!i)return;this.#f(i);const n=this.#s=this.#m;e?(this.#i.insertBefore(i,e),this.#i.insertBefore(n,e)):this.#i.append(i,n),this.#r=t,t.toolbar=this}addColorPicker(t){if(this.#e)return;this.#e=t;const e=t.renderButton();this.#f(e),this.#i.append(e,this.#m)}async addEditSignatureButton(t){const e=this.#a=await t.renderEditButton(this.#n);this.#f(e),this.#i.append(e,this.#m)}removeButton(t){t==="comment"&&(this.#r?.removeToolbarCommentButton(),this.#r=null,this.#s?.remove(),this.#s=null)}async addButton(t,e){switch(t){case"colorPicker":e&&this.addColorPicker(e);break;case"altText":e&&await this.addAltText(e);break;case"editSignature":e&&await this.addEditSignatureButton(e);break;case"delete":this.addDeleteButton();break;case"comment":e&&this.addComment(e);break}}async addButtonBefore(t,e,i){if(!e&&t==="comment")return;const n=this.#i.querySelector(i);n&&t==="comment"&&this.addComment(e,n)}updateEditSignatureButton(t){this.#a&&(this.#a.title=t)}remove(){this.#t.remove(),this.#e?.destroy(),this.#e=null}}class ed{#t=null;#e=null;#n;constructor(t){this.#n=t}#i(){const t=this.#e=document.createElement("div");t.className="editToolbar",t.setAttribute("role","toolbar");const e=this.#n._signal;e instanceof AbortSignal&&!e.aborted&&t.addEventListener("contextmenu",si,{signal:e});const i=this.#t=document.createElement("div");return i.className="buttons",t.append(i),this.#n.hasCommentManager()&&this.#r("commentButton","pdfjs-comment-floating-button","pdfjs-comment-floating-button-label",()=>{this.#n.commentSelection("floating_button")}),this.#r("highlightButton","pdfjs-highlight-floating-button1","pdfjs-highlight-floating-button-label",()=>{this.#n.highlightSelection("floating_button")}),t}#o(t,e){let i=0,n=0;for(const s of t){const r=s.y+s.height;if(r<i)continue;const o=s.x+(e?s.width:0);if(r>i){n=o,i=r;continue}e?o>n&&(n=o):o<n&&(n=o)}return[e?1-n:n,i]}show(t,e,i){const[n,s]=this.#o(e,i),{style:r}=this.#e||=this.#i();t.append(this.#e),r.insetInlineEnd=`${100*n}%`,r.top=`calc(${100*s}% + var(--editor-toolbar-vert-offset))`}hide(){this.#e.remove()}#r(t,e,i,n){const s=document.createElement("button");s.classList.add("basic",t),s.tabIndex=0,s.setAttribute("data-l10n-id",e);const r=document.createElement("span");s.append(r),r.className="visuallyHidden",r.setAttribute("data-l10n-id",i);const o=this.#n._signal;o instanceof AbortSignal&&!o.aborted&&(s.addEventListener("contextmenu",si,{signal:o}),s.addEventListener("click",n,{signal:o})),this.#t.append(s)}}function Nl(a,t,e){for(const i of e)t.addEventListener(i,a[i].bind(a))}class kt{static#t=NaN;static#e=null;static#n=NaN;static#i=null;static initializeAndAddPointerId(t){(kt.#e||=new Set).add(t)}static setPointer(t,e){kt.#t||=e,kt.#i??=t}static setTimeStamp(t){kt.#n=t}static isSamePointerId(t){return kt.#t===t}static isSamePointerIdOrRemove(t){return kt.#t===t?!0:(kt.#e?.delete(t),!1)}static isSamePointerType(t){return kt.#i===t}static isInitializedAndDifferentPointerType(t){return kt.#i!==null&&!kt.isSamePointerType(t)}static isSameTimeStamp(t){return kt.#n===t}static isUsingMultiplePointers(){return kt.#e?.size>=1}static clearPointerType(){kt.#i=null}static clearPointerIds(){kt.#t=NaN,kt.#e=null}static clearTimeStamp(){kt.#n=NaN}}class id{#t=0;get id(){return`${ls}${this.#t++}`}}class Io{#t=Ml();#e=0;#n=null;static get _isSVGFittingCanvas(){const t='data:image/svg+xml;charset=UTF-8,<svg viewBox="0 0 1 1" width="1" height="1" xmlns="http://www.w3.org/2000/svg"><rect width="1" height="1" style="fill:red;"/></svg>',i=new OffscreenCanvas(1,3).getContext("2d",{willReadFrequently:!0}),n=new Image;n.src=t;const s=n.decode().then(()=>(i.drawImage(n,0,0,1,1,0,0,1,3),new Uint32Array(i.getImageData(0,0,1,1).data.buffer)[0]===0));return pt(this,"_isSVGFittingCanvas",s)}async#i(t,e){this.#n||=new Map;let i=this.#n.get(t);if(i===null)return null;if(i?.bitmap)return i.refCounter+=1,i;try{i||={bitmap:null,id:`image_${this.#t}_${this.#e++}`,refCounter:0,isSvg:!1};let n;if(typeof e=="string"?(i.url=e,n=await bs(e,"blob")):e instanceof File?n=i.file=e:e instanceof Blob&&(n=e),n.type==="image/svg+xml"){const s=Io._isSVGFittingCanvas,r=new FileReader,o=new Image,l=new Promise((h,c)=>{o.onload=()=>{i.bitmap=o,i.isSvg=!0,h()},r.onload=async()=>{const u=i.svgUrl=r.result;o.src=await s?`${u}#svgView(preserveAspectRatio(none))`:u},o.onerror=r.onerror=c});r.readAsDataURL(n),await l}else i.bitmap=await createImageBitmap(n);i.refCounter=1}catch(n){ft(n),i=null}return this.#n.set(t,i),i&&this.#n.set(i.id,i),i}async getFromFile(t){const{lastModified:e,name:i,size:n,type:s}=t;return this.#i(`${e}_${i}_${n}_${s}`,t)}async getFromUrl(t){return this.#i(t,t)}async getFromBlob(t,e){const i=await e;return this.#i(t,i)}async getFromId(t){this.#n||=new Map;const e=this.#n.get(t);if(!e)return null;if(e.bitmap)return e.refCounter+=1,e;if(e.file)return this.getFromFile(e.file);if(e.blobPromise){const{blobPromise:i}=e;return delete e.blobPromise,this.getFromBlob(e.id,i)}return this.getFromUrl(e.url)}getFromCanvas(t,e){this.#n||=new Map;let i=this.#n.get(t);if(i?.bitmap)return i.refCounter+=1,i;const n=new OffscreenCanvas(e.width,e.height);return n.getContext("2d").drawImage(e,0,0),i={bitmap:n.transferToImageBitmap(),id:`image_${this.#t}_${this.#e++}`,refCounter:1,isSvg:!1},this.#n.set(t,i),this.#n.set(i.id,i),i}getSvgUrl(t){const e=this.#n.get(t);return e?.isSvg?e.svgUrl:null}deleteId(t){this.#n||=new Map;const e=this.#n.get(t);if(!e||(e.refCounter-=1,e.refCounter!==0))return;const{bitmap:i}=e;if(!e.url&&!e.file){const n=new OffscreenCanvas(i.width,i.height);n.getContext("bitmaprenderer").transferFromImageBitmap(i),e.blobPromise=n.convertToBlob()}i.close?.(),e.bitmap=null}isValidId(t){return t.startsWith(`image_${this.#t}_`)}}class nd{#t=[];#e=!1;#n;#i=-1;constructor(t=128){this.#n=t}add({cmd:t,undo:e,post:i,mustExec:n,type:s=NaN,overwriteIfSameType:r=!1,keepUndo:o=!1}){if(n&&t(),this.#e)return;const l={cmd:t,undo:e,post:i,type:s};if(this.#i===-1){this.#t.length>0&&(this.#t.length=0),this.#i=0,this.#t.push(l);return}if(r&&this.#t[this.#i].type===s){o&&(l.undo=this.#t[this.#i].undo),this.#t[this.#i]=l;return}const h=this.#i+1;h===this.#n?this.#t.splice(0,1):(this.#i=h,h<this.#t.length&&this.#t.splice(h)),this.#t.push(l)}undo(){if(this.#i===-1)return;this.#e=!0;const{undo:t,post:e}=this.#t[this.#i];t(),e?.(),this.#e=!1,this.#i-=1}redo(){if(this.#i<this.#t.length-1){this.#i+=1,this.#e=!0;const{cmd:t,post:e}=this.#t[this.#i];t(),e?.(),this.#e=!1}}hasSomethingToUndo(){return this.#i!==-1}hasSomethingToRedo(){return this.#i<this.#t.length-1}cleanType(t){if(this.#i!==-1){for(let e=this.#i;e>=0;e--)if(this.#t[e].type!==t){this.#t.splice(e+1,this.#i-e),this.#i=e;return}this.#t.length=0,this.#i=-1}}destroy(){this.#t=null}}class vs{constructor(t){this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;const{isMac:e}=fe.platform;for(const[i,n,s={}]of t)for(const r of i){const o=r.startsWith("mac+");e&&o?(this.callbacks.set(r.slice(4),{callback:n,options:s}),this.allKeys.add(r.split("+").at(-1))):!e&&!o&&(this.callbacks.set(r,{callback:n,options:s}),this.allKeys.add(r.split("+").at(-1)))}}#t(t){t.altKey&&this.buffer.push("alt"),t.ctrlKey&&this.buffer.push("ctrl"),t.metaKey&&this.buffer.push("meta"),t.shiftKey&&this.buffer.push("shift"),this.buffer.push(t.key);const e=this.buffer.join("+");return this.buffer.length=0,e}exec(t,e){if(!this.allKeys.has(e.key))return;const i=this.callbacks.get(this.#t(e));if(!i)return;const{callback:n,options:{bubbles:s=!1,args:r=[],checker:o=null}}=i;o&&!o(t,e)||(n.bind(t,...r,e)(),s||Zt(e))}}class Lo{static _colorsMapping=new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]);get _colors(){const t=new Map([["CanvasText",null],["Canvas",null]]);return Kc(t),pt(this,"_colors",t)}convert(t){const e=ws(t);if(!window.matchMedia("(forced-colors: active)").matches)return e;for(const[i,n]of this._colors)if(n.every((s,r)=>s===e[r]))return Lo._colorsMapping.get(i);return e}getHexCode(t){const e=this._colors.get(t);return e?J.makeHexColor(...e):t}}class Wi{#t=new AbortController;#e=null;#n=null;#i=new Map;#o=new Map;#r=null;#s=null;#a=null;#h=new nd;#l=null;#u=null;#d=null;#f=0;#m=new Set;#g=null;#c=null;#p=new Set;_editorUndoBar=null;#b=!1;#w=!1;#y=!1;#C=null;#S=null;#A=null;#P=null;#v=!1;#x=null;#k=new id;#T=!1;#D=!1;#N=!1;#M=null;#L=null;#B=null;#R=null;#G=null;#_=gt.NONE;#E=new Set;#I=null;#U=null;#H=null;#q=null;#W=null;#X={isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1,hasSelectedText:!1};#j=[0,0];#O=null;#V=null;#Q=null;#Z=null;#$=null;static TRANSLATE_SMALL=1;static TRANSLATE_BIG=10;static get _keyboardManager(){const t=Wi.prototype,e=r=>r.#V.contains(document.activeElement)&&document.activeElement.tagName!=="BUTTON"&&r.hasSomethingToControl(),i=(r,{target:o})=>{if(o instanceof HTMLInputElement){const{type:l}=o;return l!=="text"&&l!=="number"}return!0},n=this.TRANSLATE_SMALL,s=this.TRANSLATE_BIG;return pt(this,"_keyboardManager",new vs([[["ctrl+a","mac+meta+a"],t.selectAll,{checker:i}],[["ctrl+z","mac+meta+z"],t.undo,{checker:i}],[["ctrl+y","ctrl+shift+z","mac+meta+shift+z","ctrl+shift+Z","mac+meta+shift+Z"],t.redo,{checker:i}],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete","mac+Delete"],t.delete,{checker:i}],[["Enter","mac+Enter"],t.addNewEditorFromKeyboard,{checker:(r,{target:o})=>!(o instanceof HTMLButtonElement)&&r.#V.contains(o)&&!r.isEnterHandled}],[[" ","mac+ "],t.addNewEditorFromKeyboard,{checker:(r,{target:o})=>!(o instanceof HTMLButtonElement)&&r.#V.contains(document.activeElement)}],[["Escape","mac+Escape"],t.unselectAll],[["ArrowLeft","mac+ArrowLeft"],t.translateSelectedEditors,{args:[-n,0],checker:e}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t.translateSelectedEditors,{args:[-s,0],checker:e}],[["ArrowRight","mac+ArrowRight"],t.translateSelectedEditors,{args:[n,0],checker:e}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t.translateSelectedEditors,{args:[s,0],checker:e}],[["ArrowUp","mac+ArrowUp"],t.translateSelectedEditors,{args:[0,-n],checker:e}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t.translateSelectedEditors,{args:[0,-s],checker:e}],[["ArrowDown","mac+ArrowDown"],t.translateSelectedEditors,{args:[0,n],checker:e}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t.translateSelectedEditors,{args:[0,s],checker:e}]]))}constructor(t,e,i,n,s,r,o,l,h,c,u,p,b,w,v,x){const E=this._signal=this.#t.signal;this.#V=t,this.#Q=e,this.#Z=i,this.#r=n,this.#l=s,this.#U=r,this.#W=l,this._eventBus=o,o._on("editingaction",this.onEditingAction.bind(this),{signal:E}),o._on("pagechanging",this.onPageChanging.bind(this),{signal:E}),o._on("scalechanging",this.onScaleChanging.bind(this),{signal:E}),o._on("rotationchanging",this.onRotationChanging.bind(this),{signal:E}),o._on("setpreference",this.onSetPreference.bind(this),{signal:E}),o._on("switchannotationeditorparams",D=>this.updateParams(D.type,D.value),{signal:E}),window.addEventListener("pointerdown",()=>{this.#D=!0},{capture:!0,signal:E}),window.addEventListener("pointerup",()=>{this.#D=!1},{capture:!0,signal:E}),this.#ot(),this.#ut(),this.#et(),this.#s=l.annotationStorage,this.#C=l.filterFactory,this.#H=h,this.#P=c||null,this.#b=u,this.#w=p,this.#y=b,this.#G=w||null,this.viewParameters={realScale:Ln.PDF_TO_CSS_UNITS,rotation:0},this.isShiftKeyDown=!1,this._editorUndoBar=v||null,this._supportsPinchToZoom=x!==!1,s?.setSidebarUiManager(this)}destroy(){this.#$?.resolve(),this.#$=null,this.#t?.abort(),this.#t=null,this._signal=null;for(const t of this.#o.values())t.destroy();this.#o.clear(),this.#i.clear(),this.#p.clear(),this.#R?.clear(),this.#e=null,this.#E.clear(),this.#h.destroy(),this.#r?.destroy(),this.#l?.destroy(),this.#U?.destroy(),this.#x?.hide(),this.#x=null,this.#B?.destroy(),this.#B=null,this.#n=null,this.#S&&(clearTimeout(this.#S),this.#S=null),this.#O&&(clearTimeout(this.#O),this.#O=null),this._editorUndoBar?.destroy(),this.#W=null}combinedSignal(t){return AbortSignal.any([this._signal,t.signal])}get mlManager(){return this.#G}get useNewAltTextFlow(){return this.#w}get useNewAltTextWhenAddingImage(){return this.#y}get hcmFilter(){return pt(this,"hcmFilter",this.#H?this.#C.addHCMFilter(this.#H.foreground,this.#H.background):"none")}get direction(){return pt(this,"direction",getComputedStyle(this.#V).direction)}get _highlightColors(){return pt(this,"_highlightColors",this.#P?new Map(this.#P.split(",").map(t=>(t=t.split("=").map(e=>e.trim()),t[1]=t[1].toUpperCase(),t))):null)}get highlightColors(){const{_highlightColors:t}=this;if(!t)return pt(this,"highlightColors",null);const e=new Map,i=!!this.#H;for(const[n,s]of t){const r=n.endsWith("_HCM");if(i&&r){e.set(n.replace("_HCM",""),s);continue}!i&&!r&&e.set(n,s)}return pt(this,"highlightColors",e)}get highlightColorNames(){return pt(this,"highlightColorNames",this.highlightColors?new Map(Array.from(this.highlightColors,t=>t.reverse())):null)}getNonHCMColor(t){if(!this._highlightColors)return t;const e=this.highlightColorNames.get(t);return this._highlightColors.get(e)||t}getNonHCMColorName(t){return this.highlightColorNames.get(t)||t}setCurrentDrawingSession(t){t?(this.unselectAll(),this.disableUserSelect(!0)):this.disableUserSelect(!1),this.#d=t}setMainHighlightColorPicker(t){this.#B=t}editAltText(t,e=!1){this.#r?.editAltText(this,t,e)}hasCommentManager(){return!!this.#l}editComment(t,e,i,n){this.#l?.showDialog(this,t,e,i,n)}selectComment(t,e){this.#o.get(t)?.getEditorByUID(e)?.toggleComment(!0,!0)}updateComment(t){this.#l?.updateComment(t.getData())}updatePopupColor(t){this.#l?.updatePopupColor(t)}removeComment(t){this.#l?.removeComments([t.uid])}toggleComment(t,e,i=void 0){this.#l?.toggleCommentPopup(t,e,i)}makeCommentColor(t,e){return t&&this.#l?.makeCommentColor(t,e)||null}getCommentDialogElement(){return this.#l?.dialogElement||null}async waitForEditorsRendered(t){if(this.#o.has(t-1))return;const{resolve:e,promise:i}=Promise.withResolvers(),n=s=>{s.pageNumber===t&&(this._eventBus._off("editorsrendered",n),e())};this._eventBus.on("editorsrendered",n),await i}getSignature(t){this.#U?.getSignature({uiManager:this,editor:t})}get signatureManager(){return this.#U}switchToMode(t,e){this._eventBus.on("annotationeditormodechanged",e,{once:!0,signal:this._signal}),this._eventBus.dispatch("showannotationeditorui",{source:this,mode:t})}setPreference(t,e){this._eventBus.dispatch("setpreference",{source:this,name:t,value:e})}onSetPreference({name:t,value:e}){t==="enableNewAltTextWhenAddingImage"&&(this.#y=e)}onPageChanging({pageNumber:t}){this.#f=t-1}focusMainContainer(){this.#V.focus()}findParent(t,e){for(const i of this.#o.values()){const{x:n,y:s,width:r,height:o}=i.div.getBoundingClientRect();if(t>=n&&t<=n+r&&e>=s&&e<=s+o)return i}return null}disableUserSelect(t=!1){this.#Q.classList.toggle("noUserSelect",t)}addShouldRescale(t){this.#p.add(t)}removeShouldRescale(t){this.#p.delete(t)}onScaleChanging({scale:t}){this.commitOrRemove(),this.viewParameters.realScale=t*Ln.PDF_TO_CSS_UNITS;for(const e of this.#p)e.onScaleChanging();this.#d?.onScaleChanging()}onRotationChanging({pagesRotation:t}){this.commitOrRemove(),this.viewParameters.rotation=t}#J({anchorNode:t}){return t.nodeType===Node.TEXT_NODE?t.parentElement:t}#tt(t){const{currentLayer:e}=this;if(e.hasTextLayer(t))return e;for(const i of this.#o.values())if(i.hasTextLayer(t))return i;return null}highlightSelection(t="",e=!1){const i=document.getSelection();if(!i||i.isCollapsed)return;const{anchorNode:n,anchorOffset:s,focusNode:r,focusOffset:o}=i,l=i.toString(),c=this.#J(i).closest(".textLayer"),u=this.getSelectionBoxes(c);if(!u)return;i.empty();const p=this.#tt(c),b=this.#_===gt.NONE,w=()=>{const v=p?.createAndAddNewEditor({x:0,y:0},!1,{methodOfCreation:t,boxes:u,anchorNode:n,anchorOffset:s,focusNode:r,focusOffset:o,text:l});b&&this.showAllEditors("highlight",!0,!0),e&&v?.editComment()};if(b){this.switchToMode(gt.HIGHLIGHT,w);return}w()}commentSelection(t=""){this.highlightSelection(t,!0)}#st(){const t=document.getSelection();if(!t||t.isCollapsed)return;const i=this.#J(t).closest(".textLayer"),n=this.getSelectionBoxes(i);n&&(this.#x||=new ed(this),this.#x.show(i,n,this.direction==="ltr"))}getAndRemoveDataFromAnnotationStorage(t){if(!this.#s)return null;const e=`${ls}${t}`,i=this.#s.getRawValue(e);return i&&this.#s.remove(e),i}addToAnnotationStorage(t){!t.isEmpty()&&this.#s&&!this.#s.has(t.id)&&this.#s.setValue(t.id,t)}a11yAlert(t,e=null){const i=this.#Z;i&&(i.setAttribute("data-l10n-id",t),e?i.setAttribute("data-l10n-args",JSON.stringify(e)):i.removeAttribute("data-l10n-args"))}#rt(){const t=document.getSelection();if(!t||t.isCollapsed){this.#I&&(this.#x?.hide(),this.#I=null,this.#F({hasSelectedText:!1}));return}const{anchorNode:e}=t;if(e===this.#I)return;const n=this.#J(t).closest(".textLayer");if(!n){this.#I&&(this.#x?.hide(),this.#I=null,this.#F({hasSelectedText:!1}));return}if(this.#x?.hide(),this.#I=e,this.#F({hasSelectedText:!0}),!(this.#_!==gt.HIGHLIGHT&&this.#_!==gt.NONE)&&(this.#_===gt.HIGHLIGHT&&this.showAllEditors("highlight",!0,!0),this.#v=this.isShiftKeyDown,!this.isShiftKeyDown)){const s=this.#_===gt.HIGHLIGHT?this.#tt(n):null;if(s?.toggleDrawing(),this.#D){const r=new AbortController,o=this.combinedSignal(r),l=h=>{h.type==="pointerup"&&h.button!==0||(r.abort(),s?.toggleDrawing(!0),h.type==="pointerup"&&this.#Y("main_toolbar"))};window.addEventListener("pointerup",l,{signal:o}),window.addEventListener("blur",l,{signal:o})}else s?.toggleDrawing(!0),this.#Y("main_toolbar")}}#Y(t=""){this.#_===gt.HIGHLIGHT?this.highlightSelection(t):this.#b&&this.#st()}#ot(){document.addEventListener("selectionchange",this.#rt.bind(this),{signal:this._signal})}#at(){if(this.#A)return;this.#A=new AbortController;const t=this.combinedSignal(this.#A);window.addEventListener("focus",this.focus.bind(this),{signal:t}),window.addEventListener("blur",this.blur.bind(this),{signal:t})}#lt(){this.#A?.abort(),this.#A=null}blur(){if(this.isShiftKeyDown=!1,this.#v&&(this.#v=!1,this.#Y("main_toolbar")),!this.hasSelection)return;const{activeElement:t}=document;for(const e of this.#E)if(e.div.contains(t)){this.#L=[e,t],e._focusEventsAllowed=!1;break}}focus(){if(!this.#L)return;const[t,e]=this.#L;this.#L=null,e.addEventListener("focusin",()=>{t._focusEventsAllowed=!0},{once:!0,signal:this._signal}),e.focus()}#et(){if(this.#M)return;this.#M=new AbortController;const t=this.combinedSignal(this.#M);window.addEventListener("keydown",this.keydown.bind(this),{signal:t}),window.addEventListener("keyup",this.keyup.bind(this),{signal:t})}#ht(){this.#M?.abort(),this.#M=null}#ct(){if(this.#u)return;this.#u=new AbortController;const t=this.combinedSignal(this.#u);document.addEventListener("copy",this.copy.bind(this),{signal:t}),document.addEventListener("cut",this.cut.bind(this),{signal:t}),document.addEventListener("paste",this.paste.bind(this),{signal:t})}#dt(){this.#u?.abort(),this.#u=null}#ut(){const t=this._signal;document.addEventListener("dragover",this.dragOver.bind(this),{signal:t}),document.addEventListener("drop",this.drop.bind(this),{signal:t})}addEditListeners(){this.#et(),this.setEditingState(!0)}removeEditListeners(){this.#ht(),this.setEditingState(!1)}dragOver(t){for(const{type:e}of t.dataTransfer.items)for(const i of this.#c)if(i.isHandlingMimeForPasting(e)){t.dataTransfer.dropEffect="copy",t.preventDefault();return}}drop(t){for(const e of t.dataTransfer.items)for(const i of this.#c)if(i.isHandlingMimeForPasting(e.type)){i.paste(e,this.currentLayer),t.preventDefault();return}}copy(t){if(t.preventDefault(),this.#e?.commitOrRemove(),!this.hasSelection)return;const e=[];for(const i of this.#E){const n=i.serialize(!0);n&&e.push(n)}e.length!==0&&t.clipboardData.setData("application/pdfjs",JSON.stringify(e))}cut(t){this.copy(t),this.delete()}async paste(t){t.preventDefault();const{clipboardData:e}=t;for(const s of e.items)for(const r of this.#c)if(r.isHandlingMimeForPasting(s.type)){r.paste(s,this.currentLayer);return}let i=e.getData("application/pdfjs");if(!i)return;try{i=JSON.parse(i)}catch(s){ft(`paste: "${s.message}".`);return}if(!Array.isArray(i))return;this.unselectAll();const n=this.currentLayer;try{const s=[];for(const l of i){const h=await n.deserialize(l);if(!h)return;s.push(h)}const r=()=>{for(const l of s)this.#it(l);this.#nt(s)},o=()=>{for(const l of s)l.remove()};this.addCommands({cmd:r,undo:o,mustExec:!0})}catch(s){ft(`paste: "${s.message}".`)}}keydown(t){!this.isShiftKeyDown&&t.key==="Shift"&&(this.isShiftKeyDown=!0),this.#_!==gt.NONE&&!this.isEditorHandlingKeyboard&&Wi._keyboardManager.exec(this,t)}keyup(t){this.isShiftKeyDown&&t.key==="Shift"&&(this.isShiftKeyDown=!1,this.#v&&(this.#v=!1,this.#Y("main_toolbar")))}onEditingAction({name:t}){switch(t){case"undo":case"redo":case"delete":case"selectAll":this[t]();break;case"highlightSelection":this.highlightSelection("context_menu");break;case"commentSelection":this.commentSelection("context_menu");break}}#F(t){Object.entries(t).some(([i,n])=>this.#X[i]!==n)&&(this._eventBus.dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(this.#X,t)}),this.#_===gt.HIGHLIGHT&&t.hasSelectedEditor===!1&&this.#z([[Et.HIGHLIGHT_FREE,!0]]))}#z(t){this._eventBus.dispatch("annotationeditorparamschanged",{source:this,details:t})}setEditingState(t){t?(this.#at(),this.#ct(),this.#F({isEditing:this.#_!==gt.NONE,isEmpty:this.#K(),hasSomethingToUndo:this.#h.hasSomethingToUndo(),hasSomethingToRedo:this.#h.hasSomethingToRedo(),hasSelectedEditor:!1})):(this.#lt(),this.#dt(),this.#F({isEditing:!1}),this.disableUserSelect(!1))}registerEditorTypes(t){if(!this.#c){this.#c=t;for(const e of this.#c)this.#z(e.defaultPropertiesToUpdate)}}getId(){return this.#k.id}get currentLayer(){return this.#o.get(this.#f)}getLayer(t){return this.#o.get(t)}get currentPageIndex(){return this.#f}addLayer(t){this.#o.set(t.pageIndex,t),this.#T?t.enable():t.disable()}removeLayer(t){this.#o.delete(t.pageIndex)}async updateMode(t,e=null,i=!1,n=!1,s=!1,r=!1){if(this.#_!==t&&!(this.#$&&(await this.#$.promise,!this.#$))){if(this.#$=Promise.withResolvers(),this.#d?.commitOrRemove(),this.#_===gt.POPUP&&this.#l?.hideSidebar(),this.#l?.destroyPopup(),this.#_=t,t===gt.NONE){this.setEditingState(!1),this.#pt();for(const o of this.#i.values())o.hideStandaloneCommentButton();this._editorUndoBar?.hide(),this.toggleComment(null),this.#$.resolve();return}for(const o of this.#i.values())o.addStandaloneCommentButton();t===gt.SIGNATURE&&await this.#U?.loadSignatures(),i&&kt.clearPointerType(),this.setEditingState(!0),await this.#ft(),this.unselectAll();for(const o of this.#o.values())o.updateMode(t);if(t===gt.POPUP){this.#n||=await this.#W.getAnnotationsByType(new Set(this.#c.map(h=>h._editorType)));const o=new Set,l=[];for(const h of this.#i.values()){const{annotationElementId:c,hasComment:u,deleted:p}=h;c&&o.add(c),u&&!p&&l.push(h.getData())}for(const h of this.#n){const{id:c,popupRef:u,contentsObj:p}=h;u&&p?.str&&!o.has(c)&&!this.#m.has(c)&&l.push(h)}this.#l?.showSidebar(l)}if(!e){n&&this.addNewEditorFromKeyboard(),this.#$.resolve();return}for(const o of this.#i.values())o.uid===e?(this.setSelected(o),r?o.editComment():s?o.enterInEditMode():o.focus()):o.unselect();this.#$.resolve()}}addNewEditorFromKeyboard(){this.currentLayer.canCreateNewEmptyEditor()&&this.currentLayer.addNewEditor()}updateToolbar(t){t.mode!==this.#_&&this._eventBus.dispatch("switchannotationeditormode",{source:this,...t})}updateParams(t,e){if(this.#c){switch(t){case Et.CREATE:this.currentLayer.addNewEditor(e);return;case Et.HIGHLIGHT_SHOW_ALL:this._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:{type:"highlight",action:"toggle_visibility"}}}),(this.#q||=new Map).set(t,e),this.showAllEditors("highlight",e);break}if(this.hasSelection)for(const i of this.#E)i.updateParams(t,e);else for(const i of this.#c)i.updateDefaultParams(t,e)}}showAllEditors(t,e,i=!1){for(const s of this.#i.values())s.editorType===t&&s.show(e);(this.#q?.get(Et.HIGHLIGHT_SHOW_ALL)??!0)!==e&&this.#z([[Et.HIGHLIGHT_SHOW_ALL,e]])}enableWaiting(t=!1){if(this.#N!==t){this.#N=t;for(const e of this.#o.values())t?e.disableClick():e.enableClick(),e.div.classList.toggle("waiting",t)}}async#ft(){if(!this.#T){this.#T=!0;const t=[];for(const e of this.#o.values())t.push(e.enable());await Promise.all(t);for(const e of this.#i.values())e.enable()}}#pt(){if(this.unselectAll(),this.#T){this.#T=!1;for(const t of this.#o.values())t.disable();for(const t of this.#i.values())t.disable()}}*getEditors(t){for(const e of this.#i.values())e.pageIndex===t&&(yield e)}getEditor(t){return this.#i.get(t)}addEditor(t){this.#i.set(t.id,t)}removeEditor(t){t.div.contains(document.activeElement)&&(this.#S&&clearTimeout(this.#S),this.#S=setTimeout(()=>{this.focusMainContainer(),this.#S=null},0)),this.#i.delete(t.id),t.annotationElementId&&this.#R?.delete(t.annotationElementId),this.unselect(t),(!t.annotationElementId||!this.#m.has(t.annotationElementId))&&this.#s?.remove(t.id)}addDeletedAnnotationElement(t){this.#m.add(t.annotationElementId),this.addChangedExistingAnnotation(t),t.deleted=!0}isDeletedAnnotationElement(t){return this.#m.has(t)}removeDeletedAnnotationElement(t){this.#m.delete(t.annotationElementId),this.removeChangedExistingAnnotation(t),t.deleted=!1}#it(t){const e=this.#o.get(t.pageIndex);e?e.addOrRebuild(t):(this.addEditor(t),this.addToAnnotationStorage(t))}setActiveEditor(t){this.#e!==t&&(this.#e=t,t&&this.#z(t.propertiesToUpdate))}get#gt(){let t=null;for(t of this.#E);return t}updateUI(t){this.#gt===t&&this.#z(t.propertiesToUpdate)}updateUIForDefaultProperties(t){this.#z(t.defaultPropertiesToUpdate)}toggleSelected(t){if(this.#E.has(t)){this.#E.delete(t),t.unselect(),this.#F({hasSelectedEditor:this.hasSelection});return}this.#E.add(t),t.select(),this.#z(t.propertiesToUpdate),this.#F({hasSelectedEditor:!0})}setSelected(t){this.updateToolbar({mode:t.mode,editId:t.uid}),this.#d?.commitOrRemove();for(const e of this.#E)e!==t&&e.unselect();this.#E.clear(),this.#E.add(t),t.select(),this.#z(t.propertiesToUpdate),this.#F({hasSelectedEditor:!0})}isSelected(t){return this.#E.has(t)}get firstSelectedEditor(){return this.#E.values().next().value}unselect(t){t.unselect(),this.#E.delete(t),this.#F({hasSelectedEditor:this.hasSelection})}get hasSelection(){return this.#E.size!==0}get isEnterHandled(){return this.#E.size===1&&this.firstSelectedEditor.isEnterHandled}undo(){this.#h.undo(),this.#F({hasSomethingToUndo:this.#h.hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:this.#K()}),this._editorUndoBar?.hide()}redo(){this.#h.redo(),this.#F({hasSomethingToUndo:!0,hasSomethingToRedo:this.#h.hasSomethingToRedo(),isEmpty:this.#K()})}addCommands(t){this.#h.add(t),this.#F({hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:this.#K()})}cleanUndoStack(t){this.#h.cleanType(t)}#K(){if(this.#i.size===0)return!0;if(this.#i.size===1)for(const t of this.#i.values())return t.isEmpty();return!1}delete(){this.commitOrRemove();const t=this.currentLayer?.endDrawingSession(!0);if(!this.hasSelection&&!t)return;const e=t?[t]:[...this.#E],i=()=>{this._editorUndoBar?.show(n,e.length===1?e[0].editorType:e.length);for(const s of e)s.remove()},n=()=>{for(const s of e)this.#it(s)};this.addCommands({cmd:i,undo:n,mustExec:!0})}commitOrRemove(){this.#e?.commitOrRemove()}hasSomethingToControl(){return this.#e||this.hasSelection}#nt(t){for(const e of this.#E)e.unselect();this.#E.clear();for(const e of t)e.isEmpty()||(this.#E.add(e),e.select());this.#F({hasSelectedEditor:this.hasSelection})}selectAll(){for(const t of this.#E)t.commit();this.#nt(this.#i.values())}unselectAll(){if(!(this.#e&&(this.#e.commitOrRemove(),this.#_!==gt.NONE))&&!this.#d?.commitOrRemove()&&this.hasSelection){for(const t of this.#E)t.unselect();this.#E.clear(),this.#F({hasSelectedEditor:!1})}}translateSelectedEditors(t,e,i=!1){if(i||this.commitOrRemove(),!this.hasSelection)return;this.#j[0]+=t,this.#j[1]+=e;const[n,s]=this.#j,r=[...this.#E],o=1e3;this.#O&&clearTimeout(this.#O),this.#O=setTimeout(()=>{this.#O=null,this.#j[0]=this.#j[1]=0,this.addCommands({cmd:()=>{for(const l of r)this.#i.has(l.id)&&(l.translateInPage(n,s),l.translationDone())},undo:()=>{for(const l of r)this.#i.has(l.id)&&(l.translateInPage(-n,-s),l.translationDone())},mustExec:!1})},o);for(const l of r)l.translateInPage(t,e),l.translationDone()}setUpDragSession(){if(this.hasSelection){this.disableUserSelect(!0),this.#g=new Map;for(const t of this.#E)this.#g.set(t,{savedX:t.x,savedY:t.y,savedPageIndex:t.pageIndex,newX:0,newY:0,newPageIndex:-1})}}endDragSession(){if(!this.#g)return!1;this.disableUserSelect(!1);const t=this.#g;this.#g=null;let e=!1;for(const[{x:n,y:s,pageIndex:r},o]of t)o.newX=n,o.newY=s,o.newPageIndex=r,e||=n!==o.savedX||s!==o.savedY||r!==o.savedPageIndex;if(!e)return!1;const i=(n,s,r,o)=>{if(this.#i.has(n.id)){const l=this.#o.get(o);l?n._setParentAndPosition(l,s,r):(n.pageIndex=o,n.x=s,n.y=r)}};return this.addCommands({cmd:()=>{for(const[n,{newX:s,newY:r,newPageIndex:o}]of t)i(n,s,r,o)},undo:()=>{for(const[n,{savedX:s,savedY:r,savedPageIndex:o}]of t)i(n,s,r,o)},mustExec:!0}),!0}dragSelectedEditors(t,e){if(this.#g)for(const i of this.#g.keys())i.drag(t,e)}rebuild(t){if(t.parent===null){const e=this.getLayer(t.pageIndex);e?(e.changeParent(t),e.addOrRebuild(t)):(this.addEditor(t),this.addToAnnotationStorage(t),t.rebuild())}else t.parent.addOrRebuild(t)}get isEditorHandlingKeyboard(){return this.getActive()?.shouldGetKeyboardEvents()||this.#E.size===1&&this.firstSelectedEditor.shouldGetKeyboardEvents()}isActive(t){return this.#e===t}getActive(){return this.#e}getMode(){return this.#_}isEditingMode(){return this.#_!==gt.NONE}get imageManager(){return pt(this,"imageManager",new Io)}getSelectionBoxes(t){if(!t)return null;const e=document.getSelection();for(let h=0,c=e.rangeCount;h<c;h++)if(!t.contains(e.getRangeAt(h).commonAncestorContainer))return null;const{x:i,y:n,width:s,height:r}=t.getBoundingClientRect();let o;switch(t.getAttribute("data-main-rotation")){case"90":o=(h,c,u,p)=>({x:(c-n)/r,y:1-(h+u-i)/s,width:p/r,height:u/s});break;case"180":o=(h,c,u,p)=>({x:1-(h+u-i)/s,y:1-(c+p-n)/r,width:u/s,height:p/r});break;case"270":o=(h,c,u,p)=>({x:1-(c+p-n)/r,y:(h-i)/s,width:p/r,height:u/s});break;default:o=(h,c,u,p)=>({x:(h-i)/s,y:(c-n)/r,width:u/s,height:p/r});break}const l=[];for(let h=0,c=e.rangeCount;h<c;h++){const u=e.getRangeAt(h);if(!u.collapsed)for(const{x:p,y:b,width:w,height:v}of u.getClientRects())w===0||v===0||l.push(o(p,b,w,v))}return l.length===0?null:l}addChangedExistingAnnotation({annotationElementId:t,id:e}){(this.#a||=new Map).set(t,e)}removeChangedExistingAnnotation({annotationElementId:t}){this.#a?.delete(t)}renderAnnotationElement(t){const e=this.#a?.get(t.data.id);if(!e)return;const i=this.#s.getRawValue(e);i&&(this.#_===gt.NONE&&!i.hasBeenModified||i.renderAnnotationElement(t))}setMissingCanvas(t,e,i){const n=this.#R?.get(t);n&&(n.setCanvas(e,i),this.#R.delete(t))}addMissingCanvas(t,e){(this.#R||=new Map).set(t,e)}}class vi{#t=null;#e=!1;#n=null;#i=null;#o=null;#r=null;#s=!1;#a=null;#h=null;#l=null;#u=null;#d=!1;static#f=null;static _l10n=null;constructor(t){this.#h=t,this.#d=t._uiManager.useNewAltTextFlow,vi.#f||=Object.freeze({added:"pdfjs-editor-new-alt-text-added-button","added-label":"pdfjs-editor-new-alt-text-added-button-label",missing:"pdfjs-editor-new-alt-text-missing-button","missing-label":"pdfjs-editor-new-alt-text-missing-button-label",review:"pdfjs-editor-new-alt-text-to-review-button","review-label":"pdfjs-editor-new-alt-text-to-review-button-label"})}static initialize(t){vi._l10n??=t}async render(){const t=this.#n=document.createElement("button");t.className="altText",t.tabIndex="0";const e=this.#i=document.createElement("span");t.append(e),this.#d?(t.classList.add("new"),t.setAttribute("data-l10n-id",vi.#f.missing),e.setAttribute("data-l10n-id",vi.#f["missing-label"])):(t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button"),e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button-label"));const i=this.#h._uiManager._signal;t.addEventListener("contextmenu",si,{signal:i}),t.addEventListener("pointerdown",s=>s.stopPropagation(),{signal:i});const n=s=>{s.preventDefault(),this.#h._uiManager.editAltText(this.#h),this.#d&&this.#h._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_clicked",data:{label:this.#m}})};return t.addEventListener("click",n,{capture:!0,signal:i}),t.addEventListener("keydown",s=>{s.target===t&&s.key==="Enter"&&(this.#s=!0,n(s))},{signal:i}),await this.#g(),t}get#m(){return this.#t&&"added"||this.#t===null&&this.guessedText&&"review"||"missing"}finish(){this.#n&&(this.#n.focus({focusVisible:this.#s}),this.#s=!1)}isEmpty(){return this.#d?this.#t===null:!this.#t&&!this.#e}hasData(){return this.#d?this.#t!==null||!!this.#l:this.isEmpty()}get guessedText(){return this.#l}async setGuessedText(t){this.#t===null&&(this.#l=t,this.#u=await vi._l10n.get("pdfjs-editor-new-alt-text-generated-alt-text-with-disclaimer",{generatedAltText:t}),this.#g())}toggleAltTextBadge(t=!1){if(!this.#d||this.#t){this.#a?.remove(),this.#a=null;return}if(!this.#a){const e=this.#a=document.createElement("div");e.className="noAltTextBadge",this.#h.div.append(e)}this.#a.classList.toggle("hidden",!t)}serialize(t){let e=this.#t;return!t&&this.#l===e&&(e=this.#u),{altText:e,decorative:this.#e,guessedText:this.#l,textWithDisclaimer:this.#u}}get data(){return{altText:this.#t,decorative:this.#e}}set data({altText:t,decorative:e,guessedText:i,textWithDisclaimer:n,cancel:s=!1}){i&&(this.#l=i,this.#u=n),!(this.#t===t&&this.#e===e)&&(s||(this.#t=t,this.#e=e),this.#g())}toggle(t=!1){this.#n&&(!t&&this.#r&&(clearTimeout(this.#r),this.#r=null),this.#n.disabled=!t)}shown(){this.#h._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_displayed",data:{label:this.#m}})}destroy(){this.#n?.remove(),this.#n=null,this.#i=null,this.#o=null,this.#a?.remove(),this.#a=null}async#g(){const t=this.#n;if(!t)return;if(this.#d){if(t.classList.toggle("done",!!this.#t),t.setAttribute("data-l10n-id",vi.#f[this.#m]),this.#i?.setAttribute("data-l10n-id",vi.#f[`${this.#m}-label`]),!this.#t){this.#o?.remove();return}}else{if(!this.#t&&!this.#e){t.classList.remove("done"),this.#o?.remove();return}t.classList.add("done"),t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-edit-button")}let e=this.#o;if(!e){this.#o=e=document.createElement("span"),e.className="tooltip",e.setAttribute("role","tooltip"),e.id=`alt-text-tooltip-${this.#h.id}`;const n=100,s=this.#h._uiManager._signal;s.addEventListener("abort",()=>{clearTimeout(this.#r),this.#r=null},{once:!0}),t.addEventListener("mouseenter",()=>{this.#r=setTimeout(()=>{this.#r=null,this.#o.classList.add("show"),this.#h._reportTelemetry({action:"alt_text_tooltip"})},n)},{signal:s}),t.addEventListener("mouseleave",()=>{this.#r&&(clearTimeout(this.#r),this.#r=null),this.#o?.classList.remove("show")},{signal:s})}this.#e?e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-decorative-tooltip"):(e.removeAttribute("data-l10n-id"),e.textContent=this.#t),e.parentNode||t.append(e),this.#h.getElementForAltText()?.setAttribute("aria-describedby",e.id)}}class ks{#t=null;#e=null;#n=!1;#i=null;#o=null;#r=null;#s=null;#a=null;#h=!1;#l=null;constructor(t){this.#i=t}renderForToolbar(){const t=this.#e=document.createElement("button");return t.className="comment",this.#u(t,!1)}renderForStandalone(){const t=this.#t=document.createElement("button");t.className="annotationCommentButton";const e=this.#i.commentButtonPosition;if(e){const{style:i}=t;i.insetInlineEnd=`calc(${100*(this.#i._uiManager.direction==="ltr"?1-e[0]:e[0])}% - var(--comment-button-dim))`,i.top=`calc(${100*e[1]}% - var(--comment-button-dim))`;const n=this.#i.commentButtonColor;n&&(i.backgroundColor=n)}return this.#u(t,!0)}focusButton(){setTimeout(()=>{(this.#t??this.#e)?.focus()},0)}onUpdatedColor(){if(!this.#t)return;const t=this.#i.commentButtonColor;t&&(this.#t.style.backgroundColor=t),this.#i._uiManager.updatePopupColor(this.#i)}get commentButtonWidth(){return(this.#t?.getBoundingClientRect().width??0)/this.#i.parent.boundingClientRect.width}get commentPopupPositionInLayer(){if(this.#l)return this.#l;if(!this.#t)return null;const{x:t,y:e,height:i}=this.#t.getBoundingClientRect(),{x:n,y:s,width:r,height:o}=this.#i.parent.boundingClientRect;return[(t-n)/r,(e+i-s)/o]}set commentPopupPositionInLayer(t){this.#l=t}hasDefaultPopupPosition(){return this.#l===null}removeStandaloneCommentButton(){this.#t?.remove(),this.#t=null}removeToolbarCommentButton(){this.#e?.remove(),this.#e=null}setCommentButtonStates({selected:t,hasPopup:e}){this.#t&&(this.#t.classList.toggle("selected",t),this.#t.ariaExpanded=e)}#u(t,e){if(!this.#i._uiManager.hasCommentManager())return null;t.tabIndex="0",t.ariaHasPopup="dialog",e?(t.ariaControls="commentPopup",t.setAttribute("data-l10n-id","pdfjs-show-comment-button")):(t.ariaControlsElements=[this.#i._uiManager.getCommentDialogElement()],t.setAttribute("data-l10n-id","pdfjs-editor-add-comment-button"));const i=this.#i._uiManager._signal;if(!(i instanceof AbortSignal)||i.aborted)return t;t.addEventListener("contextmenu",si,{signal:i}),e&&(t.addEventListener("focusin",s=>{this.#i._focusEventsAllowed=!1,Zt(s)},{capture:!0,signal:i}),t.addEventListener("focusout",s=>{this.#i._focusEventsAllowed=!0,Zt(s)},{capture:!0,signal:i})),t.addEventListener("pointerdown",s=>s.stopPropagation(),{signal:i});const n=s=>{s.preventDefault(),t===this.#e?this.edit():this.#i.toggleComment(!0)};return t.addEventListener("click",n,{capture:!0,signal:i}),t.addEventListener("keydown",s=>{s.target===t&&s.key==="Enter"&&(this.#n=!0,n(s))},{signal:i}),t.addEventListener("pointerenter",()=>{this.#i.toggleComment(!1,!0)},{signal:i}),t.addEventListener("pointerleave",()=>{this.#i.toggleComment(!1,!1)},{signal:i}),t}edit(t){const e=this.commentPopupPositionInLayer;let i,n;if(e)[i,n]=e;else{[i,n]=this.#i.commentButtonPosition;const{width:c,height:u,x:p,y:b}=this.#i;i=p+i*c,n=b+n*u}const s=this.#i.parent.boundingClientRect,{x:r,y:o,width:l,height:h}=s;this.#i._uiManager.editComment(this.#i,r+i*l,o+n*h,{...t,parentDimensions:s})}finish(){this.#e&&(this.#e.focus({focusVisible:this.#n}),this.#n=!1)}isDeleted(){return this.#h||this.#s===""}isEmpty(){return this.#s===null}hasBeenEdited(){return this.isDeleted()||this.#s!==this.#o}serialize(){return this.data}get data(){return{text:this.#s,richText:this.#r,date:this.#a,deleted:this.isDeleted()}}set data(t){if(t!==this.#s&&(this.#r=null),t===null){this.#s="",this.#h=!0;return}this.#s=t,this.#a=new Date,this.#h=!1}setInitialText(t,e=null){this.#o=t,this.data=t,this.#a=null,this.#r=e}shown(){}destroy(){this.#e?.remove(),this.#e=null,this.#t?.remove(),this.#t=null,this.#s="",this.#r=null,this.#a=null,this.#i=null,this.#n=!1,this.#h=!1}}class yr{#t;#e=!1;#n=null;#i;#o;#r;#s;#a=null;#h;#l=null;#u;#d=null;constructor({container:t,isPinchingDisabled:e=null,isPinchingStopped:i=null,onPinchStart:n=null,onPinching:s=null,onPinchEnd:r=null,signal:o}){this.#t=t,this.#n=i,this.#i=e,this.#o=n,this.#r=s,this.#s=r,this.#u=new AbortController,this.#h=AbortSignal.any([o,this.#u.signal]),t.addEventListener("touchstart",this.#f.bind(this),{passive:!1,signal:this.#h})}get MIN_TOUCH_DISTANCE_TO_PINCH(){return 35/xi.pixelRatio}#f(t){if(this.#i?.())return;if(t.touches.length===1){if(this.#a)return;const n=this.#a=new AbortController,s=AbortSignal.any([this.#h,n.signal]),r=this.#t,o={capture:!0,signal:s,passive:!1},l=h=>{h.pointerType==="touch"&&(this.#a?.abort(),this.#a=null)};r.addEventListener("pointerdown",h=>{h.pointerType==="touch"&&(Zt(h),l(h))},o),r.addEventListener("pointerup",l,o),r.addEventListener("pointercancel",l,o);return}if(!this.#d){this.#d=new AbortController;const n=AbortSignal.any([this.#h,this.#d.signal]),s=this.#t,r={signal:n,capture:!1,passive:!1};s.addEventListener("touchmove",this.#m.bind(this),r);const o=this.#g.bind(this);s.addEventListener("touchend",o,r),s.addEventListener("touchcancel",o,r),r.capture=!0,s.addEventListener("pointerdown",Zt,r),s.addEventListener("pointermove",Zt,r),s.addEventListener("pointercancel",Zt,r),s.addEventListener("pointerup",Zt,r),this.#o?.()}if(Zt(t),t.touches.length!==2||this.#n?.()){this.#l=null;return}let[e,i]=t.touches;e.identifier>i.identifier&&([e,i]=[i,e]),this.#l={touch0X:e.screenX,touch0Y:e.screenY,touch1X:i.screenX,touch1Y:i.screenY}}#m(t){if(!this.#l||t.touches.length!==2)return;Zt(t);let[e,i]=t.touches;e.identifier>i.identifier&&([e,i]=[i,e]);const{screenX:n,screenY:s}=e,{screenX:r,screenY:o}=i,l=this.#l,{touch0X:h,touch0Y:c,touch1X:u,touch1Y:p}=l,b=u-h,w=p-c,v=r-n,x=o-s,E=Math.hypot(v,x)||1,D=Math.hypot(b,w)||1;if(!this.#e&&Math.abs(D-E)<=yr.MIN_TOUCH_DISTANCE_TO_PINCH)return;if(l.touch0X=n,l.touch0Y=s,l.touch1X=r,l.touch1Y=o,!this.#e){this.#e=!0;return}const T=[(n+r)/2,(s+o)/2];this.#r?.(T,D,E)}#g(t){t.touches.length>=2||(this.#d&&(this.#d.abort(),this.#d=null,this.#s?.()),this.#l&&(Zt(t),this.#l=null,this.#e=!1))}destroy(){this.#u?.abort(),this.#u=null,this.#a?.abort(),this.#a=null}}class nt{#t=null;#e=null;#n=null;#i=null;#o=null;#r=!1;#s=null;#a="";#h=null;#l=null;#u=null;#d=null;#f=null;#m="";#g=!1;#c=null;#p=!1;#b=!1;#w=!1;#y=null;#C=0;#S=0;#A=null;#P=null;isSelected=!1;_isCopy=!1;_editToolbar=null;_initialOptions=Object.create(null);_initialData=null;_isVisible=!0;_uiManager=null;_focusEventsAllowed=!0;static _l10n=null;static _l10nResizer=null;#v=!1;#x=nt._zIndex++;static _borderLineWidth=-1;static _colorManager=new Lo;static _zIndex=1;static _telemetryTimeout=1e3;static get _resizerKeyboardManager(){const t=nt.prototype._resizeWithKeyboard,e=Wi.TRANSLATE_SMALL,i=Wi.TRANSLATE_BIG;return pt(this,"_resizerKeyboardManager",new vs([[["ArrowLeft","mac+ArrowLeft"],t,{args:[-e,0]}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t,{args:[-i,0]}],[["ArrowRight","mac+ArrowRight"],t,{args:[e,0]}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t,{args:[i,0]}],[["ArrowUp","mac+ArrowUp"],t,{args:[0,-e]}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t,{args:[0,-i]}],[["ArrowDown","mac+ArrowDown"],t,{args:[0,e]}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t,{args:[0,i]}],[["Escape","mac+Escape"],nt.prototype._stopResizingWithKeyboard]]))}constructor(t){this.parent=t.parent,this.id=t.id,this.width=this.height=null,this.pageIndex=t.parent.pageIndex,this.name=t.name,this.div=null,this._uiManager=t.uiManager,this.annotationElementId=null,this._willKeepAspectRatio=!1,this._initialOptions.isCentered=t.isCentered,this._structTreeParentId=null,this.annotationElementId=t.annotationElementId||null,this.creationDate=t.creationDate||new Date,this.modificationDate=t.modificationDate||null,this.canAddComment=!0;const{rotation:e,rawDims:{pageWidth:i,pageHeight:n,pageX:s,pageY:r}}=this.parent.viewport;this.rotation=e,this.pageRotation=(360+e-this._uiManager.viewParameters.rotation)%360,this.pageDimensions=[i,n],this.pageTranslation=[s,r];const[o,l]=this.parentDimensions;this.x=t.x/o,this.y=t.y/l,this.isAttachedToDOM=!1,this.deleted=!1}get editorType(){return Object.getPrototypeOf(this).constructor._type}get mode(){return Object.getPrototypeOf(this).constructor._editorType}static get isDrawer(){return!1}static get _defaultLineColor(){return pt(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}static deleteAnnotationElement(t){const e=new sd({id:t.parent.getNextId(),parent:t.parent,uiManager:t._uiManager});e.annotationElementId=t.annotationElementId,e.deleted=!0,e._uiManager.addToAnnotationStorage(e)}static initialize(t,e){if(nt._l10n??=t,nt._l10nResizer||=Object.freeze({topLeft:"pdfjs-editor-resizer-top-left",topMiddle:"pdfjs-editor-resizer-top-middle",topRight:"pdfjs-editor-resizer-top-right",middleRight:"pdfjs-editor-resizer-middle-right",bottomRight:"pdfjs-editor-resizer-bottom-right",bottomMiddle:"pdfjs-editor-resizer-bottom-middle",bottomLeft:"pdfjs-editor-resizer-bottom-left",middleLeft:"pdfjs-editor-resizer-middle-left"}),nt._borderLineWidth!==-1)return;const i=getComputedStyle(document.documentElement);nt._borderLineWidth=parseFloat(i.getPropertyValue("--outline-width"))||0}static updateDefaultParams(t,e){}static get defaultPropertiesToUpdate(){return[]}static isHandlingMimeForPasting(t){return!1}static paste(t,e){Rt("Not implemented")}get propertiesToUpdate(){return[]}get _isDraggable(){return this.#v}set _isDraggable(t){this.#v=t,this.div?.classList.toggle("draggable",t)}get uid(){return this.annotationElementId||this.id}get isEnterHandled(){return!0}center(){const[t,e]=this.pageDimensions;switch(this.parentRotation){case 90:this.x-=this.height*e/(t*2),this.y+=this.width*t/(e*2);break;case 180:this.x+=this.width/2,this.y+=this.height/2;break;case 270:this.x+=this.height*e/(t*2),this.y-=this.width*t/(e*2);break;default:this.x-=this.width/2,this.y-=this.height/2;break}this.fixAndSetPosition()}addCommands(t){this._uiManager.addCommands(t)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=this.#x}setParent(t){t!==null?(this.pageIndex=t.pageIndex,this.pageDimensions=t.pageDimensions):(this.#O(),this.#d?.remove(),this.#d=null),this.parent=t}focusin(t){this._focusEventsAllowed&&(this.#g?this.#g=!1:this.parent.setSelected(this))}focusout(t){!this._focusEventsAllowed||!this.isAttachedToDOM||t.relatedTarget?.closest(`#${this.id}`)||(t.preventDefault(),this.parent?.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.isInEditMode()&&this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}setAt(t,e,i,n){const[s,r]=this.parentDimensions;[i,n]=this.screenToPageTranslation(i,n),this.x=(t+i)/s,this.y=(e+n)/r,this.fixAndSetPosition()}_moveAfterPaste(t,e){const[i,n]=this.parentDimensions;this.setAt(t*i,e*n,this.width*i,this.height*n),this._onTranslated()}#k([t,e],i,n){[i,n]=this.screenToPageTranslation(i,n),this.x+=i/t,this.y+=n/e,this._onTranslating(this.x,this.y),this.fixAndSetPosition()}translate(t,e){this.#k(this.parentDimensions,t,e)}translateInPage(t,e){this.#c||=[this.x,this.y,this.width,this.height],this.#k(this.pageDimensions,t,e),this.div.scrollIntoView({block:"nearest"})}translationDone(){this._onTranslated(this.x,this.y)}drag(t,e){this.#c||=[this.x,this.y,this.width,this.height];const{div:i,parentDimensions:[n,s]}=this;if(this.x+=t/n,this.y+=e/s,this.parent&&(this.x<0||this.x>1||this.y<0||this.y>1)){const{x:u,y:p}=this.div.getBoundingClientRect();this.parent.findNewParent(this,u,p)&&(this.x-=Math.floor(this.x),this.y-=Math.floor(this.y))}let{x:r,y:o}=this;const[l,h]=this.getBaseTranslation();r+=l,o+=h;const{style:c}=i;c.left=`${(100*r).toFixed(2)}%`,c.top=`${(100*o).toFixed(2)}%`,this._onTranslating(r,o),i.scrollIntoView({block:"nearest"})}_onTranslating(t,e){}_onTranslated(t,e){}get _hasBeenMoved(){return!!this.#c&&(this.#c[0]!==this.x||this.#c[1]!==this.y)}get _hasBeenResized(){return!!this.#c&&(this.#c[2]!==this.width||this.#c[3]!==this.height)}getBaseTranslation(){const[t,e]=this.parentDimensions,{_borderLineWidth:i}=nt,n=i/t,s=i/e;switch(this.rotation){case 90:return[-n,s];case 180:return[n,s];case 270:return[n,-s];default:return[-n,-s]}}get _mustFixPosition(){return!0}fixAndSetPosition(t=this.rotation){const{div:{style:e},pageDimensions:[i,n]}=this;let{x:s,y:r,width:o,height:l}=this;if(o*=i,l*=n,s*=i,r*=n,this._mustFixPosition)switch(t){case 0:s=Ie(s,0,i-o),r=Ie(r,0,n-l);break;case 90:s=Ie(s,0,i-l),r=Ie(r,o,n);break;case 180:s=Ie(s,o,i),r=Ie(r,l,n);break;case 270:s=Ie(s,l,i),r=Ie(r,0,n-o);break}this.x=s/=i,this.y=r/=n;const[h,c]=this.getBaseTranslation();s+=h,r+=c,e.left=`${(100*s).toFixed(2)}%`,e.top=`${(100*r).toFixed(2)}%`,this.moveInDOM()}static#T(t,e,i){switch(i){case 90:return[e,-t];case 180:return[-t,-e];case 270:return[-e,t];default:return[t,e]}}screenToPageTranslation(t,e){return nt.#T(t,e,this.parentRotation)}pageTranslationToScreen(t,e){return nt.#T(t,e,360-this.parentRotation)}#D(t){switch(t){case 90:{const[e,i]=this.pageDimensions;return[0,-e/i,i/e,0]}case 180:return[-1,0,0,-1];case 270:{const[e,i]=this.pageDimensions;return[0,e/i,-i/e,0]}default:return[1,0,0,1]}}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}get parentDimensions(){const{parentScale:t,pageDimensions:[e,i]}=this;return[e*t,i*t]}setDims(){const{div:{style:t},width:e,height:i}=this;t.width=`${(100*e).toFixed(2)}%`,t.height=`${(100*i).toFixed(2)}%`}getInitialTranslation(){return[0,0]}#N(){if(this.#h)return;this.#h=document.createElement("div"),this.#h.classList.add("resizers");const t=this._willKeepAspectRatio?["topLeft","topRight","bottomRight","bottomLeft"]:["topLeft","topMiddle","topRight","middleRight","bottomRight","bottomMiddle","bottomLeft","middleLeft"],e=this._uiManager._signal;for(const i of t){const n=document.createElement("div");this.#h.append(n),n.classList.add("resizer",i),n.setAttribute("data-resizer-name",i),n.addEventListener("pointerdown",this.#M.bind(this,i),{signal:e}),n.addEventListener("contextmenu",si,{signal:e}),n.tabIndex=-1}this.div.prepend(this.#h)}#M(t,e){e.preventDefault();const{isMac:i}=fe.platform;if(e.button!==0||e.ctrlKey&&i)return;this.#n?.toggle(!1);const n=this._isDraggable;this._isDraggable=!1,this.#l=[e.screenX,e.screenY];const s=new AbortController,r=this._uiManager.combinedSignal(s);this.parent.togglePointerEvents(!1),window.addEventListener("pointermove",this.#R.bind(this,t),{passive:!0,capture:!0,signal:r}),window.addEventListener("touchmove",Zt,{passive:!1,signal:r}),window.addEventListener("contextmenu",si,{signal:r}),this.#u={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height};const o=this.parent.div.style.cursor,l=this.div.style.cursor;this.div.style.cursor=this.parent.div.style.cursor=window.getComputedStyle(e.target).cursor;const h=()=>{s.abort(),this.parent.togglePointerEvents(!0),this.#n?.toggle(!0),this._isDraggable=n,this.parent.div.style.cursor=o,this.div.style.cursor=l,this.#B()};window.addEventListener("pointerup",h,{signal:r}),window.addEventListener("blur",h,{signal:r})}#L(t,e,i,n){this.width=i,this.height=n,this.x=t,this.y=e,this.setDims(),this.fixAndSetPosition(),this._onResized()}_onResized(){}#B(){if(!this.#u)return;const{savedX:t,savedY:e,savedWidth:i,savedHeight:n}=this.#u;this.#u=null;const s=this.x,r=this.y,o=this.width,l=this.height;s===t&&r===e&&o===i&&l===n||this.addCommands({cmd:this.#L.bind(this,s,r,o,l),undo:this.#L.bind(this,t,e,i,n),mustExec:!0})}static _round(t){return Math.round(t*1e4)/1e4}#R(t,e){const[i,n]=this.parentDimensions,s=this.x,r=this.y,o=this.width,l=this.height,h=nt.MIN_SIZE/i,c=nt.MIN_SIZE/n,u=this.#D(this.rotation),p=(G,W)=>[u[0]*G+u[2]*W,u[1]*G+u[3]*W],b=this.#D(360-this.rotation),w=(G,W)=>[b[0]*G+b[2]*W,b[1]*G+b[3]*W];let v,x,E=!1,D=!1;switch(t){case"topLeft":E=!0,v=(G,W)=>[0,0],x=(G,W)=>[G,W];break;case"topMiddle":v=(G,W)=>[G/2,0],x=(G,W)=>[G/2,W];break;case"topRight":E=!0,v=(G,W)=>[G,0],x=(G,W)=>[0,W];break;case"middleRight":D=!0,v=(G,W)=>[G,W/2],x=(G,W)=>[0,W/2];break;case"bottomRight":E=!0,v=(G,W)=>[G,W],x=(G,W)=>[0,0];break;case"bottomMiddle":v=(G,W)=>[G/2,W],x=(G,W)=>[G/2,0];break;case"bottomLeft":E=!0,v=(G,W)=>[0,W],x=(G,W)=>[G,0];break;case"middleLeft":D=!0,v=(G,W)=>[0,W/2],x=(G,W)=>[G,W/2];break}const T=v(o,l),k=x(o,l);let F=p(...k);const M=nt._round(s+F[0]),O=nt._round(r+F[1]);let N=1,R=1,$,U;if(e.fromKeyboard)({deltaX:$,deltaY:U}=e);else{const{screenX:G,screenY:W}=e,[Z,xt]=this.#l;[$,U]=this.screenToPageTranslation(G-Z,W-xt),this.#l[0]=G,this.#l[1]=W}if([$,U]=w($/i,U/n),E){const G=Math.hypot(o,l);N=R=Math.max(Math.min(Math.hypot(k[0]-T[0]-$,k[1]-T[1]-U)/G,1/o,1/l),h/o,c/l)}else D?N=Ie(Math.abs(k[0]-T[0]-$),h,1)/o:R=Ie(Math.abs(k[1]-T[1]-U),c,1)/l;const Q=nt._round(o*N),V=nt._round(l*R);F=p(...x(Q,V));const z=M-F[0],st=O-F[1];this.#c||=[this.x,this.y,this.width,this.height],this.width=Q,this.height=V,this.x=z,this.y=st,this.setDims(),this.fixAndSetPosition(),this._onResizing()}_onResizing(){}altTextFinish(){this.#n?.finish()}get toolbarButtons(){return null}async addEditToolbar(){if(this._editToolbar||this.#b)return this._editToolbar;this._editToolbar=new ts(this),this.div.append(this._editToolbar.render());const{toolbarButtons:t}=this;if(t)for(const[e,i]of t)await this._editToolbar.addButton(e,i);return this.hasComment||this._editToolbar.addButton("comment",this.addCommentButton()),this._editToolbar.addButton("delete"),this._editToolbar}addCommentButtonInToolbar(){this._editToolbar?.addButtonBefore("comment",this.addCommentButton(),".deleteButton")}removeCommentButtonFromToolbar(){this._editToolbar?.removeButton("comment")}removeEditToolbar(){this._editToolbar?.remove(),this._editToolbar=null,this.#n?.destroy()}addContainer(t){const e=this._editToolbar?.div;e?e.before(t):this.div.append(t)}getClientDimensions(){return this.div.getBoundingClientRect()}createAltText(){return this.#n||(vi.initialize(nt._l10n),this.#n=new vi(this),this.#t&&(this.#n.data=this.#t,this.#t=null)),this.#n}get altTextData(){return this.#n?.data}set altTextData(t){this.#n&&(this.#n.data=t)}get guessedAltText(){return this.#n?.guessedText}async setGuessedAltText(t){await this.#n?.setGuessedText(t)}serializeAltText(t){return this.#n?.serialize(t)}hasAltText(){return!!this.#n&&!this.#n.isEmpty()}hasAltTextData(){return this.#n?.hasData()??!1}focusCommentButton(){this.#i?.focusButton()}addCommentButton(){return this.canAddComment?this.#i||=new ks(this):null}addStandaloneCommentButton(){if(this._uiManager.hasCommentManager()){if(this.#o){this._uiManager.isEditingMode()&&this.#o.classList.remove("hidden");return}this.hasComment&&(this.#o=this.#i.renderForStandalone(),this.div.append(this.#o))}}removeStandaloneCommentButton(){this.#i.removeStandaloneCommentButton(),this.#o=null}hideStandaloneCommentButton(){this.#o?.classList.add("hidden")}get comment(){const{data:{richText:t,text:e,date:i,deleted:n}}=this.#i;return{text:e,richText:t,date:i,deleted:n,color:this.getNonHCMColor(),opacity:this.opacity??1}}set comment(t){this.#i||=new ks(this),this.#i.data=t,this.hasComment?(this.removeCommentButtonFromToolbar(),this.addStandaloneCommentButton(),this._uiManager.updateComment(this)):(this.addCommentButtonInToolbar(),this.removeStandaloneCommentButton(),this._uiManager.removeComment(this))}setCommentData({comment:t,popupRef:e,richText:i}){if(!e||(this.#i||=new ks(this),this.#i.setInitialText(t,i),!this.annotationElementId))return;const n=this._uiManager.getAndRemoveDataFromAnnotationStorage(this.annotationElementId);n&&this.updateFromAnnotationLayer(n)}get hasEditedComment(){return this.#i?.hasBeenEdited()}get hasDeletedComment(){return this.#i?.isDeleted()}get hasComment(){return!!this.#i&&!this.#i.isEmpty()&&!this.#i.isDeleted()}async editComment(t){this.#i||=new ks(this),this.#i.edit(t)}toggleComment(t,e=void 0){this.hasComment&&this._uiManager.toggleComment(this,t,e)}setSelectedCommentButton(t){this.#i.setSelectedButton(t)}addComment(t){if(this.hasEditedComment){const[,,,n]=t.rect,[s]=this.pageDimensions,[r]=this.pageTranslation,o=r+s+1,l=n-100,h=o+180;t.popup={contents:this.comment.text,deleted:this.comment.deleted,rect:[o,l,h,n]}}}updateFromAnnotationLayer({popup:{contents:t,deleted:e}}){this.#i.data=e?null:t}get parentBoundingClientRect(){return this.parent.boundingClientRect}render(){const t=this.div=document.createElement("div");t.setAttribute("data-editor-rotation",(360-this.rotation)%360),t.className=this.name,t.setAttribute("id",this.id),t.tabIndex=this.#r?-1:0,t.setAttribute("role","application"),this.defaultL10nId&&t.setAttribute("data-l10n-id",this.defaultL10nId),this._isVisible||t.classList.add("hidden"),this.setInForeground(),this.#H();const[e,i]=this.parentDimensions;this.parentRotation%180!==0&&(t.style.maxWidth=`${(100*i/e).toFixed(2)}%`,t.style.maxHeight=`${(100*e/i).toFixed(2)}%`);const[n,s]=this.getInitialTranslation();return this.translate(n,s),Nl(this,t,["keydown","pointerdown","dblclick"]),this.isResizable&&this._uiManager._supportsPinchToZoom&&(this.#P||=new yr({container:t,isPinchingDisabled:()=>!this.isSelected,onPinchStart:this.#G.bind(this),onPinching:this.#_.bind(this),onPinchEnd:this.#E.bind(this),signal:this._uiManager._signal})),this.addStandaloneCommentButton(),this._uiManager._editorUndoBar?.hide(),t}#G(){this.#u={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height},this.#n?.toggle(!1),this.parent.togglePointerEvents(!1)}#_(t,e,i){let s=.7*(i/e)+1-.7;if(s===1)return;const r=this.#D(this.rotation),o=(M,O)=>[r[0]*M+r[2]*O,r[1]*M+r[3]*O],[l,h]=this.parentDimensions,c=this.x,u=this.y,p=this.width,b=this.height,w=nt.MIN_SIZE/l,v=nt.MIN_SIZE/h;s=Math.max(Math.min(s,1/p,1/b),w/p,v/b);const x=nt._round(p*s),E=nt._round(b*s);if(x===p&&E===b)return;this.#c||=[c,u,p,b];const D=o(p/2,b/2),T=nt._round(c+D[0]),k=nt._round(u+D[1]),F=o(x/2,E/2);this.x=T-F[0],this.y=k-F[1],this.width=x,this.height=E,this.setDims(),this.fixAndSetPosition(),this._onResizing()}#E(){this.#n?.toggle(!0),this.parent.togglePointerEvents(!0),this.#B()}pointerdown(t){const{isMac:e}=fe.platform;if(t.button!==0||t.ctrlKey&&e){t.preventDefault();return}if(this.#g=!0,this._isDraggable){this.#U(t);return}this.#I(t)}#I(t){const{isMac:e}=fe.platform;t.ctrlKey&&!e||t.shiftKey||t.metaKey&&e?this.parent.toggleSelected(this):this.parent.setSelected(this)}#U(t){const{isSelected:e}=this;this._uiManager.setUpDragSession();let i=!1;const n=new AbortController,s=this._uiManager.combinedSignal(n),r={capture:!0,passive:!1,signal:s},o=h=>{n.abort(),this.#s=null,this.#g=!1,this._uiManager.endDragSession()||this.#I(h),i&&this._onStopDragging()};e&&(this.#C=t.clientX,this.#S=t.clientY,this.#s=t.pointerId,this.#a=t.pointerType,window.addEventListener("pointermove",h=>{i||(i=!0,this._uiManager.toggleComment(this,!0,!1),this._onStartDragging());const{clientX:c,clientY:u,pointerId:p}=h;if(p!==this.#s){Zt(h);return}const[b,w]=this.screenToPageTranslation(c-this.#C,u-this.#S);this.#C=c,this.#S=u,this._uiManager.dragSelectedEditors(b,w)},r),window.addEventListener("touchmove",Zt,r),window.addEventListener("pointerdown",h=>{h.pointerType===this.#a&&(this.#P||h.isPrimary)&&o(h),Zt(h)},r));const l=h=>{if(!this.#s||this.#s===h.pointerId){o(h);return}Zt(h)};window.addEventListener("pointerup",l,{signal:s}),window.addEventListener("blur",l,{signal:s})}_onStartDragging(){}_onStopDragging(){}moveInDOM(){this.#y&&clearTimeout(this.#y),this.#y=setTimeout(()=>{this.#y=null,this.parent?.moveEditorInDOM(this)},0)}_setParentAndPosition(t,e,i){t.changeParent(this),this.x=e,this.y=i,this.fixAndSetPosition(),this._onTranslated()}getRect(t,e,i=this.rotation){const n=this.parentScale,[s,r]=this.pageDimensions,[o,l]=this.pageTranslation,h=t/n,c=e/n,u=this.x*s,p=this.y*r,b=this.width*s,w=this.height*r;switch(i){case 0:return[u+h+o,r-p-c-w+l,u+h+b+o,r-p-c+l];case 90:return[u+c+o,r-p+h+l,u+c+w+o,r-p+h+b+l];case 180:return[u-h-b+o,r-p+c+l,u-h+o,r-p+c+w+l];case 270:return[u-c-w+o,r-p-h-b+l,u-c+o,r-p-h+l];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(t,e){const[i,n,s,r]=t,o=s-i,l=r-n;switch(this.rotation){case 0:return[i,e-r,o,l];case 90:return[i,e-n,l,o];case 180:return[s,e-n,o,l];case 270:return[s,e-r,l,o];default:throw new Error("Invalid rotation")}}getPDFRect(){return this.getRect(0,0)}getNonHCMColor(){return this.color&&nt._colorManager.convert(this._uiManager.getNonHCMColor(this.color))}onUpdatedColor(){this.#i?.onUpdatedColor()}getData(){const{comment:{text:t,color:e,date:i,opacity:n,deleted:s,richText:r},uid:o,pageIndex:l,creationDate:h,modificationDate:c}=this;return{id:o,pageIndex:l,rect:this.getPDFRect(),richText:r,contentsObj:{str:t},creationDate:h,modificationDate:i||c,popupRef:!s,color:e,opacity:n}}onceAdded(t){}isEmpty(){return!1}enableEditMode(){return this.isInEditMode()?!1:(this.parent.setEditingState(!1),this.#b=!0,!0)}disableEditMode(){return this.isInEditMode()?(this.parent.setEditingState(!0),this.#b=!1,!0):!1}isInEditMode(){return this.#b}shouldGetKeyboardEvents(){return this.#w}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}get isOnScreen(){const{top:t,left:e,bottom:i,right:n}=this.getClientDimensions(),{innerHeight:s,innerWidth:r}=window;return e<r&&n>0&&t<s&&i>0}#H(){if(this.#f||!this.div)return;this.#f=new AbortController;const t=this._uiManager.combinedSignal(this.#f);this.div.addEventListener("focusin",this.focusin.bind(this),{signal:t}),this.div.addEventListener("focusout",this.focusout.bind(this),{signal:t})}rebuild(){this.#H()}rotate(t){}resize(){}serializeDeleted(){return{id:this.annotationElementId,deleted:!0,pageIndex:this.pageIndex,popupRef:this._initialData?.popupRef||""}}serialize(t=!1,e=null){return{annotationType:this.mode,pageIndex:this.pageIndex,rect:this.getPDFRect(),rotation:this.rotation,structTreeParentId:this._structTreeParentId,popupRef:this._initialData?.popupRef||""}}static async deserialize(t,e,i){const n=new this.prototype.constructor({parent:e,id:e.getNextId(),uiManager:i,annotationElementId:t.annotationElementId,creationDate:t.creationDate,modificationDate:t.modificationDate});n.rotation=t.rotation,n.#t=t.accessibilityData,n._isCopy=t.isCopy||!1;const[s,r]=n.pageDimensions,[o,l,h,c]=n.getRectInCurrentCoords(t.rect,r);return n.x=o/s,n.y=l/r,n.width=h/s,n.height=c/r,n}get hasBeenModified(){return!!this.annotationElementId&&(this.deleted||this.serialize()!==null)}remove(){if(this.#f?.abort(),this.#f=null,this.isEmpty()||this.commit(),this.parent?this.parent.remove(this):this._uiManager.removeEditor(this),this.hideCommentPopup(),this.#y&&(clearTimeout(this.#y),this.#y=null),this.#O(),this.removeEditToolbar(),this.#A){for(const t of this.#A.values())clearTimeout(t);this.#A=null}this.parent=null,this.#P?.destroy(),this.#P=null,this.#d?.remove(),this.#d=null}get isResizable(){return!1}makeResizable(){this.isResizable&&(this.#N(),this.#h.classList.remove("hidden"))}get toolbarPosition(){return null}get commentButtonPosition(){return this._uiManager.direction==="ltr"?[1,0]:[0,0]}get commentButtonPositionInPage(){const{commentButtonPosition:[t,e]}=this,[i,n,s,r]=this.getPDFRect();return[nt._round(i+(s-i)*t),nt._round(n+(r-n)*(1-e))]}get commentButtonColor(){return this._uiManager.makeCommentColor(this.getNonHCMColor(),this.opacity)}get commentPopupPosition(){return this.#i.commentPopupPositionInLayer}set commentPopupPosition(t){this.#i.commentPopupPositionInLayer=t}hasDefaultPopupPosition(){return this.#i.hasDefaultPopupPosition()}get commentButtonWidth(){return this.#i.commentButtonWidth}get elementBeforePopup(){return this.div}setCommentButtonStates(t){this.#i?.setCommentButtonStates(t)}keydown(t){if(!this.isResizable||t.target!==this.div||t.key!=="Enter")return;this._uiManager.setSelected(this),this.#u={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height};const e=this.#h.children;if(!this.#e){this.#e=Array.from(e);const r=this.#q.bind(this),o=this.#W.bind(this),l=this._uiManager._signal;for(const h of this.#e){const c=h.getAttribute("data-resizer-name");h.setAttribute("role","spinbutton"),h.addEventListener("keydown",r,{signal:l}),h.addEventListener("blur",o,{signal:l}),h.addEventListener("focus",this.#X.bind(this,c),{signal:l}),h.setAttribute("data-l10n-id",nt._l10nResizer[c])}}const i=this.#e[0];let n=0;for(const r of e){if(r===i)break;n++}const s=(360-this.rotation+this.parentRotation)%360/90*(this.#e.length/4);if(s!==n){if(s<n)for(let o=0;o<n-s;o++)this.#h.append(this.#h.firstElementChild);else if(s>n)for(let o=0;o<s-n;o++)this.#h.firstElementChild.before(this.#h.lastElementChild);let r=0;for(const o of e){const h=this.#e[r++].getAttribute("data-resizer-name");o.setAttribute("data-l10n-id",nt._l10nResizer[h])}}this.#j(0),this.#w=!0,this.#h.firstElementChild.focus({focusVisible:!0}),t.preventDefault(),t.stopImmediatePropagation()}#q(t){nt._resizerKeyboardManager.exec(this,t)}#W(t){this.#w&&t.relatedTarget?.parentNode!==this.#h&&this.#O()}#X(t){this.#m=this.#w?t:""}#j(t){if(this.#e)for(const e of this.#e)e.tabIndex=t}_resizeWithKeyboard(t,e){this.#w&&this.#R(this.#m,{deltaX:t,deltaY:e,fromKeyboard:!0})}#O(){this.#w=!1,this.#j(-1),this.#B()}_stopResizingWithKeyboard(){this.#O(),this.div.focus()}select(){if(this.isSelected&&this._editToolbar){this._editToolbar.show();return}if(this.isSelected=!0,this.makeResizable(),this.div?.classList.add("selectedEditor"),!this._editToolbar){this.addEditToolbar().then(()=>{this.div?.classList.contains("selectedEditor")&&this._editToolbar?.show()});return}this._editToolbar?.show(),this.#n?.toggleAltTextBadge(!1)}focus(){this.div&&!this.div.contains(document.activeElement)&&setTimeout(()=>this.div?.focus({preventScroll:!0}),0)}unselect(){this.isSelected&&(this.isSelected=!1,this.#h?.classList.add("hidden"),this.div?.classList.remove("selectedEditor"),this.div?.contains(document.activeElement)&&this._uiManager.currentLayer.div.focus({preventScroll:!0}),this._editToolbar?.hide(),this.#n?.toggleAltTextBadge(!0),this.hideCommentPopup())}hideCommentPopup(){this.hasComment&&this._uiManager.toggleComment(null)}updateParams(t,e){}disableEditing(){}enableEditing(){}get canChangeContent(){return!1}enterInEditMode(){this.canChangeContent&&(this.enableEditMode(),this.div.focus())}dblclick(t){t.target.nodeName!=="BUTTON"&&(this.enterInEditMode(),this.parent.updateToolbar({mode:this.constructor._editorType,editId:this.uid}))}getElementForAltText(){return this.div}get contentDiv(){return this.div}get isEditing(){return this.#p}set isEditing(t){this.#p=t,this.parent&&(t?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null))}static get MIN_SIZE(){return 16}static canCreateNewEmptyEditor(){return!0}get telemetryInitialData(){return{action:"added"}}get telemetryFinalData(){return null}_reportTelemetry(t,e=!1){if(e){this.#A||=new Map;const{action:i}=t;let n=this.#A.get(i);n&&clearTimeout(n),n=setTimeout(()=>{this._reportTelemetry(t),this.#A.delete(i),this.#A.size===0&&(this.#A=null)},nt._telemetryTimeout),this.#A.set(i,n);return}t.type||=this.editorType,this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:t}})}show(t=this._isVisible){this.div.classList.toggle("hidden",!t),this._isVisible=t}enable(){this.div&&(this.div.tabIndex=0),this.#r=!1}disable(){this.div&&(this.div.tabIndex=-1),this.#r=!0}updateFakeAnnotationElement(t){if(!this.#d&&!this.deleted){this.#d=t.addFakeAnnotation(this);return}if(this.deleted){this.#d.remove(),this.#d=null;return}(this.hasEditedComment||this._hasBeenMoved||this._hasBeenResized)&&this.#d.updateEdited({rect:this.getPDFRect(),popup:this.comment})}renderAnnotationElement(t){if(this.deleted)return t.hide(),null;let e=t.container.querySelector(".annotationContent");if(!e)e=document.createElement("div"),e.classList.add("annotationContent",this.editorType),t.container.prepend(e);else if(e.nodeName==="CANVAS"){const i=e;e=document.createElement("div"),e.classList.add("annotationContent",this.editorType),i.before(e)}return e}resetAnnotationElement(t){const{firstElementChild:e}=t.container;e?.nodeName==="DIV"&&e.classList.contains("annotationContent")&&e.remove()}}class sd extends nt{constructor(t){super(t),this.annotationElementId=t.annotationElementId,this.deleted=!0}serialize(){return this.serializeDeleted()}}const Pa=3285377520,Ze=4294901760,mi=65535;class Bl{constructor(t){this.h1=t?t&4294967295:Pa,this.h2=t?t&4294967295:Pa}update(t){let e,i;if(typeof t=="string"){e=new Uint8Array(t.length*2),i=0;for(let v=0,x=t.length;v<x;v++){const E=t.charCodeAt(v);E<=255?e[i++]=E:(e[i++]=E>>>8,e[i++]=E&255)}}else if(ArrayBuffer.isView(t))e=t.slice(),i=e.byteLength;else throw new Error("Invalid data format, must be a string or TypedArray.");const n=i>>2,s=i-n*4,r=new Uint32Array(e.buffer,0,n);let o=0,l=0,h=this.h1,c=this.h2;const u=3432918353,p=461845907,b=u&mi,w=p&mi;for(let v=0;v<n;v++)v&1?(o=r[v],o=o*u&Ze|o*b&mi,o=o<<15|o>>>17,o=o*p&Ze|o*w&mi,h^=o,h=h<<13|h>>>19,h=h*5+3864292196):(l=r[v],l=l*u&Ze|l*b&mi,l=l<<15|l>>>17,l=l*p&Ze|l*w&mi,c^=l,c=c<<13|c>>>19,c=c*5+3864292196);switch(o=0,s){case 3:o^=e[n*4+2]<<16;case 2:o^=e[n*4+1]<<8;case 1:o^=e[n*4],o=o*u&Ze|o*b&mi,o=o<<15|o>>>17,o=o*p&Ze|o*w&mi,n&1?h^=o:c^=o}this.h1=h,this.h2=c}hexdigest(){let t=this.h1,e=this.h2;return t^=e>>>1,t=t*3981806797&Ze|t*36045&mi,e=e*4283543511&Ze|((e<<16|t>>>16)*2950163797&Ze)>>>16,t^=e>>>1,t=t*444984403&Ze|t*60499&mi,e=e*3301882366&Ze|((e<<16|t>>>16)*3120437893&Ze)>>>16,t^=e>>>1,(t>>>0).toString(16).padStart(8,"0")+(e>>>0).toString(16).padStart(8,"0")}}const po=Object.freeze({map:null,hash:"",transfer:void 0});class Ro{#t=!1;#e=null;#n=null;#i=new Map;constructor(){this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(t,e){const i=this.#i.get(t);return i===void 0?e:Object.assign(e,i)}getRawValue(t){return this.#i.get(t)}remove(t){const e=this.#i.get(t);if(e!==void 0&&(e instanceof nt&&this.#n.delete(e.annotationElementId),this.#i.delete(t),this.#i.size===0&&this.resetModified(),typeof this.onAnnotationEditor=="function")){for(const i of this.#i.values())if(i instanceof nt)return;this.onAnnotationEditor(null)}}setValue(t,e){const i=this.#i.get(t);let n=!1;if(i!==void 0)for(const[s,r]of Object.entries(e))i[s]!==r&&(n=!0,i[s]=r);else n=!0,this.#i.set(t,e);n&&this.#o(),e instanceof nt&&((this.#n||=new Map).set(e.annotationElementId,e),typeof this.onAnnotationEditor=="function"&&this.onAnnotationEditor(e.constructor._type))}has(t){return this.#i.has(t)}get size(){return this.#i.size}#o(){this.#t||(this.#t=!0,typeof this.onSetModified=="function"&&this.onSetModified())}resetModified(){this.#t&&(this.#t=!1,typeof this.onResetModified=="function"&&this.onResetModified())}get print(){return new Ul(this)}get serializable(){if(this.#i.size===0)return po;const t=new Map,e=new Bl,i=[],n=Object.create(null);let s=!1;for(const[r,o]of this.#i){const l=o instanceof nt?o.serialize(!1,n):o;l&&(t.set(r,l),e.update(`${r}:${JSON.stringify(l)}`),s||=!!l.bitmap)}if(s)for(const r of t.values())r.bitmap&&i.push(r.bitmap);return t.size>0?{map:t,hash:e.hexdigest(),transfer:i}:po}get editorStats(){let t=null;const e=new Map;let i=0,n=0;for(const s of this.#i.values()){if(!(s instanceof nt)){s.popup&&(s.popup.deleted?n+=1:i+=1);continue}s.isCommentDeleted?n+=1:s.hasEditedComment&&(i+=1);const r=s.telemetryFinalData;if(!r)continue;const{type:o}=r;e.has(o)||e.set(o,Object.getPrototypeOf(s).constructor),t||=Object.create(null);const l=t[o]||=new Map;for(const[h,c]of Object.entries(r)){if(h==="type")continue;let u=l.get(h);u||(u=new Map,l.set(h,u));const p=u.get(c)??0;u.set(c,p+1)}}if((n>0||i>0)&&(t||=Object.create(null),t.comments={deleted:n,edited:i}),!t)return null;for(const[s,r]of e)t[s]=r.computeTelemetryFinalData(t[s]);return t}resetModifiedIds(){this.#e=null}updateEditor(t,e){const i=this.#n?.get(t);return i?(i.updateFromAnnotationLayer(e),!0):!1}getEditor(t){return this.#n?.get(t)||null}get modifiedIds(){if(this.#e)return this.#e;const t=[];if(this.#n)for(const e of this.#n.values())e.serialize()&&t.push(e.annotationElementId);return this.#e={ids:new Set(t),hash:t.join(",")}}[Symbol.iterator](){return this.#i.entries()}}class Ul extends Ro{#t;constructor(t){super();const{map:e,hash:i,transfer:n}=t.serializable,s=structuredClone(e,n?{transfer:n}:null);this.#t={map:s,hash:i,transfer:n}}get print(){Rt("Should not call PrintAnnotationStorage.print")}get serializable(){return this.#t}get modifiedIds(){return pt(this,"modifiedIds",{ids:new Set,hash:""})}}class rd{#t=new Set;constructor({ownerDocument:t=globalThis.document,styleElement:e=null}){this._document=t,this.nativeFontFaces=new Set,this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}addNativeFontFace(t){this.nativeFontFaces.add(t),this._document.fonts.add(t)}removeNativeFontFace(t){this.nativeFontFaces.delete(t),this._document.fonts.delete(t)}insertRule(t){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));const e=this.styleElement.sheet;e.insertRule(t,e.cssRules.length)}clear(){for(const t of this.nativeFontFaces)this._document.fonts.delete(t);this.nativeFontFaces.clear(),this.#t.clear(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}async loadSystemFont({systemFontInfo:t,disableFontFace:e,_inspectFont:i}){if(!(!t||this.#t.has(t.loadedName))){if(St(!e,"loadSystemFont shouldn't be called when `disableFontFace` is set."),this.isFontLoadingAPISupported){const{loadedName:n,src:s,style:r}=t,o=new FontFace(n,s,r);this.addNativeFontFace(o);try{await o.load(),this.#t.add(n),i?.(t)}catch{ft(`Cannot load system font: ${t.baseFontName}, installing it could help to improve PDF rendering.`),this.removeNativeFontFace(o)}return}Rt("Not implemented: loadSystemFont without the Font Loading API.")}}async bind(t){if(t.attached||t.missingFile&&!t.systemFontInfo)return;if(t.attached=!0,t.systemFontInfo){await this.loadSystemFont(t);return}if(this.isFontLoadingAPISupported){const i=t.createNativeFontFace();if(i){this.addNativeFontFace(i);try{await i.loaded}catch(n){throw ft(`Failed to load font '${i.family}': '${n}'.`),t.disableFontFace=!0,n}}return}const e=t.createFontFaceRule();if(e){if(this.insertRule(e),this.isSyncFontLoadingSupported)return;await new Promise(i=>{const n=this._queueLoadingCallback(i);this._prepareFontLoadEvent(t,n)})}}get isFontLoadingAPISupported(){const t=!!this._document?.fonts;return pt(this,"isFontLoadingAPISupported",t)}get isSyncFontLoadingSupported(){return pt(this,"isSyncFontLoadingSupported",Me||fe.platform.isFirefox)}_queueLoadingCallback(t){function e(){for(St(!n.done,"completeRequest() cannot be called twice."),n.done=!0;i.length>0&&i[0].done;){const s=i.shift();setTimeout(s.callback,0)}}const{loadingRequests:i}=this,n={done:!1,complete:e,callback:t};return i.push(n),n}get _loadTestFont(){const t=atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==");return pt(this,"_loadTestFont",t)}_prepareFontLoadEvent(t,e){function i(k,F){return k.charCodeAt(F)<<24|k.charCodeAt(F+1)<<16|k.charCodeAt(F+2)<<8|k.charCodeAt(F+3)&255}function n(k,F,M,O){const N=k.substring(0,F),R=k.substring(F+M);return N+O+R}let s,r;const o=this._document.createElement("canvas");o.width=1,o.height=1;const l=o.getContext("2d");let h=0;function c(k,F){if(++h>30){ft("Load test font never loaded."),F();return}if(l.font="30px "+k,l.fillText(".",0,20),l.getImageData(0,0,1,1).data[3]>0){F();return}setTimeout(c.bind(null,k,F))}const u=`lt${Date.now()}${this.loadTestFontId++}`;let p=this._loadTestFont;p=n(p,976,u.length,u);const w=16,v=1482184792;let x=i(p,w);for(s=0,r=u.length-3;s<r;s+=4)x=x-v+i(u,s)|0;s<u.length&&(x=x-v+i(u+"XXX",s)|0),p=n(p,w,4,Uc(x));const E=`url(data:font/opentype;base64,${btoa(p)});`,D=`@font-face {font-family:"${u}";src:${E}}`;this.insertRule(D);const T=this._document.createElement("div");T.style.visibility="hidden",T.style.width=T.style.height="10px",T.style.position="absolute",T.style.top=T.style.left="0px";for(const k of[t.loadedName,u]){const F=this._document.createElement("span");F.textContent="Hi",F.style.fontFamily=k,T.append(F)}this._document.body.append(T),c(u,()=>{T.remove(),e.complete()})}}class od{#t;constructor(t,e=null,i,n){this.compiledGlyphs=Object.create(null),this.#t=t,this._inspectFont=e,i&&Object.assign(this,i),n&&(this.charProcOperatorList=n)}createNativeFontFace(){if(!this.data||this.disableFontFace)return null;let t;if(!this.cssFontInfo)t=new FontFace(this.loadedName,this.data,{});else{const e={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(e.style=`oblique ${this.cssFontInfo.italicAngle}deg`),t=new FontFace(this.cssFontInfo.fontFamily,this.data,e)}return this._inspectFont?.(this),t}createFontFaceRule(){if(!this.data||this.disableFontFace)return null;const t=`url(data:${this.mimetype};base64,${Il(this.data)});`;let e;if(!this.cssFontInfo)e=`@font-face {font-family:"${this.loadedName}";src:${t}}`;else{let i=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(i+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),e=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${i}src:${t}}`}return this._inspectFont?.(this,t),e}getPathGenerator(t,e){if(this.compiledGlyphs[e]!==void 0)return this.compiledGlyphs[e];const i=this.loadedName+"_path_"+e;let n;try{n=t.get(i)}catch(r){ft(`getPathGenerator - ignoring character: "${r}".`)}const s=Ol(n?.path);return this.fontExtraProperties||t.delete(i),this.compiledGlyphs[e]=s}get black(){return this.#t.black}get bold(){return this.#t.bold}get disableFontFace(){return this.#t.disableFontFace??!1}set disableFontFace(t){pt(this,"disableFontFace",!!t)}get fontExtraProperties(){return this.#t.fontExtraProperties??!1}get isInvalidPDFjsFont(){return this.#t.isInvalidPDFjsFont}get isType3Font(){return this.#t.isType3Font}get italic(){return this.#t.italic}get missingFile(){return this.#t.missingFile}get remeasure(){return this.#t.remeasure}get vertical(){return this.#t.vertical}get ascent(){return this.#t.ascent}get defaultWidth(){return this.#t.defaultWidth}get descent(){return this.#t.descent}get bbox(){return this.#t.bbox}set bbox(t){pt(this,"bbox",t)}get fontMatrix(){return this.#t.fontMatrix}get fallbackName(){return this.#t.fallbackName}get loadedName(){return this.#t.loadedName}get mimetype(){return this.#t.mimetype}get name(){return this.#t.name}get data(){return this.#t.data}clearData(){this.#t.clearData()}get cssFontInfo(){return this.#t.cssFontInfo}get systemFontInfo(){return this.#t.systemFontInfo}get defaultVMetrics(){return this.#t.defaultVMetrics}}class Dn{#t;#e;#n;static strings=["fontFamily","fontWeight","italicAngle"];static write(t){const e=new TextEncoder,i={};let n=0;for(const h of Dn.strings){const c=e.encode(t[h]);i[h]=c,n+=4+c.length}const s=new ArrayBuffer(n),r=new Uint8Array(s),o=new DataView(s);let l=0;for(const h of Dn.strings){const c=i[h],u=c.length;o.setUint32(l,u),r.set(c,l+4),l+=4+u}return St(l===s.byteLength,"CssFontInfo.write: Buffer overflow"),s}constructor(t){this.#t=t,this.#e=new DataView(this.#t),this.#n=new TextDecoder}#i(t){St(t<Dn.strings.length,"Invalid string index");let e=0;for(let n=0;n<t;n++)e+=this.#e.getUint32(e)+4;const i=this.#e.getUint32(e);return this.#n.decode(new Uint8Array(this.#t,e+4,i))}get fontFamily(){return this.#i(0)}get fontWeight(){return this.#i(1)}get italicAngle(){return this.#i(2)}}class kn{#t;#e;#n;static strings=["css","loadedName","baseFontName","src"];static write(t){const e=new TextEncoder,i={};let n=0;for(const p of kn.strings){const b=e.encode(t[p]);i[p]=b,n+=4+b.length}n+=4;let s,r,o=1+n;t.style&&(s=e.encode(t.style.style),r=e.encode(t.style.weight),o+=4+s.length+4+r.length);const l=new ArrayBuffer(o),h=new Uint8Array(l),c=new DataView(l);let u=0;c.setUint8(u++,t.guessFallback?1:0),c.setUint32(u,0),u+=4,n=0;for(const p of kn.strings){const b=i[p],w=b.length;n+=4+w,c.setUint32(u,w),h.set(b,u+4),u+=4+w}return c.setUint32(u-n-4,n),t.style&&(c.setUint32(u,s.length),h.set(s,u+4),u+=4+s.length,c.setUint32(u,r.length),h.set(r,u+4),u+=4+r.length),St(u<=l.byteLength,"SubstitionInfo.write: Buffer overflow"),l.transferToFixedLength(u)}constructor(t){this.#t=t,this.#e=new DataView(this.#t),this.#n=new TextDecoder}get guessFallback(){return this.#e.getUint8(0)!==0}#i(t){St(t<kn.strings.length,"Invalid string index");let e=5;for(let n=0;n<t;n++)e+=this.#e.getUint32(e)+4;const i=this.#e.getUint32(e);return this.#n.decode(new Uint8Array(this.#t,e+4,i))}get css(){return this.#i(0)}get loadedName(){return this.#i(1)}get baseFontName(){return this.#i(2)}get src(){return this.#i(3)}get style(){let t=1;t+=4+this.#e.getUint32(t);const e=this.#e.getUint32(t),i=this.#n.decode(new Uint8Array(this.#t,t+4,e));t+=4+e;const n=this.#e.getUint32(t),s=this.#n.decode(new Uint8Array(this.#t,t+4,n));return{style:i,weight:s}}}class It{static bools=["black","bold","disableFontFace","fontExtraProperties","isInvalidPDFjsFont","isType3Font","italic","missingFile","remeasure","vertical"];static numbers=["ascent","defaultWidth","descent"];static strings=["fallbackName","loadedName","mimetype","name"];static#t=Math.ceil(this.bools.length*2/8);static#e=this.#t+this.numbers.length*8;static#n=this.#e+1+8;static#i=this.#n+1+48;static#o=this.#i+1+6;#r;#s;#a;constructor({data:t,extra:e}){this.#r=t,this.#s=new TextDecoder,this.#a=new DataView(this.#r),e&&Object.assign(this,e)}#h(t){St(t<It.bools.length,"Invalid boolean index");const e=Math.floor(t/4),i=t*2%8,n=this.#a.getUint8(e)>>i&3;return n===0?void 0:n===2}get black(){return this.#h(0)}get bold(){return this.#h(1)}get disableFontFace(){return this.#h(2)}get fontExtraProperties(){return this.#h(3)}get isInvalidPDFjsFont(){return this.#h(4)}get isType3Font(){return this.#h(5)}get italic(){return this.#h(6)}get missingFile(){return this.#h(7)}get remeasure(){return this.#h(8)}get vertical(){return this.#h(9)}#l(t){return St(t<It.numbers.length,"Invalid number index"),this.#a.getFloat64(It.#t+t*8)}get ascent(){return this.#l(0)}get defaultWidth(){return this.#l(1)}get descent(){return this.#l(2)}get bbox(){let t=It.#e;if(this.#a.getUint8(t)===0)return;t+=1;const i=[];for(let n=0;n<4;n++)i.push(this.#a.getInt16(t,!0)),t+=2;return i}get fontMatrix(){let t=It.#n;if(this.#a.getUint8(t)===0)return;t+=1;const i=[];for(let n=0;n<6;n++)i.push(this.#a.getFloat64(t,!0)),t+=8;return i}get defaultVMetrics(){let t=It.#i;if(this.#a.getUint8(t)===0)return;t+=1;const i=[];for(let n=0;n<3;n++)i.push(this.#a.getInt16(t,!0)),t+=2;return i}#u(t){St(t<It.strings.length,"Invalid string index");let e=It.#o+4;for(let s=0;s<t;s++)e+=this.#a.getUint32(e)+4;const i=this.#a.getUint32(e),n=new Uint8Array(i);return n.set(new Uint8Array(this.#r,e+4,i)),this.#s.decode(n)}get fallbackName(){return this.#u(0)}get loadedName(){return this.#u(1)}get mimetype(){return this.#u(2)}get name(){return this.#u(3)}get data(){let t=It.#o;const e=this.#a.getUint32(t);t+=4+e;const i=this.#a.getUint32(t);t+=4+i;const n=this.#a.getUint32(t);t+=4+n;const s=this.#a.getUint32(t);if(s!==0)return new Uint8Array(this.#r,t+4,s)}clearData(){let t=It.#o;const e=this.#a.getUint32(t);t+=4+e;const i=this.#a.getUint32(t);t+=4+i;const n=this.#a.getUint32(t);t+=4+n;const s=this.#a.getUint32(t);new Uint8Array(this.#r,t+4,s).fill(0),this.#a.setUint32(t,0)}get cssFontInfo(){let t=It.#o;const e=this.#a.getUint32(t);t+=4+e;const i=this.#a.getUint32(t);t+=4+i;const n=this.#a.getUint32(t);if(n===0)return null;const s=new Uint8Array(n);return s.set(new Uint8Array(this.#r,t+4,n)),new Dn(s.buffer)}get systemFontInfo(){let t=It.#o;const e=this.#a.getUint32(t);t+=4+e;const i=this.#a.getUint32(t);if(i===0)return null;const n=new Uint8Array(i);return n.set(new Uint8Array(this.#r,t+4,i)),new kn(n.buffer)}static write(t){const e=t.systemFontInfo?kn.write(t.systemFontInfo):null,i=t.cssFontInfo?Dn.write(t.cssFontInfo):null,n=new TextEncoder,s={};let r=0;for(const v of It.strings)s[v]=n.encode(t[v]),r+=4+s[v].length;const o=It.#o+4+r+4+(e?e.byteLength:0)+4+(i?i.byteLength:0)+4+(t.data?t.data.length:0),l=new ArrayBuffer(o),h=new Uint8Array(l),c=new DataView(l);let u=0;const p=It.bools.length;let b=0,w=0;for(let v=0;v<p;v++){const x=t[It.bools[v]];b|=(x===void 0?0:x?2:1)<<w,w+=2,(w===8||v===p-1)&&(c.setUint8(u++,b),b=0,w=0)}St(u===It.#t,"FontInfo.write: Boolean properties offset mismatch");for(const v of It.numbers)c.setFloat64(u,t[v]),u+=8;if(St(u===It.#e,"FontInfo.write: Number properties offset mismatch"),t.bbox){c.setUint8(u++,4);for(const v of t.bbox)c.setInt16(u,v,!0),u+=2}else c.setUint8(u++,0),u+=8;if(St(u===It.#n,"FontInfo.write: BBox properties offset mismatch"),t.fontMatrix){c.setUint8(u++,6);for(const v of t.fontMatrix)c.setFloat64(u,v,!0),u+=8}else c.setUint8(u++,0),u+=48;if(St(u===It.#i,"FontInfo.write: FontMatrix properties offset mismatch"),t.defaultVMetrics){c.setUint8(u++,1);for(const v of t.defaultVMetrics)c.setInt16(u,v,!0),u+=2}else c.setUint8(u++,0),u+=6;St(u===It.#o,"FontInfo.write: DefaultVMetrics properties offset mismatch"),c.setUint32(It.#o,0),u+=4;for(const v of It.strings){const x=s[v],E=x.length;c.setUint32(u,E),h.set(x,u+4),u+=4+E}if(c.setUint32(It.#o,u-It.#o-4),!e)c.setUint32(u,0),u+=4;else{const v=e.byteLength;c.setUint32(u,v),St(u+4+v<=l.byteLength,"FontInfo.write: Buffer overflow at systemFontInfo"),h.set(new Uint8Array(e),u+4),u+=4+v}if(!i)c.setUint32(u,0),u+=4;else{const v=i.byteLength;c.setUint32(u,v),St(u+4+v<=l.byteLength,"FontInfo.write: Buffer overflow at cssFontInfo"),h.set(new Uint8Array(i),u+4),u+=4+v}return t.data===void 0?(c.setUint32(u,0),u+=4):(c.setUint32(u,t.data.length),h.set(t.data,u+4),u+=4+t.data.length),St(u<=l.byteLength,"FontInfo.write: Buffer overflow"),l.transferToFixedLength(u)}}class pe{static#t=0;static#e=1;static#n=2;static#i=3;static#o=4;static#r=8;static#s=12;static#a=16;constructor(t){this.buffer=t,this.view=new DataView(t),this.data=new Uint8Array(t)}static write(t){let e,i=null,n=[],s=[],r=[],o=[],l=null,h=null;switch(t[0]){case"RadialAxial":e=t[1]==="axial"?1:2,i=t[2],r=t[3],e===1?n.push(...t[4],...t[5]):n.push(t[4][0],t[4][1],t[6],t[5][0],t[5][1],t[7]);break;case"Mesh":e=3,l=t[1],n=t[2],s=t[3],o=t[4]||[],i=t[6],h=t[7];break;default:throw new Error(`Unsupported pattern type: ${t[0]}`)}const c=Math.floor(n.length/2),u=Math.floor(s.length/3),p=r.length,b=o.length;let w=0;for(const F of o)w+=1,w=Math.ceil(w/4)*4,w+=4+F.coords.length*4,w+=4+F.colors.length*4,F.verticesPerRow!==void 0&&(w+=4);const v=20+c*8+u*3+p*8+(i?16:0)+(h?3:0)+w,x=new ArrayBuffer(v),E=new DataView(x),D=new Uint8Array(x);E.setUint8(pe.#t,e),E.setUint8(pe.#e,i?1:0),E.setUint8(pe.#n,h?1:0),E.setUint8(pe.#i,l),E.setUint32(pe.#o,c,!0),E.setUint32(pe.#r,u,!0),E.setUint32(pe.#s,p,!0),E.setUint32(pe.#a,b,!0);let T=20;new Float32Array(x,T,c*2).set(n),T+=c*8,D.set(s,T),T+=u*3;for(const[F,M]of r)E.setFloat32(T,F,!0),T+=4,E.setUint32(T,parseInt(M.slice(1),16),!0),T+=4;if(i)for(const F of i)E.setFloat32(T,F,!0),T+=4;h&&(D.set(h,T),T+=3);for(let F=0;F<o.length;F++){const M=o[F];E.setUint8(T,M.type),T+=1,T=Math.ceil(T/4)*4,E.setUint32(T,M.coords.length,!0),T+=4,new Int32Array(x,T,M.coords.length).set(M.coords),T+=M.coords.length*4,E.setUint32(T,M.colors.length,!0),T+=4,new Int32Array(x,T,M.colors.length).set(M.colors),T+=M.colors.length*4,M.verticesPerRow!==void 0&&(E.setUint32(T,M.verticesPerRow,!0),T+=4)}return x}getIR(){const t=this.view,e=this.data[pe.#t],i=!!this.data[pe.#e],n=!!this.data[pe.#n],s=t.getUint32(pe.#o,!0),r=t.getUint32(pe.#r,!0),o=t.getUint32(pe.#s,!0),l=t.getUint32(pe.#a,!0);let h=20;const c=new Float32Array(this.buffer,h,s*2);h+=s*8;const u=new Uint8Array(this.buffer,h,r*3);h+=r*3;const p=[];for(let x=0;x<o;++x){const E=t.getFloat32(h,!0);h+=4;const D=t.getUint32(h,!0);h+=4,p.push([E,`#${D.toString(16).padStart(6,"0")}`])}let b=null;if(i){b=[];for(let x=0;x<4;++x)b.push(t.getFloat32(h,!0)),h+=4}let w=null;n&&(w=new Uint8Array(this.buffer,h,3),h+=3);const v=[];for(let x=0;x<l;++x){const E=t.getUint8(h);h+=1,h=Math.ceil(h/4)*4;const D=t.getUint32(h,!0);h+=4;const T=new Int32Array(this.buffer,h,D);h+=D*4;const k=t.getUint32(h,!0);h+=4;const F=new Int32Array(this.buffer,h,k);h+=k*4;const M={type:E,coords:T,colors:F};E===lo.LATTICE&&(M.verticesPerRow=t.getUint32(h,!0),h+=4),v.push(M)}if(e===1)return["RadialAxial","axial",b,p,Array.from(c.slice(0,2)),Array.from(c.slice(2,4)),null,null];if(e===2)return["RadialAxial","radial",b,p,[c[0],c[1]],[c[3],c[4]],c[2],c[5]];if(e===3){const x=this.data[pe.#i];let E=null;if(c.length>0){let D=c[0],T=c[0],k=c[1],F=c[1];for(let M=0;M<c.length;M+=2){const O=c[M],N=c[M+1];D=D>O?O:D,k=k>N?N:k,T=T<O?O:T,F=F<N?N:F}E=[D,k,T,F]}return["Mesh",x,c,u,v,E,b,w]}throw new Error(`Unsupported pattern kind: ${e}`)}}class ad{static write(t){let e,i;return fe.isFloat16ArraySupported?(i=new ArrayBuffer(t.length*2),e=new Float16Array(i)):(i=new ArrayBuffer(t.length*4),e=new Float32Array(i)),e.set(t),i}#t;constructor(t){this.#t=t}get path(){return fe.isFloat16ArraySupported?new Float16Array(this.#t):new Float32Array(this.#t)}}function ld(a){if(a instanceof URL)return a.href;if(typeof a=="string"){if(Me)return a;const t=URL.parse(a,window.location);if(t)return t.href}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.")}function hd(a){if(Me&&typeof oo<"u"&&a instanceof oo)throw new Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");if(a instanceof Uint8Array&&a.byteLength===a.buffer.byteLength)return a;if(typeof a=="string")return ms(a);if(a instanceof ArrayBuffer||ArrayBuffer.isView(a)||typeof a=="object"&&!isNaN(a?.length))return new Uint8Array(a);throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}function Fs(a){if(typeof a!="string")return null;if(a.endsWith("/"))return a;throw new Error(`Invalid factory url: "${a}" must include trailing slash.`)}const go=a=>typeof a=="object"&&Number.isInteger(a?.num)&&a.num>=0&&Number.isInteger(a?.gen)&&a.gen>=0,cd=a=>typeof a=="object"&&typeof a?.name=="string",dd=Gc.bind(null,go,cd);class ud{#t=new Map;#e=Promise.resolve();postMessage(t,e){const i={data:structuredClone(t,e?{transfer:e}:null)};this.#e.then(()=>{for(const[n]of this.#t)n.call(this,i)})}addEventListener(t,e,i=null){let n=null;if(i?.signal instanceof AbortSignal){const{signal:s}=i;if(s.aborted){ft("LoopbackPort - cannot use an `aborted` signal.");return}const r=()=>this.removeEventListener(t,e);n=()=>s.removeEventListener("abort",r),s.addEventListener("abort",r)}this.#t.set(e,n)}removeEventListener(t,e){this.#t.get(e)?.(),this.#t.delete(e)}terminate(){for(const[,t]of this.#t)t?.();this.#t.clear()}}const Ms={DATA:1,ERROR:2},oe={CANCEL:1,CANCEL_COMPLETE:2,CLOSE:3,ENQUEUE:4,ERROR:5,PULL:6,PULL_COMPLETE:7,START_COMPLETE:8};function Ta(){}function Ue(a){if(a instanceof Vi||a instanceof ho||a instanceof va||a instanceof tr||a instanceof Nr)return a;switch(a instanceof Error||typeof a=="object"&&a!==null||Rt('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),a.name){case"AbortException":return new Vi(a.message);case"InvalidPDFException":return new ho(a.message);case"PasswordException":return new va(a.message,a.code);case"ResponseException":return new tr(a.message,a.status,a.missing);case"UnknownErrorException":return new Nr(a.message,a.details)}return new Nr(a.message,a.toString())}class Yn{#t=new AbortController;constructor(t,e,i){this.sourceName=t,this.targetName=e,this.comObj=i,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),i.addEventListener("message",this.#e.bind(this),{signal:this.#t.signal})}#e({data:t}){if(t.targetName!==this.sourceName)return;if(t.stream){this.#i(t);return}if(t.callback){const i=t.callbackId,n=this.callbackCapabilities[i];if(!n)throw new Error(`Cannot resolve callback ${i}`);if(delete this.callbackCapabilities[i],t.callback===Ms.DATA)n.resolve(t.data);else if(t.callback===Ms.ERROR)n.reject(Ue(t.reason));else throw new Error("Unexpected callback case");return}const e=this.actionHandler[t.action];if(!e)throw new Error(`Unknown action from worker: ${t.action}`);if(t.callbackId){const i=this.sourceName,n=t.sourceName,s=this.comObj;Promise.try(e,t.data).then(function(r){s.postMessage({sourceName:i,targetName:n,callback:Ms.DATA,callbackId:t.callbackId,data:r})},function(r){s.postMessage({sourceName:i,targetName:n,callback:Ms.ERROR,callbackId:t.callbackId,reason:Ue(r)})});return}if(t.streamId){this.#n(t);return}e(t.data)}on(t,e){const i=this.actionHandler;if(i[t])throw new Error(`There is already an actionName called "${t}"`);i[t]=e}send(t,e,i){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:t,data:e},i)}sendWithPromise(t,e,i){const n=this.callbackId++,s=Promise.withResolvers();this.callbackCapabilities[n]=s;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:t,callbackId:n,data:e},i)}catch(r){s.reject(r)}return s.promise}sendWithStream(t,e,i,n){const s=this.streamId++,r=this.sourceName,o=this.targetName,l=this.comObj;return new ReadableStream({start:h=>{const c=Promise.withResolvers();return this.streamControllers[s]={controller:h,startCall:c,pullCall:null,cancelCall:null,isClosed:!1},l.postMessage({sourceName:r,targetName:o,action:t,streamId:s,data:e,desiredSize:h.desiredSize},n),c.promise},pull:h=>{const c=Promise.withResolvers();return this.streamControllers[s].pullCall=c,l.postMessage({sourceName:r,targetName:o,stream:oe.PULL,streamId:s,desiredSize:h.desiredSize}),c.promise},cancel:h=>{St(h instanceof Error,"cancel must have a valid reason");const c=Promise.withResolvers();return this.streamControllers[s].cancelCall=c,this.streamControllers[s].isClosed=!0,l.postMessage({sourceName:r,targetName:o,stream:oe.CANCEL,streamId:s,reason:Ue(h)}),c.promise}},i)}#n(t){const e=t.streamId,i=this.sourceName,n=t.sourceName,s=this.comObj,r=this,o=this.actionHandler[t.action],l={enqueue(h,c=1,u){if(this.isCancelled)return;const p=this.desiredSize;this.desiredSize-=c,p>0&&this.desiredSize<=0&&(this.sinkCapability=Promise.withResolvers(),this.ready=this.sinkCapability.promise),s.postMessage({sourceName:i,targetName:n,stream:oe.ENQUEUE,streamId:e,chunk:h},u)},close(){this.isCancelled||(this.isCancelled=!0,s.postMessage({sourceName:i,targetName:n,stream:oe.CLOSE,streamId:e}),delete r.streamSinks[e])},error(h){St(h instanceof Error,"error must have a valid reason"),!this.isCancelled&&(this.isCancelled=!0,s.postMessage({sourceName:i,targetName:n,stream:oe.ERROR,streamId:e,reason:Ue(h)}))},sinkCapability:Promise.withResolvers(),onPull:null,onCancel:null,isCancelled:!1,desiredSize:t.desiredSize,ready:null};l.sinkCapability.resolve(),l.ready=l.sinkCapability.promise,this.streamSinks[e]=l,Promise.try(o,t.data,l).then(function(){s.postMessage({sourceName:i,targetName:n,stream:oe.START_COMPLETE,streamId:e,success:!0})},function(h){s.postMessage({sourceName:i,targetName:n,stream:oe.START_COMPLETE,streamId:e,reason:Ue(h)})})}#i(t){const e=t.streamId,i=this.sourceName,n=t.sourceName,s=this.comObj,r=this.streamControllers[e],o=this.streamSinks[e];switch(t.stream){case oe.START_COMPLETE:t.success?r.startCall.resolve():r.startCall.reject(Ue(t.reason));break;case oe.PULL_COMPLETE:t.success?r.pullCall.resolve():r.pullCall.reject(Ue(t.reason));break;case oe.PULL:if(!o){s.postMessage({sourceName:i,targetName:n,stream:oe.PULL_COMPLETE,streamId:e,success:!0});break}o.desiredSize<=0&&t.desiredSize>0&&o.sinkCapability.resolve(),o.desiredSize=t.desiredSize,Promise.try(o.onPull||Ta).then(function(){s.postMessage({sourceName:i,targetName:n,stream:oe.PULL_COMPLETE,streamId:e,success:!0})},function(h){s.postMessage({sourceName:i,targetName:n,stream:oe.PULL_COMPLETE,streamId:e,reason:Ue(h)})});break;case oe.ENQUEUE:if(St(r,"enqueue should have stream controller"),r.isClosed)break;r.controller.enqueue(t.chunk);break;case oe.CLOSE:if(St(r,"close should have stream controller"),r.isClosed)break;r.isClosed=!0,r.controller.close(),this.#o(r,e);break;case oe.ERROR:St(r,"error should have stream controller"),r.controller.error(Ue(t.reason)),this.#o(r,e);break;case oe.CANCEL_COMPLETE:t.success?r.cancelCall.resolve():r.cancelCall.reject(Ue(t.reason)),this.#o(r,e);break;case oe.CANCEL:if(!o)break;const l=Ue(t.reason);Promise.try(o.onCancel||Ta,l).then(function(){s.postMessage({sourceName:i,targetName:n,stream:oe.CANCEL_COMPLETE,streamId:e,success:!0})},function(h){s.postMessage({sourceName:i,targetName:n,stream:oe.CANCEL_COMPLETE,streamId:e,reason:Ue(h)})}),o.sinkCapability.reject(l),o.isCancelled=!0,delete this.streamSinks[e];break;default:throw new Error("Unexpected stream case")}}async#o(t,e){await Promise.allSettled([t.startCall?.promise,t.pullCall?.promise,t.cancelCall?.promise]),delete this.streamControllers[e]}destroy(){this.#t?.abort(),this.#t=null}}class $l{#t=!1;constructor({enableHWA:t=!1}){this.#t=t}create(t,e){if(t<=0||e<=0)throw new Error("Invalid canvas size");const i=this._createCanvas(t,e);return{canvas:i,context:i.getContext("2d",{willReadFrequently:!this.#t})}}reset(t,e,i){if(!t.canvas)throw new Error("Canvas is not specified");if(e<=0||i<=0)throw new Error("Invalid canvas size");t.canvas.width=e,t.canvas.height=i}destroy(t){if(!t.canvas)throw new Error("Canvas is not specified");t.canvas.width=0,t.canvas.height=0,t.canvas=null,t.context=null}_createCanvas(t,e){Rt("Abstract method `_createCanvas` called.")}}class fd extends $l{constructor({ownerDocument:t=globalThis.document,enableHWA:e=!1}){super({enableHWA:e}),this._document=t}_createCanvas(t,e){const i=this._document.createElement("canvas");return i.width=t,i.height=e,i}}class Hl{constructor({baseUrl:t=null,isCompressed:e=!0}){this.baseUrl=t,this.isCompressed=e}async fetch({name:t}){if(!this.baseUrl)throw new Error("Ensure that the `cMapUrl` and `cMapPacked` API parameters are provided.");if(!t)throw new Error("CMap name must be specified.");const e=this.baseUrl+t+(this.isCompressed?".bcmap":"");return this._fetch(e).then(i=>({cMapData:i,isCompressed:this.isCompressed})).catch(i=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${e}`)})}async _fetch(t){Rt("Abstract method `_fetch` called.")}}class Da extends Hl{async _fetch(t){const e=await bs(t,this.isCompressed?"arraybuffer":"text");return e instanceof ArrayBuffer?new Uint8Array(e):ms(e)}}class jl{addFilter(t){return"none"}addHCMFilter(t,e){return"none"}addAlphaFilter(t){return"none"}addLuminosityFilter(t){return"none"}addHighlightHCMFilter(t,e,i,n,s){return"none"}destroy(t=!1){}}class pd extends jl{#t;#e;#n;#i;#o;#r;#s=0;constructor({docId:t,ownerDocument:e=globalThis.document}){super(),this.#i=t,this.#o=e}get#a(){return this.#e||=new Map}get#h(){return this.#r||=new Map}get#l(){if(!this.#n){const t=this.#o.createElement("div"),{style:e}=t;e.visibility="hidden",e.contain="strict",e.width=e.height=0,e.position="absolute",e.top=e.left=0,e.zIndex=-1;const i=this.#o.createElementNS(Ti,"svg");i.setAttribute("width",0),i.setAttribute("height",0),this.#n=this.#o.createElementNS(Ti,"defs"),t.append(i),i.append(this.#n),this.#o.body.append(t)}return this.#n}#u(t){if(t.length===1){const l=t[0],h=new Array(256);for(let u=0;u<256;u++)h[u]=l[u]/255;const c=h.join(",");return[c,c,c]}const[e,i,n]=t,s=new Array(256),r=new Array(256),o=new Array(256);for(let l=0;l<256;l++)s[l]=e[l]/255,r[l]=i[l]/255,o[l]=n[l]/255;return[s.join(","),r.join(","),o.join(",")]}#d(t){if(this.#t===void 0){this.#t="";const e=this.#o.URL;e!==this.#o.baseURI&&(br(e)?ft('#createUrl: ignore "data:"-URL for performance reasons.'):this.#t=kl(e,""))}return`url(${this.#t}#${t})`}addFilter(t){if(!t)return"none";let e=this.#a.get(t);if(e)return e;const[i,n,s]=this.#u(t),r=t.length===1?i:`${i}${n}${s}`;if(e=this.#a.get(r),e)return this.#a.set(t,e),e;const o=`g_${this.#i}_transfer_map_${this.#s++}`,l=this.#d(o);this.#a.set(t,l),this.#a.set(r,l);const h=this.#g(o);return this.#p(i,n,s,h),l}addHCMFilter(t,e){const i=`${t}-${e}`,n="base";let s=this.#h.get(n);if(s?.key===i||(s?(s.filter?.remove(),s.key=i,s.url="none",s.filter=null):(s={key:i,url:"none",filter:null},this.#h.set(n,s)),!t||!e))return s.url;const r=this.#w(t);t=J.makeHexColor(...r);const o=this.#w(e);if(e=J.makeHexColor(...o),this.#l.style.color="",t==="#000000"&&e==="#ffffff"||t===e)return s.url;const l=new Array(256);for(let b=0;b<=255;b++){const w=b/255;l[b]=w<=.03928?w/12.92:((w+.055)/1.055)**2.4}const h=l.join(","),c=`g_${this.#i}_hcm_filter`,u=s.filter=this.#g(c);this.#p(h,h,h,u),this.#m(u);const p=(b,w)=>{const v=r[b]/255,x=o[b]/255,E=new Array(w+1);for(let D=0;D<=w;D++)E[D]=v+D/w*(x-v);return E.join(",")};return this.#p(p(0,5),p(1,5),p(2,5),u),s.url=this.#d(c),s.url}addAlphaFilter(t){let e=this.#a.get(t);if(e)return e;const[i]=this.#u([t]),n=`alpha_${i}`;if(e=this.#a.get(n),e)return this.#a.set(t,e),e;const s=`g_${this.#i}_alpha_map_${this.#s++}`,r=this.#d(s);this.#a.set(t,r),this.#a.set(n,r);const o=this.#g(s);return this.#b(i,o),r}addLuminosityFilter(t){let e=this.#a.get(t||"luminosity");if(e)return e;let i,n;if(t?([i]=this.#u([t]),n=`luminosity_${i}`):n="luminosity",e=this.#a.get(n),e)return this.#a.set(t,e),e;const s=`g_${this.#i}_luminosity_map_${this.#s++}`,r=this.#d(s);this.#a.set(t,r),this.#a.set(n,r);const o=this.#g(s);return this.#f(o),t&&this.#b(i,o),r}addHighlightHCMFilter(t,e,i,n,s){const r=`${e}-${i}-${n}-${s}`;let o=this.#h.get(t);if(o?.key===r||(o?(o.filter?.remove(),o.key=r,o.url="none",o.filter=null):(o={key:r,url:"none",filter:null},this.#h.set(t,o)),!e||!i))return o.url;const[l,h]=[e,i].map(this.#w.bind(this));let c=Math.round(.2126*l[0]+.7152*l[1]+.0722*l[2]),u=Math.round(.2126*h[0]+.7152*h[1]+.0722*h[2]),[p,b]=[n,s].map(this.#w.bind(this));u<c&&([c,u,p,b]=[u,c,b,p]),this.#l.style.color="";const w=(E,D,T)=>{const k=new Array(256),F=(u-c)/T,M=E/255,O=(D-E)/(255*T);let N=0;for(let R=0;R<=T;R++){const $=Math.round(c+R*F),U=M+R*O;for(let Q=N;Q<=$;Q++)k[Q]=U;N=$+1}for(let R=N;R<256;R++)k[R]=k[N-1];return k.join(",")},v=`g_${this.#i}_hcm_${t}_filter`,x=o.filter=this.#g(v);return this.#m(x),this.#p(w(p[0],b[0],5),w(p[1],b[1],5),w(p[2],b[2],5),x),o.url=this.#d(v),o.url}destroy(t=!1){t&&this.#r?.size||(this.#n?.parentNode.parentNode.remove(),this.#n=null,this.#e?.clear(),this.#e=null,this.#r?.clear(),this.#r=null,this.#s=0)}#f(t){const e=this.#o.createElementNS(Ti,"feColorMatrix");e.setAttribute("type","matrix"),e.setAttribute("values","0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.3 0.59 0.11 0 0"),t.append(e)}#m(t){const e=this.#o.createElementNS(Ti,"feColorMatrix");e.setAttribute("type","matrix"),e.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"),t.append(e)}#g(t){const e=this.#o.createElementNS(Ti,"filter");return e.setAttribute("color-interpolation-filters","sRGB"),e.setAttribute("id",t),this.#l.append(e),e}#c(t,e,i){const n=this.#o.createElementNS(Ti,e);n.setAttribute("type","discrete"),n.setAttribute("tableValues",i),t.append(n)}#p(t,e,i,n){const s=this.#o.createElementNS(Ti,"feComponentTransfer");n.append(s),this.#c(s,"feFuncR",t),this.#c(s,"feFuncG",e),this.#c(s,"feFuncB",i)}#b(t,e){const i=this.#o.createElementNS(Ti,"feComponentTransfer");e.append(i),this.#c(i,"feFuncA",t)}#w(t){return this.#l.style.color=t,ws(getComputedStyle(this.#l).getPropertyValue("color"))}}class zl{constructor({baseUrl:t=null}){this.baseUrl=t}async fetch({filename:t}){if(!this.baseUrl)throw new Error("Ensure that the `standardFontDataUrl` API parameter is provided.");if(!t)throw new Error("Font filename must be specified.");const e=`${this.baseUrl}${t}`;return this._fetch(e).catch(i=>{throw new Error(`Unable to load font data at: ${e}`)})}async _fetch(t){Rt("Abstract method `_fetch` called.")}}class ka extends zl{async _fetch(t){const e=await bs(t,"arraybuffer");return new Uint8Array(e)}}class Gl{constructor({baseUrl:t=null}){this.baseUrl=t}async fetch({filename:t}){if(!this.baseUrl)throw new Error("Ensure that the `wasmUrl` API parameter is provided.");if(!t)throw new Error("Wasm filename must be specified.");const e=`${this.baseUrl}${t}`;return this._fetch(e).catch(i=>{throw new Error(`Unable to load wasm data at: ${e}`)})}async _fetch(t){Rt("Abstract method `_fetch` called.")}}class Fa extends Gl{async _fetch(t){const e=await bs(t,"arraybuffer");return new Uint8Array(e)}}Me&&ft("Please use the `legacy` build in Node.js environments.");async function Oo(a){const e=await Qt.getBuiltinModule("fs").promises.readFile(a);return new Uint8Array(e)}class gd extends jl{}class md extends $l{_createCanvas(t,e){return Qt.getBuiltinModule("module").createRequire(import.meta.url)("@napi-rs/canvas").createCanvas(t,e)}}class bd extends Hl{async _fetch(t){return Oo(t)}}class yd extends zl{async _fetch(t){return Oo(t)}}class wd extends Gl{async _fetch(t){return Oo(t)}}const gn="__forcedDependency",{floor:Ma,ceil:Ia}=Math;function Is(a,t,e,i,n,s){a[t*4+0]=Math.min(a[t*4+0],e),a[t*4+1]=Math.min(a[t*4+1],i),a[t*4+2]=Math.max(a[t*4+2],n),a[t*4+3]=Math.max(a[t*4+3],s)}const mo=new Uint32Array(new Uint8Array([255,255,0,0]).buffer)[0];class vd{#t;#e;constructor(t,e){this.#t=t,this.#e=e}get length(){return this.#t.length}isEmpty(t){return this.#t[t]===mo}minX(t){return this.#e[t*4+0]/256}minY(t){return this.#e[t*4+1]/256}maxX(t){return(this.#e[t*4+2]+1)/256}maxY(t){return(this.#e[t*4+3]+1)/256}}const Ls=(a,t)=>{if(!a)return;let e=a.get(t);return e||(e={dependencies:new Set,isRenderingOperation:!1},a.set(t,e)),e};class Ad{#t={__proto__:null};#e={__proto__:null,transform:[],moveText:[],sameLineText:[],[gn]:[]};#n=new Map;#i=[];#o=[];#r=[[1,0,0,1,0,0]];#s=[-1/0,-1/0,1/0,1/0];#a=new Float64Array([1/0,1/0,-1/0,-1/0]);#h=-1;#l=new Set;#u=new Map;#d=new Map;#f;#m;#g;#c;#p;constructor(t,e,i=!1){this.#f=t.width,this.#m=t.height,this.#b(e),i&&(this.#p=new Map)}growOperationsCount(t){t>=this.#c.length&&this.#b(t,this.#c)}#b(t,e){const i=new ArrayBuffer(t*4);this.#g=new Uint8ClampedArray(i),this.#c=new Uint32Array(i),e&&e.length>0?(this.#c.set(e),this.#c.fill(mo,e.length)):this.#c.fill(mo)}save(t){return this.#t={__proto__:this.#t},this.#e={__proto__:this.#e,transform:{__proto__:this.#e.transform},moveText:{__proto__:this.#e.moveText},sameLineText:{__proto__:this.#e.sameLineText},[gn]:{__proto__:this.#e[gn]}},this.#s={__proto__:this.#s},this.#i.push(t),this}restore(t){const e=Object.getPrototypeOf(this.#t);if(e===null)return this;this.#t=e,this.#e=Object.getPrototypeOf(this.#e),this.#s=Object.getPrototypeOf(this.#s);const i=this.#i.pop();return i!==void 0&&(Ls(this.#p,t)?.dependencies.add(i),this.#c[t]=this.#c[i]),this}recordOpenMarker(t){return this.#i.push(t),this}getOpenMarker(){return this.#i.length===0?null:this.#i.at(-1)}recordCloseMarker(t){const e=this.#i.pop();return e!==void 0&&(Ls(this.#p,t)?.dependencies.add(e),this.#c[t]=this.#c[e]),this}beginMarkedContent(t){return this.#o.push(t),this}endMarkedContent(t){const e=this.#o.pop();return e!==void 0&&(Ls(this.#p,t)?.dependencies.add(e),this.#c[t]=this.#c[e]),this}pushBaseTransform(t){return this.#r.push(J.multiplyByDOMMatrix(this.#r.at(-1),t.getTransform())),this}popBaseTransform(){return this.#r.length>1&&this.#r.pop(),this}recordSimpleData(t,e){return this.#t[t]=e,this}recordIncrementalData(t,e){return this.#e[t].push(e),this}resetIncrementalData(t,e){return this.#e[t].length=0,this}recordNamedData(t,e){return this.#n.set(t,e),this}recordSimpleDataFromNamed(t,e,i){this.#t[t]=this.#n.get(e)??i}recordFutureForcedDependency(t,e){return this.recordIncrementalData(gn,e),this}inheritSimpleDataAsFutureForcedDependencies(t){for(const e of t)e in this.#t&&this.recordFutureForcedDependency(e,this.#t[e]);return this}inheritPendingDependenciesAsFutureForcedDependencies(){for(const t of this.#l)this.recordFutureForcedDependency(gn,t);return this}resetBBox(t){return this.#h!==t&&(this.#h=t,this.#a[0]=1/0,this.#a[1]=1/0,this.#a[2]=-1/0,this.#a[3]=-1/0),this}recordClipBox(t,e,i,n,s,r){const o=J.multiplyByDOMMatrix(this.#r.at(-1),e.getTransform()),l=[1/0,1/0,-1/0,-1/0];J.axialAlignedBoundingBox([i,s,n,r],o,l);const h=J.intersect(this.#s,l);return h?(this.#s[0]=h[0],this.#s[1]=h[1],this.#s[2]=h[2],this.#s[3]=h[3]):(this.#s[0]=this.#s[1]=1/0,this.#s[2]=this.#s[3]=-1/0),this}recordBBox(t,e,i,n,s,r){const o=this.#s;if(o[0]===1/0)return this;const l=J.multiplyByDOMMatrix(this.#r.at(-1),e.getTransform());if(o[0]===-1/0)return J.axialAlignedBoundingBox([i,s,n,r],l,this.#a),this;const h=[1/0,1/0,-1/0,-1/0];return J.axialAlignedBoundingBox([i,s,n,r],l,h),this.#a[0]=Math.min(this.#a[0],Math.max(h[0],o[0])),this.#a[1]=Math.min(this.#a[1],Math.max(h[1],o[1])),this.#a[2]=Math.max(this.#a[2],Math.min(h[2],o[2])),this.#a[3]=Math.max(this.#a[3],Math.min(h[3],o[3])),this}recordCharacterBBox(t,e,i,n=1,s=0,r=0,o){const l=i.bbox;let h,c;if(l&&(h=l[2]!==l[0]&&l[3]!==l[1]&&this.#d.get(i),h!==!1&&(c=[0,0,0,0],J.axialAlignedBoundingBox(l,i.fontMatrix,c),(n!==1||s!==0||r!==0)&&J.scaleMinMax([n,0,0,-n,s,r],c),h)))return this.recordBBox(t,e,c[0],c[2],c[1],c[3]);if(!o)return this.recordFullPageBBox(t);const u=o();return l&&c&&h===void 0&&(h=c[0]<=s-u.actualBoundingBoxLeft&&c[2]>=s+u.actualBoundingBoxRight&&c[1]<=r-u.actualBoundingBoxAscent&&c[3]>=r+u.actualBoundingBoxDescent,this.#d.set(i,h),h)?this.recordBBox(t,e,c[0],c[2],c[1],c[3]):this.recordBBox(t,e,s-u.actualBoundingBoxLeft,s+u.actualBoundingBoxRight,r-u.actualBoundingBoxAscent,r+u.actualBoundingBoxDescent)}recordFullPageBBox(t){return this.#a[0]=Math.max(0,this.#s[0]),this.#a[1]=Math.max(0,this.#s[1]),this.#a[2]=Math.min(this.#f,this.#s[2]),this.#a[3]=Math.min(this.#m,this.#s[3]),this}getSimpleIndex(t){return this.#t[t]}recordDependencies(t,e){const i=this.#l,n=this.#t,s=this.#e;for(const r of e)r in this.#t?i.add(n[r]):r in s&&s[r].forEach(i.add,i);return this}recordNamedDependency(t,e){return this.#n.has(e)&&this.#l.add(this.#n.get(e)),this}recordOperation(t,e=!1){if(this.recordDependencies(t,[gn]),this.#p){const i=Ls(this.#p,t),{dependencies:n}=i;this.#l.forEach(n.add,n),this.#i.forEach(n.add,n),this.#o.forEach(n.add,n),n.delete(t),i.isRenderingOperation=!0}if(this.#h===t){const i=Ma(this.#a[0]*256/this.#f),n=Ma(this.#a[1]*256/this.#m),s=Ia(this.#a[2]*256/this.#f),r=Ia(this.#a[3]*256/this.#m);Is(this.#g,t,i,n,s,r);for(const o of this.#l)o!==t&&Is(this.#g,o,i,n,s,r);for(const o of this.#i)o!==t&&Is(this.#g,o,i,n,s,r);for(const o of this.#o)o!==t&&Is(this.#g,o,i,n,s,r);e||(this.#l.clear(),this.#h=-1)}return this}recordShowTextOperation(t,e=!1){const i=Array.from(this.#l);this.recordOperation(t,e),this.recordIncrementalData("sameLineText",t);for(const n of i)this.recordIncrementalData("sameLineText",n);return this}bboxToClipBoxDropOperation(t,e=!1){return this.#h===t&&(this.#h=-1,this.#s[0]=Math.max(this.#s[0],this.#a[0]),this.#s[1]=Math.max(this.#s[1],this.#a[1]),this.#s[2]=Math.min(this.#s[2],this.#a[2]),this.#s[3]=Math.min(this.#s[3],this.#a[3]),e||this.#l.clear()),this}_takePendingDependencies(){const t=this.#l;return this.#l=new Set,t}_extractOperation(t){const e=this.#u.get(t);return this.#u.delete(t),e}_pushPendingDependencies(t){for(const e of t)this.#l.add(e)}take(){return this.#d.clear(),new vd(this.#c,this.#g)}takeDebugMetadata(){return this.#p}}class er{#t;#e;#n;#i=0;#o=0;constructor(t,e,i){if(t instanceof er&&t.#n===!!i)return t;this.#t=t,this.#e=e,this.#n=!!i}growOperationsCount(){throw new Error("Unreachable")}save(t){return this.#o++,this.#t.save(this.#e),this}restore(t){return this.#o>0&&(this.#t.restore(this.#e),this.#o--),this}recordOpenMarker(t){return this.#i++,this}getOpenMarker(){return this.#i>0?this.#e:this.#t.getOpenMarker()}recordCloseMarker(t){return this.#i--,this}beginMarkedContent(t){return this}endMarkedContent(t){return this}pushBaseTransform(t){return this.#t.pushBaseTransform(t),this}popBaseTransform(){return this.#t.popBaseTransform(),this}recordSimpleData(t,e){return this.#t.recordSimpleData(t,this.#e),this}recordIncrementalData(t,e){return this.#t.recordIncrementalData(t,this.#e),this}resetIncrementalData(t,e){return this.#t.resetIncrementalData(t,this.#e),this}recordNamedData(t,e){return this}recordSimpleDataFromNamed(t,e,i){return this.#t.recordSimpleDataFromNamed(t,e,this.#e),this}recordFutureForcedDependency(t,e){return this.#t.recordFutureForcedDependency(t,this.#e),this}inheritSimpleDataAsFutureForcedDependencies(t){return this.#t.inheritSimpleDataAsFutureForcedDependencies(t),this}inheritPendingDependenciesAsFutureForcedDependencies(){return this.#t.inheritPendingDependenciesAsFutureForcedDependencies(),this}resetBBox(t){return this.#n||this.#t.resetBBox(this.#e),this}recordClipBox(t,e,i,n,s,r){return this.#n||this.#t.recordClipBox(this.#e,e,i,n,s,r),this}recordBBox(t,e,i,n,s,r){return this.#n||this.#t.recordBBox(this.#e,e,i,n,s,r),this}recordCharacterBBox(t,e,i,n,s,r,o){return this.#n||this.#t.recordCharacterBBox(this.#e,e,i,n,s,r,o),this}recordFullPageBBox(t){return this.#n||this.#t.recordFullPageBBox(this.#e),this}getSimpleIndex(t){return this.#t.getSimpleIndex(t)}recordDependencies(t,e){return this.#t.recordDependencies(this.#e,e),this}recordNamedDependency(t,e){return this.#t.recordNamedDependency(this.#e,e),this}recordOperation(t){return this.#t.recordOperation(this.#e,!0),this}recordShowTextOperation(t){return this.#t.recordShowTextOperation(this.#e,!0),this}bboxToClipBoxDropOperation(t){return this.#n||this.#t.bboxToClipBoxDropOperation(this.#e,!0),this}take(){throw new Error("Unreachable")}takeDebugMetadata(){throw new Error("Unreachable")}}const ti={stroke:["path","transform","filter","strokeColor","strokeAlpha","lineWidth","lineCap","lineJoin","miterLimit","dash"],fill:["path","transform","filter","fillColor","fillAlpha","globalCompositeOperation","SMask"],imageXObject:["transform","SMask","filter","fillAlpha","strokeAlpha","globalCompositeOperation"],rawFillPath:["filter","fillColor","fillAlpha"],showText:["transform","leading","charSpacing","wordSpacing","hScale","textRise","moveText","textMatrix","font","fontObj","filter","fillColor","textRenderingMode","SMask","fillAlpha","strokeAlpha","globalCompositeOperation","sameLineText"],transform:["transform"],transformAndFill:["transform","fillColor"]},Ee={FILL:"Fill",STROKE:"Stroke",SHADING:"Shading"};function bo(a,t){if(!t)return;const e=t[2]-t[0],i=t[3]-t[1],n=new Path2D;n.rect(t[0],t[1],e,i),a.clip(n)}class No{isModifyingCurrentTransform(){return!1}getPattern(){Rt("Abstract method `getPattern` called.")}}class Ed extends No{constructor(t){super(),this._type=t[1],this._bbox=t[2],this._colorStops=t[3],this._p0=t[4],this._p1=t[5],this._r0=t[6],this._r1=t[7],this.matrix=null}isOriginBased(){return this._p0[0]===0&&this._p0[1]===0&&(!this.isRadial()||this._p1[0]===0&&this._p1[1]===0)}isRadial(){return this._type==="radial"}_createGradient(t,e=null){let i,n=this._p0,s=this._p1;if(e&&(n=n.slice(),s=s.slice(),J.applyTransform(n,e),J.applyTransform(s,e)),this._type==="axial")i=t.createLinearGradient(n[0],n[1],s[0],s[1]);else if(this._type==="radial"){let r=this._r0,o=this._r1;if(e){const l=new Float32Array(2);J.singularValueDecompose2dScale(e,l),r*=l[0],o*=l[0]}i=t.createRadialGradient(n[0],n[1],r,s[0],s[1],o)}for(const r of this._colorStops)i.addColorStop(r[0],r[1]);return i}getPattern(t,e,i,n){let s;if(n===Ee.STROKE||n===Ee.FILL){if(this.isOriginBased()){let p=J.transform(i,e.baseTransform);this.matrix&&(p=J.transform(p,this.matrix));const b=.001,w=Math.hypot(p[0],p[1]),v=Math.hypot(p[2],p[3]),x=(p[0]*p[2]+p[1]*p[3])/(w*v);if(Math.abs(x)<b)if(this.isRadial()){if(Math.abs(w-v)<b)return this._createGradient(t,p)}else return this._createGradient(t,p)}const r=e.current.getClippedPathBoundingBox(n,Vt(t))||[0,0,0,0],o=Math.ceil(r[2]-r[0])||1,l=Math.ceil(r[3]-r[1])||1,h=e.cachedCanvases.getCanvas("pattern",o,l),c=h.context;c.clearRect(0,0,c.canvas.width,c.canvas.height),c.beginPath(),c.rect(0,0,c.canvas.width,c.canvas.height),c.translate(-r[0],-r[1]),i=J.transform(i,[1,0,0,1,r[0],r[1]]),c.transform(...e.baseTransform),this.matrix&&c.transform(...this.matrix),bo(c,this._bbox),c.fillStyle=this._createGradient(c),c.fill(),s=t.createPattern(h.canvas,"no-repeat");const u=new DOMMatrix(i);s.setTransform(u)}else bo(t,this._bbox),s=this._createGradient(t);return s}}function $r(a,t,e,i,n,s,r,o){const l=t.coords,h=t.colors,c=a.data,u=a.width*4;let p;l[e+1]>l[i+1]&&(p=e,e=i,i=p,p=s,s=r,r=p),l[i+1]>l[n+1]&&(p=i,i=n,n=p,p=r,r=o,o=p),l[e+1]>l[i+1]&&(p=e,e=i,i=p,p=s,s=r,r=p);const b=(l[e]+t.offsetX)*t.scaleX,w=(l[e+1]+t.offsetY)*t.scaleY,v=(l[i]+t.offsetX)*t.scaleX,x=(l[i+1]+t.offsetY)*t.scaleY,E=(l[n]+t.offsetX)*t.scaleX,D=(l[n+1]+t.offsetY)*t.scaleY;if(w>=D)return;const T=h[s],k=h[s+1],F=h[s+2],M=h[r],O=h[r+1],N=h[r+2],R=h[o],$=h[o+1],U=h[o+2],Q=Math.round(w),V=Math.round(D);let z,st,G,W,Z,xt,Ft,it;for(let ot=Q;ot<=V;ot++){if(ot<x){const Pt=ot<w?0:(w-ot)/(w-x);z=b-(b-v)*Pt,st=T-(T-M)*Pt,G=k-(k-O)*Pt,W=F-(F-N)*Pt}else{let Pt;ot>D?Pt=1:x===D?Pt=0:Pt=(x-ot)/(x-D),z=v-(v-E)*Pt,st=M-(M-R)*Pt,G=O-(O-$)*Pt,W=N-(N-U)*Pt}let mt;ot<w?mt=0:ot>D?mt=1:mt=(w-ot)/(w-D),Z=b-(b-E)*mt,xt=T-(T-R)*mt,Ft=k-(k-$)*mt,it=F-(F-U)*mt;const dt=Math.round(Math.min(z,Z)),Ct=Math.round(Math.max(z,Z));let yt=u*ot+dt*4;for(let Pt=dt;Pt<=Ct;Pt++)mt=(z-Pt)/(z-Z),mt<0?mt=0:mt>1&&(mt=1),c[yt++]=st-(st-xt)*mt|0,c[yt++]=G-(G-Ft)*mt|0,c[yt++]=W-(W-it)*mt|0,c[yt++]=255}}function Sd(a,t,e){const i=t.coords,n=t.colors;let s,r;switch(t.type){case lo.LATTICE:const o=t.verticesPerRow,l=Math.floor(i.length/o)-1,h=o-1;for(s=0;s<l;s++){let c=s*o;for(let u=0;u<h;u++,c++)$r(a,e,i[c],i[c+1],i[c+o],n[c],n[c+1],n[c+o]),$r(a,e,i[c+o+1],i[c+1],i[c+o],n[c+o+1],n[c+1],n[c+o])}break;case lo.TRIANGLES:for(s=0,r=i.length;s<r;s+=3)$r(a,e,i[s],i[s+1],i[s+2],n[s],n[s+1],n[s+2]);break;default:throw new Error("illegal figure")}}class xd extends No{constructor(t){super(),this._coords=t[2],this._colors=t[3],this._figures=t[4],this._bounds=t[5],this._bbox=t[6],this._background=t[7],this.matrix=null}_createMeshCanvas(t,e,i){const o=Math.floor(this._bounds[0]),l=Math.floor(this._bounds[1]),h=Math.ceil(this._bounds[2])-o,c=Math.ceil(this._bounds[3])-l,u=Math.min(Math.ceil(Math.abs(h*t[0]*1.1)),3e3),p=Math.min(Math.ceil(Math.abs(c*t[1]*1.1)),3e3),b=h/u,w=c/p,v={coords:this._coords,colors:this._colors,offsetX:-o,offsetY:-l,scaleX:1/b,scaleY:1/w},x=u+4,E=p+4,D=i.getCanvas("mesh",x,E),T=D.context,k=T.createImageData(u,p);if(e){const M=k.data;for(let O=0,N=M.length;O<N;O+=4)M[O]=e[0],M[O+1]=e[1],M[O+2]=e[2],M[O+3]=255}for(const M of this._figures)Sd(k,M,v);return T.putImageData(k,2,2),{canvas:D.canvas,offsetX:o-2*b,offsetY:l-2*w,scaleX:b,scaleY:w}}isModifyingCurrentTransform(){return!0}getPattern(t,e,i,n){bo(t,this._bbox);const s=new Float32Array(2);if(n===Ee.SHADING)J.singularValueDecompose2dScale(Vt(t),s);else if(this.matrix){J.singularValueDecompose2dScale(this.matrix,s);const[o,l]=s;J.singularValueDecompose2dScale(e.baseTransform,s),s[0]*=o,s[1]*=l}else J.singularValueDecompose2dScale(e.baseTransform,s);const r=this._createMeshCanvas(s,n===Ee.SHADING?null:this._background,e.cachedCanvases);return n!==Ee.SHADING&&(t.setTransform(...e.baseTransform),this.matrix&&t.transform(...this.matrix)),t.translate(r.offsetX,r.offsetY),t.scale(r.scaleX,r.scaleY),t.createPattern(r.canvas,"no-repeat")}}class Cd extends No{getPattern(){return"hotpink"}}function _d(a){switch(a[0]){case"RadialAxial":return new Ed(a);case"Mesh":return new xd(a);case"Dummy":return new Cd}throw new Error(`Unknown IR type: ${a[0]}`)}const La={COLORED:1,UNCOLORED:2};class Bo{static MAX_PATTERN_SIZE=3e3;constructor(t,e,i,n){this.color=t[1],this.operatorList=t[2],this.matrix=t[3],this.bbox=t[4],this.xstep=t[5],this.ystep=t[6],this.paintType=t[7],this.tilingType=t[8],this.ctx=e,this.canvasGraphicsFactory=i,this.baseTransform=n}createPatternCanvas(t,e){const{bbox:i,operatorList:n,paintType:s,tilingType:r,color:o,canvasGraphicsFactory:l}=this;let{xstep:h,ystep:c}=this;h=Math.abs(h),c=Math.abs(c),mr("TilingType: "+r);const u=i[0],p=i[1],b=i[2],w=i[3],v=b-u,x=w-p,E=new Float32Array(2);J.singularValueDecompose2dScale(this.matrix,E);const[D,T]=E;J.singularValueDecompose2dScale(this.baseTransform,E);const k=D*E[0],F=T*E[1];let M=v,O=x,N=!1,R=!1;const $=Math.ceil(h*k),U=Math.ceil(c*F),Q=Math.ceil(v*k),V=Math.ceil(x*F);$>=Q?M=h:N=!0,U>=V?O=c:R=!0;const z=this.getSizeAndScale(M,this.ctx.canvas.width,k),st=this.getSizeAndScale(O,this.ctx.canvas.height,F),G=t.cachedCanvases.getCanvas("pattern",z.size,st.size),W=G.context,Z=l.createCanvasGraphics(W,e);if(Z.groupLevel=t.groupLevel,this.setFillAndStrokeStyleToContext(Z,s,o),W.translate(-z.scale*u,-st.scale*p),Z.transform(0,z.scale,0,0,st.scale,0,0),W.save(),Z.dependencyTracker?.save(),this.clipBbox(Z,u,p,b,w),Z.baseTransform=Vt(Z.ctx),Z.executeOperatorList(n),Z.endDrawing(),Z.dependencyTracker?.restore(),W.restore(),N||R){const xt=G.canvas;N&&(M=h),R&&(O=c);const Ft=this.getSizeAndScale(M,this.ctx.canvas.width,k),it=this.getSizeAndScale(O,this.ctx.canvas.height,F),ot=Ft.size,mt=it.size,dt=t.cachedCanvases.getCanvas("pattern-workaround",ot,mt),Ct=dt.context,yt=N?Math.floor(v/h):0,Pt=R?Math.floor(x/c):0;for(let _t=0;_t<=yt;_t++)for(let se=0;se<=Pt;se++)Ct.drawImage(xt,ot*_t,mt*se,ot,mt,0,0,ot,mt);return{canvas:dt.canvas,scaleX:Ft.scale,scaleY:it.scale,offsetX:u,offsetY:p}}return{canvas:G.canvas,scaleX:z.scale,scaleY:st.scale,offsetX:u,offsetY:p}}getSizeAndScale(t,e,i){const n=Math.max(Bo.MAX_PATTERN_SIZE,e);let s=Math.ceil(t*i);return s>=n?s=n:i=s/t,{scale:i,size:s}}clipBbox(t,e,i,n,s){const r=n-e,o=s-i;t.ctx.rect(e,i,r,o),J.axialAlignedBoundingBox([e,i,n,s],Vt(t.ctx),t.current.minMax),t.clip(),t.endPath()}setFillAndStrokeStyleToContext(t,e,i){const n=t.ctx,s=t.current;switch(e){case La.COLORED:const{fillStyle:r,strokeStyle:o}=this.ctx;n.fillStyle=s.fillColor=r,n.strokeStyle=s.strokeColor=o;break;case La.UNCOLORED:n.fillStyle=n.strokeStyle=i,s.fillColor=s.strokeColor=i;break;default:throw new Bc(`Unsupported paint type: ${e}`)}}isModifyingCurrentTransform(){return!1}getPattern(t,e,i,n,s){let r=i;n!==Ee.SHADING&&(r=J.transform(r,e.baseTransform),this.matrix&&(r=J.transform(r,this.matrix)));const o=this.createPatternCanvas(e,s);let l=new DOMMatrix(r);l=l.translate(o.offsetX,o.offsetY),l=l.scale(1/o.scaleX,1/o.scaleY);const h=t.createPattern(o.canvas,"repeat");return h.setTransform(l),h}}function Pd({src:a,srcPos:t=0,dest:e,width:i,height:n,nonBlackColor:s=4294967295,inverseDecode:r=!1}){const o=fe.isLittleEndian?4278190080:255,[l,h]=r?[s,o]:[o,s],c=i>>3,u=i&7,p=a.length;e=new Uint32Array(e.buffer);let b=0;for(let w=0;w<n;w++){for(const x=t+c;t<x;t++){const E=t<p?a[t]:255;e[b++]=E&128?h:l,e[b++]=E&64?h:l,e[b++]=E&32?h:l,e[b++]=E&16?h:l,e[b++]=E&8?h:l,e[b++]=E&4?h:l,e[b++]=E&2?h:l,e[b++]=E&1?h:l}if(u===0)continue;const v=t<p?a[t++]:255;for(let x=0;x<u;x++)e[b++]=v&1<<7-x?h:l}return{srcPos:t,destPos:b}}const Ra=16,Oa=100,Td=15,Na=10,$e=16,Hr=new DOMMatrix,Ye=new Float32Array(2),xn=new Float32Array([1/0,1/0,-1/0,-1/0]);function Dd(a,t){if(a._removeMirroring)throw new Error("Context is already forwarding operations.");a.__originalSave=a.save,a.__originalRestore=a.restore,a.__originalRotate=a.rotate,a.__originalScale=a.scale,a.__originalTranslate=a.translate,a.__originalTransform=a.transform,a.__originalSetTransform=a.setTransform,a.__originalResetTransform=a.resetTransform,a.__originalClip=a.clip,a.__originalMoveTo=a.moveTo,a.__originalLineTo=a.lineTo,a.__originalBezierCurveTo=a.bezierCurveTo,a.__originalRect=a.rect,a.__originalClosePath=a.closePath,a.__originalBeginPath=a.beginPath,a._removeMirroring=()=>{a.save=a.__originalSave,a.restore=a.__originalRestore,a.rotate=a.__originalRotate,a.scale=a.__originalScale,a.translate=a.__originalTranslate,a.transform=a.__originalTransform,a.setTransform=a.__originalSetTransform,a.resetTransform=a.__originalResetTransform,a.clip=a.__originalClip,a.moveTo=a.__originalMoveTo,a.lineTo=a.__originalLineTo,a.bezierCurveTo=a.__originalBezierCurveTo,a.rect=a.__originalRect,a.closePath=a.__originalClosePath,a.beginPath=a.__originalBeginPath,delete a._removeMirroring},a.save=function(){t.save(),this.__originalSave()},a.restore=function(){t.restore(),this.__originalRestore()},a.translate=function(e,i){t.translate(e,i),this.__originalTranslate(e,i)},a.scale=function(e,i){t.scale(e,i),this.__originalScale(e,i)},a.transform=function(e,i,n,s,r,o){t.transform(e,i,n,s,r,o),this.__originalTransform(e,i,n,s,r,o)},a.setTransform=function(e,i,n,s,r,o){t.setTransform(e,i,n,s,r,o),this.__originalSetTransform(e,i,n,s,r,o)},a.resetTransform=function(){t.resetTransform(),this.__originalResetTransform()},a.rotate=function(e){t.rotate(e),this.__originalRotate(e)},a.clip=function(e){t.clip(e),this.__originalClip(e)},a.moveTo=function(e,i){t.moveTo(e,i),this.__originalMoveTo(e,i)},a.lineTo=function(e,i){t.lineTo(e,i),this.__originalLineTo(e,i)},a.bezierCurveTo=function(e,i,n,s,r,o){t.bezierCurveTo(e,i,n,s,r,o),this.__originalBezierCurveTo(e,i,n,s,r,o)},a.rect=function(e,i,n,s){t.rect(e,i,n,s),this.__originalRect(e,i,n,s)},a.closePath=function(){t.closePath(),this.__originalClosePath()},a.beginPath=function(){t.beginPath(),this.__originalBeginPath()}}class kd{constructor(t){this.canvasFactory=t,this.cache=Object.create(null)}getCanvas(t,e,i){let n;return this.cache[t]!==void 0?(n=this.cache[t],this.canvasFactory.reset(n,e,i)):(n=this.canvasFactory.create(e,i),this.cache[t]=n),n}delete(t){delete this.cache[t]}clear(){for(const t in this.cache){const e=this.cache[t];this.canvasFactory.destroy(e),delete this.cache[t]}}}function Rs(a,t,e,i,n,s,r,o,l,h){const[c,u,p,b,w,v]=Vt(a);if(u===0&&p===0){const D=r*c+w,T=Math.round(D),k=o*b+v,F=Math.round(k),M=(r+l)*c+w,O=Math.abs(Math.round(M)-T)||1,N=(o+h)*b+v,R=Math.abs(Math.round(N)-F)||1;return a.setTransform(Math.sign(c),0,0,Math.sign(b),T,F),a.drawImage(t,e,i,n,s,0,0,O,R),a.setTransform(c,u,p,b,w,v),[O,R]}if(c===0&&b===0){const D=o*p+w,T=Math.round(D),k=r*u+v,F=Math.round(k),M=(o+h)*p+w,O=Math.abs(Math.round(M)-T)||1,N=(r+l)*u+v,R=Math.abs(Math.round(N)-F)||1;return a.setTransform(0,Math.sign(u),Math.sign(p),0,T,F),a.drawImage(t,e,i,n,s,0,0,R,O),a.setTransform(c,u,p,b,w,v),[R,O]}a.drawImage(t,e,i,n,s,r,o,l,h);const x=Math.hypot(c,u),E=Math.hypot(p,b);return[x*l,E*h]}class Ba{alphaIsShape=!1;fontSize=0;fontSizeScale=1;textMatrix=null;textMatrixScale=1;fontMatrix=ao;leading=0;x=0;y=0;lineX=0;lineY=0;charSpacing=0;wordSpacing=0;textHScale=1;textRenderingMode=ue.FILL;textRise=0;fillColor="#000000";strokeColor="#000000";patternFill=!1;patternStroke=!1;fillAlpha=1;strokeAlpha=1;lineWidth=1;activeSMask=null;transferMaps="none";constructor(t,e,i){i?.(this),this.clipBox=new Float32Array([0,0,t,e]),this.minMax=xn.slice()}clone(){const t=Object.create(this);return t.clipBox=this.clipBox.slice(),t.minMax=this.minMax.slice(),t}getPathBoundingBox(t=Ee.FILL,e=null){const i=this.minMax.slice();if(t===Ee.STROKE){e||Rt("Stroke bounding box must include transform."),J.singularValueDecompose2dScale(e,Ye);const n=Ye[0]*this.lineWidth/2,s=Ye[1]*this.lineWidth/2;i[0]-=n,i[1]-=s,i[2]+=n,i[3]+=s}return i}updateClipFromPath(){const t=J.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(t||[0,0,0,0])}isEmptyClip(){return this.minMax[0]===1/0}startNewPathAndClipBox(t){this.clipBox.set(t,0),this.minMax.set(xn,0)}getClippedPathBoundingBox(t=Ee.FILL,e=null){return J.intersect(this.clipBox,this.getPathBoundingBox(t,e))}}function Ua(a,t){if(t instanceof ImageData){a.putImageData(t,0,0);return}const e=t.height,i=t.width,n=e%$e,s=(e-n)/$e,r=n===0?s:s+1,o=a.createImageData(i,$e);let l=0,h;const c=t.data,u=o.data;let p,b,w,v;if(t.kind===Ws.GRAYSCALE_1BPP){const x=c.byteLength,E=new Uint32Array(u.buffer,0,u.byteLength>>2),D=E.length,T=i+7>>3,k=4294967295,F=fe.isLittleEndian?4278190080:255;for(p=0;p<r;p++){for(w=p<s?$e:n,h=0,b=0;b<w;b++){const M=x-l;let O=0;const N=M>T?i:M*8-7,R=N&-8;let $=0,U=0;for(;O<R;O+=8)U=c[l++],E[h++]=U&128?k:F,E[h++]=U&64?k:F,E[h++]=U&32?k:F,E[h++]=U&16?k:F,E[h++]=U&8?k:F,E[h++]=U&4?k:F,E[h++]=U&2?k:F,E[h++]=U&1?k:F;for(;O<N;O++)$===0&&(U=c[l++],$=128),E[h++]=U&$?k:F,$>>=1}for(;h<D;)E[h++]=0;a.putImageData(o,0,p*$e)}}else if(t.kind===Ws.RGBA_32BPP){for(b=0,v=i*$e*4,p=0;p<s;p++)u.set(c.subarray(l,l+v)),l+=v,a.putImageData(o,0,b),b+=$e;p<r&&(v=i*n*4,u.set(c.subarray(l,l+v)),a.putImageData(o,0,b))}else if(t.kind===Ws.RGB_24BPP)for(w=$e,v=i*w,p=0;p<r;p++){for(p>=s&&(w=n,v=i*w),h=0,b=v;b--;)u[h++]=c[l++],u[h++]=c[l++],u[h++]=c[l++],u[h++]=255;a.putImageData(o,0,p*$e)}else throw new Error(`bad image kind: ${t.kind}`)}function $a(a,t){if(t.bitmap){a.drawImage(t.bitmap,0,0);return}const e=t.height,i=t.width,n=e%$e,s=(e-n)/$e,r=n===0?s:s+1,o=a.createImageData(i,$e);let l=0;const h=t.data,c=o.data;for(let u=0;u<r;u++){const p=u<s?$e:n;({srcPos:l}=Pd({src:h,srcPos:l,dest:c,width:i,height:p,nonBlackColor:0})),a.putImageData(o,0,u*$e)}}function zn(a,t){const e=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"];for(const i of e)a[i]!==void 0&&(t[i]=a[i]);a.setLineDash!==void 0&&(t.setLineDash(a.getLineDash()),t.lineDashOffset=a.lineDashOffset)}function Os(a){a.strokeStyle=a.fillStyle="#000000",a.fillRule="nonzero",a.globalAlpha=1,a.lineWidth=1,a.lineCap="butt",a.lineJoin="miter",a.miterLimit=10,a.globalCompositeOperation="source-over",a.font="10px sans-serif",a.setLineDash!==void 0&&(a.setLineDash([]),a.lineDashOffset=0);const{filter:t}=a;t!=="none"&&t!==""&&(a.filter="none")}function Ha(a,t){if(t)return!0;J.singularValueDecompose2dScale(a,Ye);const e=Math.fround(xi.pixelRatio*Ln.PDF_TO_CSS_UNITS);return Ye[0]<=e&&Ye[1]<=e}const Fd=["butt","round","square"],Md=["miter","round","bevel"],Id={},ja={};class Fn{constructor(t,e,i,n,s,{optionalContentConfig:r,markedContentStack:o=null},l,h,c){this.ctx=t,this.current=new Ba(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=e,this.objs=i,this.canvasFactory=n,this.filterFactory=s,this.groupStack=[],this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=o||[],this.optionalContentConfig=r,this.cachedCanvases=new kd(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=l,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.pageColors=h,this._cachedScaleForStroking=[-1,0],this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map,this.dependencyTracker=c??null}getObject(t,e,i=null){return typeof e=="string"?(this.dependencyTracker?.recordNamedDependency(t,e),e.startsWith("g_")?this.commonObjs.get(e):this.objs.get(e)):i}beginDrawing({transform:t,viewport:e,transparency:i=!1,background:n=null}){const s=this.ctx.canvas.width,r=this.ctx.canvas.height,o=this.ctx.fillStyle;if(this.ctx.fillStyle=n||"#ffffff",this.ctx.fillRect(0,0,s,r),this.ctx.fillStyle=o,i){const l=this.cachedCanvases.getCanvas("transparent",s,r);this.compositeCtx=this.ctx,this.transparentCanvas=l.canvas,this.ctx=l.context,this.ctx.save(),this.ctx.transform(...Vt(this.compositeCtx))}this.ctx.save(),Os(this.ctx),t&&(this.ctx.transform(...t),this.outputScaleX=t[0],this.outputScaleY=t[0]),this.ctx.transform(...e.transform),this.viewportScale=e.scale,this.baseTransform=Vt(this.ctx)}executeOperatorList(t,e,i,n,s){const r=t.argsArray,o=t.fnArray;let l=e||0;const h=r.length;if(h===l)return l;const c=h-l>Na&&typeof i=="function",u=c?Date.now()+Td:0;let p=0;const b=this.commonObjs,w=this.objs;let v,x;for(;;){if(n!==void 0&&l===n.nextBreakPoint)return n.breakIt(l,i),l;if(!s||s(l))if(v=o[l],x=r[l]??null,v!==hs.dependency)x===null?this[v](l):this[v](l,...x);else for(const E of x){this.dependencyTracker?.recordNamedData(E,l);const D=E.startsWith("g_")?b:w;if(!D.has(E))return D.get(E,i),l}if(l++,l===h)return l;if(c&&++p>Na){if(Date.now()>u)return i(),l;p=0}}}#t(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.current.activeSMask=null,this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)}endDrawing(){this.#t(),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(const t of this._cachedBitmapsMap.values()){for(const e of t.values())typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement&&(e.width=e.height=0);t.clear()}this._cachedBitmapsMap.clear(),this.#e()}#e(){if(this.pageColors){const t=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if(t!=="none"){const e=this.ctx.filter;this.ctx.filter=t,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=e}}}_scaleImage(t,e){const i=t.width??t.displayWidth,n=t.height??t.displayHeight;let s=Math.max(Math.hypot(e[0],e[1]),1),r=Math.max(Math.hypot(e[2],e[3]),1),o=i,l=n,h="prescale1",c,u;for(;s>2&&o>1||r>2&&l>1;){let p=o,b=l;s>2&&o>1&&(p=o>=16384?Math.floor(o/2)-1||1:Math.ceil(o/2),s/=o/p),r>2&&l>1&&(b=l>=16384?Math.floor(l/2)-1||1:Math.ceil(l)/2,r/=l/b),c=this.cachedCanvases.getCanvas(h,p,b),u=c.context,u.clearRect(0,0,p,b),u.drawImage(t,0,0,o,l,0,0,p,b),t=c.canvas,o=p,l=b,h=h==="prescale1"?"prescale2":"prescale1"}return{img:t,paintWidth:o,paintHeight:l}}_createMaskCanvas(t,e){const i=this.ctx,{width:n,height:s}=e,r=this.current.fillColor,o=this.current.patternFill,l=Vt(i);let h,c,u,p;if((e.bitmap||e.data)&&e.count>1){const $=e.bitmap||e.data.buffer;c=JSON.stringify(o?l:[l.slice(0,4),r]),h=this._cachedBitmapsMap.get($),h||(h=new Map,this._cachedBitmapsMap.set($,h));const U=h.get(c);if(U&&!o){const Q=Math.round(Math.min(l[0],l[2])+l[4]),V=Math.round(Math.min(l[1],l[3])+l[5]);return this.dependencyTracker?.recordDependencies(t,ti.transformAndFill),{canvas:U,offsetX:Q,offsetY:V}}u=U}u||(p=this.cachedCanvases.getCanvas("maskCanvas",n,s),$a(p.context,e));let b=J.transform(l,[1/n,0,0,-1/s,0,0]);b=J.transform(b,[1,0,0,1,0,-s]);const w=xn.slice();J.axialAlignedBoundingBox([0,0,n,s],b,w);const[v,x,E,D]=w,T=Math.round(E-v)||1,k=Math.round(D-x)||1,F=this.cachedCanvases.getCanvas("fillCanvas",T,k),M=F.context,O=v,N=x;M.translate(-O,-N),M.transform(...b),u||(u=this._scaleImage(p.canvas,gi(M)),u=u.img,h&&o&&h.set(c,u)),M.imageSmoothingEnabled=Ha(Vt(M),e.interpolate),Rs(M,u,0,0,u.width,u.height,0,0,n,s),M.globalCompositeOperation="source-in";const R=J.transform(gi(M),[1,0,0,1,-O,-N]);return M.fillStyle=o?r.getPattern(i,this,R,Ee.FILL,t):r,M.fillRect(0,0,n,s),h&&!o&&(this.cachedCanvases.delete("fillCanvas"),h.set(c,F.canvas)),this.dependencyTracker?.recordDependencies(t,ti.transformAndFill),{canvas:F.canvas,offsetX:Math.round(O),offsetY:Math.round(N)}}setLineWidth(t,e){this.dependencyTracker?.recordSimpleData("lineWidth",t),e!==this.current.lineWidth&&(this._cachedScaleForStroking[0]=-1),this.current.lineWidth=e,this.ctx.lineWidth=e}setLineCap(t,e){this.dependencyTracker?.recordSimpleData("lineCap",t),this.ctx.lineCap=Fd[e]}setLineJoin(t,e){this.dependencyTracker?.recordSimpleData("lineJoin",t),this.ctx.lineJoin=Md[e]}setMiterLimit(t,e){this.dependencyTracker?.recordSimpleData("miterLimit",t),this.ctx.miterLimit=e}setDash(t,e,i){this.dependencyTracker?.recordSimpleData("dash",t);const n=this.ctx;n.setLineDash!==void 0&&(n.setLineDash(e),n.lineDashOffset=i)}setRenderingIntent(t,e){}setFlatness(t,e){}setGState(t,e){for(const[i,n]of e)switch(i){case"LW":this.setLineWidth(t,n);break;case"LC":this.setLineCap(t,n);break;case"LJ":this.setLineJoin(t,n);break;case"ML":this.setMiterLimit(t,n);break;case"D":this.setDash(t,n[0],n[1]);break;case"RI":this.setRenderingIntent(t,n);break;case"FL":this.setFlatness(t,n);break;case"Font":this.setFont(t,n[0],n[1]);break;case"CA":this.dependencyTracker?.recordSimpleData("strokeAlpha",t),this.current.strokeAlpha=n;break;case"ca":this.dependencyTracker?.recordSimpleData("fillAlpha",t),this.ctx.globalAlpha=this.current.fillAlpha=n;break;case"BM":this.dependencyTracker?.recordSimpleData("globalCompositeOperation",t),this.ctx.globalCompositeOperation=n;break;case"SMask":this.dependencyTracker?.recordSimpleData("SMask",t),this.current.activeSMask=n?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.dependencyTracker?.recordSimpleData("filter",t),this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(n);break}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){const t=this.inSMaskMode;this.current.activeSMask&&!t?this.beginSMaskMode():!this.current.activeSMask&&t&&this.endSMaskMode()}beginSMaskMode(t){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");const e=this.ctx.canvas.width,i=this.ctx.canvas.height,n="smaskGroupAt"+this.groupLevel,s=this.cachedCanvases.getCanvas(n,e,i);this.suspendedCtx=this.ctx;const r=this.ctx=s.context;r.setTransform(this.suspendedCtx.getTransform()),zn(this.suspendedCtx,r),Dd(r,this.suspendedCtx),this.setGState(t,[["BM","source-over"]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),zn(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(t){if(!this.current.activeSMask)return;t?(t[0]=Math.floor(t[0]),t[1]=Math.floor(t[1]),t[2]=Math.ceil(t[2]),t[3]=Math.ceil(t[3])):t=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];const e=this.current.activeSMask,i=this.suspendedCtx;this.composeSMask(i,e,this.ctx,t),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}composeSMask(t,e,i,n){const s=n[0],r=n[1],o=n[2]-s,l=n[3]-r;o===0||l===0||(this.genericComposeSMask(e.context,i,o,l,e.subtype,e.backdrop,e.transferMap,s,r,e.offsetX,e.offsetY),t.save(),t.globalAlpha=1,t.globalCompositeOperation="source-over",t.setTransform(1,0,0,1,0,0),t.drawImage(i.canvas,0,0),t.restore())}genericComposeSMask(t,e,i,n,s,r,o,l,h,c,u){let p=t.canvas,b=l-c,w=h-u;if(r)if(b<0||w<0||b+i>p.width||w+n>p.height){const x=this.cachedCanvases.getCanvas("maskExtension",i,n),E=x.context;E.drawImage(p,-b,-w),E.globalCompositeOperation="destination-atop",E.fillStyle=r,E.fillRect(0,0,i,n),E.globalCompositeOperation="source-over",p=x.canvas,b=w=0}else{t.save(),t.globalAlpha=1,t.setTransform(1,0,0,1,0,0);const x=new Path2D;x.rect(b,w,i,n),t.clip(x),t.globalCompositeOperation="destination-atop",t.fillStyle=r,t.fillRect(b,w,i,n),t.restore()}e.save(),e.globalAlpha=1,e.setTransform(1,0,0,1,0,0),s==="Alpha"&&o?e.filter=this.filterFactory.addAlphaFilter(o):s==="Luminosity"&&(e.filter=this.filterFactory.addLuminosityFilter(o));const v=new Path2D;v.rect(l,h,i,n),e.clip(v),e.globalCompositeOperation="destination-in",e.drawImage(p,b,w,i,n,l,h,i,n),e.restore()}save(t){this.inSMaskMode&&zn(this.ctx,this.suspendedCtx),this.ctx.save();const e=this.current;this.stateStack.push(e),this.current=e.clone(),this.dependencyTracker?.save(t)}restore(t){if(this.dependencyTracker?.restore(t),this.stateStack.length===0){this.inSMaskMode&&this.endSMaskMode();return}this.current=this.stateStack.pop(),this.ctx.restore(),this.inSMaskMode&&zn(this.suspendedCtx,this.ctx),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}transform(t,e,i,n,s,r,o){this.dependencyTracker?.recordIncrementalData("transform",t),this.ctx.transform(e,i,n,s,r,o),this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}constructPath(t,e,i,n){let[s]=i;if(!n){s||=i[0]=new Path2D,this[e](t,s);return}if(this.dependencyTracker!==null){const r=e===hs.stroke?this.current.lineWidth/2:0;this.dependencyTracker.resetBBox(t).recordBBox(t,this.ctx,n[0]-r,n[2]+r,n[1]-r,n[3]+r).recordDependencies(t,["transform"])}s instanceof Path2D||(s=i[0]=Ol(s)),J.axialAlignedBoundingBox(n,Vt(this.ctx),this.current.minMax),this[e](t,s),this._pathStartIdx=t}closePath(t){this.ctx.closePath()}stroke(t,e,i=!0){const n=this.ctx,s=this.current.strokeColor;if(n.globalAlpha=this.current.strokeAlpha,this.contentVisible)if(typeof s=="object"&&s?.getPattern){const r=s.isModifyingCurrentTransform()?n.getTransform():null;if(n.save(),n.strokeStyle=s.getPattern(n,this,gi(n),Ee.STROKE,t),r){const o=new Path2D;o.addPath(e,n.getTransform().invertSelf().multiplySelf(r)),e=o}this.rescaleAndStroke(e,!1),n.restore()}else this.rescaleAndStroke(e,!0);this.dependencyTracker?.recordDependencies(t,ti.stroke),i&&this.consumePath(t,e,this.current.getClippedPathBoundingBox(Ee.STROKE,Vt(this.ctx))),n.globalAlpha=this.current.fillAlpha}closeStroke(t,e){this.stroke(t,e)}fill(t,e,i=!0){const n=this.ctx,s=this.current.fillColor,r=this.current.patternFill;let o=!1;if(r){const h=s.isModifyingCurrentTransform()?n.getTransform():null;if(this.dependencyTracker?.save(t),n.save(),n.fillStyle=s.getPattern(n,this,gi(n),Ee.FILL,t),h){const c=new Path2D;c.addPath(e,n.getTransform().invertSelf().multiplySelf(h)),e=c}o=!0}const l=this.current.getClippedPathBoundingBox();this.contentVisible&&l!==null&&(this.pendingEOFill?(n.fill(e,"evenodd"),this.pendingEOFill=!1):n.fill(e)),this.dependencyTracker?.recordDependencies(t,ti.fill),o&&(n.restore(),this.dependencyTracker?.restore(t)),i&&this.consumePath(t,e,l)}eoFill(t,e){this.pendingEOFill=!0,this.fill(t,e)}fillStroke(t,e){this.fill(t,e,!1),this.stroke(t,e,!1),this.consumePath(t,e)}eoFillStroke(t,e){this.pendingEOFill=!0,this.fillStroke(t,e)}closeFillStroke(t,e){this.fillStroke(t,e)}closeEOFillStroke(t,e){this.pendingEOFill=!0,this.fillStroke(t,e)}endPath(t,e){this.consumePath(t,e)}rawFillPath(t,e){this.ctx.fill(e),this.dependencyTracker?.recordDependencies(t,ti.rawFillPath).recordOperation(t)}clip(t){this.dependencyTracker?.recordFutureForcedDependency("clipMode",t),this.pendingClip=Id}eoClip(t){this.dependencyTracker?.recordFutureForcedDependency("clipMode",t),this.pendingClip=ja}beginText(t){this.current.textMatrix=null,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0,this.dependencyTracker?.recordOpenMarker(t).resetIncrementalData("sameLineText").resetIncrementalData("moveText",t)}endText(t){const e=this.pendingTextPaths,i=this.ctx;if(this.dependencyTracker){const{dependencyTracker:n}=this;e!==void 0&&n.recordFutureForcedDependency("textClip",n.getOpenMarker()).recordFutureForcedDependency("textClip",t),n.recordCloseMarker(t)}if(e!==void 0){const n=new Path2D,s=i.getTransform().invertSelf();for(const{transform:r,x:o,y:l,fontSize:h,path:c}of e)c&&n.addPath(c,new DOMMatrix(r).preMultiplySelf(s).translate(o,l).scale(h,-h));i.clip(n)}delete this.pendingTextPaths}setCharSpacing(t,e){this.dependencyTracker?.recordSimpleData("charSpacing",t),this.current.charSpacing=e}setWordSpacing(t,e){this.dependencyTracker?.recordSimpleData("wordSpacing",t),this.current.wordSpacing=e}setHScale(t,e){this.dependencyTracker?.recordSimpleData("hScale",t),this.current.textHScale=e/100}setLeading(t,e){this.dependencyTracker?.recordSimpleData("leading",t),this.current.leading=-e}setFont(t,e,i){this.dependencyTracker?.recordSimpleData("font",t).recordSimpleDataFromNamed("fontObj",e,t);const n=this.commonObjs.get(e),s=this.current;if(!n)throw new Error(`Can't find font for ${e}`);if(s.fontMatrix=n.fontMatrix||ao,(s.fontMatrix[0]===0||s.fontMatrix[3]===0)&&ft("Invalid font matrix for font "+e),i<0?(i=-i,s.fontDirection=-1):s.fontDirection=1,this.current.font=n,this.current.fontSize=i,n.isType3Font)return;const r=n.loadedName||"sans-serif",o=n.systemFontInfo?.css||`"${r}", ${n.fallbackName}`;let l="normal";n.black?l="900":n.bold&&(l="bold");const h=n.italic?"italic":"normal";let c=i;i<Ra?c=Ra:i>Oa&&(c=Oa),this.current.fontSizeScale=i/c,this.ctx.font=`${h} ${l} ${c}px ${o}`}setTextRenderingMode(t,e){this.dependencyTracker?.recordSimpleData("textRenderingMode",t),this.current.textRenderingMode=e}setTextRise(t,e){this.dependencyTracker?.recordSimpleData("textRise",t),this.current.textRise=e}moveText(t,e,i){this.dependencyTracker?.resetIncrementalData("sameLineText").recordIncrementalData("moveText",t),this.current.x=this.current.lineX+=e,this.current.y=this.current.lineY+=i}setLeadingMoveText(t,e,i){this.setLeading(t,-i),this.moveText(t,e,i)}setTextMatrix(t,e){this.dependencyTracker?.resetIncrementalData("sameLineText").recordSimpleData("textMatrix",t);const{current:i}=this;i.textMatrix=e,i.textMatrixScale=Math.hypot(e[0],e[1]),i.x=i.lineX=0,i.y=i.lineY=0}nextLine(t){this.moveText(t,0,this.current.leading),this.dependencyTracker?.recordIncrementalData("moveText",this.dependencyTracker.getSimpleIndex("leading")??t)}#n(t,e,i){const n=new Path2D;return n.addPath(t,new DOMMatrix(i).invertSelf().multiplySelf(e)),n}paintChar(t,e,i,n,s,r){const o=this.ctx,l=this.current,h=l.font,c=l.textRenderingMode,u=l.fontSize/l.fontSizeScale,p=c&ue.FILL_STROKE_MASK,b=!!(c&ue.ADD_TO_PATH_FLAG),w=l.patternFill&&!h.missingFile,v=l.patternStroke&&!h.missingFile;let x;if((h.disableFontFace||b||w||v)&&!h.missingFile&&(x=h.getPathGenerator(this.commonObjs,e)),x&&(h.disableFontFace||w||v)){o.save(),o.translate(i,n),o.scale(u,-u),this.dependencyTracker?.recordCharacterBBox(t,o,h);let E;if(p===ue.FILL||p===ue.FILL_STROKE)if(s){E=o.getTransform(),o.setTransform(...s);const D=this.#n(x,E,s);o.fill(D)}else o.fill(x);if(p===ue.STROKE||p===ue.FILL_STROKE)if(r){E||=o.getTransform(),o.setTransform(...r);const{a:D,b:T,c:k,d:F}=E,M=J.inverseTransform(r),O=J.transform([D,T,k,F,0,0],M);J.singularValueDecompose2dScale(O,Ye),o.lineWidth*=Math.max(Ye[0],Ye[1])/u,o.stroke(this.#n(x,E,r))}else o.lineWidth/=u,o.stroke(x);o.restore()}else(p===ue.FILL||p===ue.FILL_STROKE)&&(o.fillText(e,i,n),this.dependencyTracker?.recordCharacterBBox(t,o,h,u,i,n,()=>o.measureText(e))),(p===ue.STROKE||p===ue.FILL_STROKE)&&(this.dependencyTracker&&this.dependencyTracker?.recordCharacterBBox(t,o,h,u,i,n,()=>o.measureText(e)).recordDependencies(t,ti.stroke),o.strokeText(e,i,n));b&&((this.pendingTextPaths||=[]).push({transform:Vt(o),x:i,y:n,fontSize:u,path:x}),this.dependencyTracker?.recordCharacterBBox(t,o,h,u,i,n))}get isFontSubpixelAAEnabled(){const{context:t}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);t.scale(1.5,1),t.fillText("I",0,10);const e=t.getImageData(0,0,10,10).data;let i=!1;for(let n=3;n<e.length;n+=4)if(e[n]>0&&e[n]<255){i=!0;break}return pt(this,"isFontSubpixelAAEnabled",i)}showText(t,e){this.dependencyTracker&&(this.dependencyTracker.recordDependencies(t,ti.showText).resetBBox(t),this.current.textRenderingMode&ue.ADD_TO_PATH_FLAG&&this.dependencyTracker.recordFutureForcedDependency("textClip",t).inheritPendingDependenciesAsFutureForcedDependencies());const i=this.current,n=i.font;if(n.isType3Font){this.showType3Text(t,e),this.dependencyTracker?.recordShowTextOperation(t);return}const s=i.fontSize;if(s===0){this.dependencyTracker?.recordOperation(t);return}const r=this.ctx,o=i.fontSizeScale,l=i.charSpacing,h=i.wordSpacing,c=i.fontDirection,u=i.textHScale*c,p=e.length,b=n.vertical,w=b?1:-1,v=n.defaultVMetrics,x=s*i.fontMatrix[0],E=i.textRenderingMode===ue.FILL&&!n.disableFontFace&&!i.patternFill;r.save(),i.textMatrix&&r.transform(...i.textMatrix),r.translate(i.x,i.y+i.textRise),c>0?r.scale(u,-1):r.scale(u,1);let D,T;const k=i.textRenderingMode&ue.FILL_STROKE_MASK,F=k===ue.FILL||k===ue.FILL_STROKE,M=k===ue.STROKE||k===ue.FILL_STROKE;if(F&&i.patternFill){r.save();const U=i.fillColor.getPattern(r,this,gi(r),Ee.FILL,t);D=Vt(r),r.restore(),r.fillStyle=U}if(M&&i.patternStroke){r.save();const U=i.strokeColor.getPattern(r,this,gi(r),Ee.STROKE,t);T=Vt(r),r.restore(),r.strokeStyle=U}let O=i.lineWidth;const N=i.textMatrixScale;if(N===0||O===0?M&&(O=this.getSinglePixelWidth()):O/=N,o!==1&&(r.scale(o,o),O/=o),r.lineWidth=O,n.isInvalidPDFjsFont){const U=[];let Q=0;for(const z of e)U.push(z.unicode),Q+=z.width;const V=U.join("");if(r.fillText(V,0,0),this.dependencyTracker!==null){const z=r.measureText(V);this.dependencyTracker.recordBBox(t,this.ctx,-z.actualBoundingBoxLeft,z.actualBoundingBoxRight,-z.actualBoundingBoxAscent,z.actualBoundingBoxDescent).recordShowTextOperation(t)}i.x+=Q*x*u,r.restore(),this.compose();return}let R=0,$;for($=0;$<p;++$){const U=e[$];if(typeof U=="number"){R+=w*U*s/1e3;continue}let Q=!1;const V=(U.isSpace?h:0)+l,z=U.fontChar,st=U.accent;let G,W,Z=U.width;if(b){const it=U.vmetric||v,ot=-(U.vmetric?it[1]:Z*.5)*x,mt=it[2]*x;Z=it?-it[0]:Z,G=ot/o,W=(R+mt)/o}else G=R/o,W=0;let xt;if(n.remeasure&&Z>0){xt=r.measureText(z);const it=xt.width*1e3/s*o;if(Z<it&&this.isFontSubpixelAAEnabled){const ot=Z/it;Q=!0,r.save(),r.scale(ot,1),G/=ot}else Z!==it&&(G+=(Z-it)/2e3*s/o)}if(this.contentVisible&&(U.isInFont||n.missingFile)){if(E&&!st)r.fillText(z,G,W),this.dependencyTracker?.recordCharacterBBox(t,r,xt?{bbox:null}:n,s/o,G,W,()=>xt??r.measureText(z));else if(this.paintChar(t,z,G,W,D,T),st){const it=G+s*st.offset.x/o,ot=W-s*st.offset.y/o;this.paintChar(t,st.fontChar,it,ot,D,T)}}const Ft=b?Z*x-V*c:Z*x+V*c;R+=Ft,Q&&r.restore()}b?i.y-=R:i.x+=R*u,r.restore(),this.compose(),this.dependencyTracker?.recordShowTextOperation(t)}showType3Text(t,e){const i=this.ctx,n=this.current,s=n.font,r=n.fontSize,o=n.fontDirection,l=s.vertical?1:-1,h=n.charSpacing,c=n.wordSpacing,u=n.textHScale*o,p=n.fontMatrix||ao,b=e.length,w=n.textRenderingMode===ue.INVISIBLE;let v,x,E,D;if(w||r===0)return;this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null,i.save(),n.textMatrix&&i.transform(...n.textMatrix),i.translate(n.x,n.y+n.textRise),i.scale(u,o);const T=this.dependencyTracker;for(this.dependencyTracker=T?new er(T,t):null,v=0;v<b;++v){if(x=e[v],typeof x=="number"){D=l*x*r/1e3,this.ctx.translate(D,0),n.x+=D*u;continue}const k=(x.isSpace?c:0)+h,F=s.charProcOperatorList[x.operatorListId];F?this.contentVisible&&(this.save(),i.scale(r,r),i.transform(...p),this.executeOperatorList(F),this.restore()):ft(`Type3 character "${x.operatorListId}" is not available.`);const M=[x.width,0];J.applyTransform(M,p),E=M[0]*r+k,i.translate(E,0),n.x+=E*u}i.restore(),T&&(this.dependencyTracker=T)}setCharWidth(t,e,i){}setCharWidthAndBounds(t,e,i,n,s,r,o){const l=new Path2D;l.rect(n,s,r-n,o-s),this.ctx.clip(l),this.dependencyTracker?.recordBBox(t,this.ctx,n,r,s,o).recordClipBox(t,this.ctx,n,r,s,o),this.endPath(t)}getColorN_Pattern(t,e){let i;if(e[0]==="TilingPattern"){const n=this.baseTransform||Vt(this.ctx),s={createCanvasGraphics:(r,o)=>new Fn(r,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack},void 0,void 0,this.dependencyTracker?new er(this.dependencyTracker,o,!0):null)};i=new Bo(e,this.ctx,s,n)}else i=this._getPattern(t,e[1],e[2]);return i}setStrokeColorN(t,...e){this.dependencyTracker?.recordSimpleData("strokeColor",t),this.current.strokeColor=this.getColorN_Pattern(t,e),this.current.patternStroke=!0}setFillColorN(t,...e){this.dependencyTracker?.recordSimpleData("fillColor",t),this.current.fillColor=this.getColorN_Pattern(t,e),this.current.patternFill=!0}setStrokeRGBColor(t,e){this.dependencyTracker?.recordSimpleData("strokeColor",t),this.ctx.strokeStyle=this.current.strokeColor=e,this.current.patternStroke=!1}setStrokeTransparent(t){this.dependencyTracker?.recordSimpleData("strokeColor",t),this.ctx.strokeStyle=this.current.strokeColor="transparent",this.current.patternStroke=!1}setFillRGBColor(t,e){this.dependencyTracker?.recordSimpleData("fillColor",t),this.ctx.fillStyle=this.current.fillColor=e,this.current.patternFill=!1}setFillTransparent(t){this.dependencyTracker?.recordSimpleData("fillColor",t),this.ctx.fillStyle=this.current.fillColor="transparent",this.current.patternFill=!1}_getPattern(t,e,i=null){let n;return this.cachedPatterns.has(e)?n=this.cachedPatterns.get(e):(n=_d(this.getObject(t,e)),this.cachedPatterns.set(e,n)),i&&(n.matrix=i),n}shadingFill(t,e){if(!this.contentVisible)return;const i=this.ctx;this.save(t);const n=this._getPattern(t,e);i.fillStyle=n.getPattern(i,this,gi(i),Ee.SHADING,t);const s=gi(i);if(s){const{width:r,height:o}=i.canvas,l=xn.slice();J.axialAlignedBoundingBox([0,0,r,o],s,l);const[h,c,u,p]=l;this.ctx.fillRect(h,c,u-h,p-c)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.dependencyTracker?.resetBBox(t).recordFullPageBBox(t).recordDependencies(t,ti.transform).recordDependencies(t,ti.fill).recordOperation(t),this.compose(this.current.getClippedPathBoundingBox()),this.restore(t)}beginInlineImage(){Rt("Should not call beginInlineImage")}beginImageData(){Rt("Should not call beginImageData")}paintFormXObjectBegin(t,e,i){if(this.contentVisible&&(this.save(t),this.baseTransformStack.push(this.baseTransform),e&&this.transform(t,...e),this.baseTransform=Vt(this.ctx),i)){J.axialAlignedBoundingBox(i,this.baseTransform,this.current.minMax);const[n,s,r,o]=i,l=new Path2D;l.rect(n,s,r-n,o-s),this.ctx.clip(l),this.dependencyTracker?.recordClipBox(t,this.ctx,n,r,s,o),this.endPath(t)}}paintFormXObjectEnd(t){this.contentVisible&&(this.restore(t),this.baseTransform=this.baseTransformStack.pop())}beginGroup(t,e){if(!this.contentVisible)return;this.save(t),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);const i=this.ctx;e.isolated||mr("TODO: Support non-isolated groups."),e.knockout&&ft("Knockout groups not supported.");const n=Vt(i);if(e.matrix&&i.transform(...e.matrix),!e.bbox)throw new Error("Bounding box is required.");let s=xn.slice();J.axialAlignedBoundingBox(e.bbox,Vt(i),s);const r=[0,0,i.canvas.width,i.canvas.height];s=J.intersect(s,r)||[0,0,0,0];const o=Math.floor(s[0]),l=Math.floor(s[1]),h=Math.max(Math.ceil(s[2])-o,1),c=Math.max(Math.ceil(s[3])-l,1);this.current.startNewPathAndClipBox([0,0,h,c]);let u="groupAt"+this.groupLevel;e.smask&&(u+="_smask_"+this.smaskCounter++%2);const p=this.cachedCanvases.getCanvas(u,h,c),b=p.context;b.translate(-o,-l),b.transform(...n);let w=new Path2D;const[v,x,E,D]=e.bbox;if(w.rect(v,x,E-v,D-x),e.matrix){const T=new Path2D;T.addPath(w,new DOMMatrix(e.matrix)),w=T}b.clip(w),e.smask&&this.smaskStack.push({canvas:p.canvas,context:b,offsetX:o,offsetY:l,subtype:e.smask.subtype,backdrop:e.smask.backdrop,transferMap:e.smask.transferMap||null,startTransformInverse:null}),(!e.smask||this.dependencyTracker)&&(i.setTransform(1,0,0,1,0,0),i.translate(o,l),i.save()),zn(i,b),this.ctx=b,this.dependencyTracker?.inheritSimpleDataAsFutureForcedDependencies(["fillAlpha","strokeAlpha","globalCompositeOperation"]).pushBaseTransform(i),this.setGState(t,[["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(i),this.groupLevel++}endGroup(t,e){if(!this.contentVisible)return;this.groupLevel--;const i=this.ctx,n=this.groupStack.pop();if(this.ctx=n,this.ctx.imageSmoothingEnabled=!1,this.dependencyTracker?.popBaseTransform(),e.smask)this.tempSMask=this.smaskStack.pop(),this.restore(t),this.dependencyTracker&&this.ctx.restore();else{this.ctx.restore();const s=Vt(this.ctx);this.restore(t),this.ctx.save(),this.ctx.setTransform(...s);const r=xn.slice();J.axialAlignedBoundingBox([0,0,i.canvas.width,i.canvas.height],s,r),this.ctx.drawImage(i.canvas,0,0),this.ctx.restore(),this.compose(r)}}beginAnnotation(t,e,i,n,s,r){if(this.#t(),Os(this.ctx),this.ctx.save(),this.save(t),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),i){const o=i[2]-i[0],l=i[3]-i[1];if(r&&this.annotationCanvasMap){n=n.slice(),n[4]-=i[0],n[5]-=i[1],i=i.slice(),i[0]=i[1]=0,i[2]=o,i[3]=l,J.singularValueDecompose2dScale(Vt(this.ctx),Ye);const{viewportScale:h}=this,c=Math.ceil(o*this.outputScaleX*h),u=Math.ceil(l*this.outputScaleY*h);this.annotationCanvas=this.canvasFactory.create(c,u);const{canvas:p,context:b}=this.annotationCanvas;this.annotationCanvasMap.set(e,p),this.annotationCanvas.savedCtx=this.ctx,this.ctx=b,this.ctx.save(),this.ctx.setTransform(Ye[0],0,0,-Ye[1],0,l*Ye[1]),Os(this.ctx)}else{Os(this.ctx),this.endPath(t);const h=new Path2D;h.rect(i[0],i[1],o,l),this.ctx.clip(h)}}this.current=new Ba(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(t,...n),this.transform(t,...s)}endAnnotation(t){this.annotationCanvas&&(this.ctx.restore(),this.#e(),this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(t,e){if(!this.contentVisible)return;const i=e.count;e=this.getObject(t,e.data,e),e.count=i;const n=this.ctx,s=this._createMaskCanvas(t,e),r=s.canvas;n.save(),n.setTransform(1,0,0,1,0,0),n.drawImage(r,s.offsetX,s.offsetY),this.dependencyTracker?.resetBBox(t).recordBBox(t,this.ctx,s.offsetX,s.offsetX+r.width,s.offsetY,s.offsetY+r.height).recordOperation(t),n.restore(),this.compose()}paintImageMaskXObjectRepeat(t,e,i,n=0,s=0,r,o){if(!this.contentVisible)return;e=this.getObject(t,e.data,e);const l=this.ctx;l.save();const h=Vt(l);l.transform(i,n,s,r,0,0);const c=this._createMaskCanvas(t,e);l.setTransform(1,0,0,1,c.offsetX-h[4],c.offsetY-h[5]),this.dependencyTracker?.resetBBox(t);for(let u=0,p=o.length;u<p;u+=2){const b=J.transform(h,[i,n,s,r,o[u],o[u+1]]);l.drawImage(c.canvas,b[4],b[5]),this.dependencyTracker?.recordBBox(t,this.ctx,b[4],b[4]+c.canvas.width,b[5],b[5]+c.canvas.height)}l.restore(),this.compose(),this.dependencyTracker?.recordOperation(t)}paintImageMaskXObjectGroup(t,e){if(!this.contentVisible)return;const i=this.ctx,n=this.current.fillColor,s=this.current.patternFill;this.dependencyTracker?.resetBBox(t).recordDependencies(t,ti.transformAndFill);for(const r of e){const{data:o,width:l,height:h,transform:c}=r,u=this.cachedCanvases.getCanvas("maskCanvas",l,h),p=u.context;p.save();const b=this.getObject(t,o,r);$a(p,b),p.globalCompositeOperation="source-in",p.fillStyle=s?n.getPattern(p,this,gi(i),Ee.FILL,t):n,p.fillRect(0,0,l,h),p.restore(),i.save(),i.transform(...c),i.scale(1,-1),Rs(i,u.canvas,0,0,l,h,0,-1,1,1),this.dependencyTracker?.recordBBox(t,i,0,l,0,h),i.restore()}this.compose(),this.dependencyTracker?.recordOperation(t)}paintImageXObject(t,e){if(!this.contentVisible)return;const i=this.getObject(t,e);if(!i){ft("Dependent image isn't ready yet");return}this.paintInlineImageXObject(t,i)}paintImageXObjectRepeat(t,e,i,n,s){if(!this.contentVisible)return;const r=this.getObject(t,e);if(!r){ft("Dependent image isn't ready yet");return}const o=r.width,l=r.height,h=[];for(let c=0,u=s.length;c<u;c+=2)h.push({transform:[i,0,0,n,s[c],s[c+1]],x:0,y:0,w:o,h:l});this.paintInlineImageXObjectGroup(t,r,h)}applyTransferMapsToCanvas(t){return this.current.transferMaps!=="none"&&(t.filter=this.current.transferMaps,t.drawImage(t.canvas,0,0),t.filter="none"),t.canvas}applyTransferMapsToBitmap(t){if(this.current.transferMaps==="none")return t.bitmap;const{bitmap:e,width:i,height:n}=t,s=this.cachedCanvases.getCanvas("inlineImage",i,n),r=s.context;return r.filter=this.current.transferMaps,r.drawImage(e,0,0),r.filter="none",s.canvas}paintInlineImageXObject(t,e){if(!this.contentVisible)return;const i=e.width,n=e.height,s=this.ctx;this.save(t);const{filter:r}=s;r!=="none"&&r!==""&&(s.filter="none"),s.scale(1/i,-1/n);let o;if(e.bitmap)o=this.applyTransferMapsToBitmap(e);else if(typeof HTMLElement=="function"&&e instanceof HTMLElement||!e.data)o=e;else{const c=this.cachedCanvases.getCanvas("inlineImage",i,n).context;Ua(c,e),o=this.applyTransferMapsToCanvas(c)}const l=this._scaleImage(o,gi(s));s.imageSmoothingEnabled=Ha(Vt(s),e.interpolate),this.dependencyTracker?.resetBBox(t).recordBBox(t,s,0,i,-n,0).recordDependencies(t,ti.imageXObject).recordOperation(t),Rs(s,l.img,0,0,l.paintWidth,l.paintHeight,0,-n,i,n),this.compose(),this.restore(t)}paintInlineImageXObjectGroup(t,e,i){if(!this.contentVisible)return;const n=this.ctx;let s;if(e.bitmap)s=e.bitmap;else{const r=e.width,o=e.height,h=this.cachedCanvases.getCanvas("inlineImage",r,o).context;Ua(h,e),s=this.applyTransferMapsToCanvas(h)}this.dependencyTracker?.resetBBox(t);for(const r of i)n.save(),n.transform(...r.transform),n.scale(1,-1),Rs(n,s,r.x,r.y,r.w,r.h,0,-1,1,1),this.dependencyTracker?.recordBBox(t,n,0,1,-1,0),n.restore();this.dependencyTracker?.recordOperation(t),this.compose()}paintSolidColorImageMask(t){this.contentVisible&&(this.dependencyTracker?.resetBBox(t).recordBBox(t,this.ctx,0,1,0,1).recordDependencies(t,ti.fill).recordOperation(t),this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(t,e){}markPointProps(t,e,i){}beginMarkedContent(t,e){this.dependencyTracker?.beginMarkedContent(t),this.markedContentStack.push({visible:!0})}beginMarkedContentProps(t,e,i){this.dependencyTracker?.beginMarkedContent(t),e==="OC"?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(i)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(t){this.dependencyTracker?.endMarkedContent(t),this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(t){}endCompat(t){}consumePath(t,e,i){const n=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(i);const s=this.ctx;this.pendingClip?(n||(this.pendingClip===ja?s.clip(e,"evenodd"):s.clip(e)),this.pendingClip=null,this.dependencyTracker?.bboxToClipBoxDropOperation(t).recordFutureForcedDependency("clipPath",t)):this.dependencyTracker?.recordOperation(t),this.current.startNewPathAndClipBox(this.current.clipBox)}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){const t=Vt(this.ctx);if(t[1]===0&&t[2]===0)this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(t[0]),Math.abs(t[3]));else{const e=Math.abs(t[0]*t[3]-t[2]*t[1]),i=Math.hypot(t[0],t[2]),n=Math.hypot(t[1],t[3]);this._cachedGetSinglePixelWidth=Math.max(i,n)/e}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(this._cachedScaleForStroking[0]===-1){const{lineWidth:t}=this.current,{a:e,b:i,c:n,d:s}=this.ctx.getTransform();let r,o;if(i===0&&n===0){const l=Math.abs(e),h=Math.abs(s);if(l===h)if(t===0)r=o=1/l;else{const c=l*t;r=o=c<1?1/c:1}else if(t===0)r=1/l,o=1/h;else{const c=l*t,u=h*t;r=c<1?1/c:1,o=u<1?1/u:1}}else{const l=Math.abs(e*s-i*n),h=Math.hypot(e,i),c=Math.hypot(n,s);if(t===0)r=c/l,o=h/l;else{const u=t*l;r=c>u?c/u:1,o=h>u?h/u:1}}this._cachedScaleForStroking[0]=r,this._cachedScaleForStroking[1]=o}return this._cachedScaleForStroking}rescaleAndStroke(t,e){const{ctx:i,current:{lineWidth:n}}=this,[s,r]=this.getScaleForStroking();if(s===r){i.lineWidth=(n||1)*s,i.stroke(t);return}const o=i.getLineDash();e&&i.save(),i.scale(s,r),Hr.a=1/s,Hr.d=1/r;const l=new Path2D;if(l.addPath(t,Hr),o.length>0){const h=Math.max(s,r);i.setLineDash(o.map(c=>c/h)),i.lineDashOffset/=h}i.lineWidth=n||1,i.stroke(l),e&&i.restore()}isContentVisible(){for(let t=this.markedContentStack.length-1;t>=0;t--)if(!this.markedContentStack[t].visible)return!1;return!0}}for(const a in hs)Fn.prototype[a]!==void 0&&(Fn.prototype[hs[a]]=Fn.prototype[a]);class Gi{static#t=null;static#e="";static get workerPort(){return this.#t}static set workerPort(t){if(!(typeof Worker<"u"&&t instanceof Worker)&&t!==null)throw new Error("Invalid `workerPort` type.");this.#t=t}static get workerSrc(){return this.#e}static set workerSrc(t){if(typeof t!="string")throw new Error("Invalid `workerSrc` type.");this.#e=t}}class Ld{#t;#e;constructor({parsedData:t,rawData:e}){this.#t=t,this.#e=e}getRaw(){return this.#e}get(t){return this.#t.get(t)??null}[Symbol.iterator](){return this.#t.entries()}}const vn=Symbol("INTERNAL");class Rd{#t=!1;#e=!1;#n=!1;#i=!0;constructor(t,{name:e,intent:i,usage:n,rbGroups:s}){this.#t=!!(t&qe.DISPLAY),this.#e=!!(t&qe.PRINT),this.name=e,this.intent=i,this.usage=n,this.rbGroups=s}get visible(){if(this.#n)return this.#i;if(!this.#i)return!1;const{print:t,view:e}=this.usage;return this.#t?e?.viewState!=="OFF":this.#e?t?.printState!=="OFF":!0}_setVisible(t,e,i=!1){t!==vn&&Rt("Internal method `_setVisible` called."),this.#n=i,this.#i=e}}class Od{#t=null;#e=new Map;#n=null;#i=null;constructor(t,e=qe.DISPLAY){if(this.renderingIntent=e,this.name=null,this.creator=null,t!==null){this.name=t.name,this.creator=t.creator,this.#i=t.order;for(const i of t.groups)this.#e.set(i.id,new Rd(e,i));if(t.baseState==="OFF")for(const i of this.#e.values())i._setVisible(vn,!1);for(const i of t.on)this.#e.get(i)._setVisible(vn,!0);for(const i of t.off)this.#e.get(i)._setVisible(vn,!1);this.#n=this.getHash()}}#o(t){const e=t.length;if(e<2)return!0;const i=t[0];for(let n=1;n<e;n++){const s=t[n];let r;if(Array.isArray(s))r=this.#o(s);else if(this.#e.has(s))r=this.#e.get(s).visible;else return ft(`Optional content group not found: ${s}`),!0;switch(i){case"And":if(!r)return!1;break;case"Or":if(r)return!0;break;case"Not":return!r;default:return!0}}return i==="And"}isVisible(t){if(this.#e.size===0)return!0;if(!t)return mr("Optional content group not defined."),!0;if(t.type==="OCG")return this.#e.has(t.id)?this.#e.get(t.id).visible:(ft(`Optional content group not found: ${t.id}`),!0);if(t.type==="OCMD"){if(t.expression)return this.#o(t.expression);if(!t.policy||t.policy==="AnyOn"){for(const e of t.ids){if(!this.#e.has(e))return ft(`Optional content group not found: ${e}`),!0;if(this.#e.get(e).visible)return!0}return!1}else if(t.policy==="AllOn"){for(const e of t.ids){if(!this.#e.has(e))return ft(`Optional content group not found: ${e}`),!0;if(!this.#e.get(e).visible)return!1}return!0}else if(t.policy==="AnyOff"){for(const e of t.ids){if(!this.#e.has(e))return ft(`Optional content group not found: ${e}`),!0;if(!this.#e.get(e).visible)return!0}return!1}else if(t.policy==="AllOff"){for(const e of t.ids){if(!this.#e.has(e))return ft(`Optional content group not found: ${e}`),!0;if(this.#e.get(e).visible)return!1}return!0}return ft(`Unknown optional content policy ${t.policy}.`),!0}return ft(`Unknown group type ${t.type}.`),!0}setVisibility(t,e=!0,i=!0){const n=this.#e.get(t);if(!n){ft(`Optional content group not found: ${t}`);return}if(i&&e&&n.rbGroups.length)for(const s of n.rbGroups)for(const r of s)r!==t&&this.#e.get(r)?._setVisible(vn,!1,!0);n._setVisible(vn,!!e,!0),this.#t=null}setOCGState({state:t,preserveRB:e}){let i;for(const n of t){switch(n){case"ON":case"OFF":case"Toggle":i=n;continue}const s=this.#e.get(n);if(s)switch(i){case"ON":this.setVisibility(n,!0,e);break;case"OFF":this.setVisibility(n,!1,e);break;case"Toggle":this.setVisibility(n,!s.visible,e);break}}this.#t=null}get hasInitialVisibility(){return this.#n===null||this.getHash()===this.#n}getOrder(){return this.#e.size?this.#i?this.#i.slice():[...this.#e.keys()]:null}getGroup(t){return this.#e.get(t)||null}getHash(){if(this.#t!==null)return this.#t;const t=new Bl;for(const[e,i]of this.#e)t.update(`${e}:${i.visible}`);return this.#t=t.hexdigest()}[Symbol.iterator](){return this.#e.entries()}}class Nd{constructor(t,{disableRange:e=!1,disableStream:i=!1}){St(t,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.');const{length:n,initialData:s,progressiveDone:r,contentDispositionFilename:o}=t;if(this._queuedChunks=[],this._progressiveDone=r,this._contentDispositionFilename=o,s?.length>0){const l=s instanceof Uint8Array&&s.byteLength===s.buffer.byteLength?s.buffer:new Uint8Array(s).buffer;this._queuedChunks.push(l)}this._pdfDataRangeTransport=t,this._isStreamingSupported=!i,this._isRangeSupported=!e,this._contentLength=n,this._fullRequestReader=null,this._rangeReaders=[],t.addRangeListener((l,h)=>{this._onReceiveData({begin:l,chunk:h})}),t.addProgressListener((l,h)=>{this._onProgress({loaded:l,total:h})}),t.addProgressiveReadListener(l=>{this._onReceiveData({chunk:l})}),t.addProgressiveDoneListener(()=>{this._onProgressiveDone()}),t.transportReady()}_onReceiveData({begin:t,chunk:e}){const i=e instanceof Uint8Array&&e.byteLength===e.buffer.byteLength?e.buffer:new Uint8Array(e).buffer;if(t===void 0)this._fullRequestReader?this._fullRequestReader._enqueue(i):this._queuedChunks.push(i);else{const n=this._rangeReaders.some(function(s){return s._begin!==t?!1:(s._enqueue(i),!0)});St(n,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}_onProgress(t){t.total===void 0?this._rangeReaders[0]?.onProgress?.({loaded:t.loaded}):this._fullRequestReader?.onProgress?.({loaded:t.loaded,total:t.total})}_onProgressiveDone(){this._fullRequestReader?.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(t){const e=this._rangeReaders.indexOf(t);e>=0&&this._rangeReaders.splice(e,1)}getFullReader(){St(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");const t=this._queuedChunks;return this._queuedChunks=null,new Bd(this,t,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(t,e){if(e<=this._progressiveDataLength)return null;const i=new Ud(this,t,e);return this._pdfDataRangeTransport.requestDataRange(t,e),this._rangeReaders.push(i),i}cancelAllRequests(t){this._fullRequestReader?.cancel(t);for(const e of this._rangeReaders.slice(0))e.cancel(t);this._pdfDataRangeTransport.abort()}}class Bd{constructor(t,e,i=!1,n=null){this._stream=t,this._done=i||!1,this._filename=Mo(n)?n:null,this._queuedChunks=e||[],this._loaded=0;for(const s of this._queuedChunks)this._loaded+=s.byteLength;this._requests=[],this._headersReady=Promise.resolve(),t._fullRequestReader=this,this.onProgress=null}_enqueue(t){this._done||(this._requests.length>0?this._requests.shift().resolve({value:t,done:!1}):this._queuedChunks.push(t),this._loaded+=t.byteLength)}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}async read(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const t=Promise.withResolvers();return this._requests.push(t),t.promise}cancel(t){this._done=!0;for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}}class Ud{constructor(t,e,i){this._stream=t,this._begin=e,this._end=i,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(t){if(!this._done){if(this._requests.length===0)this._queuedChunk=t;else{this._requests.shift().resolve({value:t,done:!1});for(const i of this._requests)i.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}async read(){if(this._queuedChunk){const e=this._queuedChunk;return this._queuedChunk=null,{value:e,done:!1}}if(this._done)return{value:void 0,done:!0};const t=Promise.withResolvers();return this._requests.push(t),t.promise}cancel(t){this._done=!0;for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}}function $d(a){let t=!0,e=i("filename\\*","i").exec(a);if(e){e=e[1];let c=o(e);return c=unescape(c),c=l(c),c=h(c),s(c)}if(e=r(a),e){const c=h(e);return s(c)}if(e=i("filename","i").exec(a),e){e=e[1];let c=o(e);return c=h(c),s(c)}function i(c,u){return new RegExp("(?:^|;)\\s*"+c+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',u)}function n(c,u){if(c){if(!/^[\x00-\xFF]+$/.test(u))return u;try{const p=new TextDecoder(c,{fatal:!0}),b=ms(u);u=p.decode(b),t=!1}catch{}}return u}function s(c){return t&&/[\x80-\xff]/.test(c)&&(c=n("utf-8",c),t&&(c=n("iso-8859-1",c))),c}function r(c){const u=[];let p;const b=i("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;(p=b.exec(c))!==null;){let[,v,x,E]=p;if(v=parseInt(v,10),v in u){if(v===0)break;continue}u[v]=[x,E]}const w=[];for(let v=0;v<u.length&&v in u;++v){let[x,E]=u[v];E=o(E),x&&(E=unescape(E),v===0&&(E=l(E))),w.push(E)}return w.join("")}function o(c){if(c.startsWith('"')){const u=c.slice(1).split('\\"');for(let p=0;p<u.length;++p){const b=u[p].indexOf('"');b!==-1&&(u[p]=u[p].slice(0,b),u.length=p+1),u[p]=u[p].replaceAll(/\\(.)/g,"$1")}c=u.join('"')}return c}function l(c){const u=c.indexOf("'");if(u===-1)return c;const p=c.slice(0,u),w=c.slice(u+1).replace(/^[^']*'/,"");return n(p,w)}function h(c){return!c.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(c)?c:c.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(u,p,b,w){if(b==="q"||b==="Q")return w=w.replaceAll("_"," "),w=w.replaceAll(/=([0-9a-fA-F]{2})/g,function(v,x){return String.fromCharCode(parseInt(x,16))}),n(p,w);try{w=atob(w)}catch{}return n(p,w)})}return""}function Vl(a,t){const e=new Headers;if(!a||!t||typeof t!="object")return e;for(const i in t){const n=t[i];n!==void 0&&e.append(i,n)}return e}function wr(a){return URL.parse(a)?.origin??null}function Wl({responseHeaders:a,isHttp:t,rangeChunkSize:e,disableRange:i}){const n={allowRangeRequests:!1,suggestedLength:void 0},s=parseInt(a.get("Content-Length"),10);return!Number.isInteger(s)||(n.suggestedLength=s,s<=2*e)||i||!t||a.get("Accept-Ranges")!=="bytes"||(a.get("Content-Encoding")||"identity")!=="identity"||(n.allowRangeRequests=!0),n}function ql(a){const t=a.get("Content-Disposition");if(t){let e=$d(t);if(e.includes("%"))try{e=decodeURIComponent(e)}catch{}if(Mo(e))return e}return null}function As(a,t){return new tr(`Unexpected server response (${a}) while retrieving PDF "${t}".`,a,a===404||a===0&&t.startsWith("file:"))}function Xl(a){return a===200||a===206}function Yl(a,t,e){return{method:"GET",headers:a,signal:e.signal,mode:"cors",credentials:t?"include":"same-origin",redirect:"follow"}}function Kl(a){return a instanceof Uint8Array?a.buffer:a instanceof ArrayBuffer?a:(ft(`getArrayBuffer - unexpected data format: ${a}`),new Uint8Array(a).buffer)}class Hd{_responseOrigin=null;constructor(t){this.source=t,this.isHttp=/^https?:/i.test(t.url),this.headers=Vl(this.isHttp,t.httpHeaders),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return St(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new jd(this),this._fullRequestReader}getRangeReader(t,e){if(e<=this._progressiveDataLength)return null;const i=new zd(this,t,e);return this._rangeRequestReaders.push(i),i}cancelAllRequests(t){this._fullRequestReader?.cancel(t);for(const e of this._rangeRequestReaders.slice(0))e.cancel(t)}}class jd{constructor(t){this._stream=t,this._reader=null,this._loaded=0,this._filename=null;const e=t.source;this._withCredentials=e.withCredentials||!1,this._contentLength=e.length,this._headersCapability=Promise.withResolvers(),this._disableRange=e.disableRange||!1,this._rangeChunkSize=e.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!e.disableStream,this._isRangeSupported=!e.disableRange;const i=new Headers(t.headers),n=e.url;fetch(n,Yl(i,this._withCredentials,this._abortController)).then(s=>{if(t._responseOrigin=wr(s.url),!Xl(s.status))throw As(s.status,n);this._reader=s.body.getReader(),this._headersCapability.resolve();const r=s.headers,{allowRangeRequests:o,suggestedLength:l}=Wl({responseHeaders:r,isHttp:t.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=o,this._contentLength=l||this._contentLength,this._filename=ql(r),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new Vi("Streaming is disabled."))}).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._headersCapability.promise;const{value:t,done:e}=await this._reader.read();return e?{value:t,done:e}:(this._loaded+=t.byteLength,this.onProgress?.({loaded:this._loaded,total:this._contentLength}),{value:Kl(t),done:!1})}cancel(t){this._reader?.cancel(t),this._abortController.abort()}}class zd{constructor(t,e,i){this._stream=t,this._reader=null,this._loaded=0;const n=t.source;this._withCredentials=n.withCredentials||!1,this._readCapability=Promise.withResolvers(),this._isStreamingSupported=!n.disableStream,this._abortController=new AbortController;const s=new Headers(t.headers);s.append("Range",`bytes=${e}-${i-1}`);const r=n.url;fetch(r,Yl(s,this._withCredentials,this._abortController)).then(o=>{const l=wr(o.url);if(l!==t._responseOrigin)throw new Error(`Expected range response-origin "${l}" to match "${t._responseOrigin}".`);if(!Xl(o.status))throw As(o.status,r);this._readCapability.resolve(),this._reader=o.body.getReader()}).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._readCapability.promise;const{value:t,done:e}=await this._reader.read();return e?{value:t,done:e}:(this._loaded+=t.byteLength,this.onProgress?.({loaded:this._loaded}),{value:Kl(t),done:!1})}cancel(t){this._reader?.cancel(t),this._abortController.abort()}}const jr=200,zr=206;function Gd(a){const t=a.response;return typeof t!="string"?t:ms(t).buffer}class Vd{_responseOrigin=null;constructor({url:t,httpHeaders:e,withCredentials:i}){this.url=t,this.isHttp=/^https?:/i.test(t),this.headers=Vl(this.isHttp,e),this.withCredentials=i||!1,this.currXhrId=0,this.pendingRequests=Object.create(null)}request(t){const e=new XMLHttpRequest,i=this.currXhrId++,n=this.pendingRequests[i]={xhr:e};e.open("GET",this.url),e.withCredentials=this.withCredentials;for(const[s,r]of this.headers)e.setRequestHeader(s,r);return this.isHttp&&"begin"in t&&"end"in t?(e.setRequestHeader("Range",`bytes=${t.begin}-${t.end-1}`),n.expectedStatus=zr):n.expectedStatus=jr,e.responseType="arraybuffer",St(t.onError,"Expected `onError` callback to be provided."),e.onerror=()=>{t.onError(e.status)},e.onreadystatechange=this.onStateChange.bind(this,i),e.onprogress=this.onProgress.bind(this,i),n.onHeadersReceived=t.onHeadersReceived,n.onDone=t.onDone,n.onError=t.onError,n.onProgress=t.onProgress,e.send(null),i}onProgress(t,e){const i=this.pendingRequests[t];i&&i.onProgress?.(e)}onStateChange(t,e){const i=this.pendingRequests[t];if(!i)return;const n=i.xhr;if(n.readyState>=2&&i.onHeadersReceived&&(i.onHeadersReceived(),delete i.onHeadersReceived),n.readyState!==4||!(t in this.pendingRequests))return;if(delete this.pendingRequests[t],n.status===0&&this.isHttp){i.onError(n.status);return}const s=n.status||jr;if(!(s===jr&&i.expectedStatus===zr)&&s!==i.expectedStatus){i.onError(n.status);return}const o=Gd(n);if(s===zr){const l=n.getResponseHeader("Content-Range"),h=/bytes (\d+)-(\d+)\/(\d+)/.exec(l);h?i.onDone({begin:parseInt(h[1],10),chunk:o}):(ft('Missing or invalid "Content-Range" header.'),i.onError(0))}else o?i.onDone({begin:0,chunk:o}):i.onError(n.status)}getRequestXhr(t){return this.pendingRequests[t].xhr}isPendingRequest(t){return t in this.pendingRequests}abortRequest(t){const e=this.pendingRequests[t].xhr;delete this.pendingRequests[t],e.abort()}}class Wd{constructor(t){this._source=t,this._manager=new Vd(t),this._rangeChunkSize=t.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(t){const e=this._rangeRequestReaders.indexOf(t);e>=0&&this._rangeRequestReaders.splice(e,1)}getFullReader(){return St(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new qd(this._manager,this._source),this._fullRequestReader}getRangeReader(t,e){const i=new Xd(this._manager,t,e);return i.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(i),i}cancelAllRequests(t){this._fullRequestReader?.cancel(t);for(const e of this._rangeRequestReaders.slice(0))e.cancel(t)}}class qd{constructor(t,e){this._manager=t,this._url=e.url,this._fullRequestId=t.request({onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._headersCapability=Promise.withResolvers(),this._disableRange=e.disableRange||!1,this._contentLength=e.length,this._rangeChunkSize=e.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){const t=this._fullRequestId,e=this._manager.getRequestXhr(t);this._manager._responseOrigin=wr(e.responseURL);const i=e.getAllResponseHeaders(),n=new Headers(i?i.trimStart().replace(/[^\S ]+$/,"").split(/[\r\n]+/).map(o=>{const[l,...h]=o.split(": ");return[l,h.join(": ")]}):[]),{allowRangeRequests:s,suggestedLength:r}=Wl({responseHeaders:n,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});s&&(this._isRangeSupported=!0),this._contentLength=r||this._contentLength,this._filename=ql(n),this._isRangeSupported&&this._manager.abortRequest(t),this._headersCapability.resolve()}_onDone(t){if(t&&(this._requests.length>0?this._requests.shift().resolve({value:t.chunk,done:!1}):this._cachedChunks.push(t.chunk)),this._done=!0,!(this._cachedChunks.length>0)){for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(t){this._storedError=As(t,this._url),this._headersCapability.reject(this._storedError);for(const e of this._requests)e.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(t){this.onProgress?.({loaded:t.loaded,total:t.lengthComputable?t.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersCapability.promise}async read(){if(await this._headersCapability.promise,this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const t=Promise.withResolvers();return this._requests.push(t),t.promise}cancel(t){this._done=!0,this._headersCapability.reject(t);for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}}class Xd{constructor(t,e,i){this._manager=t,this._url=t.url,this._requestId=t.request({begin:e,end:i,onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_onHeadersReceived(){const t=wr(this._manager.getRequestXhr(this._requestId)?.responseURL);t!==this._manager._responseOrigin&&(this._storedError=new Error(`Expected range response-origin "${t}" to match "${this._manager._responseOrigin}".`),this._onError(0))}_close(){this.onClosed?.(this)}_onDone(t){const e=t.chunk;this._requests.length>0?this._requests.shift().resolve({value:e,done:!1}):this._queuedChunk=e,this._done=!0;for(const i of this._requests)i.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(t){this._storedError??=As(t,this._url);for(const e of this._requests)e.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(t){this.isStreamingSupported||this.onProgress?.({loaded:t.loaded})}get isStreamingSupported(){return!1}async read(){if(this._storedError)throw this._storedError;if(this._queuedChunk!==null){const e=this._queuedChunk;return this._queuedChunk=null,{value:e,done:!1}}if(this._done)return{value:void 0,done:!0};const t=Promise.withResolvers();return this._requests.push(t),t.promise}cancel(t){this._done=!0;for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}}const Yd=/^[a-z][a-z0-9\-+.]+:/i;function Kd(a){if(Yd.test(a))return new URL(a);const t=Qt.getBuiltinModule("url");return new URL(t.pathToFileURL(a))}class Jd{constructor(t){this.source=t,this.url=Kd(t.url),St(this.url.protocol==="file:","PDFNodeStream only supports file:// URLs."),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return St(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=new Qd(this),this._fullRequestReader}getRangeReader(t,e){if(e<=this._progressiveDataLength)return null;const i=new Zd(this,t,e);return this._rangeRequestReaders.push(i),i}cancelAllRequests(t){this._fullRequestReader?.cancel(t);for(const e of this._rangeRequestReaders.slice(0))e.cancel(t)}}class Qd{constructor(t){this._url=t.url,this._done=!1,this._storedError=null,this.onProgress=null;const e=t.source;this._contentLength=e.length,this._loaded=0,this._filename=null,this._disableRange=e.disableRange||!1,this._rangeChunkSize=e.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!e.disableStream,this._isRangeSupported=!e.disableRange,this._readableStream=null,this._readCapability=Promise.withResolvers(),this._headersCapability=Promise.withResolvers();const i=Qt.getBuiltinModule("fs");i.promises.lstat(this._url).then(n=>{this._contentLength=n.size,this._setReadableStream(i.createReadStream(this._url)),this._headersCapability.resolve()},n=>{n.code==="ENOENT"&&(n=As(0,this._url.href)),this._storedError=n,this._headersCapability.reject(n)})}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const t=this._readableStream.read();return t===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=t.length,this.onProgress?.({loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(t).buffer,done:!1})}cancel(t){if(!this._readableStream){this._error(t);return}this._readableStream.destroy(t)}_error(t){this._storedError=t,this._readCapability.resolve()}_setReadableStream(t){this._readableStream=t,t.on("readable",()=>{this._readCapability.resolve()}),t.on("end",()=>{t.destroy(),this._done=!0,this._readCapability.resolve()}),t.on("error",e=>{this._error(e)}),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new Vi("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}}class Zd{constructor(t,e,i){this._url=t.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=Promise.withResolvers();const n=t.source;this._isStreamingSupported=!n.disableStream;const s=Qt.getBuiltinModule("fs");this._setReadableStream(s.createReadStream(this._url,{start:e,end:i-1}))}get isStreamingSupported(){return this._isStreamingSupported}async read(){if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const t=this._readableStream.read();return t===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=t.length,this.onProgress?.({loaded:this._loaded}),{value:new Uint8Array(t).buffer,done:!1})}cancel(t){if(!this._readableStream){this._error(t);return}this._readableStream.destroy(t)}_error(t){this._storedError=t,this._readCapability.resolve()}_setReadableStream(t){this._readableStream=t,t.on("readable",()=>{this._readCapability.resolve()}),t.on("end",()=>{t.destroy(),this._done=!0,this._readCapability.resolve()}),t.on("error",e=>{this._error(e)}),this._storedError&&this._readableStream.destroy(this._storedError)}}const Gn=Symbol("INITIAL_DATA");class Jl{#t=Object.create(null);#e(t){return this.#t[t]||={...Promise.withResolvers(),data:Gn}}get(t,e=null){if(e){const n=this.#e(t);return n.promise.then(()=>e(n.data)),null}const i=this.#t[t];if(!i||i.data===Gn)throw new Error(`Requesting object that isn't resolved yet ${t}.`);return i.data}has(t){const e=this.#t[t];return!!e&&e.data!==Gn}delete(t){const e=this.#t[t];return!e||e.data===Gn?!1:(delete this.#t[t],!0)}resolve(t,e=null){const i=this.#e(t);i.data=e,i.resolve()}clear(){for(const t in this.#t){const{data:e}=this.#t[t];e?.bitmap?.close()}this.#t=Object.create(null)}*[Symbol.iterator](){for(const t in this.#t){const{data:e}=this.#t[t];e!==Gn&&(yield[t,e])}}}const tu=1e5,za=30;class Xe{#t=Promise.withResolvers();#e=null;#n=!1;#i=!!globalThis.FontInspector?.enabled;#o=null;#r=null;#s=0;#a=0;#h=null;#l=null;#u=0;#d=0;#f=Object.create(null);#m=[];#g=null;#c=[];#p=new WeakMap;#b=null;static#w=new Map;static#y=new Map;static#C=new WeakMap;static#S=null;static#A=new Set;constructor({textContentSource:t,container:e,viewport:i}){if(t instanceof ReadableStream)this.#g=t;else if(typeof t=="object")this.#g=new ReadableStream({start(l){l.enqueue(t),l.close()}});else throw new Error('No "textContentSource" parameter specified.');this.#e=this.#l=e,this.#d=i.scale*xi.pixelRatio,this.#u=i.rotation,this.#r={div:null,properties:null,ctx:null};const{pageWidth:n,pageHeight:s,pageX:r,pageY:o}=i.rawDims;this.#b=[1,0,0,-1,-r,o+s],this.#a=n,this.#s=s,Xe.#D(),e.style.setProperty("--min-font-size",Xe.#S),on(e,i),this.#t.promise.finally(()=>{Xe.#A.delete(this),this.#r=null,this.#f=null}).catch(()=>{})}static get fontFamilyMap(){const{isWindows:t,isFirefox:e}=fe.platform;return pt(this,"fontFamilyMap",new Map([["sans-serif",`${t&&e?"Calibri, ":""}sans-serif`],["monospace",`${t&&e?"Lucida Console, ":""}monospace`]]))}render(){const t=()=>{this.#h.read().then(({value:e,done:i})=>{if(i){this.#t.resolve();return}this.#o??=e.lang,Object.assign(this.#f,e.styles),this.#P(e.items),t()},this.#t.reject)};return this.#h=this.#g.getReader(),Xe.#A.add(this),t(),this.#t.promise}update({viewport:t,onBefore:e=null}){const i=t.scale*xi.pixelRatio,n=t.rotation;if(n!==this.#u&&(e?.(),this.#u=n,on(this.#l,{rotation:n})),i!==this.#d){e?.(),this.#d=i;const s={div:null,properties:null,ctx:Xe.#k(this.#o)};for(const r of this.#c)s.properties=this.#p.get(r),s.div=r,this.#x(s)}}cancel(){const t=new Vi("TextLayer task cancelled.");this.#h?.cancel(t).catch(()=>{}),this.#h=null,this.#t.reject(t)}get textDivs(){return this.#c}get textContentItemsStr(){return this.#m}#P(t){if(this.#n)return;this.#r.ctx??=Xe.#k(this.#o);const e=this.#c,i=this.#m;for(const n of t){if(e.length>tu){ft("Ignoring additional textDivs for performance reasons."),this.#n=!0;return}if(n.str===void 0){if(n.type==="beginMarkedContentProps"||n.type==="beginMarkedContent"){const s=this.#e;this.#e=document.createElement("span"),this.#e.classList.add("markedContent"),n.id&&this.#e.setAttribute("id",`${n.id}`),s.append(this.#e)}else n.type==="endMarkedContent"&&(this.#e=this.#e.parentNode);continue}i.push(n.str),this.#v(n)}}#v(t){const e=document.createElement("span"),i={angle:0,canvasWidth:0,hasText:t.str!=="",hasEOL:t.hasEOL,fontSize:0};this.#c.push(e);const n=J.transform(this.#b,t.transform);let s=Math.atan2(n[1],n[0]);const r=this.#f[t.fontName];r.vertical&&(s+=Math.PI/2);let o=this.#i&&r.fontSubstitution||r.fontFamily;o=Xe.fontFamilyMap.get(o)||o;const l=Math.hypot(n[2],n[3]),h=l*Xe.#N(o,r,this.#o);let c,u;s===0?(c=n[4],u=n[5]-h):(c=n[4]+h*Math.sin(s),u=n[5]-h*Math.cos(s));const p=e.style;p.left=`${(100*c/this.#a).toFixed(2)}%`,p.top=`${(100*u/this.#s).toFixed(2)}%`,p.setProperty("--font-height",`${l.toFixed(2)}px`),p.fontFamily=o,i.fontSize=l,e.setAttribute("role","presentation"),e.textContent=t.str,e.dir=t.dir,this.#i&&(e.dataset.fontName=r.fontSubstitutionLoadedName||t.fontName),s!==0&&(i.angle=s*(180/Math.PI));let b=!1;if(t.str.length>1)b=!0;else if(t.str!==" "&&t.transform[0]!==t.transform[3]){const w=Math.abs(t.transform[0]),v=Math.abs(t.transform[3]);w!==v&&Math.max(w,v)/Math.min(w,v)>1.5&&(b=!0)}if(b&&(i.canvasWidth=r.vertical?t.height:t.width),this.#p.set(e,i),this.#r.div=e,this.#r.properties=i,this.#x(this.#r),i.hasText&&this.#e.append(e),i.hasEOL){const w=document.createElement("br");w.setAttribute("role","presentation"),this.#e.append(w)}}#x(t){const{div:e,properties:i,ctx:n}=t,{style:s}=e;if(i.canvasWidth!==0&&i.hasText){const{fontFamily:r}=s,{canvasWidth:o,fontSize:l}=i;Xe.#T(n,l*this.#d,r);const{width:h}=n.measureText(e.textContent);h>0&&s.setProperty("--scale-x",o*this.#d/h)}i.angle!==0&&s.setProperty("--rotate",`${i.angle}deg`)}static cleanup(){if(!(this.#A.size>0)){this.#w.clear();for(const{canvas:t}of this.#y.values())t.remove();this.#y.clear()}}static#k(t=null){let e=this.#y.get(t||="");if(!e){const i=document.createElement("canvas");i.className="hiddenCanvasElement",i.lang=t,document.body.append(i),e=i.getContext("2d",{alpha:!1,willReadFrequently:!0}),this.#y.set(t,e),this.#C.set(e,{size:0,family:""})}return e}static#T(t,e,i){const n=this.#C.get(t);e===n.size&&i===n.family||(t.font=`${e}px ${i}`,n.size=e,n.family=i)}static#D(){if(this.#S!==null)return;const t=document.createElement("div");t.style.opacity=0,t.style.lineHeight=1,t.style.fontSize="1px",t.style.position="absolute",t.textContent="X",document.body.append(t),this.#S=t.getBoundingClientRect().height,t.remove()}static#N(t,e,i){const n=this.#w.get(t);if(n)return n;const s=this.#k(i);s.canvas.width=s.canvas.height=za,this.#T(s,za,t);const r=s.measureText(""),o=r.fontBoundingBoxAscent,l=Math.abs(r.fontBoundingBoxDescent);s.canvas.width=s.canvas.height=0;let h=.8;return o?h=o/(o+l):(fe.platform.isFirefox&&ft("Enable the `dom.textMetrics.fontBoundingBox.enabled` preference in `about:config` to improve TextLayer rendering."),e.ascent?h=e.ascent:e.descent&&(h=1+e.descent)),this.#w.set(t,h),h}}const eu=100;function Ql(a={}){typeof a=="string"||a instanceof URL?a={url:a}:(a instanceof ArrayBuffer||ArrayBuffer.isView(a))&&(a={data:a});const t=new Uo,{docId:e}=t,i=a.url?ld(a.url):null,n=a.data?hd(a.data):null,s=a.httpHeaders||null,r=a.withCredentials===!0,o=a.password??null,l=a.range instanceof Zl?a.range:null,h=Number.isInteger(a.rangeChunkSize)&&a.rangeChunkSize>0?a.rangeChunkSize:2**16;let c=a.worker instanceof ds?a.worker:null;const u=a.verbosity,p=typeof a.docBaseUrl=="string"&&!br(a.docBaseUrl)?a.docBaseUrl:null,b=Fs(a.cMapUrl),w=a.cMapPacked!==!1,v=a.CMapReaderFactory||(Me?bd:Da),x=Fs(a.iccUrl),E=Fs(a.standardFontDataUrl),D=a.StandardFontDataFactory||(Me?yd:ka),T=Fs(a.wasmUrl),k=a.WasmFactory||(Me?wd:Fa),F=a.stopAtErrors!==!0,M=Number.isInteger(a.maxImageSize)&&a.maxImageSize>-1?a.maxImageSize:-1,O=a.isEvalSupported!==!1,N=typeof a.isOffscreenCanvasSupported=="boolean"?a.isOffscreenCanvasSupported:!Me,R=typeof a.isImageDecoderSupported=="boolean"?a.isImageDecoderSupported:!Me&&(fe.platform.isFirefox||!globalThis.chrome),$=Number.isInteger(a.canvasMaxAreaInBytes)?a.canvasMaxAreaInBytes:-1,U=typeof a.disableFontFace=="boolean"?a.disableFontFace:Me,Q=a.fontExtraProperties===!0,V=a.enableXfa===!0,z=a.ownerDocument||globalThis.document,st=a.disableRange===!0,G=a.disableStream===!0,W=a.disableAutoFetch===!0,Z=a.pdfBug===!0,xt=a.CanvasFactory||(Me?md:fd),Ft=a.FilterFactory||(Me?gd:pd),it=a.enableHWA===!0,ot=a.useWasm!==!1,mt=l?l.length:a.length??NaN,dt=typeof a.useSystemFonts=="boolean"?a.useSystemFonts:!Me&&!U,Ct=typeof a.useWorkerFetch=="boolean"?a.useWorkerFetch:!!(v===Da&&D===ka&&k===Fa&&b&&E&&T&&Xn(b,document.baseURI)&&Xn(E,document.baseURI)&&Xn(T,document.baseURI)),yt=null;Rc(u);const Pt={canvasFactory:new xt({ownerDocument:z,enableHWA:it}),filterFactory:new Ft({docId:e,ownerDocument:z}),cMapReaderFactory:Ct?null:new v({baseUrl:b,isCompressed:w}),standardFontDataFactory:Ct?null:new D({baseUrl:E}),wasmFactory:Ct?null:new k({baseUrl:T})};c||(c=ds.create({verbosity:u,port:Gi.workerPort}),t._worker=c);const _t={docId:e,apiVersion:"5.4.530",data:n,password:o,disableAutoFetch:W,rangeChunkSize:h,length:mt,docBaseUrl:p,enableXfa:V,evaluatorOptions:{maxImageSize:M,disableFontFace:U,ignoreErrors:F,isEvalSupported:O,isOffscreenCanvasSupported:N,isImageDecoderSupported:R,canvasMaxAreaInBytes:$,fontExtraProperties:Q,useSystemFonts:dt,useWasm:ot,useWorkerFetch:Ct,cMapUrl:b,iccUrl:x,standardFontDataUrl:E,wasmUrl:T}},se={ownerDocument:z,pdfBug:Z,styleElement:yt,loadingParams:{disableAutoFetch:W,enableXfa:V}};return c.promise.then(function(){if(t.destroyed)throw new Error("Loading aborted");if(c.destroyed)throw new Error("Worker was destroyed");const je=c.messageHandler.sendWithPromise("GetDocRequest",_t,n?[n.buffer]:null);let Se;if(l)Se=new Nd(l,{disableRange:st,disableStream:G});else if(!n){if(!i)throw new Error("getDocument - no `url` parameter provided.");const ze=Xn(i)?Hd:Me?Jd:Wd;Se=new ze({url:i,length:mt,httpHeaders:s,withCredentials:r,rangeChunkSize:h,disableRange:st,disableStream:G})}return je.then(ze=>{if(t.destroyed)throw new Error("Loading aborted");if(c.destroyed)throw new Error("Worker was destroyed");const Te=new Yn(e,ze,c.port),qt=new su(Te,t,Se,se,Pt,it);t._transport=qt,Te.send("Ready",null)})}).catch(t._capability.reject),t}class Uo{static#t=0;_capability=Promise.withResolvers();_transport=null;_worker=null;docId=`d${Uo.#t++}`;destroyed=!1;onPassword=null;onProgress=null;get promise(){return this._capability.promise}async destroy(){this.destroyed=!0;try{this._worker?.port&&(this._worker._pendingDestroy=!0),await this._transport?.destroy()}catch(t){throw this._worker?.port&&delete this._worker._pendingDestroy,t}this._transport=null,this._worker?.destroy(),this._worker=null}async getData(){return this._transport.getData()}}class Zl{#t=Promise.withResolvers();#e=[];#n=[];#i=[];#o=[];constructor(t,e,i=!1,n=null){this.length=t,this.initialData=e,this.progressiveDone=i,this.contentDispositionFilename=n}addRangeListener(t){this.#o.push(t)}addProgressListener(t){this.#i.push(t)}addProgressiveReadListener(t){this.#n.push(t)}addProgressiveDoneListener(t){this.#e.push(t)}onDataRange(t,e){for(const i of this.#o)i(t,e)}onDataProgress(t,e){this.#t.promise.then(()=>{for(const i of this.#i)i(t,e)})}onDataProgressiveRead(t){this.#t.promise.then(()=>{for(const e of this.#n)e(t)})}onDataProgressiveDone(){this.#t.promise.then(()=>{for(const t of this.#e)t()})}transportReady(){this.#t.resolve()}requestDataRange(t,e){Rt("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}}class iu{constructor(t,e){this._pdfInfo=t,this._transport=e}get annotationStorage(){return this._transport.annotationStorage}get canvasFactory(){return this._transport.canvasFactory}get filterFactory(){return this._transport.filterFactory}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return pt(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(t){return this._transport.getPage(t)}getPageIndex(t){return this._transport.getPageIndex(t)}getDestinations(){return this._transport.getDestinations()}getDestination(t){return this._transport.getDestination(t)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getAnnotationsByType(t,e){return this._transport.getAnnotationsByType(t,e)}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig({intent:t="display"}={}){const{renderingIntent:e}=this._transport.getRenderingIntent(t);return this._transport.getOptionalContentConfig(e)}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}extractPages(t){return this._transport.extractPages(t)}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(t=!1){return this._transport.startCleanup(t||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}cachedPageNumber(t){return this._transport.cachedPageNumber(t)}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}}class nu{#t=!1;constructor(t,e,i,n=!1){this._pageIndex=t,this._pageInfo=e,this._transport=i,this._stats=n?new Ea:null,this._pdfBug=n,this.commonObjs=i.commonObjs,this.objs=new Jl,this._intentStates=new Map,this.destroyed=!1,this.recordedBBoxes=null}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:t,rotation:e=this.rotate,offsetX:i=0,offsetY:n=0,dontFlip:s=!1}={}){return new ys({viewBox:this.view,userUnit:this.userUnit,scale:t,rotation:e,offsetX:i,offsetY:n,dontFlip:s})}getAnnotations({intent:t="display"}={}){const{renderingIntent:e}=this._transport.getRenderingIntent(t);return this._transport.getAnnotations(this._pageIndex,e)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get filterFactory(){return this._transport.filterFactory}get isPureXfa(){return pt(this,"isPureXfa",!!this._transport._htmlForXfa)}async getXfa(){return this._transport._htmlForXfa?.children[this._pageIndex]||null}render({canvasContext:t,canvas:e=t.canvas,viewport:i,intent:n="display",annotationMode:s=$i.ENABLE,transform:r=null,background:o=null,optionalContentConfigPromise:l=null,annotationCanvasMap:h=null,pageColors:c=null,printAnnotationStorage:u=null,isEditing:p=!1,recordOperations:b=!1,operationsFilter:w=null}){this._stats?.time("Overall");const v=this._transport.getRenderingIntent(n,s,u,p),{renderingIntent:x,cacheKey:E}=v;this.#t=!1,l||=this._transport.getOptionalContentConfig(x);let D=this._intentStates.get(E);D||(D=Object.create(null),this._intentStates.set(E,D)),D.streamReaderCancelTimeout&&(clearTimeout(D.streamReaderCancelTimeout),D.streamReaderCancelTimeout=null);const T=!!(x&qe.PRINT);D.displayReadyCapability||(D.displayReadyCapability=Promise.withResolvers(),D.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats?.time("Page Request"),this._pumpOperatorList(v));const k=!!(this._pdfBug&&globalThis.StepperManager?.enabled),F=!this.recordedBBoxes&&(b||k),M=R=>{if(D.renderTasks.delete(O),F){const $=O.gfx?.dependencyTracker.take();$&&(O.stepper&&O.stepper.setOperatorBBoxes($,O.gfx.dependencyTracker.takeDebugMetadata()),b&&(this.recordedBBoxes=$))}T&&(this.#t=!0),this.#e(),R?(O.capability.reject(R),this._abortOperatorList({intentState:D,reason:R instanceof Error?R:new Error(R)})):O.capability.resolve(),this._stats&&(this._stats.timeEnd("Rendering"),this._stats.timeEnd("Overall"),globalThis.Stats?.enabled&&globalThis.Stats.add(this.pageNumber,this._stats))},O=new Cn({callback:M,params:{canvas:e,canvasContext:t,dependencyTracker:F?new Ad(e,D.operatorList.length,k):null,viewport:i,transform:r,background:o},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:h,operatorList:D.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!T,pdfBug:this._pdfBug,pageColors:c,enableHWA:this._transport.enableHWA,operationsFilter:w});(D.renderTasks||=new Set).add(O);const N=O.task;return Promise.all([D.displayReadyCapability.promise,l]).then(([R,$])=>{if(this.destroyed){M();return}if(this._stats?.time("Rendering"),!($.renderingIntent&x))throw new Error("Must use the same `intent`-argument when calling the `PDFPageProxy.render` and `PDFDocumentProxy.getOptionalContentConfig` methods.");O.initializeGraphics({transparency:R,optionalContentConfig:$}),O.operatorListChanged()}).catch(M),N}getOperatorList({intent:t="display",annotationMode:e=$i.ENABLE,printAnnotationStorage:i=null,isEditing:n=!1}={}){function s(){o.operatorList.lastChunk&&(o.opListReadCapability.resolve(o.operatorList),o.renderTasks.delete(l))}const r=this._transport.getRenderingIntent(t,e,i,n,!0);let o=this._intentStates.get(r.cacheKey);o||(o=Object.create(null),this._intentStates.set(r.cacheKey,o));let l;return o.opListReadCapability||(l=Object.create(null),l.operatorListChanged=s,o.opListReadCapability=Promise.withResolvers(),(o.renderTasks||=new Set).add(l),o.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats?.time("Page Request"),this._pumpOperatorList(r)),o.opListReadCapability.promise}streamTextContent({includeMarkedContent:t=!1,disableNormalization:e=!1}={}){return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:t===!0,disableNormalization:e===!0},{highWaterMark:100,size(n){return n.items.length}})}getTextContent(t={}){if(this._transport._htmlForXfa)return this.getXfa().then(i=>cs.textContent(i));const e=this.streamTextContent(t);return new Promise(function(i,n){function s(){r.read().then(function({value:l,done:h}){if(h){i(o);return}o.lang??=l.lang,Object.assign(o.styles,l.styles),o.items.push(...l.items),s()},n)}const r=e.getReader(),o={items:[],styles:Object.create(null),lang:null};s()})}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;const t=[];for(const e of this._intentStates.values())if(this._abortOperatorList({intentState:e,reason:new Error("Page was destroyed."),force:!0}),!e.opListReadCapability)for(const i of e.renderTasks)t.push(i.completed),i.cancel();return this.objs.clear(),this.#t=!1,Promise.all(t)}cleanup(t=!1){this.#t=!0;const e=this.#e();return t&&e&&(this._stats&&=new Ea),e}#e(){if(!this.#t||this.destroyed)return!1;for(const{renderTasks:t,operatorList:e}of this._intentStates.values())if(t.size>0||!e.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),this.#t=!1,!0}_startRenderPage(t,e){const i=this._intentStates.get(e);i&&(this._stats?.timeEnd("Page Request"),i.displayReadyCapability?.resolve(t))}_renderPageChunk(t,e){for(let i=0,n=t.length;i<n;i++)e.operatorList.fnArray.push(t.fnArray[i]),e.operatorList.argsArray.push(t.argsArray[i]);e.operatorList.lastChunk=t.lastChunk,e.operatorList.separateAnnots=t.separateAnnots;for(const i of e.renderTasks)i.operatorListChanged();t.lastChunk&&this.#e()}_pumpOperatorList({renderingIntent:t,cacheKey:e,annotationStorageSerializable:i,modifiedIds:n}){const{map:s,transfer:r}=i,l=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:t,cacheKey:e,annotationStorage:s,modifiedIds:n},r).getReader(),h=this._intentStates.get(e);h.streamReader=l;const c=()=>{l.read().then(({value:u,done:p})=>{if(p){h.streamReader=null;return}this._transport.destroyed||(this._renderPageChunk(u,h),c())},u=>{if(h.streamReader=null,!this._transport.destroyed){if(h.operatorList){h.operatorList.lastChunk=!0;for(const p of h.renderTasks)p.operatorListChanged();this.#e()}if(h.displayReadyCapability)h.displayReadyCapability.reject(u);else if(h.opListReadCapability)h.opListReadCapability.reject(u);else throw u}})};c()}_abortOperatorList({intentState:t,reason:e,force:i=!1}){if(t.streamReader){if(t.streamReaderCancelTimeout&&(clearTimeout(t.streamReaderCancelTimeout),t.streamReaderCancelTimeout=null),!i){if(t.renderTasks.size>0)return;if(e instanceof Fo){let n=eu;e.extraDelay>0&&e.extraDelay<1e3&&(n+=e.extraDelay),t.streamReaderCancelTimeout=setTimeout(()=>{t.streamReaderCancelTimeout=null,this._abortOperatorList({intentState:t,reason:e,force:!0})},n);return}}if(t.streamReader.cancel(new Vi(e.message)).catch(()=>{}),t.streamReader=null,!this._transport.destroyed){for(const[n,s]of this._intentStates)if(s===t){this._intentStates.delete(n);break}this.cleanup()}}}get stats(){return this._stats}}var ji,hi,ki,nn,ur,sn,rn,Le,qs,th,eh,Kn,In,Xs;const jt=class jt{constructor({name:t=null,port:e=null,verbosity:i=Oc()}={}){fi(this,Le);fi(this,ji,Promise.withResolvers());fi(this,hi,null);fi(this,ki,null);fi(this,nn,null);if(this.name=t,this.destroyed=!1,this.verbosity=i,e){if($t(jt,rn).has(e))throw new Error("Cannot use more than one PDFWorker per port.");$t(jt,rn).set(e,this),pi(this,Le,th).call(this,e)}else pi(this,Le,eh).call(this)}get promise(){return $t(this,ji).promise}get port(){return $t(this,ki)}get messageHandler(){return $t(this,hi)}destroy(){this.destroyed=!0,$t(this,nn)?.terminate(),Oe(this,nn,null),$t(jt,rn).delete($t(this,ki)),Oe(this,ki,null),$t(this,hi)?.destroy(),Oe(this,hi,null)}static create(t){const e=$t(this,rn).get(t?.port);if(e){if(e._pendingDestroy)throw new Error("PDFWorker.create - the worker is being destroyed.\nPlease remember to await `PDFDocumentLoadingTask.destroy()`-calls.");return e}return new jt(t)}static get workerSrc(){if(Gi.workerSrc)return Gi.workerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get _setupFakeWorkerGlobal(){return pt(this,"_setupFakeWorkerGlobal",(async()=>$t(this,In,Xs)?$t(this,In,Xs):(await import(this.workerSrc)).WorkerMessageHandler)())}};ji=new WeakMap,hi=new WeakMap,ki=new WeakMap,nn=new WeakMap,ur=new WeakMap,sn=new WeakMap,rn=new WeakMap,Le=new WeakSet,qs=function(){$t(this,ji).resolve(),$t(this,hi).send("configure",{verbosity:this.verbosity})},th=function(t){Oe(this,ki,t),Oe(this,hi,new Yn("main","worker",t)),$t(this,hi).on("ready",()=>{}),pi(this,Le,qs).call(this)},eh=function(){if($t(jt,sn)||$t(jt,In,Xs)){pi(this,Le,Kn).call(this);return}let{workerSrc:t}=jt;try{jt._isSameOrigin(window.location,t)||(t=jt._createCDNWrapper(new URL(t,window.location).href));const e=new Worker(t,{type:"module"}),i=new Yn("main","worker",e),n=()=>{s.abort(),i.destroy(),e.terminate(),this.destroyed?$t(this,ji).reject(new Error("Worker was destroyed")):pi(this,Le,Kn).call(this)},s=new AbortController;e.addEventListener("error",()=>{$t(this,nn)||n()},{signal:s.signal}),i.on("test",o=>{if(s.abort(),this.destroyed||!o){n();return}Oe(this,hi,i),Oe(this,ki,e),Oe(this,nn,e),pi(this,Le,qs).call(this)}),i.on("ready",o=>{if(s.abort(),this.destroyed){n();return}try{r()}catch{pi(this,Le,Kn).call(this)}});const r=()=>{const o=new Uint8Array;i.send("test",o,[o.buffer])};r();return}catch{mr("The worker has been disabled.")}pi(this,Le,Kn).call(this)},Kn=function(){$t(jt,sn)||(ft("Setting up fake worker."),Oe(jt,sn,!0)),jt._setupFakeWorkerGlobal.then(t=>{if(this.destroyed){$t(this,ji).reject(new Error("Worker was destroyed"));return}const e=new ud;Oe(this,ki,e);const i=`fake${ba(jt,ur)._++}`,n=new Yn(i+"_worker",i,e);t.setup(n,e),Oe(this,hi,new Yn(i,i+"_worker",e)),pi(this,Le,qs).call(this)}).catch(t=>{$t(this,ji).reject(new Error(`Setting up fake worker failed: "${t.message}".`))})},In=new WeakSet,Xs=function(){try{return globalThis.pdfjsWorker?.WorkerMessageHandler||null}catch{return null}},fi(jt,In),fi(jt,ur,0),fi(jt,sn,!1),fi(jt,rn,new WeakMap),Me&&(Oe(jt,sn,!0),Gi.workerSrc||="./pdf.worker.mjs"),jt._isSameOrigin=(t,e)=>{const i=URL.parse(t);if(!i?.origin||i.origin==="null")return!1;const n=new URL(e,i);return i.origin===n.origin},jt._createCDNWrapper=t=>{const e=`await import("${t}");`;return URL.createObjectURL(new Blob([e],{type:"text/javascript"}))},jt.fromPort=t=>{if(Xc("`PDFWorker.fromPort` - please use `PDFWorker.create` instead."),!t?.port)throw new Error("PDFWorker.fromPort - invalid method signature.");return jt.create(t)};let ds=jt;class su{#t=new Map;#e=new Map;#n=new Map;#i=new Map;#o=null;constructor(t,e,i,n,s,r){this.messageHandler=t,this.loadingTask=e,this.commonObjs=new Jl,this.fontLoader=new rd({ownerDocument:n.ownerDocument,styleElement:n.styleElement}),this.loadingParams=n.loadingParams,this._params=n,this.canvasFactory=s.canvasFactory,this.filterFactory=s.filterFactory,this.cMapReaderFactory=s.cMapReaderFactory,this.standardFontDataFactory=s.standardFontDataFactory,this.wasmFactory=s.wasmFactory,this.destroyed=!1,this.destroyCapability=null,this._networkStream=i,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=Promise.withResolvers(),this.enableHWA=r,this.setupMessageHandler()}#r(t,e=null){const i=this.#t.get(t);if(i)return i;const n=this.messageHandler.sendWithPromise(t,e);return this.#t.set(t,n),n}get annotationStorage(){return pt(this,"annotationStorage",new Ro)}getRenderingIntent(t,e=$i.ENABLE,i=null,n=!1,s=!1){let r=qe.DISPLAY,o=po;switch(t){case"any":r=qe.ANY;break;case"display":break;case"print":r=qe.PRINT;break;default:ft(`getRenderingIntent - invalid intent: ${t}`)}const l=r&qe.PRINT&&i instanceof Ul?i:this.annotationStorage;switch(e){case $i.DISABLE:r+=qe.ANNOTATIONS_DISABLE;break;case $i.ENABLE:break;case $i.ENABLE_FORMS:r+=qe.ANNOTATIONS_FORMS;break;case $i.ENABLE_STORAGE:r+=qe.ANNOTATIONS_STORAGE,o=l.serializable;break;default:ft(`getRenderingIntent - invalid annotationMode: ${e}`)}n&&(r+=qe.IS_EDITING),s&&(r+=qe.OPLIST);const{ids:h,hash:c}=l.modifiedIds,u=[r,o.hash,c];return{renderingIntent:r,cacheKey:u.join("_"),annotationStorageSerializable:o,modifiedIds:h}}destroy(){if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=Promise.withResolvers(),this.#o?.reject(new Error("Worker was destroyed during onPassword callback"));const t=[];for(const i of this.#e.values())t.push(i._destroy());this.#e.clear(),this.#n.clear(),this.#i.clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();const e=this.messageHandler.sendWithPromise("Terminate",null);return t.push(e),Promise.all(t).then(()=>{this.commonObjs.clear(),this.fontLoader.clear(),this.#t.clear(),this.filterFactory.destroy(),Xe.cleanup(),this._networkStream?.cancelAllRequests(new Vi("Worker was terminated.")),this.messageHandler?.destroy(),this.messageHandler=null,this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){const{messageHandler:t,loadingTask:e}=this;t.on("GetReader",(i,n)=>{St(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=s=>{this._lastProgress={loaded:s.loaded,total:s.total}},n.onPull=()=>{this._fullReader.read().then(function({value:s,done:r}){if(r){n.close();return}St(s instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),n.enqueue(new Uint8Array(s),1,[s])}).catch(s=>{n.error(s)})},n.onCancel=s=>{this._fullReader.cancel(s),n.ready.catch(r=>{if(!this.destroyed)throw r})}}),t.on("ReaderHeadersReady",async i=>{await this._fullReader.headersReady;const{isStreamingSupported:n,isRangeSupported:s,contentLength:r}=this._fullReader;return(!n||!s)&&(this._lastProgress&&e.onProgress?.(this._lastProgress),this._fullReader.onProgress=o=>{e.onProgress?.({loaded:o.loaded,total:o.total})}),{isStreamingSupported:n,isRangeSupported:s,contentLength:r}}),t.on("GetRangeReader",(i,n)=>{St(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");const s=this._networkStream.getRangeReader(i.begin,i.end);if(!s){n.close();return}n.onPull=()=>{s.read().then(function({value:r,done:o}){if(o){n.close();return}St(r instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),n.enqueue(new Uint8Array(r),1,[r])}).catch(r=>{n.error(r)})},n.onCancel=r=>{s.cancel(r),n.ready.catch(o=>{if(!this.destroyed)throw o})}}),t.on("GetDoc",({pdfInfo:i})=>{this._numPages=i.numPages,this._htmlForXfa=i.htmlForXfa,delete i.htmlForXfa,e._capability.resolve(new iu(i,this))}),t.on("DocException",i=>{e._capability.reject(Ue(i))}),t.on("PasswordRequest",i=>{this.#o=Promise.withResolvers();try{if(!e.onPassword)throw Ue(i);const n=s=>{s instanceof Error?this.#o.reject(s):this.#o.resolve({password:s})};e.onPassword(n,i.code)}catch(n){this.#o.reject(n)}return this.#o.promise}),t.on("DataLoaded",i=>{e.onProgress?.({loaded:i.length,total:i.length}),this.downloadInfoCapability.resolve(i)}),t.on("StartRenderPage",i=>{if(this.destroyed)return;this.#e.get(i.pageIndex)._startRenderPage(i.transparency,i.cacheKey)}),t.on("commonobj",([i,n,s])=>{if(this.destroyed||this.commonObjs.has(i))return null;switch(n){case"Font":if("error"in s){const u=s.error;ft(`Error during font loading: ${u}`),this.commonObjs.resolve(i,u);break}const r=new It(s),o=this._params.pdfBug&&globalThis.FontInspector?.enabled?(u,p)=>globalThis.FontInspector.fontAdded(u,p):null,l=new od(r,o,s.extra,s.charProcOperatorList);this.fontLoader.bind(l).catch(()=>t.sendWithPromise("FontFallback",{id:i})).finally(()=>{!l.fontExtraProperties&&l.data&&l.clearData(),this.commonObjs.resolve(i,l)});break;case"CopyLocalImage":const{imageRef:h}=s;St(h,"The imageRef must be defined.");for(const u of this.#e.values())for(const[,p]of u.objs)if(p?.ref===h)return p.dataLen?(this.commonObjs.resolve(i,structuredClone(p)),p.dataLen):null;break;case"FontPath":this.commonObjs.resolve(i,new ad(s));break;case"Image":this.commonObjs.resolve(i,s);break;case"Pattern":const c=new pe(s);this.commonObjs.resolve(i,c.getIR());break;default:throw new Error(`Got unknown common object type ${n}`)}return null}),t.on("obj",([i,n,s,r])=>{if(this.destroyed)return;const o=this.#e.get(n);if(!o.objs.has(i)){if(o._intentStates.size===0){r?.bitmap?.close();return}switch(s){case"Image":case"Pattern":o.objs.resolve(i,r);break;default:throw new Error(`Got unknown object type ${s}`)}}}),t.on("DocProgress",i=>{this.destroyed||e.onProgress?.({loaded:i.loaded,total:i.total})}),t.on("FetchBinaryData",async i=>{if(this.destroyed)throw new Error("Worker was destroyed.");const n=this[i.type];if(!n)throw new Error(`${i.type} not initialized, see the \`useWorkerFetch\` parameter.`);return n.fetch(i)})}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){this.annotationStorage.size<=0&&ft("saveDocument called while `annotationStorage` is empty, please use the getData-method instead.");const{map:t,transfer:e}=this.annotationStorage.serializable;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:t,filename:this._fullReader?.filename??null},e).finally(()=>{this.annotationStorage.resetModified()})}extractPages(t){return this.messageHandler.sendWithPromise("ExtractPages",{pageInfos:t})}getPage(t){if(!Number.isInteger(t)||t<=0||t>this._numPages)return Promise.reject(new Error("Invalid page request."));const e=t-1,i=this.#n.get(e);if(i)return i;const n=this.messageHandler.sendWithPromise("GetPage",{pageIndex:e}).then(s=>{if(this.destroyed)throw new Error("Transport destroyed");s.refStr&&this.#i.set(s.refStr,t);const r=new nu(e,s,this,this._params.pdfBug);return this.#e.set(e,r),r});return this.#n.set(e,n),n}getPageIndex(t){return go(t)?this.messageHandler.sendWithPromise("GetPageIndex",{num:t.num,gen:t.gen}):Promise.reject(new Error("Invalid pageIndex request."))}getAnnotations(t,e){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:t,intent:e})}getFieldObjects(){return this.#r("GetFieldObjects")}hasJSActions(){return this.#r("HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(t){return typeof t!="string"?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:t})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getAnnotationsByType(t,e){return this.messageHandler.sendWithPromise("GetAnnotationsByType",{types:t,pageIndexesToSkip:e})}getDocJSActions(){return this.#r("GetDocJSActions")}getPageJSActions(t){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:t})}getStructTree(t){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:t})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(t){return this.#r("GetOptionalContentConfig").then(e=>new Od(e,t))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){const t="GetMetadata",e=this.#t.get(t);if(e)return e;const i=this.messageHandler.sendWithPromise(t,null).then(n=>({info:n[0],metadata:n[1]?new Ld(n[1]):null,contentDispositionFilename:this._fullReader?.filename??null,contentLength:this._fullReader?.contentLength??null,hasStructTree:n[2]}));return this.#t.set(t,i),i}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}async startCleanup(t=!1){if(!this.destroyed){await this.messageHandler.sendWithPromise("Cleanup",null);for(const e of this.#e.values())if(!e.cleanup())throw new Error(`startCleanup: Page ${e.pageNumber} is currently rendering.`);this.commonObjs.clear(),t||this.fontLoader.clear(),this.#t.clear(),this.filterFactory.destroy(!0),Xe.cleanup()}}cachedPageNumber(t){if(!go(t))return null;const e=t.gen===0?`${t.num}R`:`${t.num}R${t.gen}`;return this.#i.get(e)??null}}class ru{#t=null;onContinue=null;onError=null;constructor(t){this.#t=t}get promise(){return this.#t.capability.promise}cancel(t=0){this.#t.cancel(null,t)}get separateAnnots(){const{separateAnnots:t}=this.#t.operatorList;if(!t)return!1;const{annotationCanvasMap:e}=this.#t;return t.form||t.canvas&&e?.size>0}}class Cn{#t=null;static#e=new WeakSet;constructor({callback:t,params:e,objs:i,commonObjs:n,annotationCanvasMap:s,operatorList:r,pageIndex:o,canvasFactory:l,filterFactory:h,useRequestAnimationFrame:c=!1,pdfBug:u=!1,pageColors:p=null,enableHWA:b=!1,operationsFilter:w=null}){this.callback=t,this.params=e,this.objs=i,this.commonObjs=n,this.annotationCanvasMap=s,this.operatorListIdx=null,this.operatorList=r,this._pageIndex=o,this.canvasFactory=l,this.filterFactory=h,this._pdfBug=u,this.pageColors=p,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=c===!0&&typeof window<"u",this.cancelled=!1,this.capability=Promise.withResolvers(),this.task=new ru(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=e.canvas,this._canvasContext=e.canvas?null:e.canvasContext,this._enableHWA=b,this._dependencyTracker=e.dependencyTracker,this._operationsFilter=w}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics({transparency:t=!1,optionalContentConfig:e}){if(this.cancelled)return;if(this._canvas){if(Cn.#e.has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");Cn.#e.add(this._canvas)}this._pdfBug&&globalThis.StepperManager?.enabled&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());const{viewport:i,transform:n,background:s,dependencyTracker:r}=this.params,o=this._canvasContext||this._canvas.getContext("2d",{alpha:!1,willReadFrequently:!this._enableHWA});this.gfx=new Fn(o,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:e},this.annotationCanvasMap,this.pageColors,r),this.gfx.beginDrawing({transform:n,viewport:i,transparency:t,background:s}),this.operatorListIdx=0,this.graphicsReady=!0,this.graphicsReadyCallback?.()}cancel(t=null,e=0){this.running=!1,this.cancelled=!0,this.gfx?.endDrawing(),this.#t&&(window.cancelAnimationFrame(this.#t),this.#t=null),Cn.#e.delete(this._canvas),t||=new Fo(`Rendering cancelled, page ${this._pageIndex+1}`,e),this.callback(t),this.task.onError?.(t)}operatorListChanged(){if(!this.graphicsReady){this.graphicsReadyCallback||=this._continueBound;return}this.gfx.dependencyTracker?.growOperationsCount(this.operatorList.fnArray.length),this.stepper?.updateOperatorList(this.operatorList),!this.running&&this._continue()}_continue(){this.running=!0,!this.cancelled&&(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?this.#t=window.requestAnimationFrame(()=>{this.#t=null,this._nextBound().catch(this._cancelBound)}):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}async _next(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper,this._operationsFilter),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),Cn.#e.delete(this._canvas),this.callback())))}}const ou="5.4.530",au="50cc4adac";class ii{#t=null;#e=null;#n;#i=null;#o=!1;#r=!1;#s=null;#a;#h=null;#l=null;static#u=null;static get _keyboardManager(){return pt(this,"_keyboardManager",new vs([[["Escape","mac+Escape"],ii.prototype._hideDropdownFromKeyboard],[[" ","mac+ "],ii.prototype._colorSelectFromKeyboard],[["ArrowDown","ArrowRight","mac+ArrowDown","mac+ArrowRight"],ii.prototype._moveToNext],[["ArrowUp","ArrowLeft","mac+ArrowUp","mac+ArrowLeft"],ii.prototype._moveToPrevious],[["Home","mac+Home"],ii.prototype._moveToBeginning],[["End","mac+End"],ii.prototype._moveToEnd]]))}constructor({editor:t=null,uiManager:e=null}){t?(this.#r=!1,this.#s=t):this.#r=!0,this.#l=t?._uiManager||e,this.#a=this.#l._eventBus,this.#n=t?.color?.toUpperCase()||this.#l?.highlightColors.values().next().value||"#FFFF98",ii.#u||=Object.freeze({blue:"pdfjs-editor-colorpicker-blue",green:"pdfjs-editor-colorpicker-green",pink:"pdfjs-editor-colorpicker-pink",red:"pdfjs-editor-colorpicker-red",yellow:"pdfjs-editor-colorpicker-yellow"})}renderButton(){const t=this.#t=document.createElement("button");t.className="colorPicker",t.tabIndex="0",t.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-button"),t.ariaHasPopup="true",this.#s&&(t.ariaControls=`${this.#s.id}_colorpicker_dropdown`);const e=this.#l._signal;t.addEventListener("click",this.#g.bind(this),{signal:e}),t.addEventListener("keydown",this.#m.bind(this),{signal:e});const i=this.#e=document.createElement("span");return i.className="swatch",i.ariaHidden="true",i.style.backgroundColor=this.#n,t.append(i),t}renderMainDropdown(){const t=this.#i=this.#d();return t.ariaOrientation="horizontal",t.ariaLabelledBy="highlightColorPickerLabel",t}#d(){const t=document.createElement("div"),e=this.#l._signal;t.addEventListener("contextmenu",si,{signal:e}),t.className="dropdown",t.role="listbox",t.ariaMultiSelectable="false",t.ariaOrientation="vertical",t.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-dropdown"),this.#s&&(t.id=`${this.#s.id}_colorpicker_dropdown`);for(const[i,n]of this.#l.highlightColors){const s=document.createElement("button");s.tabIndex="0",s.role="option",s.setAttribute("data-color",n),s.title=i,s.setAttribute("data-l10n-id",ii.#u[i]);const r=document.createElement("span");s.append(r),r.className="swatch",r.style.backgroundColor=n,s.ariaSelected=n===this.#n,s.addEventListener("click",this.#f.bind(this,n),{signal:e}),t.append(s)}return t.addEventListener("keydown",this.#m.bind(this),{signal:e}),t}#f(t,e){e.stopPropagation(),this.#a.dispatch("switchannotationeditorparams",{source:this,type:Et.HIGHLIGHT_COLOR,value:t}),this.updateColor(t)}_colorSelectFromKeyboard(t){if(t.target===this.#t){this.#g(t);return}const e=t.target.getAttribute("data-color");e&&this.#f(e,t)}_moveToNext(t){if(!this.#p){this.#g(t);return}if(t.target===this.#t){this.#i.firstElementChild?.focus();return}t.target.nextSibling?.focus()}_moveToPrevious(t){if(t.target===this.#i?.firstElementChild||t.target===this.#t){this.#p&&this._hideDropdownFromKeyboard();return}this.#p||this.#g(t),t.target.previousSibling?.focus()}_moveToBeginning(t){if(!this.#p){this.#g(t);return}this.#i.firstElementChild?.focus()}_moveToEnd(t){if(!this.#p){this.#g(t);return}this.#i.lastElementChild?.focus()}#m(t){ii._keyboardManager.exec(this,t)}#g(t){if(this.#p){this.hideDropdown();return}if(this.#o=t.detail===0,this.#h||(this.#h=new AbortController,window.addEventListener("pointerdown",this.#c.bind(this),{signal:this.#l.combinedSignal(this.#h)})),this.#t.ariaExpanded="true",this.#i){this.#i.classList.remove("hidden");return}const e=this.#i=this.#d();this.#t.append(e)}#c(t){this.#i?.contains(t.target)||this.hideDropdown()}hideDropdown(){this.#i?.classList.add("hidden"),this.#t.ariaExpanded="false",this.#h?.abort(),this.#h=null}get#p(){return this.#i&&!this.#i.classList.contains("hidden")}_hideDropdownFromKeyboard(){if(!this.#r){if(!this.#p){this.#s?.unselect();return}this.hideDropdown(),this.#t.focus({preventScroll:!0,focusVisible:this.#o})}}updateColor(t){if(this.#e&&(this.#e.style.backgroundColor=t),!this.#i)return;const e=this.#l.highlightColors.values();for(const i of this.#i.children)i.ariaSelected=e.next().value===t.toUpperCase()}destroy(){this.#t?.remove(),this.#t=null,this.#e=null,this.#i?.remove(),this.#i=null}}class us{#t=null;#e=null;#n=null;static#i=null;constructor(t){this.#e=t,this.#n=t._uiManager,us.#i||=Object.freeze({freetext:"pdfjs-editor-color-picker-free-text-input",ink:"pdfjs-editor-color-picker-ink-input"})}renderButton(){if(this.#t)return this.#t;const{editorType:t,colorType:e,color:i}=this.#e,n=this.#t=document.createElement("input");return n.type="color",n.value=i||"#000000",n.className="basicColorPicker",n.tabIndex=0,n.setAttribute("data-l10n-id",us.#i[t]),n.addEventListener("input",()=>{this.#n.updateParams(e,n.value)},{signal:this.#n._signal}),n}update(t){this.#t&&(this.#t.value=t)}destroy(){this.#t?.remove(),this.#t=null}hideDropdown(){}}function Ga(a){return Math.floor(Math.max(0,Math.min(1,a))*255).toString(16).padStart(2,"0")}function Vn(a){return Math.max(0,Math.min(255,255*a))}class Va{static CMYK_G([t,e,i,n]){return["G",1-Math.min(1,.3*t+.59*i+.11*e+n)]}static G_CMYK([t]){return["CMYK",0,0,0,1-t]}static G_RGB([t]){return["RGB",t,t,t]}static G_rgb([t]){return t=Vn(t),[t,t,t]}static G_HTML([t]){const e=Ga(t);return`#${e}${e}${e}`}static RGB_G([t,e,i]){return["G",.3*t+.59*e+.11*i]}static RGB_rgb(t){return t.map(Vn)}static RGB_HTML(t){return`#${t.map(Ga).join("")}`}static T_HTML(){return"#00000000"}static T_rgb(){return[null]}static CMYK_RGB([t,e,i,n]){return["RGB",1-Math.min(1,t+n),1-Math.min(1,i+n),1-Math.min(1,e+n)]}static CMYK_rgb([t,e,i,n]){return[Vn(1-Math.min(1,t+n)),Vn(1-Math.min(1,i+n)),Vn(1-Math.min(1,e+n))]}static CMYK_HTML(t){const e=this.CMYK_RGB(t).slice(1);return this.RGB_HTML(e)}static RGB_CMYK([t,e,i]){const n=1-t,s=1-e,r=1-i,o=Math.min(n,s,r);return["CMYK",n,s,r,o]}}class lu{create(t,e,i=!1){if(t<=0||e<=0)throw new Error("Invalid SVG dimensions");const n=this._createSVG("svg:svg");return n.setAttribute("version","1.1"),i||(n.setAttribute("width",`${t}px`),n.setAttribute("height",`${e}px`)),n.setAttribute("preserveAspectRatio","none"),n.setAttribute("viewBox",`0 0 ${t} ${e}`),n}createElement(t){if(typeof t!="string")throw new Error("Invalid SVG element type");return this._createSVG(t)}_createSVG(t){Rt("Abstract method `_createSVG` called.")}}class ir extends lu{_createSVG(t){return document.createElementNS(Ti,t)}}const hu=9,an=new WeakSet,cu=new Date().getTimezoneOffset()*60*1e3;class Gr{static create(t){switch(t.data.annotationType){case ae.LINK:return new $o(t);case ae.TEXT:return new uu(t);case ae.WIDGET:switch(t.data.fieldType){case"Tx":return new fu(t);case"Btn":return t.data.radioButton?new ih(t):t.data.checkBox?new gu(t):new mu(t);case"Ch":return new bu(t);case"Sig":return new pu(t)}return new cn(t);case ae.POPUP:return new yo(t);case ae.FREETEXT:return new nh(t);case ae.LINE:return new wu(t);case ae.SQUARE:return new vu(t);case ae.CIRCLE:return new Au(t);case ae.POLYLINE:return new sh(t);case ae.CARET:return new Su(t);case ae.INK:return new Ho(t);case ae.POLYGON:return new Eu(t);case ae.HIGHLIGHT:return new rh(t);case ae.UNDERLINE:return new xu(t);case ae.SQUIGGLY:return new Cu(t);case ae.STRIKEOUT:return new _u(t);case ae.STAMP:return new oh(t);case ae.FILEATTACHMENT:return new Pu(t);default:return new Wt(t)}}}class Wt{#t=null;#e=!1;#n=null;constructor(t,{isRenderable:e=!1,ignoreBorder:i=!1,createQuadrilaterals:n=!1}={}){this.isRenderable=e,this.data=t.data,this.layer=t.layer,this.linkService=t.linkService,this.downloadManager=t.downloadManager,this.imageResourcesPath=t.imageResourcesPath,this.renderForms=t.renderForms,this.svgFactory=t.svgFactory,this.annotationStorage=t.annotationStorage,this.enableComment=t.enableComment,this.enableScripting=t.enableScripting,this.hasJSActions=t.hasJSActions,this._fieldObjects=t.fieldObjects,this.parent=t.parent,this.hasOwnCommentButton=!1,e&&(this.contentElement=this.container=this._createContainer(i)),n&&this._createQuadrilaterals()}static _hasPopupData({contentsObj:t,richText:e}){return!!(t?.str||e?.str)}get _isEditable(){return this.data.isEditable}get hasPopupData(){return Wt._hasPopupData(this.data)||this.enableComment&&!!this.commentText}get commentData(){const{data:t}=this,e=this.annotationStorage?.getEditor(t.id);return e?e.getData():t}get hasCommentButton(){return this.enableComment&&this.hasPopupElement}get commentButtonPosition(){const t=this.annotationStorage?.getEditor(this.data.id);if(t)return t.commentButtonPositionInPage;const{quadPoints:e,inkLists:i,rect:n}=this.data;let s=-1/0,r=-1/0;if(e?.length>=8){for(let o=0;o<e.length;o+=8)e[o+1]>r?(r=e[o+1],s=e[o+2]):e[o+1]===r&&(s=Math.max(s,e[o+2]));return[s,r]}if(i?.length>=1){for(const o of i)for(let l=0,h=o.length;l<h;l+=2)o[l+1]>r?(r=o[l+1],s=o[l]):o[l+1]===r&&(s=Math.max(s,o[l]));if(s!==1/0)return[s,r]}return n?[n[2],n[3]]:null}_normalizePoint(t){const{page:{view:e},viewport:{rawDims:{pageWidth:i,pageHeight:n,pageX:s,pageY:r}}}=this.parent;return t[1]=e[3]-t[1]+e[1],t[0]=100*(t[0]-s)/i,t[1]=100*(t[1]-r)/n,t}get commentText(){const{data:t}=this;return this.annotationStorage.getRawValue(`${ls}${t.id}`)?.popup?.contents||t.contentsObj?.str||""}set commentText(t){const{data:e}=this,i={deleted:!t,contents:t||""};this.annotationStorage.updateEditor(e.id,{popup:i})||this.annotationStorage.setValue(`${ls}${e.id}`,{id:e.id,annotationType:e.annotationType,pageIndex:this.parent.page._pageIndex,popup:i,popupRef:e.popupRef,modificationDate:new Date}),t||this.removePopup()}removePopup(){(this.#n?.popup||this.popup)?.remove(),this.#n=this.popup=null}updateEdited(t){if(!this.container)return;t.rect&&(this.#t||={rect:this.data.rect.slice(0)});const{rect:e,popup:i}=t;e&&this.#i(e);let n=this.#n?.popup||this.popup;!n&&i?.text&&(this._createPopup(i),n=this.#n.popup),n&&(n.updateEdited(t),i?.deleted&&(n.remove(),this.#n=null,this.popup=null))}resetEdited(){this.#t&&(this.#i(this.#t.rect),this.#n?.popup.resetEdited(),this.#t=null)}#i(t){const{container:{style:e},data:{rect:i,rotation:n},parent:{viewport:{rawDims:{pageWidth:s,pageHeight:r,pageX:o,pageY:l}}}}=this;i?.splice(0,4,...t),e.left=`${100*(t[0]-o)/s}%`,e.top=`${100*(r-t[3]+l)/r}%`,n===0?(e.width=`${100*(t[2]-t[0])/s}%`,e.height=`${100*(t[3]-t[1])/r}%`):this.setRotation(n)}_createContainer(t){const{data:e,parent:{page:i,viewport:n}}=this,s=document.createElement("section");s.setAttribute("data-annotation-id",e.id),!(this instanceof cn)&&!(this instanceof $o)&&(s.tabIndex=0);const{style:r}=s;if(r.zIndex=this.parent.zIndex,this.parent.zIndex+=2,e.alternativeText&&(s.title=e.alternativeText),e.noRotate&&s.classList.add("norotate"),!e.rect||this instanceof yo){const{rotation:v}=e;return!e.hasOwnCanvas&&v!==0&&this.setRotation(v,s),s}const{width:o,height:l}=this;if(!t&&e.borderStyle.width>0){r.borderWidth=`${e.borderStyle.width}px`;const v=e.borderStyle.horizontalCornerRadius,x=e.borderStyle.verticalCornerRadius;if(v>0||x>0){const D=`calc(${v}px * var(--total-scale-factor)) / calc(${x}px * var(--total-scale-factor))`;r.borderRadius=D}else if(this instanceof ih){const D=`calc(${o}px * var(--total-scale-factor)) / calc(${l}px * var(--total-scale-factor))`;r.borderRadius=D}switch(e.borderStyle.style){case wn.SOLID:r.borderStyle="solid";break;case wn.DASHED:r.borderStyle="dashed";break;case wn.BEVELED:ft("Unimplemented border style: beveled");break;case wn.INSET:ft("Unimplemented border style: inset");break;case wn.UNDERLINE:r.borderBottomStyle="solid";break}const E=e.borderColor||null;E?(this.#e=!0,r.borderColor=J.makeHexColor(E[0]|0,E[1]|0,E[2]|0)):r.borderWidth=0}const h=J.normalizeRect([e.rect[0],i.view[3]-e.rect[1]+i.view[1],e.rect[2],i.view[3]-e.rect[3]+i.view[1]]),{pageWidth:c,pageHeight:u,pageX:p,pageY:b}=n.rawDims;r.left=`${100*(h[0]-p)/c}%`,r.top=`${100*(h[1]-b)/u}%`;const{rotation:w}=e;return e.hasOwnCanvas||w===0?(r.width=`${100*o/c}%`,r.height=`${100*l/u}%`):this.setRotation(w,s),s}setRotation(t,e=this.container){if(!this.data.rect)return;const{pageWidth:i,pageHeight:n}=this.parent.viewport.rawDims;let{width:s,height:r}=this;t%180!==0&&([s,r]=[r,s]),e.style.width=`${100*s/i}%`,e.style.height=`${100*r/n}%`,e.setAttribute("data-main-rotation",(360-t)%360)}get _commonActions(){const t=(e,i,n)=>{const s=n.detail[e],r=s[0],o=s.slice(1);n.target.style[i]=Va[`${r}_HTML`](o),this.annotationStorage.setValue(this.data.id,{[i]:Va[`${r}_rgb`](o)})};return pt(this,"_commonActions",{display:e=>{const{display:i}=e.detail,n=i%2===1;this.container.style.visibility=n?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noView:n,noPrint:i===1||i===2})},print:e=>{this.annotationStorage.setValue(this.data.id,{noPrint:!e.detail.print})},hidden:e=>{const{hidden:i}=e.detail;this.container.style.visibility=i?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noPrint:i,noView:i})},focus:e=>{setTimeout(()=>e.target.focus({preventScroll:!1}),0)},userName:e=>{e.target.title=e.detail.userName},readonly:e=>{e.target.disabled=e.detail.readonly},required:e=>{this._setRequired(e.target,e.detail.required)},bgColor:e=>{t("bgColor","backgroundColor",e)},fillColor:e=>{t("fillColor","backgroundColor",e)},fgColor:e=>{t("fgColor","color",e)},textColor:e=>{t("textColor","color",e)},borderColor:e=>{t("borderColor","borderColor",e)},strokeColor:e=>{t("strokeColor","borderColor",e)},rotation:e=>{const i=e.detail.rotation;this.setRotation(i),this.annotationStorage.setValue(this.data.id,{rotation:i})}})}_dispatchEventFromSandbox(t,e){const i=this._commonActions;for(const n of Object.keys(e.detail))(t[n]||i[n])?.(e)}_setDefaultPropertiesFromJS(t){if(!this.enableScripting)return;const e=this.annotationStorage.getRawValue(this.data.id);if(!e)return;const i=this._commonActions;for(const[n,s]of Object.entries(e)){const r=i[n];if(r){const o={detail:{[n]:s},target:t};r(o),delete e[n]}}}_createQuadrilaterals(){if(!this.container)return;const{quadPoints:t}=this.data;if(!t)return;const[e,i,n,s]=this.data.rect.map(v=>Math.fround(v));if(t.length===8){const[v,x,E,D]=t.subarray(2,6);if(n===v&&s===x&&e===E&&i===D)return}const{style:r}=this.container;let o;if(this.#e){const{borderColor:v,borderWidth:x}=r;r.borderWidth=0,o=["url('data:image/svg+xml;utf8,",'<svg xmlns="http://www.w3.org/2000/svg"',' preserveAspectRatio="none" viewBox="0 0 1 1">',`<g fill="transparent" stroke="${v}" stroke-width="${x}">`],this.container.classList.add("hasBorder")}const l=n-e,h=s-i,{svgFactory:c}=this,u=c.createElement("svg");u.classList.add("quadrilateralsContainer"),u.setAttribute("width",0),u.setAttribute("height",0),u.role="none";const p=c.createElement("defs");u.append(p);const b=c.createElement("clipPath"),w=`clippath_${this.data.id}`;b.setAttribute("id",w),b.setAttribute("clipPathUnits","objectBoundingBox"),p.append(b);for(let v=2,x=t.length;v<x;v+=8){const E=t[v],D=t[v+1],T=t[v+2],k=t[v+3],F=c.createElement("rect"),M=(T-e)/l,O=(s-D)/h,N=(E-T)/l,R=(D-k)/h;F.setAttribute("x",M),F.setAttribute("y",O),F.setAttribute("width",N),F.setAttribute("height",R),b.append(F),o?.push(`<rect vector-effect="non-scaling-stroke" x="${M}" y="${O}" width="${N}" height="${R}"/>`)}this.#e&&(o.push("</g></svg>')"),r.backgroundImage=o.join("")),this.container.append(u),this.container.style.clipPath=`url(#${w})`}_createPopup(t=null){const{data:e}=this;let i,n;t?(i={str:t.text},n=t.date):(i=e.contentsObj,n=e.modificationDate),this.#n=new yo({data:{color:e.color,titleObj:e.titleObj,modificationDate:n,contentsObj:i,richText:e.richText,parentRect:e.rect,borderStyle:0,id:`popup_${e.id}`,rotation:e.rotation,noRotate:!0},linkService:this.linkService,parent:this.parent,elements:[this]})}get hasPopupElement(){return!!(this.#n||this.popup||this.data.popupRef)}get extraPopupElement(){return this.#n}render(){Rt("Abstract method `AnnotationElement.render` called")}_getElementsByName(t,e=null){const i=[];if(this._fieldObjects){const n=this._fieldObjects[t];if(n)for(const{page:s,id:r,exportValues:o}of n){if(s===-1||r===e)continue;const l=typeof o=="string"?o:null,h=document.querySelector(`[data-element-id="${r}"]`);if(h&&!an.has(h)){ft(`_getElementsByName - element not allowed: ${r}`);continue}i.push({id:r,exportValue:l,domElement:h})}return i}for(const n of document.getElementsByName(t)){const{exportValue:s}=n,r=n.getAttribute("data-element-id");r!==e&&an.has(n)&&i.push({id:r,exportValue:s,domElement:n})}return i}show(){this.container&&(this.container.hidden=!1),this.popup?.maybeShow()}hide(){this.container&&(this.container.hidden=!0),this.popup?.forceHide()}getElementsToTriggerPopup(){return this.container}addHighlightArea(){const t=this.getElementsToTriggerPopup();if(Array.isArray(t))for(const e of t)e.classList.add("highlightArea");else t.classList.add("highlightArea")}_editOnDoubleClick(){if(!this._isEditable)return;const{annotationEditorType:t,data:{id:e}}=this;this.container.addEventListener("dblclick",()=>{this.linkService.eventBus?.dispatch("switchannotationeditormode",{source:this,mode:t,editId:e,mustEnterInEditMode:!0})})}get width(){return this.data.rect[2]-this.data.rect[0]}get height(){return this.data.rect[3]-this.data.rect[1]}}class du extends Wt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0}),this.editor=t.editor}render(){return this.container.className="editorAnnotation",this.container}createOrUpdatePopup(){const{editor:t}=this;t.hasComment&&this._createPopup(t.comment)}get hasCommentButton(){return this.enableComment&&this.editor.hasComment}get commentButtonPosition(){return this.editor.commentButtonPositionInPage}get commentText(){return this.editor.comment.text}set commentText(t){this.editor.comment=t,t||this.removePopup()}get commentData(){return this.editor.getData()}remove(){this.parent.removeAnnotation(this.data.id),this.container.remove(),this.container=null,this.removePopup()}}class $o extends Wt{constructor(t,e=null){super(t,{isRenderable:!0,ignoreBorder:!!e?.ignoreBorder,createQuadrilaterals:!0}),this.isTooltipOnly=t.data.isTooltipOnly}render(){const{data:t,linkService:e}=this,i=document.createElement("a");i.setAttribute("data-element-id",t.id);let n=!1;return t.url?(e.addLinkAttributes(i,t.url,t.newWindow),n=!0):t.action?(this._bindNamedAction(i,t.action,t.overlaidText),n=!0):t.attachment?(this.#e(i,t.attachment,t.overlaidText,t.attachmentDest),n=!0):t.setOCGState?(this.#n(i,t.setOCGState,t.overlaidText),n=!0):t.dest?(this._bindLink(i,t.dest,t.overlaidText),n=!0):(t.actions&&(t.actions.Action||t.actions["Mouse Up"]||t.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(i,t),n=!0),t.resetForm?(this._bindResetFormAction(i,t.resetForm),n=!0):this.isTooltipOnly&&!n&&(this._bindLink(i,""),n=!0)),this.container.classList.add("linkAnnotation"),n&&(this.contentElement=i,this.container.append(i)),this.container}#t(){this.container.setAttribute("data-internal-link","")}_bindLink(t,e,i=""){t.href=this.linkService.getDestinationHash(e),t.onclick=()=>(e&&this.linkService.goToDestination(e),!1),(e||e==="")&&this.#t(),i&&(t.title=i)}_bindNamedAction(t,e,i=""){t.href=this.linkService.getAnchorUrl(""),t.onclick=()=>(this.linkService.executeNamedAction(e),!1),i&&(t.title=i),this.#t()}#e(t,e,i="",n=null){t.href=this.linkService.getAnchorUrl(""),e.description?t.title=e.description:i&&(t.title=i),t.onclick=()=>(this.downloadManager?.openOrDownloadData(e.content,e.filename,n),!1),this.#t()}#n(t,e,i=""){t.href=this.linkService.getAnchorUrl(""),t.onclick=()=>(this.linkService.executeSetOCGState(e),!1),i&&(t.title=i),this.#t()}_bindJSAction(t,e){t.href=this.linkService.getAnchorUrl("");const i=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(const n of Object.keys(e.actions)){const s=i.get(n);s&&(t[s]=()=>(this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e.id,name:n}}),!1))}e.overlaidText&&(t.title=e.overlaidText),t.onclick||(t.onclick=()=>!1),this.#t()}_bindResetFormAction(t,e){const i=t.onclick;if(i||(t.href=this.linkService.getAnchorUrl("")),this.#t(),!this._fieldObjects){ft('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),i||(t.onclick=()=>!1);return}t.onclick=()=>{i?.();const{fields:n,refs:s,include:r}=e,o=[];if(n.length!==0||s.length!==0){const c=new Set(s);for(const u of n){const p=this._fieldObjects[u]||[];for(const{id:b}of p)c.add(b)}for(const u of Object.values(this._fieldObjects))for(const p of u)c.has(p.id)===r&&o.push(p)}else for(const c of Object.values(this._fieldObjects))o.push(...c);const l=this.annotationStorage,h=[];for(const c of o){const{id:u}=c;switch(h.push(u),c.type){case"text":{const b=c.defaultValue||"";l.setValue(u,{value:b});break}case"checkbox":case"radiobutton":{const b=c.defaultValue===c.exportValues;l.setValue(u,{value:b});break}case"combobox":case"listbox":{const b=c.defaultValue||"";l.setValue(u,{value:b});break}default:continue}const p=document.querySelector(`[data-element-id="${u}"]`);if(p){if(!an.has(p)){ft(`_bindResetFormAction - element not allowed: ${u}`);continue}}else continue;p.dispatchEvent(new Event("resetform"))}return this.enableScripting&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:h,name:"ResetForm"}}),!1}}}class uu extends Wt{constructor(t){super(t,{isRenderable:!0})}render(){this.container.classList.add("textAnnotation");const t=document.createElement("img");return t.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",t.setAttribute("data-l10n-id","pdfjs-text-annotation-type"),t.setAttribute("data-l10n-args",JSON.stringify({type:this.data.name})),!this.data.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.append(t),this.container}}class cn extends Wt{render(){return this.container}showElementAndHideCanvas(t){this.data.hasOwnCanvas&&(t.previousSibling?.nodeName==="CANVAS"&&(t.previousSibling.hidden=!0),t.hidden=!1)}_getKeyModifier(t){return fe.platform.isMac?t.metaKey:t.ctrlKey}_setEventListener(t,e,i,n,s){i.includes("mouse")?t.addEventListener(i,r=>{this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:n,value:s(r),shift:r.shiftKey,modifier:this._getKeyModifier(r)}})}):t.addEventListener(i,r=>{if(i==="blur"){if(!e.focused||!r.relatedTarget)return;e.focused=!1}else if(i==="focus"){if(e.focused)return;e.focused=!0}s&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:n,value:s(r)}})})}_setEventListeners(t,e,i,n){for(const[s,r]of i)(r==="Action"||this.data.actions?.[r])&&((r==="Focus"||r==="Blur")&&(e||={focused:!1}),this._setEventListener(t,e,s,r,n),r==="Focus"&&!this.data.actions?.Blur?this._setEventListener(t,e,"blur","Blur",null):r==="Blur"&&!this.data.actions?.Focus&&this._setEventListener(t,e,"focus","Focus",null))}_setBackgroundColor(t){const e=this.data.backgroundColor||null;t.style.backgroundColor=e===null?"transparent":J.makeHexColor(e[0],e[1],e[2])}_setTextStyle(t){const e=["left","center","right"],{fontColor:i}=this.data.defaultAppearanceData,n=this.data.defaultAppearanceData.fontSize||hu,s=t.style;let r;const o=2,l=h=>Math.round(10*h)/10;if(this.data.multiLine){const h=Math.abs(this.data.rect[3]-this.data.rect[1]-o),c=Math.round(h/(Or*n))||1,u=h/c;r=Math.min(n,l(u/Or))}else{const h=Math.abs(this.data.rect[3]-this.data.rect[1]-o);r=Math.min(n,l(h/Or))}s.fontSize=`calc(${r}px * var(--total-scale-factor))`,s.color=J.makeHexColor(i[0],i[1],i[2]),this.data.textAlignment!==null&&(s.textAlign=e[this.data.textAlignment])}_setRequired(t,e){e?t.setAttribute("required",!0):t.removeAttribute("required"),t.setAttribute("aria-required",e)}}class fu extends cn{constructor(t){const e=t.renderForms||t.data.hasOwnCanvas||!t.data.hasAppearance&&!!t.data.fieldValue;super(t,{isRenderable:e})}setPropertyOnSiblings(t,e,i,n){const s=this.annotationStorage;for(const r of this._getElementsByName(t.name,t.id))r.domElement&&(r.domElement[e]=i),s.setValue(r.id,{[n]:i})}render(){const t=this.annotationStorage,e=this.data.id;this.container.classList.add("textWidgetAnnotation");let i=null;if(this.renderForms){const n=t.getValue(e,{value:this.data.fieldValue});let s=n.value||"";const r=t.getValue(e,{charLimit:this.data.maxLen}).charLimit;r&&s.length>r&&(s=s.slice(0,r));let o=n.formattedValue||this.data.textContent?.join(`
`)||null;o&&this.data.comb&&(o=o.replaceAll(/\s+/g,""));const l={userValue:s,formattedValue:o,lastCommittedValue:null,commitKey:1,focused:!1};this.data.multiLine?(i=document.createElement("textarea"),i.textContent=o??s,this.data.doNotScroll&&(i.style.overflowY="hidden")):(i=document.createElement("input"),i.type=this.data.password?"password":"text",i.setAttribute("value",o??s),this.data.doNotScroll&&(i.style.overflowX="hidden")),this.data.hasOwnCanvas&&(i.hidden=!0),an.add(i),this.contentElement=i,i.setAttribute("data-element-id",e),i.disabled=this.data.readOnly,i.name=this.data.fieldName,i.tabIndex=0;const{datetimeFormat:h,datetimeType:c,timeStep:u}=this.data,p=!!c&&this.enableScripting;h&&(i.title=h),this._setRequired(i,this.data.required),r&&(i.maxLength=r),i.addEventListener("input",w=>{t.setValue(e,{value:w.target.value}),this.setPropertyOnSiblings(i,"value",w.target.value,"value"),l.formattedValue=null}),i.addEventListener("resetform",w=>{const v=this.data.defaultFieldValue??"";i.value=l.userValue=v,l.formattedValue=null});let b=w=>{const{formattedValue:v}=l;v!=null&&(w.target.value=v),w.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){i.addEventListener("focus",v=>{if(l.focused)return;const{target:x}=v;if(p&&(x.type=c,u&&(x.step=u)),l.userValue){const E=l.userValue;if(p)if(c==="time"){const D=new Date(E),T=[D.getHours(),D.getMinutes(),D.getSeconds()];x.value=T.map(k=>k.toString().padStart(2,"0")).join(":")}else x.value=new Date(E-cu).toISOString().split(c==="date"?"T":".",1)[0];else x.value=E}l.lastCommittedValue=x.value,l.commitKey=1,this.data.actions?.Focus||(l.focused=!0)}),i.addEventListener("updatefromsandbox",v=>{this.showElementAndHideCanvas(v.target);const x={value(E){l.userValue=E.detail.value??"",p||t.setValue(e,{value:l.userValue.toString()}),E.target.value=l.userValue},formattedValue(E){const{formattedValue:D}=E.detail;l.formattedValue=D,D!=null&&E.target!==document.activeElement&&(E.target.value=D);const T={formattedValue:D};p&&(T.value=D),t.setValue(e,T)},selRange(E){E.target.setSelectionRange(...E.detail.selRange)},charLimit:E=>{const{charLimit:D}=E.detail,{target:T}=E;if(D===0){T.removeAttribute("maxLength");return}T.setAttribute("maxLength",D);let k=l.userValue;!k||k.length<=D||(k=k.slice(0,D),T.value=l.userValue=k,t.setValue(e,{value:k}),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:k,willCommit:!0,commitKey:1,selStart:T.selectionStart,selEnd:T.selectionEnd}}))}};this._dispatchEventFromSandbox(x,v)}),i.addEventListener("keydown",v=>{l.commitKey=1;let x=-1;if(v.key==="Escape"?x=0:v.key==="Enter"&&!this.data.multiLine?x=2:v.key==="Tab"&&(l.commitKey=3),x===-1)return;const{value:E}=v.target;l.lastCommittedValue!==E&&(l.lastCommittedValue=E,l.userValue=E,this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:E,willCommit:!0,commitKey:x,selStart:v.target.selectionStart,selEnd:v.target.selectionEnd}}))});const w=b;b=null,i.addEventListener("blur",v=>{if(!l.focused||!v.relatedTarget)return;this.data.actions?.Blur||(l.focused=!1);const{target:x}=v;let{value:E}=x;if(p){if(E&&c==="time"){const D=E.split(":").map(T=>parseInt(T,10));E=new Date(2e3,0,1,D[0],D[1],D[2]||0).valueOf(),x.step=""}else E.includes("T")||(E=`${E}T00:00`),E=new Date(E).valueOf();x.type="text"}l.userValue=E,l.lastCommittedValue!==E&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:E,willCommit:!0,commitKey:l.commitKey,selStart:v.target.selectionStart,selEnd:v.target.selectionEnd}}),w(v)}),this.data.actions?.Keystroke&&i.addEventListener("beforeinput",v=>{l.lastCommittedValue=null;const{data:x,target:E}=v,{value:D,selectionStart:T,selectionEnd:k}=E;let F=T,M=k;switch(v.inputType){case"deleteWordBackward":{const O=D.substring(0,T).match(/\w*[^\w]*$/);O&&(F-=O[0].length);break}case"deleteWordForward":{const O=D.substring(T).match(/^[^\w]*\w*/);O&&(M+=O[0].length);break}case"deleteContentBackward":T===k&&(F-=1);break;case"deleteContentForward":T===k&&(M+=1);break}v.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:D,change:x||"",willCommit:!1,selStart:F,selEnd:M}})}),this._setEventListeners(i,l,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],v=>v.target.value)}if(b&&i.addEventListener("blur",b),this.data.comb){const v=(this.data.rect[2]-this.data.rect[0])/r;i.classList.add("comb"),i.style.letterSpacing=`calc(${v}px * var(--total-scale-factor) - 1ch)`}}else i=document.createElement("div"),i.textContent=this.data.fieldValue,i.style.verticalAlign="middle",i.style.display="table-cell",this.data.hasOwnCanvas&&(i.hidden=!0);return this._setTextStyle(i),this._setBackgroundColor(i),this._setDefaultPropertiesFromJS(i),this.container.append(i),this.container}}class pu extends cn{constructor(t){super(t,{isRenderable:!!t.data.hasOwnCanvas})}}class gu extends cn{constructor(t){super(t,{isRenderable:t.renderForms})}render(){const t=this.annotationStorage,e=this.data,i=e.id;let n=t.getValue(i,{value:e.exportValue===e.fieldValue}).value;typeof n=="string"&&(n=n!=="Off",t.setValue(i,{value:n})),this.container.classList.add("buttonWidgetAnnotation","checkBox");const s=document.createElement("input");return an.add(s),s.setAttribute("data-element-id",i),s.disabled=e.readOnly,this._setRequired(s,this.data.required),s.type="checkbox",s.name=e.fieldName,n&&s.setAttribute("checked",!0),s.setAttribute("exportValue",e.exportValue),s.tabIndex=0,s.addEventListener("change",r=>{const{name:o,checked:l}=r.target;for(const h of this._getElementsByName(o,i)){const c=l&&h.exportValue===e.exportValue;h.domElement&&(h.domElement.checked=c),t.setValue(h.id,{value:c})}t.setValue(i,{value:l})}),s.addEventListener("resetform",r=>{const o=e.defaultFieldValue||"Off";r.target.checked=o===e.exportValue}),this.enableScripting&&this.hasJSActions&&(s.addEventListener("updatefromsandbox",r=>{const o={value(l){l.target.checked=l.detail.value!=="Off",t.setValue(i,{value:l.target.checked})}};this._dispatchEventFromSandbox(o,r)}),this._setEventListeners(s,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],r=>r.target.checked)),this._setBackgroundColor(s),this._setDefaultPropertiesFromJS(s),this.container.append(s),this.container}}class ih extends cn{constructor(t){super(t,{isRenderable:t.renderForms})}render(){this.container.classList.add("buttonWidgetAnnotation","radioButton");const t=this.annotationStorage,e=this.data,i=e.id;let n=t.getValue(i,{value:e.fieldValue===e.buttonValue}).value;if(typeof n=="string"&&(n=n!==e.buttonValue,t.setValue(i,{value:n})),n)for(const r of this._getElementsByName(e.fieldName,i))t.setValue(r.id,{value:!1});const s=document.createElement("input");if(an.add(s),s.setAttribute("data-element-id",i),s.disabled=e.readOnly,this._setRequired(s,this.data.required),s.type="radio",s.name=e.fieldName,n&&s.setAttribute("checked",!0),s.tabIndex=0,s.addEventListener("change",r=>{const{name:o,checked:l}=r.target;for(const h of this._getElementsByName(o,i))t.setValue(h.id,{value:!1});t.setValue(i,{value:l})}),s.addEventListener("resetform",r=>{const o=e.defaultFieldValue;r.target.checked=o!=null&&o===e.buttonValue}),this.enableScripting&&this.hasJSActions){const r=e.buttonValue;s.addEventListener("updatefromsandbox",o=>{const l={value:h=>{const c=r===h.detail.value;for(const u of this._getElementsByName(h.target.name)){const p=c&&u.id===i;u.domElement&&(u.domElement.checked=p),t.setValue(u.id,{value:p})}}};this._dispatchEventFromSandbox(l,o)}),this._setEventListeners(s,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],o=>o.target.checked)}return this._setBackgroundColor(s),this._setDefaultPropertiesFromJS(s),this.container.append(s),this.container}}class mu extends $o{constructor(t){super(t,{ignoreBorder:t.data.hasAppearance})}render(){const t=super.render();t.classList.add("buttonWidgetAnnotation","pushButton");const e=t.lastChild;return this.enableScripting&&this.hasJSActions&&e&&(this._setDefaultPropertiesFromJS(e),e.addEventListener("updatefromsandbox",i=>{this._dispatchEventFromSandbox({},i)})),t}}class bu extends cn{constructor(t){super(t,{isRenderable:t.renderForms})}render(){this.container.classList.add("choiceWidgetAnnotation");const t=this.annotationStorage,e=this.data.id,i=t.getValue(e,{value:this.data.fieldValue}),n=document.createElement("select");an.add(n),n.setAttribute("data-element-id",e),n.disabled=this.data.readOnly,this._setRequired(n,this.data.required),n.name=this.data.fieldName,n.tabIndex=0;let s=this.data.combo&&this.data.options.length>0;this.data.combo||(n.size=this.data.options.length,this.data.multiSelect&&(n.multiple=!0)),n.addEventListener("resetform",c=>{const u=this.data.defaultFieldValue;for(const p of n.options)p.selected=p.value===u});for(const c of this.data.options){const u=document.createElement("option");u.textContent=c.displayValue,u.value=c.exportValue,i.value.includes(c.exportValue)&&(u.setAttribute("selected",!0),s=!1),n.append(u)}let r=null;if(s){const c=document.createElement("option");c.value=" ",c.setAttribute("hidden",!0),c.setAttribute("selected",!0),n.prepend(c),r=()=>{c.remove(),n.removeEventListener("input",r),r=null},n.addEventListener("input",r)}const o=c=>{const u=c?"value":"textContent",{options:p,multiple:b}=n;return b?Array.prototype.filter.call(p,w=>w.selected).map(w=>w[u]):p.selectedIndex===-1?null:p[p.selectedIndex][u]};let l=o(!1);const h=c=>{const u=c.target.options;return Array.prototype.map.call(u,p=>({displayValue:p.textContent,exportValue:p.value}))};return this.enableScripting&&this.hasJSActions?(n.addEventListener("updatefromsandbox",c=>{const u={value(p){r?.();const b=p.detail.value,w=new Set(Array.isArray(b)?b:[b]);for(const v of n.options)v.selected=w.has(v.value);t.setValue(e,{value:o(!0)}),l=o(!1)},multipleSelection(p){n.multiple=!0},remove(p){const b=n.options,w=p.detail.remove;b[w].selected=!1,n.remove(w),b.length>0&&Array.prototype.findIndex.call(b,x=>x.selected)===-1&&(b[0].selected=!0),t.setValue(e,{value:o(!0),items:h(p)}),l=o(!1)},clear(p){for(;n.length!==0;)n.remove(0);t.setValue(e,{value:null,items:[]}),l=o(!1)},insert(p){const{index:b,displayValue:w,exportValue:v}=p.detail.insert,x=n.children[b],E=document.createElement("option");E.textContent=w,E.value=v,x?x.before(E):n.append(E),t.setValue(e,{value:o(!0),items:h(p)}),l=o(!1)},items(p){const{items:b}=p.detail;for(;n.length!==0;)n.remove(0);for(const w of b){const{displayValue:v,exportValue:x}=w,E=document.createElement("option");E.textContent=v,E.value=x,n.append(E)}n.options.length>0&&(n.options[0].selected=!0),t.setValue(e,{value:o(!0),items:h(p)}),l=o(!1)},indices(p){const b=new Set(p.detail.indices);for(const w of p.target.options)w.selected=b.has(w.index);t.setValue(e,{value:o(!0)}),l=o(!1)},editable(p){p.target.disabled=!p.detail.editable}};this._dispatchEventFromSandbox(u,c)}),n.addEventListener("input",c=>{const u=o(!0),p=o(!1);t.setValue(e,{value:u}),c.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:l,change:p,changeEx:u,willCommit:!1,commitKey:1,keyDown:!1}})}),this._setEventListeners(n,null,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],c=>c.target.value)):n.addEventListener("input",function(c){t.setValue(e,{value:o(!0)})}),this.data.combo&&this._setTextStyle(n),this._setBackgroundColor(n),this._setDefaultPropertiesFromJS(n),this.container.append(n),this.container}}class yo extends Wt{constructor(t){const{data:e,elements:i,parent:n}=t,s=!!n._commentManager;if(super(t,{isRenderable:!s&&Wt._hasPopupData(e)}),this.elements=i,s&&Wt._hasPopupData(e)){const r=this.popup=this.#t();for(const o of i)o.popup=r}else this.popup=null}#t(){return new yu({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate||this.data.creationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open,commentManager:this.parent._commentManager})}render(){const{container:t}=this;t.classList.add("popupAnnotation"),t.role="comment";const e=this.popup=this.#t(),i=[];for(const n of this.elements)n.popup=e,n.container.ariaHasPopup="dialog",i.push(n.data.id),n.addHighlightArea();return this.container.setAttribute("aria-controls",i.map(n=>`${Sn}${n}`).join(",")),this.container}}class yu{#t=null;#e=this.#G.bind(this);#n=this.#U.bind(this);#i=this.#I.bind(this);#o=this.#E.bind(this);#r=null;#s=null;#a=null;#h=null;#l=null;#u=null;#d=null;#f=!1;#m=null;#g=null;#c=null;#p=null;#b=null;#w=null;#y=null;#C=null;#S=null;#A=null;#P=!1;#v=null;#x=null;constructor({container:t,color:e,elements:i,titleObj:n,modificationDate:s,contentsObj:r,richText:o,parent:l,rect:h,parentRect:c,open:u,commentManager:p=null}){this.#s=t,this.#S=n,this.#a=r,this.#C=o,this.#u=l,this.#r=e,this.#y=h,this.#d=c,this.#l=i,this.#t=p,this.#v=i[0],this.#h=co.toDateObject(s),this.trigger=i.flatMap(b=>b.getElementsToTriggerPopup()),p||(this.#k(),this.#s.hidden=!0,u&&this.#E())}#k(){if(this.#g)return;this.#g=new AbortController;const{signal:t}=this.#g;for(const e of this.trigger)e.addEventListener("click",this.#o,{signal:t}),e.addEventListener("pointerenter",this.#i,{signal:t}),e.addEventListener("pointerleave",this.#n,{signal:t}),e.classList.add("popupTriggerArea");for(const e of this.#l)e.container?.addEventListener("keydown",this.#e,{signal:t})}#T(){const t=this.#l.find(e=>e.hasCommentButton);t&&(this.#b=t._normalizePoint(t.commentButtonPosition))}renderCommentButton(){if(this.#p){this.#p.parentNode||this.#v.container.after(this.#p);return}if(this.#b||this.#T(),!this.#b)return;const{signal:t}=this.#g=new AbortController,e=this.#v.hasOwnCommentButton,i=()=>{this.#t.toggleCommentPopup(this,!0,void 0,!e)},n=()=>{this.#t.toggleCommentPopup(this,!1,!0,!e)},s=()=>{this.#t.toggleCommentPopup(this,!1,!1)};if(e){this.#p=this.#v.container;for(const r of this.trigger)r.ariaHasPopup="dialog",r.ariaControls="commentPopup",r.addEventListener("keydown",this.#e,{signal:t}),r.addEventListener("click",i,{signal:t}),r.addEventListener("pointerenter",n,{signal:t}),r.addEventListener("pointerleave",s,{signal:t}),r.classList.add("popupTriggerArea")}else{const r=this.#p=document.createElement("button");r.className="annotationCommentButton";const o=this.#v.container;r.style.zIndex=o.style.zIndex+1,r.tabIndex=0,r.ariaHasPopup="dialog",r.ariaControls="commentPopup",r.setAttribute("data-l10n-id","pdfjs-show-comment-button"),this.#N(),this.#D(),r.addEventListener("keydown",this.#e,{signal:t}),r.addEventListener("click",i,{signal:t}),r.addEventListener("pointerenter",n,{signal:t}),r.addEventListener("pointerleave",s,{signal:t}),o.after(r)}}#D(){if(this.#v.extraPopupElement&&!this.#v.editor)return;this.#p||this.renderCommentButton();const[t,e]=this.#b,{style:i}=this.#p;i.left=`calc(${t}%)`,i.top=`calc(${e}% - var(--comment-button-dim))`}#N(){this.#v.extraPopupElement||(this.#p||this.renderCommentButton(),this.#p.style.backgroundColor=this.commentButtonColor||"")}get commentButtonColor(){const{color:t,opacity:e}=this.#v.commentData;return t?this.#u._commentManager.makeCommentColor(t,e):null}focusCommentButton(){setTimeout(()=>{this.#p?.focus()},0)}getData(){const{richText:t,color:e,opacity:i,creationDate:n,modificationDate:s}=this.#v.commentData;return{contentsObj:{str:this.comment},richText:t,color:e,opacity:i,creationDate:n,modificationDate:s}}get elementBeforePopup(){return this.#p}get comment(){return this.#x||=this.#v.commentText,this.#x}set comment(t){t!==this.comment&&(this.#v.commentText=this.#x=t)}focus(){this.#v.container?.focus()}get parentBoundingClientRect(){return this.#v.layer.getBoundingClientRect()}setCommentButtonStates({selected:t,hasPopup:e}){this.#p&&(this.#p.classList.toggle("selected",t),this.#p.ariaExpanded=e)}setSelectedCommentButton(t){this.#p.classList.toggle("selected",t)}get commentPopupPosition(){if(this.#w)return this.#w;const{x:t,y:e,height:i}=this.#p.getBoundingClientRect(),{x:n,y:s,width:r,height:o}=this.#v.layer.getBoundingClientRect();return[(t-n)/r,(e+i-s)/o]}set commentPopupPosition(t){this.#w=t}hasDefaultPopupPosition(){return this.#w===null}get commentButtonPosition(){return this.#b}get commentButtonWidth(){return this.#p.getBoundingClientRect().width/this.parentBoundingClientRect.width}editComment(t){const[e,i]=this.#w||this.commentButtonPosition.map(h=>h/100),n=this.parentBoundingClientRect,{x:s,y:r,width:o,height:l}=n;this.#t.showDialog(null,this,s+e*o,r+i*l,{...t,parentDimensions:n})}render(){if(this.#m)return;const t=this.#m=document.createElement("div");if(t.className="popup",this.#r){const i=t.style.outlineColor=J.makeHexColor(...this.#r);t.style.backgroundColor=`color-mix(in srgb, ${i} 30%, white)`}const e=document.createElement("span");if(e.className="header",this.#S?.str){const i=document.createElement("span");i.className="title",e.append(i),{dir:i.dir,str:i.textContent}=this.#S}if(t.append(e),this.#h){const i=document.createElement("time");i.className="popupDate",i.setAttribute("data-l10n-id","pdfjs-annotation-date-time-string"),i.setAttribute("data-l10n-args",JSON.stringify({dateObj:this.#h.valueOf()})),i.dateTime=this.#h.toISOString(),e.append(i)}Rl({html:this.#M||this.#a.str,dir:this.#a?.dir,className:"popupContent"},t),this.#s.append(t)}get#M(){const t=this.#C,e=this.#a;return t?.str&&(!e?.str||e.str===t.str)&&this.#C.html||null}get#L(){return this.#M?.attributes?.style?.fontSize||0}get#B(){return this.#M?.attributes?.style?.color||null}#R(t){const e=[],i={str:t,html:{name:"div",attributes:{dir:"auto"},children:[{name:"p",children:e}]}},n={style:{color:this.#B,fontSize:this.#L?`calc(${this.#L}px * var(--total-scale-factor))`:""}};for(const s of t.split(`
`))e.push({name:"span",value:s,attributes:n});return i}#G(t){t.altKey||t.shiftKey||t.ctrlKey||t.metaKey||(t.key==="Enter"||t.key==="Escape"&&this.#f)&&this.#E()}updateEdited({rect:t,popup:e,deleted:i}){if(this.#t){i?(this.remove(),this.#x=null):e&&(e.deleted?this.remove():(this.#N(),this.#x=e.text)),t&&(this.#b=null,this.#T(),this.#D());return}if(i||e?.deleted){this.remove();return}this.#k(),this.#A||={contentsObj:this.#a,richText:this.#C},t&&(this.#c=null),e&&e.text&&(this.#C=this.#R(e.text),this.#h=co.toDateObject(e.date),this.#a=null),this.#m?.remove(),this.#m=null}resetEdited(){this.#A&&({contentsObj:this.#a,richText:this.#C}=this.#A,this.#A=null,this.#m?.remove(),this.#m=null,this.#c=null)}remove(){if(this.#g?.abort(),this.#g=null,this.#m?.remove(),this.#m=null,this.#P=!1,this.#f=!1,this.#p?.remove(),this.#p=null,this.trigger)for(const t of this.trigger)t.classList.remove("popupTriggerArea")}#_(){if(this.#c!==null)return;const{page:{view:t},viewport:{rawDims:{pageWidth:e,pageHeight:i,pageX:n,pageY:s}}}=this.#u;let r=!!this.#d,o=r?this.#d:this.#y;for(const w of this.#l)if(!o||J.intersect(w.data.rect,o)!==null){o=w.data.rect,r=!0;break}const l=J.normalizeRect([o[0],t[3]-o[1]+t[1],o[2],t[3]-o[3]+t[1]]),c=r?o[2]-o[0]+5:0,u=l[0]+c,p=l[1];this.#c=[100*(u-n)/e,100*(p-s)/i];const{style:b}=this.#s;b.left=`${this.#c[0]}%`,b.top=`${this.#c[1]}%`}#E(){if(this.#t){this.#t.toggleCommentPopup(this,!1);return}this.#f=!this.#f,this.#f?(this.#I(),this.#s.addEventListener("click",this.#o),this.#s.addEventListener("keydown",this.#e)):(this.#U(),this.#s.removeEventListener("click",this.#o),this.#s.removeEventListener("keydown",this.#e))}#I(){this.#m||this.render(),this.isVisible?this.#f&&this.#s.classList.add("focused"):(this.#_(),this.#s.hidden=!1,this.#s.style.zIndex=parseInt(this.#s.style.zIndex)+1e3)}#U(){this.#s.classList.remove("focused"),!(this.#f||!this.isVisible)&&(this.#s.hidden=!0,this.#s.style.zIndex=parseInt(this.#s.style.zIndex)-1e3)}forceHide(){this.#P=this.isVisible,this.#P&&(this.#s.hidden=!0)}maybeShow(){this.#t||(this.#k(),this.#P&&(this.#m||this.#I(),this.#P=!1,this.#s.hidden=!1))}get isVisible(){return this.#t?!1:this.#s.hidden===!1}}class nh extends Wt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0}),this.textContent=t.data.textContent,this.textPosition=t.data.textPosition,this.annotationEditorType=gt.FREETEXT}render(){if(this.container.classList.add("freeTextAnnotation"),this.textContent){const t=this.contentElement=document.createElement("div");t.classList.add("annotationTextContent"),t.setAttribute("role","comment");for(const e of this.textContent){const i=document.createElement("span");i.textContent=e,t.append(i)}this.container.append(t)}return!this.data.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this._editOnDoubleClick(),this.container}}class wu extends Wt{#t=null;constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("lineAnnotation");const{data:t,width:e,height:i}=this,n=this.svgFactory.create(e,i,!0),s=this.#t=this.svgFactory.createElement("svg:line");return s.setAttribute("x1",t.rect[2]-t.lineCoordinates[0]),s.setAttribute("y1",t.rect[3]-t.lineCoordinates[1]),s.setAttribute("x2",t.rect[2]-t.lineCoordinates[2]),s.setAttribute("y2",t.rect[3]-t.lineCoordinates[3]),s.setAttribute("stroke-width",t.borderStyle.width||1),s.setAttribute("stroke","transparent"),s.setAttribute("fill","transparent"),n.append(s),this.container.append(n),!t.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}}class vu extends Wt{#t=null;constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("squareAnnotation");const{data:t,width:e,height:i}=this,n=this.svgFactory.create(e,i,!0),s=t.borderStyle.width,r=this.#t=this.svgFactory.createElement("svg:rect");return r.setAttribute("x",s/2),r.setAttribute("y",s/2),r.setAttribute("width",e-s),r.setAttribute("height",i-s),r.setAttribute("stroke-width",s||1),r.setAttribute("stroke","transparent"),r.setAttribute("fill","transparent"),n.append(r),this.container.append(n),!t.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}}class Au extends Wt{#t=null;constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("circleAnnotation");const{data:t,width:e,height:i}=this,n=this.svgFactory.create(e,i,!0),s=t.borderStyle.width,r=this.#t=this.svgFactory.createElement("svg:ellipse");return r.setAttribute("cx",e/2),r.setAttribute("cy",i/2),r.setAttribute("rx",e/2-s/2),r.setAttribute("ry",i/2-s/2),r.setAttribute("stroke-width",s||1),r.setAttribute("stroke","transparent"),r.setAttribute("fill","transparent"),n.append(r),this.container.append(n),!t.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}}class sh extends Wt{#t=null;constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0}),this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);const{data:{rect:t,vertices:e,borderStyle:i,popupRef:n},width:s,height:r}=this;if(!e)return this.container;const o=this.svgFactory.create(s,r,!0);let l=[];for(let c=0,u=e.length;c<u;c+=2){const p=e[c]-t[0],b=t[3]-e[c+1];l.push(`${p},${b}`)}l=l.join(" ");const h=this.#t=this.svgFactory.createElement(this.svgElementName);return h.setAttribute("points",l),h.setAttribute("stroke-width",i.width||1),h.setAttribute("stroke","transparent"),h.setAttribute("fill","transparent"),o.append(h),this.container.append(o),!n&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}}class Eu extends sh{constructor(t){super(t),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}}class Su extends Wt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("caretAnnotation"),!this.data.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container}}class Ho extends Wt{#t=null;#e=[];constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0}),this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline",this.annotationEditorType=this.data.it==="InkHighlight"?gt.HIGHLIGHT:gt.INK}#n(t,e){switch(t){case 90:return{transform:`rotate(90) translate(${-e[0]},${e[1]}) scale(1,-1)`,width:e[3]-e[1],height:e[2]-e[0]};case 180:return{transform:`rotate(180) translate(${-e[2]},${e[1]}) scale(1,-1)`,width:e[2]-e[0],height:e[3]-e[1]};case 270:return{transform:`rotate(270) translate(${-e[2]},${e[3]}) scale(1,-1)`,width:e[3]-e[1],height:e[2]-e[0]};default:return{transform:`translate(${-e[0]},${e[3]}) scale(1,-1)`,width:e[2]-e[0],height:e[3]-e[1]}}}render(){this.container.classList.add(this.containerClassName);const{data:{rect:t,rotation:e,inkLists:i,borderStyle:n,popupRef:s}}=this,{transform:r,width:o,height:l}=this.#n(e,t),h=this.svgFactory.create(o,l,!0),c=this.#t=this.svgFactory.createElement("svg:g");h.append(c),c.setAttribute("stroke-width",n.width||1),c.setAttribute("stroke-linecap","round"),c.setAttribute("stroke-linejoin","round"),c.setAttribute("stroke-miterlimit",10),c.setAttribute("stroke","transparent"),c.setAttribute("fill","transparent"),c.setAttribute("transform",r);for(let u=0,p=i.length;u<p;u++){const b=this.svgFactory.createElement(this.svgElementName);this.#e.push(b),b.setAttribute("points",i[u].join(",")),c.append(b)}return!s&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.append(h),this._editOnDoubleClick(),this.container}updateEdited(t){super.updateEdited(t);const{thickness:e,points:i,rect:n}=t,s=this.#t;if(e>=0&&s.setAttribute("stroke-width",e||1),i)for(let r=0,o=this.#e.length;r<o;r++)this.#e[r].setAttribute("points",i[r].join(","));if(n){const{transform:r,width:o,height:l}=this.#n(this.data.rotation,n);s.parentElement.setAttribute("viewBox",`0 0 ${o} ${l}`),s.setAttribute("transform",r)}}getElementsToTriggerPopup(){return this.#e}addHighlightArea(){this.container.classList.add("highlightArea")}}class rh extends Wt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0}),this.annotationEditorType=gt.HIGHLIGHT}render(){const{data:{overlaidText:t,popupRef:e}}=this;if(!e&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.classList.add("highlightAnnotation"),this._editOnDoubleClick(),t){const i=document.createElement("mark");i.classList.add("overlaidText"),i.textContent=t,this.container.append(i)}return this.container}}class xu extends Wt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){const{data:{overlaidText:t,popupRef:e}}=this;if(!e&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.classList.add("underlineAnnotation"),t){const i=document.createElement("u");i.classList.add("overlaidText"),i.textContent=t,this.container.append(i)}return this.container}}class Cu extends Wt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){const{data:{overlaidText:t,popupRef:e}}=this;if(!e&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.classList.add("squigglyAnnotation"),t){const i=document.createElement("u");i.classList.add("overlaidText"),i.textContent=t,this.container.append(i)}return this.container}}class _u extends Wt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){const{data:{overlaidText:t,popupRef:e}}=this;if(!e&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.classList.add("strikeoutAnnotation"),t){const i=document.createElement("s");i.classList.add("overlaidText"),i.textContent=t,this.container.append(i)}return this.container}}class oh extends Wt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0}),this.annotationEditorType=gt.STAMP}render(){return this.container.classList.add("stampAnnotation"),this.container.setAttribute("role","img"),!this.data.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this._editOnDoubleClick(),this.container}}class Pu extends Wt{#t=null;constructor(t){super(t,{isRenderable:!0});const{file:e}=this.data;this.filename=e.filename,this.content=e.content,this.linkService.eventBus?.dispatch("fileattachmentannotation",{source:this,...e})}render(){this.container.classList.add("fileAttachmentAnnotation");const{container:t,data:e}=this;let i;e.hasAppearance||e.fillAlpha===0?i=document.createElement("div"):(i=document.createElement("img"),i.src=`${this.imageResourcesPath}annotation-${/paperclip/i.test(e.name)?"paperclip":"pushpin"}.svg`,e.fillAlpha&&e.fillAlpha<1&&(i.style=`filter: opacity(${Math.round(e.fillAlpha*100)}%);`)),i.addEventListener("dblclick",this.#e.bind(this)),this.#t=i;const{isMac:n}=fe.platform;return t.addEventListener("keydown",s=>{s.key==="Enter"&&(n?s.metaKey:s.ctrlKey)&&this.#e()}),!e.popupRef&&this.hasPopupData?(this.hasOwnCommentButton=!0,this._createPopup()):i.classList.add("popupTriggerArea"),t.append(i),t}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}#e(){this.downloadManager?.openOrDownloadData(this.content,this.filename)}}class jo{#t=null;#e=null;#n=null;#i=new Map;#o=null;#r=null;#s=[];#a=!1;constructor({div:t,accessibilityManager:e,annotationCanvasMap:i,annotationEditorUIManager:n,page:s,viewport:r,structTreeLayer:o,commentManager:l,linkService:h,annotationStorage:c}){this.div=t,this.#t=e,this.#e=i,this.#o=o||null,this.#r=h||null,this.#n=c||new Ro,this.page=s,this.viewport=r,this.zIndex=0,this._annotationEditorUIManager=n,this._commentManager=l||null}hasEditableAnnotations(){return this.#i.size>0}async render(t){const{annotations:e}=t,i=this.div;on(i,this.viewport);const n=new Map,s=[],r={data:null,layer:i,linkService:this.#r,downloadManager:t.downloadManager,imageResourcesPath:t.imageResourcesPath||"",renderForms:t.renderForms!==!1,svgFactory:new ir,annotationStorage:this.#n,enableComment:t.enableComment===!0,enableScripting:t.enableScripting===!0,hasJSActions:t.hasJSActions,fieldObjects:t.fieldObjects,parent:this,elements:null};for(const o of e){if(o.noHTML)continue;const l=o.annotationType===ae.POPUP;if(l){const u=n.get(o.id);if(!u)continue;if(!this._commentManager){s.push(o);continue}r.elements=u}else if(o.rect[2]===o.rect[0]||o.rect[3]===o.rect[1])continue;r.data=o;const h=Gr.create(r);if(!h.isRenderable)continue;if(!l&&(this.#s.push(h),o.popupRef)){const u=n.get(o.popupRef);u?u.push(h):n.set(o.popupRef,[h])}const c=h.render();o.hidden&&(c.style.visibility="hidden"),h._isEditable&&(this.#i.set(h.data.id,h),this._annotationEditorUIManager?.renderAnnotationElement(h))}await this.#h();for(const o of s){const l=r.elements=n.get(o.id);r.data=o;const h=Gr.create(r);if(!h.isRenderable)continue;const c=h.render();h.contentElement.id=`${Sn}${o.id}`,o.hidden&&(c.style.visibility="hidden"),l.at(-1).container.after(c)}this.#l()}async#h(){if(this.#s.length===0)return;this.div.replaceChildren();const t=[];if(!this.#a){this.#a=!0;for(const{contentElement:i,data:{id:n}}of this.#s){const s=i.id=`${Sn}${n}`;t.push(this.#o?.getAriaAttributes(s).then(r=>{if(r)for(const[o,l]of r)i.setAttribute(o,l)}))}}this.#s.sort(({data:{rect:[i,n,s,r]}},{data:{rect:[o,l,h,c]}})=>{if(i===s&&n===r)return 1;if(o===h&&l===c)return-1;const u=r,p=n,b=(n+r)/2,w=c,v=l,x=(l+c)/2;if(b>=w&&x<=p)return-1;if(x>=u&&b<=v)return 1;const E=(i+s)/2,D=(o+h)/2;return E-D});const e=document.createDocumentFragment();for(const i of this.#s)e.append(i.container),this._commentManager?(i.extraPopupElement?.popup||i.popup)?.renderCommentButton():i.extraPopupElement&&e.append(i.extraPopupElement.render());if(this.div.append(e),await Promise.all(t),this.#t)for(const i of this.#s)this.#t.addPointerInTextLayer(i.contentElement,!1)}async addLinkAnnotations(t){const e={data:null,layer:this.div,linkService:this.#r,svgFactory:new ir,parent:this};for(const i of t){i.borderStyle||=jo._defaultBorderStyle,e.data=i;const n=Gr.create(e);n.isRenderable&&(n.render(),n.contentElement.id=`${Sn}${i.id}`,this.#s.push(n))}await this.#h()}update({viewport:t}){const e=this.div;this.viewport=t,on(e,{rotation:t.rotation}),this.#l(),e.hidden=!1}#l(){if(!this.#e)return;const t=this.div;for(const[e,i]of this.#e){const n=t.querySelector(`[data-annotation-id="${e}"]`);if(!n)continue;i.className="annotationContent";const{firstChild:s}=n;s?s.nodeName==="CANVAS"?s.replaceWith(i):s.classList.contains("annotationContent")?s.after(i):s.before(i):n.append(i);const r=this.#i.get(e);r&&(r._hasNoCanvas?(this._annotationEditorUIManager?.setMissingCanvas(e,n.id,i),r._hasNoCanvas=!1):r.canvas=i)}this.#e.clear()}getEditableAnnotations(){return Array.from(this.#i.values())}getEditableAnnotation(t){return this.#i.get(t)}addFakeAnnotation(t){const{div:e}=this,{id:i,rotation:n}=t,s=new du({data:{id:i,rect:t.getPDFRect(),rotation:n},editor:t,layer:e,parent:this,enableComment:!!this._commentManager,linkService:this.#r,annotationStorage:this.#n});return s.render(),s.contentElement.id=`${Sn}${i}`,s.createOrUpdatePopup(),this.#s.push(s),s}removeAnnotation(t){const e=this.#s.findIndex(n=>n.data.id===t);if(e<0)return;const[i]=this.#s.splice(e,1);this.#t?.removePointerInTextLayer(i.contentElement)}updateFakeAnnotations(t){if(t.length!==0){for(const e of t)e.updateFakeAnnotationElement(this);this.#h()}}togglePointerEvents(t=!1){this.div.classList.toggle("disabled",!t)}static get _defaultBorderStyle(){return pt(this,"_defaultBorderStyle",Object.freeze({width:1,rawWidth:1,style:wn.SOLID,dashArray:[3],horizontalCornerRadius:0,verticalCornerRadius:0}))}}const Ns=/\r\n?|\n/g;class ge extends nt{#t="";#e=`${this.id}-editor`;#n=null;#i;_colorPicker=null;static _freeTextDefaultContent="";static _internalPadding=0;static _defaultColor=null;static _defaultFontSize=10;static get _keyboardManager(){const t=ge.prototype,e=s=>s.isEmpty(),i=Wi.TRANSLATE_SMALL,n=Wi.TRANSLATE_BIG;return pt(this,"_keyboardManager",new vs([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],t.commitOrRemove,{bubbles:!0}],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],t.commitOrRemove],[["ArrowLeft","mac+ArrowLeft"],t._translateEmpty,{args:[-i,0],checker:e}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t._translateEmpty,{args:[-n,0],checker:e}],[["ArrowRight","mac+ArrowRight"],t._translateEmpty,{args:[i,0],checker:e}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t._translateEmpty,{args:[n,0],checker:e}],[["ArrowUp","mac+ArrowUp"],t._translateEmpty,{args:[0,-i],checker:e}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t._translateEmpty,{args:[0,-n],checker:e}],[["ArrowDown","mac+ArrowDown"],t._translateEmpty,{args:[0,i],checker:e}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t._translateEmpty,{args:[0,n],checker:e}]]))}static _type="freetext";static _editorType=gt.FREETEXT;constructor(t){super({...t,name:"freeTextEditor"}),this.color=t.color||ge._defaultColor||nt._defaultLineColor,this.#i=t.fontSize||ge._defaultFontSize,this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-freetext-added-alert"),this.canAddComment=!1}static initialize(t,e){nt.initialize(t,e);const i=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(i.getPropertyValue("--freetext-padding"))}static updateDefaultParams(t,e){switch(t){case Et.FREETEXT_SIZE:ge._defaultFontSize=e;break;case Et.FREETEXT_COLOR:ge._defaultColor=e;break}}updateParams(t,e){switch(t){case Et.FREETEXT_SIZE:this.#o(e);break;case Et.FREETEXT_COLOR:this.#r(e);break}}static get defaultPropertiesToUpdate(){return[[Et.FREETEXT_SIZE,ge._defaultFontSize],[Et.FREETEXT_COLOR,ge._defaultColor||nt._defaultLineColor]]}get propertiesToUpdate(){return[[Et.FREETEXT_SIZE,this.#i],[Et.FREETEXT_COLOR,this.color]]}get toolbarButtons(){return this._colorPicker||=new us(this),[["colorPicker",this._colorPicker]]}get colorType(){return Et.FREETEXT_COLOR}#o(t){const e=n=>{this.editorDiv.style.fontSize=`calc(${n}px * var(--total-scale-factor))`,this.translate(0,-(n-this.#i)*this.parentScale),this.#i=n,this.#a()},i=this.#i;this.addCommands({cmd:e.bind(this,t),undo:e.bind(this,i),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Et.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})}onUpdatedColor(){this.editorDiv.style.color=this.color,this._colorPicker?.update(this.color),super.onUpdatedColor()}#r(t){const e=n=>{this.color=n,this.onUpdatedColor()},i=this.color;this.addCommands({cmd:e.bind(this,t),undo:e.bind(this,i),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Et.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})}_translateEmpty(t,e){this._uiManager.translateSelectedEditors(t,e,!0)}getInitialTranslation(){const t=this.parentScale;return[-ge._internalPadding*t,-(ge._internalPadding+this.#i)*t]}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.isAttachedToDOM||this.parent.add(this)))}enableEditMode(){if(!super.enableEditMode())return!1;this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this._isDraggable=!1,this.div.removeAttribute("aria-activedescendant"),this.#n=new AbortController;const t=this._uiManager.combinedSignal(this.#n);return this.editorDiv.addEventListener("keydown",this.editorDivKeydown.bind(this),{signal:t}),this.editorDiv.addEventListener("focus",this.editorDivFocus.bind(this),{signal:t}),this.editorDiv.addEventListener("blur",this.editorDivBlur.bind(this),{signal:t}),this.editorDiv.addEventListener("input",this.editorDivInput.bind(this),{signal:t}),this.editorDiv.addEventListener("paste",this.editorDivPaste.bind(this),{signal:t}),!0}disableEditMode(){return super.disableEditMode()?(this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",this.#e),this._isDraggable=!0,this.#n?.abort(),this.#n=null,this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freetextEditing"),!0):!1}focusin(t){this._focusEventsAllowed&&(super.focusin(t),t.target!==this.editorDiv&&this.editorDiv.focus())}onceAdded(t){this.width||(this.enableEditMode(),t&&this.editorDiv.focus(),this._initialOptions?.isCentered&&this.center(),this._initialOptions=null)}isEmpty(){return!this.editorDiv||this.editorDiv.innerText.trim()===""}remove(){this.isEditing=!1,this.parent&&(this.parent.setEditingState(!0),this.parent.div.classList.add("freetextEditing")),super.remove()}#s(){const t=[];this.editorDiv.normalize();let e=null;for(const i of this.editorDiv.childNodes)e?.nodeType===Node.TEXT_NODE&&i.nodeName==="BR"||(t.push(ge.#h(i)),e=i);return t.join(`
`)}#a(){const[t,e]=this.parentDimensions;let i;if(this.isAttachedToDOM)i=this.div.getBoundingClientRect();else{const{currentLayer:n,div:s}=this,r=s.style.display,o=s.classList.contains("hidden");s.classList.remove("hidden"),s.style.display="hidden",n.div.append(this.div),i=s.getBoundingClientRect(),s.remove(),s.style.display=r,s.classList.toggle("hidden",o)}this.rotation%180===this.parentRotation%180?(this.width=i.width/t,this.height=i.height/e):(this.width=i.height/t,this.height=i.width/e),this.fixAndSetPosition()}commit(){if(!this.isInEditMode())return;super.commit(),this.disableEditMode();const t=this.#t,e=this.#t=this.#s().trimEnd();if(t===e)return;const i=n=>{if(this.#t=n,!n){this.remove();return}this.#l(),this._uiManager.rebuild(this),this.#a()};this.addCommands({cmd:()=>{i(e)},undo:()=>{i(t)},mustExec:!1}),this.#a()}shouldGetKeyboardEvents(){return this.isInEditMode()}enterInEditMode(){this.enableEditMode(),this.editorDiv.focus()}keydown(t){t.target===this.div&&t.key==="Enter"&&(this.enterInEditMode(),t.preventDefault())}editorDivKeydown(t){ge._keyboardManager.exec(this,t)}editorDivFocus(t){this.isEditing=!0}editorDivBlur(t){this.isEditing=!1}editorDivInput(t){this.parent.div.classList.toggle("freetextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}get canChangeContent(){return!0}render(){if(this.div)return this.div;let t,e;(this._isCopy||this.annotationElementId)&&(t=this.x,e=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",this.#e),this.editorDiv.setAttribute("data-l10n-id","pdfjs-free-text2"),this.editorDiv.setAttribute("data-l10n-attrs","default-content"),this.enableEditing(),this.editorDiv.contentEditable=!0;const{style:i}=this.editorDiv;if(i.fontSize=`calc(${this.#i}px * var(--total-scale-factor))`,i.color=this.color,this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),this._isCopy||this.annotationElementId){const[n,s]=this.parentDimensions;if(this.annotationElementId){const{position:r}=this._initialData;let[o,l]=this.getInitialTranslation();[o,l]=this.pageTranslationToScreen(o,l);const[h,c]=this.pageDimensions,[u,p]=this.pageTranslation;let b,w;switch(this.rotation){case 0:b=t+(r[0]-u)/h,w=e+this.height-(r[1]-p)/c;break;case 90:b=t+(r[0]-u)/h,w=e-(r[1]-p)/c,[o,l]=[l,-o];break;case 180:b=t-this.width+(r[0]-u)/h,w=e-(r[1]-p)/c,[o,l]=[-o,-l];break;case 270:b=t+(r[0]-u-this.height*c)/h,w=e+(r[1]-p-this.width*h)/c,[o,l]=[-l,o];break}this.setAt(b*n,w*s,o,l)}else this._moveAfterPaste(t,e);this.#l(),this._isDraggable=!0,this.editorDiv.contentEditable=!1}else this._isDraggable=!1,this.editorDiv.contentEditable=!0;return this.div}static#h(t){return(t.nodeType===Node.TEXT_NODE?t.nodeValue:t.innerText).replaceAll(Ns,"")}editorDivPaste(t){const e=t.clipboardData||window.clipboardData,{types:i}=e;if(i.length===1&&i[0]==="text/plain")return;t.preventDefault();const n=ge.#d(e.getData("text")||"").replaceAll(Ns,`
`);if(!n)return;const s=window.getSelection();if(!s.rangeCount)return;this.editorDiv.normalize(),s.deleteFromDocument();const r=s.getRangeAt(0);if(!n.includes(`
`)){r.insertNode(document.createTextNode(n)),this.editorDiv.normalize(),s.collapseToStart();return}const{startContainer:o,startOffset:l}=r,h=[],c=[];if(o.nodeType===Node.TEXT_NODE){const b=o.parentElement;if(c.push(o.nodeValue.slice(l).replaceAll(Ns,"")),b!==this.editorDiv){let w=h;for(const v of this.editorDiv.childNodes){if(v===b){w=c;continue}w.push(ge.#h(v))}}h.push(o.nodeValue.slice(0,l).replaceAll(Ns,""))}else if(o===this.editorDiv){let b=h,w=0;for(const v of this.editorDiv.childNodes)w++===l&&(b=c),b.push(ge.#h(v))}this.#t=`${h.join(`
`)}${n}${c.join(`
`)}`,this.#l();const u=new Range;let p=Math.sumPrecise(h.map(b=>b.length));for(const{firstChild:b}of this.editorDiv.childNodes)if(b.nodeType===Node.TEXT_NODE){const w=b.nodeValue.length;if(p<=w){u.setStart(b,p),u.setEnd(b,p);break}p-=w}s.removeAllRanges(),s.addRange(u)}#l(){if(this.editorDiv.replaceChildren(),!!this.#t)for(const t of this.#t.split(`
`)){const e=document.createElement("div");e.append(t?document.createTextNode(t):document.createElement("br")),this.editorDiv.append(e)}}#u(){return this.#t.replaceAll(""," ")}static#d(t){return t.replaceAll(" ","")}get contentDiv(){return this.editorDiv}getPDFRect(){const t=ge._internalPadding*this.parentScale;return this.getRect(t,t)}static async deserialize(t,e,i){let n=null;if(t instanceof nh){const{data:{defaultAppearanceData:{fontSize:r,fontColor:o},rect:l,rotation:h,id:c,popupRef:u,richText:p,contentsObj:b,creationDate:w,modificationDate:v},textContent:x,textPosition:E,parent:{page:{pageNumber:D}}}=t;if(!x||x.length===0)return null;n=t={annotationType:gt.FREETEXT,color:Array.from(o),fontSize:r,value:x.join(`
`),position:E,pageIndex:D-1,rect:l.slice(0),rotation:h,annotationElementId:c,id:c,deleted:!1,popupRef:u,comment:b?.str||null,richText:p,creationDate:w,modificationDate:v}}const s=await super.deserialize(t,e,i);return s.#i=t.fontSize,s.color=J.makeHexColor(...t.color),s.#t=ge.#d(t.value),s._initialData=n,t.comment&&s.setCommentData(t),s}serialize(t=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const e=nt._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:this.color),i=Object.assign(super.serialize(t),{color:e,fontSize:this.#i,value:this.#u()});return this.addComment(i),t?(i.isCopy=!0,i):this.annotationElementId&&!this.#f(i)?null:(i.id=this.annotationElementId,i)}#f(t){const{value:e,fontSize:i,color:n,pageIndex:s}=this._initialData;return this.hasEditedComment||this._hasBeenMoved||t.value!==e||t.fontSize!==i||t.color.some((r,o)=>r!==n[o])||t.pageIndex!==s}renderAnnotationElement(t){const e=super.renderAnnotationElement(t);if(!e)return null;const{style:i}=e;i.fontSize=`calc(${this.#i}px * var(--total-scale-factor))`,i.color=this.color,e.replaceChildren();for(const n of this.#t.split(`
`)){const s=document.createElement("div");s.append(n?document.createTextNode(n):document.createElement("br")),e.append(s)}return t.updateEdited({rect:this.getPDFRect(),popup:this._uiManager.hasCommentManager()||this.hasEditedComment?this.comment:{text:this.#t}}),e}resetAnnotationElement(t){super.resetAnnotationElement(t),t.resetEdited()}}class tt{static PRECISION=1e-4;toSVGPath(){Rt("Abstract method `toSVGPath` must be implemented.")}get box(){Rt("Abstract getter `box` must be implemented.")}serialize(t,e){Rt("Abstract method `serialize` must be implemented.")}static _rescale(t,e,i,n,s,r){r||=new Float32Array(t.length);for(let o=0,l=t.length;o<l;o+=2)r[o]=e+t[o]*n,r[o+1]=i+t[o+1]*s;return r}static _rescaleAndSwap(t,e,i,n,s,r){r||=new Float32Array(t.length);for(let o=0,l=t.length;o<l;o+=2)r[o]=e+t[o+1]*n,r[o+1]=i+t[o]*s;return r}static _translate(t,e,i,n){n||=new Float32Array(t.length);for(let s=0,r=t.length;s<r;s+=2)n[s]=e+t[s],n[s+1]=i+t[s+1];return n}static svgRound(t){return Math.round(t*1e4)}static _normalizePoint(t,e,i,n,s){switch(s){case 90:return[1-e/i,t/n];case 180:return[1-t/i,1-e/n];case 270:return[e/i,1-t/n];default:return[t/i,e/n]}}static _normalizePagePoint(t,e,i){switch(i){case 90:return[1-e,t];case 180:return[1-t,1-e];case 270:return[e,1-t];default:return[t,e]}}static createBezierPoints(t,e,i,n,s,r){return[(t+5*i)/6,(e+5*n)/6,(5*i+s)/6,(5*n+r)/6,(i+s)/2,(n+r)/2]}}class en{#t;#e=[];#n;#i;#o=[];#r=new Float32Array(18);#s;#a;#h;#l;#u;#d;#f=[];static#m=8;static#g=2;static#c=en.#m+en.#g;constructor({x:t,y:e},i,n,s,r,o=0){this.#t=i,this.#d=s*n,this.#i=r,this.#r.set([NaN,NaN,NaN,NaN,t,e],6),this.#n=o,this.#l=en.#m*n,this.#h=en.#c*n,this.#u=n,this.#f.push(t,e)}isEmpty(){return isNaN(this.#r[8])}#p(){const t=this.#r.subarray(4,6),e=this.#r.subarray(16,18),[i,n,s,r]=this.#t;return[(this.#s+(t[0]-e[0])/2-i)/s,(this.#a+(t[1]-e[1])/2-n)/r,(this.#s+(e[0]-t[0])/2-i)/s,(this.#a+(e[1]-t[1])/2-n)/r]}add({x:t,y:e}){this.#s=t,this.#a=e;const[i,n,s,r]=this.#t;let[o,l,h,c]=this.#r.subarray(8,12);const u=t-h,p=e-c,b=Math.hypot(u,p);if(b<this.#h)return!1;const w=b-this.#l,v=w/b,x=v*u,E=v*p;let D=o,T=l;o=h,l=c,h+=x,c+=E,this.#f?.push(t,e);const k=-E/w,F=x/w,M=k*this.#d,O=F*this.#d;return this.#r.set(this.#r.subarray(2,8),0),this.#r.set([h+M,c+O],4),this.#r.set(this.#r.subarray(14,18),12),this.#r.set([h-M,c-O],16),isNaN(this.#r[6])?(this.#o.length===0&&(this.#r.set([o+M,l+O],2),this.#o.push(NaN,NaN,NaN,NaN,(o+M-i)/s,(l+O-n)/r),this.#r.set([o-M,l-O],14),this.#e.push(NaN,NaN,NaN,NaN,(o-M-i)/s,(l-O-n)/r)),this.#r.set([D,T,o,l,h,c],6),!this.isEmpty()):(this.#r.set([D,T,o,l,h,c],6),Math.abs(Math.atan2(T-l,D-o)-Math.atan2(E,x))<Math.PI/2?([o,l,h,c]=this.#r.subarray(2,6),this.#o.push(NaN,NaN,NaN,NaN,((o+h)/2-i)/s,((l+c)/2-n)/r),[o,l,D,T]=this.#r.subarray(14,18),this.#e.push(NaN,NaN,NaN,NaN,((D+o)/2-i)/s,((T+l)/2-n)/r),!0):([D,T,o,l,h,c]=this.#r.subarray(0,6),this.#o.push(((D+5*o)/6-i)/s,((T+5*l)/6-n)/r,((5*o+h)/6-i)/s,((5*l+c)/6-n)/r,((o+h)/2-i)/s,((l+c)/2-n)/r),[h,c,o,l,D,T]=this.#r.subarray(12,18),this.#e.push(((D+5*o)/6-i)/s,((T+5*l)/6-n)/r,((5*o+h)/6-i)/s,((5*l+c)/6-n)/r,((o+h)/2-i)/s,((l+c)/2-n)/r),!0))}toSVGPath(){if(this.isEmpty())return"";const t=this.#o,e=this.#e;if(isNaN(this.#r[6])&&!this.isEmpty())return this.#b();const i=[];i.push(`M${t[4]} ${t[5]}`);for(let n=6;n<t.length;n+=6)isNaN(t[n])?i.push(`L${t[n+4]} ${t[n+5]}`):i.push(`C${t[n]} ${t[n+1]} ${t[n+2]} ${t[n+3]} ${t[n+4]} ${t[n+5]}`);this.#y(i);for(let n=e.length-6;n>=6;n-=6)isNaN(e[n])?i.push(`L${e[n+4]} ${e[n+5]}`):i.push(`C${e[n]} ${e[n+1]} ${e[n+2]} ${e[n+3]} ${e[n+4]} ${e[n+5]}`);return this.#w(i),i.join(" ")}#b(){const[t,e,i,n]=this.#t,[s,r,o,l]=this.#p();return`M${(this.#r[2]-t)/i} ${(this.#r[3]-e)/n} L${(this.#r[4]-t)/i} ${(this.#r[5]-e)/n} L${s} ${r} L${o} ${l} L${(this.#r[16]-t)/i} ${(this.#r[17]-e)/n} L${(this.#r[14]-t)/i} ${(this.#r[15]-e)/n} Z`}#w(t){const e=this.#e;t.push(`L${e[4]} ${e[5]} Z`)}#y(t){const[e,i,n,s]=this.#t,r=this.#r.subarray(4,6),o=this.#r.subarray(16,18),[l,h,c,u]=this.#p();t.push(`L${(r[0]-e)/n} ${(r[1]-i)/s} L${l} ${h} L${c} ${u} L${(o[0]-e)/n} ${(o[1]-i)/s}`)}newFreeDrawOutline(t,e,i,n,s,r){return new ah(t,e,i,n,s,r)}getOutlines(){const t=this.#o,e=this.#e,i=this.#r,[n,s,r,o]=this.#t,l=new Float32Array((this.#f?.length??0)+2);for(let u=0,p=l.length-2;u<p;u+=2)l[u]=(this.#f[u]-n)/r,l[u+1]=(this.#f[u+1]-s)/o;if(l[l.length-2]=(this.#s-n)/r,l[l.length-1]=(this.#a-s)/o,isNaN(i[6])&&!this.isEmpty())return this.#C(l);const h=new Float32Array(this.#o.length+24+this.#e.length);let c=t.length;for(let u=0;u<c;u+=2){if(isNaN(t[u])){h[u]=h[u+1]=NaN;continue}h[u]=t[u],h[u+1]=t[u+1]}c=this.#A(h,c);for(let u=e.length-6;u>=6;u-=6)for(let p=0;p<6;p+=2){if(isNaN(e[u+p])){h[c]=h[c+1]=NaN,c+=2;continue}h[c]=e[u+p],h[c+1]=e[u+p+1],c+=2}return this.#S(h,c),this.newFreeDrawOutline(h,l,this.#t,this.#u,this.#n,this.#i)}#C(t){const e=this.#r,[i,n,s,r]=this.#t,[o,l,h,c]=this.#p(),u=new Float32Array(36);return u.set([NaN,NaN,NaN,NaN,(e[2]-i)/s,(e[3]-n)/r,NaN,NaN,NaN,NaN,(e[4]-i)/s,(e[5]-n)/r,NaN,NaN,NaN,NaN,o,l,NaN,NaN,NaN,NaN,h,c,NaN,NaN,NaN,NaN,(e[16]-i)/s,(e[17]-n)/r,NaN,NaN,NaN,NaN,(e[14]-i)/s,(e[15]-n)/r],0),this.newFreeDrawOutline(u,t,this.#t,this.#u,this.#n,this.#i)}#S(t,e){const i=this.#e;return t.set([NaN,NaN,NaN,NaN,i[4],i[5]],e),e+=6}#A(t,e){const i=this.#r.subarray(4,6),n=this.#r.subarray(16,18),[s,r,o,l]=this.#t,[h,c,u,p]=this.#p();return t.set([NaN,NaN,NaN,NaN,(i[0]-s)/o,(i[1]-r)/l,NaN,NaN,NaN,NaN,h,c,NaN,NaN,NaN,NaN,u,p,NaN,NaN,NaN,NaN,(n[0]-s)/o,(n[1]-r)/l],e),e+=24}}class ah extends tt{#t;#e=new Float32Array(4);#n;#i;#o;#r;#s;constructor(t,e,i,n,s,r){super(),this.#s=t,this.#o=e,this.#t=i,this.#r=n,this.#n=s,this.#i=r,this.firstPoint=[NaN,NaN],this.lastPoint=[NaN,NaN],this.#a(r);const[o,l,h,c]=this.#e;for(let u=0,p=t.length;u<p;u+=2)t[u]=(t[u]-o)/h,t[u+1]=(t[u+1]-l)/c;for(let u=0,p=e.length;u<p;u+=2)e[u]=(e[u]-o)/h,e[u+1]=(e[u+1]-l)/c}toSVGPath(){const t=[`M${this.#s[4]} ${this.#s[5]}`];for(let e=6,i=this.#s.length;e<i;e+=6){if(isNaN(this.#s[e])){t.push(`L${this.#s[e+4]} ${this.#s[e+5]}`);continue}t.push(`C${this.#s[e]} ${this.#s[e+1]} ${this.#s[e+2]} ${this.#s[e+3]} ${this.#s[e+4]} ${this.#s[e+5]}`)}return t.push("Z"),t.join(" ")}serialize([t,e,i,n],s){const r=i-t,o=n-e;let l,h;switch(s){case 0:l=tt._rescale(this.#s,t,n,r,-o),h=tt._rescale(this.#o,t,n,r,-o);break;case 90:l=tt._rescaleAndSwap(this.#s,t,e,r,o),h=tt._rescaleAndSwap(this.#o,t,e,r,o);break;case 180:l=tt._rescale(this.#s,i,e,-r,o),h=tt._rescale(this.#o,i,e,-r,o);break;case 270:l=tt._rescaleAndSwap(this.#s,i,n,-r,-o),h=tt._rescaleAndSwap(this.#o,i,n,-r,-o);break}return{outline:Array.from(l),points:[Array.from(h)]}}#a(t){const e=this.#s;let i=e[4],n=e[5];const s=[i,n,i,n];let r=i,o=n,l=i,h=n;const c=t?Math.max:Math.min,u=new Float32Array(4);for(let b=6,w=e.length;b<w;b+=6){const v=e[b+4],x=e[b+5];isNaN(e[b])?(J.pointBoundingBox(v,x,s),o>x?(r=v,o=x):o===x&&(r=c(r,v)),h<x?(l=v,h=x):h===x&&(l=c(l,v))):(u[0]=u[1]=1/0,u[2]=u[3]=-1/0,J.bezierBoundingBox(i,n,...e.slice(b,b+6),u),J.rectBoundingBox(u[0],u[1],u[2],u[3],s),o>u[1]?(r=u[0],o=u[1]):o===u[1]&&(r=c(r,u[0])),h<u[3]?(l=u[2],h=u[3]):h===u[3]&&(l=c(l,u[2]))),i=v,n=x}const p=this.#e;p[0]=s[0]-this.#n,p[1]=s[1]-this.#n,p[2]=s[2]-s[0]+2*this.#n,p[3]=s[3]-s[1]+2*this.#n,this.firstPoint=[r,o],this.lastPoint=[l,h]}get box(){return this.#e}newOutliner(t,e,i,n,s,r=0){return new en(t,e,i,n,s,r)}getNewOutline(t,e){const[i,n,s,r]=this.#e,[o,l,h,c]=this.#t,u=s*h,p=r*c,b=i*h+o,w=n*c+l,v=this.newOutliner({x:this.#o[0]*u+b,y:this.#o[1]*p+w},this.#t,this.#r,t,this.#i,e??this.#n);for(let x=2;x<this.#o.length;x+=2)v.add({x:this.#o[x]*u+b,y:this.#o[x+1]*p+w});return v.getOutlines()}}class wo{#t;#e;#n;#i=[];#o=[];constructor(t,e=0,i=0,n=!0){const s=[1/0,1/0,-1/0,-1/0],r=10**-4;for(const{x:v,y:x,width:E,height:D}of t){const T=Math.floor((v-e)/r)*r,k=Math.ceil((v+E+e)/r)*r,F=Math.floor((x-e)/r)*r,M=Math.ceil((x+D+e)/r)*r,O=[T,F,M,!0],N=[k,F,M,!1];this.#i.push(O,N),J.rectBoundingBox(T,F,k,M,s)}const o=s[2]-s[0]+2*i,l=s[3]-s[1]+2*i,h=s[0]-i,c=s[1]-i;let u=n?-1/0:1/0,p=1/0;const b=this.#i.at(n?-1:-2),w=[b[0],b[2]];for(const v of this.#i){const[x,E,D,T]=v;!T&&n?E<p?(p=E,u=x):E===p&&(u=Math.max(u,x)):T&&!n&&(E<p?(p=E,u=x):E===p&&(u=Math.min(u,x))),v[0]=(x-h)/o,v[1]=(E-c)/l,v[2]=(D-c)/l}this.#t=new Float32Array([h,c,o,l]),this.#e=[u,p],this.#n=w}getOutlines(){this.#i.sort((e,i)=>e[0]-i[0]||e[1]-i[1]||e[2]-i[2]);const t=[];for(const e of this.#i)e[3]?(t.push(...this.#l(e)),this.#a(e)):(this.#h(e),t.push(...this.#l(e)));return this.#r(t)}#r(t){const e=[],i=new Set;for(const r of t){const[o,l,h]=r;e.push([o,l,r],[o,h,r])}e.sort((r,o)=>r[1]-o[1]||r[0]-o[0]);for(let r=0,o=e.length;r<o;r+=2){const l=e[r][2],h=e[r+1][2];l.push(h),h.push(l),i.add(l),i.add(h)}const n=[];let s;for(;i.size>0;){const r=i.values().next().value;let[o,l,h,c,u]=r;i.delete(r);let p=o,b=l;for(s=[o,h],n.push(s);;){let w;if(i.has(c))w=c;else if(i.has(u))w=u;else break;i.delete(w),[o,l,h,c,u]=w,p!==o&&(s.push(p,b,o,b===l?l:h),p=o),b=b===l?h:l}s.push(p,b)}return new Tu(n,this.#t,this.#e,this.#n)}#s(t){const e=this.#o;let i=0,n=e.length-1;for(;i<=n;){const s=i+n>>1,r=e[s][0];if(r===t)return s;r<t?i=s+1:n=s-1}return n+1}#a([,t,e]){const i=this.#s(t);this.#o.splice(i,0,[t,e])}#h([,t,e]){const i=this.#s(t);for(let n=i;n<this.#o.length;n++){const[s,r]=this.#o[n];if(s!==t)break;if(s===t&&r===e){this.#o.splice(n,1);return}}for(let n=i-1;n>=0;n--){const[s,r]=this.#o[n];if(s!==t)break;if(s===t&&r===e){this.#o.splice(n,1);return}}}#l(t){const[e,i,n]=t,s=[[e,i,n]],r=this.#s(n);for(let o=0;o<r;o++){const[l,h]=this.#o[o];for(let c=0,u=s.length;c<u;c++){const[,p,b]=s[c];if(!(h<=p||b<=l)){if(p>=l){if(b>h)s[c][1]=h;else{if(u===1)return[];s.splice(c,1),c--,u--}continue}s[c][2]=l,b>h&&s.push([e,h,b])}}}return s}}class Tu extends tt{#t;#e;constructor(t,e,i,n){super(),this.#e=t,this.#t=e,this.firstPoint=i,this.lastPoint=n}toSVGPath(){const t=[];for(const e of this.#e){let[i,n]=e;t.push(`M${i} ${n}`);for(let s=2;s<e.length;s+=2){const r=e[s],o=e[s+1];r===i?(t.push(`V${o}`),n=o):o===n&&(t.push(`H${r}`),i=r)}t.push("Z")}return t.join(" ")}serialize([t,e,i,n],s){const r=[],o=i-t,l=n-e;for(const h of this.#e){const c=new Array(h.length);for(let u=0;u<h.length;u+=2)c[u]=t+h[u]*o,c[u+1]=n-h[u+1]*l;r.push(c)}return r}get box(){return this.#t}get classNamesForOutlining(){return["highlightOutline"]}}class vo extends en{newFreeDrawOutline(t,e,i,n,s,r){return new Du(t,e,i,n,s,r)}}class Du extends ah{newOutliner(t,e,i,n,s,r=0){return new vo(t,e,i,n,s,r)}}class ee extends nt{#t=null;#e=0;#n;#i=null;#o=null;#r=null;#s=null;#a=0;#h=null;#l=null;#u=null;#d=!1;#f=null;#m=null;#g=null;#c="";#p;#b="";static _defaultColor=null;static _defaultOpacity=1;static _defaultThickness=12;static _type="highlight";static _editorType=gt.HIGHLIGHT;static _freeHighlightId=-1;static _freeHighlight=null;static _freeHighlightClipId="";static get _keyboardManager(){const t=ee.prototype;return pt(this,"_keyboardManager",new vs([[["ArrowLeft","mac+ArrowLeft"],t._moveCaret,{args:[0]}],[["ArrowRight","mac+ArrowRight"],t._moveCaret,{args:[1]}],[["ArrowUp","mac+ArrowUp"],t._moveCaret,{args:[2]}],[["ArrowDown","mac+ArrowDown"],t._moveCaret,{args:[3]}]]))}constructor(t){super({...t,name:"highlightEditor"}),this.color=t.color||ee._defaultColor,this.#p=t.thickness||ee._defaultThickness,this.opacity=t.opacity||ee._defaultOpacity,this.#n=t.boxes||null,this.#b=t.methodOfCreation||"",this.#c=t.text||"",this._isDraggable=!1,this.defaultL10nId="pdfjs-editor-highlight-editor",t.highlightId>-1?(this.#d=!0,this.#y(t),this.#v()):this.#n&&(this.#t=t.anchorNode,this.#e=t.anchorOffset,this.#s=t.focusNode,this.#a=t.focusOffset,this.#w(),this.#v(),this.rotate(this.rotation)),this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-highlight-added-alert")}get telemetryInitialData(){return{action:"added",type:this.#d?"free_highlight":"highlight",color:this._uiManager.getNonHCMColorName(this.color),thickness:this.#p,methodOfCreation:this.#b}}get telemetryFinalData(){return{type:"highlight",color:this._uiManager.getNonHCMColorName(this.color)}}static computeTelemetryFinalData(t){return{numberOfColors:t.get("color").size}}#w(){const t=new wo(this.#n,.001);this.#l=t.getOutlines(),[this.x,this.y,this.width,this.height]=this.#l.box;const e=new wo(this.#n,.0025,.001,this._uiManager.direction==="ltr");this.#r=e.getOutlines();const{firstPoint:i}=this.#l;this.#f=[(i[0]-this.x)/this.width,(i[1]-this.y)/this.height];const{lastPoint:n}=this.#r;this.#m=[(n[0]-this.x)/this.width,(n[1]-this.y)/this.height]}#y({highlightOutlines:t,highlightId:e,clipPathId:i}){this.#l=t;const n=1.5;if(this.#r=t.getNewOutline(this.#p/2+n,.0025),e>=0)this.#u=e,this.#i=i,this.parent.drawLayer.finalizeDraw(e,{bbox:t.box,path:{d:t.toSVGPath()}}),this.#g=this.parent.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:!0},bbox:this.#r.box,path:{d:this.#r.toSVGPath()}},!0);else if(this.parent){const u=this.parent.viewport.rotation;this.parent.drawLayer.updateProperties(this.#u,{bbox:ee.#x(this.#l.box,(u-this.rotation+360)%360),path:{d:t.toSVGPath()}}),this.parent.drawLayer.updateProperties(this.#g,{bbox:ee.#x(this.#r.box,u),path:{d:this.#r.toSVGPath()}})}const[s,r,o,l]=t.box;switch(this.rotation){case 0:this.x=s,this.y=r,this.width=o,this.height=l;break;case 90:{const[u,p]=this.parentDimensions;this.x=r,this.y=1-s,this.width=o*p/u,this.height=l*u/p;break}case 180:this.x=1-s,this.y=1-r,this.width=o,this.height=l;break;case 270:{const[u,p]=this.parentDimensions;this.x=1-r,this.y=s,this.width=o*p/u,this.height=l*u/p;break}}const{firstPoint:h}=t;this.#f=[(h[0]-s)/o,(h[1]-r)/l];const{lastPoint:c}=this.#r;this.#m=[(c[0]-s)/o,(c[1]-r)/l]}static initialize(t,e){nt.initialize(t,e),ee._defaultColor||=e.highlightColors?.values().next().value||"#fff066"}static updateDefaultParams(t,e){switch(t){case Et.HIGHLIGHT_COLOR:ee._defaultColor=e;break;case Et.HIGHLIGHT_THICKNESS:ee._defaultThickness=e;break}}translateInPage(t,e){}get toolbarPosition(){return this.#m}get commentButtonPosition(){return this.#f}updateParams(t,e){switch(t){case Et.HIGHLIGHT_COLOR:this.#C(e);break;case Et.HIGHLIGHT_THICKNESS:this.#S(e);break}}static get defaultPropertiesToUpdate(){return[[Et.HIGHLIGHT_COLOR,ee._defaultColor],[Et.HIGHLIGHT_THICKNESS,ee._defaultThickness]]}get propertiesToUpdate(){return[[Et.HIGHLIGHT_COLOR,this.color||ee._defaultColor],[Et.HIGHLIGHT_THICKNESS,this.#p||ee._defaultThickness],[Et.HIGHLIGHT_FREE,this.#d]]}onUpdatedColor(){this.parent?.drawLayer.updateProperties(this.#u,{root:{fill:this.color,"fill-opacity":this.opacity}}),this.#o?.updateColor(this.color),super.onUpdatedColor()}#C(t){const e=(s,r)=>{this.color=s,this.opacity=r,this.onUpdatedColor()},i=this.color,n=this.opacity;this.addCommands({cmd:e.bind(this,t,ee._defaultOpacity),undo:e.bind(this,i,n),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Et.HIGHLIGHT_COLOR,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"color_changed",color:this._uiManager.getNonHCMColorName(t)},!0)}#S(t){const e=this.#p,i=n=>{this.#p=n,this.#A(n)};this.addCommands({cmd:i.bind(this,t),undo:i.bind(this,e),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Et.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"thickness_changed",thickness:t},!0)}get toolbarButtons(){return this._uiManager.highlightColors?[["colorPicker",this.#o=new ii({editor:this})]]:super.toolbarButtons}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}fixAndSetPosition(){return super.fixAndSetPosition(this.#D())}getBaseTranslation(){return[0,0]}getRect(t,e){return super.getRect(t,e,this.#D())}onceAdded(t){this.annotationElementId||this.parent.addUndoableEditor(this),t&&this.div.focus()}remove(){this.#P(),this._reportTelemetry({action:"deleted"}),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.#v(),this.isAttachedToDOM||this.parent.add(this)))}setParent(t){let e=!1;this.parent&&!t?this.#P():t&&(this.#v(t),e=!this.parent&&this.div?.classList.contains("selectedEditor")),super.setParent(t),this.show(this._isVisible),e&&this.select()}#A(t){this.#d&&(this.#y({highlightOutlines:this.#l.getNewOutline(t/2)}),this.fixAndSetPosition(),this.setDims())}#P(){this.#u===null||!this.parent||(this.parent.drawLayer.remove(this.#u),this.#u=null,this.parent.drawLayer.remove(this.#g),this.#g=null)}#v(t=this.parent){this.#u===null&&({id:this.#u,clipPathId:this.#i}=t.drawLayer.draw({bbox:this.#l.box,root:{viewBox:"0 0 1 1",fill:this.color,"fill-opacity":this.opacity},rootClass:{highlight:!0,free:this.#d},path:{d:this.#l.toSVGPath()}},!1,!0),this.#g=t.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:this.#d},bbox:this.#r.box,path:{d:this.#r.toSVGPath()}},this.#d),this.#h&&(this.#h.style.clipPath=this.#i))}static#x([t,e,i,n],s){switch(s){case 90:return[1-e-n,t,n,i];case 180:return[1-t-i,1-e-n,i,n];case 270:return[e,1-t-i,n,i]}return[t,e,i,n]}rotate(t){const{drawLayer:e}=this.parent;let i;this.#d?(t=(t-this.rotation+360)%360,i=ee.#x(this.#l.box,t)):i=ee.#x([this.x,this.y,this.width,this.height],t),e.updateProperties(this.#u,{bbox:i,root:{"data-main-rotation":t}}),e.updateProperties(this.#g,{bbox:ee.#x(this.#r.box,t),root:{"data-main-rotation":t}})}render(){if(this.div)return this.div;const t=super.render();this.#c&&(t.setAttribute("aria-label",this.#c),t.setAttribute("role","mark")),this.#d?t.classList.add("free"):this.div.addEventListener("keydown",this.#k.bind(this),{signal:this._uiManager._signal});const e=this.#h=document.createElement("div");return t.append(e),e.setAttribute("aria-hidden","true"),e.className="internal",e.style.clipPath=this.#i,this.setDims(),Nl(this,this.#h,["pointerover","pointerleave"]),this.enableEditing(),t}pointerover(){this.isSelected||this.parent?.drawLayer.updateProperties(this.#g,{rootClass:{hovered:!0}})}pointerleave(){this.isSelected||this.parent?.drawLayer.updateProperties(this.#g,{rootClass:{hovered:!1}})}#k(t){ee._keyboardManager.exec(this,t)}_moveCaret(t){switch(this.parent.unselect(this),t){case 0:case 2:this.#T(!0);break;case 1:case 3:this.#T(!1);break}}#T(t){if(!this.#t)return;const e=window.getSelection();t?e.setPosition(this.#t,this.#e):e.setPosition(this.#s,this.#a)}select(){super.select(),this.#g&&this.parent?.drawLayer.updateProperties(this.#g,{rootClass:{hovered:!1,selected:!0}})}unselect(){super.unselect(),this.#g&&(this.parent?.drawLayer.updateProperties(this.#g,{rootClass:{selected:!1}}),this.#d||this.#T(!1))}get _mustFixPosition(){return!this.#d}show(t=this._isVisible){super.show(t),this.parent&&(this.parent.drawLayer.updateProperties(this.#u,{rootClass:{hidden:!t}}),this.parent.drawLayer.updateProperties(this.#g,{rootClass:{hidden:!t}}))}#D(){return this.#d?this.rotation:0}#N(){if(this.#d)return null;const[t,e]=this.pageDimensions,[i,n]=this.pageTranslation,s=this.#n,r=new Float32Array(s.length*8);let o=0;for(const{x:l,y:h,width:c,height:u}of s){const p=l*t+i,b=(1-h)*e+n;r[o]=r[o+4]=p,r[o+1]=r[o+3]=b,r[o+2]=r[o+6]=p+c*t,r[o+5]=r[o+7]=b-u*e,o+=8}return r}#M(t){return this.#l.serialize(t,this.#D())}static startHighlighting(t,e,{target:i,x:n,y:s}){const{x:r,y:o,width:l,height:h}=i.getBoundingClientRect(),c=new AbortController,u=t.combinedSignal(c),p=b=>{c.abort(),this.#B(t,b)};window.addEventListener("blur",p,{signal:u}),window.addEventListener("pointerup",p,{signal:u}),window.addEventListener("pointerdown",Zt,{capture:!0,passive:!1,signal:u}),window.addEventListener("contextmenu",si,{signal:u}),i.addEventListener("pointermove",this.#L.bind(this,t),{signal:u}),this._freeHighlight=new vo({x:n,y:s},[r,o,l,h],t.scale,this._defaultThickness/2,e,.001),{id:this._freeHighlightId,clipPathId:this._freeHighlightClipId}=t.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:this._defaultColor,"fill-opacity":this._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:this._freeHighlight.toSVGPath()}},!0,!0)}static#L(t,e){this._freeHighlight.add(e)&&t.drawLayer.updateProperties(this._freeHighlightId,{path:{d:this._freeHighlight.toSVGPath()}})}static#B(t,e){this._freeHighlight.isEmpty()?t.drawLayer.remove(this._freeHighlightId):t.createAndAddNewEditor(e,!1,{highlightId:this._freeHighlightId,highlightOutlines:this._freeHighlight.getOutlines(),clipPathId:this._freeHighlightClipId,methodOfCreation:"main_toolbar"}),this._freeHighlightId=-1,this._freeHighlight=null,this._freeHighlightClipId=""}static async deserialize(t,e,i){let n=null;if(t instanceof rh){const{data:{quadPoints:w,rect:v,rotation:x,id:E,color:D,opacity:T,popupRef:k,richText:F,contentsObj:M,creationDate:O,modificationDate:N},parent:{page:{pageNumber:R}}}=t;n=t={annotationType:gt.HIGHLIGHT,color:Array.from(D),opacity:T,quadPoints:w,boxes:null,pageIndex:R-1,rect:v.slice(0),rotation:x,annotationElementId:E,id:E,deleted:!1,popupRef:k,richText:F,comment:M?.str||null,creationDate:O,modificationDate:N}}else if(t instanceof Ho){const{data:{inkLists:w,rect:v,rotation:x,id:E,color:D,borderStyle:{rawWidth:T},popupRef:k,richText:F,contentsObj:M,creationDate:O,modificationDate:N},parent:{page:{pageNumber:R}}}=t;n=t={annotationType:gt.HIGHLIGHT,color:Array.from(D),thickness:T,inkLists:w,boxes:null,pageIndex:R-1,rect:v.slice(0),rotation:x,annotationElementId:E,id:E,deleted:!1,popupRef:k,richText:F,comment:M?.str||null,creationDate:O,modificationDate:N}}const{color:s,quadPoints:r,inkLists:o,opacity:l}=t,h=await super.deserialize(t,e,i);h.color=J.makeHexColor(...s),h.opacity=l||1,o&&(h.#p=t.thickness),h._initialData=n,t.comment&&h.setCommentData(t);const[c,u]=h.pageDimensions,[p,b]=h.pageTranslation;if(r){const w=h.#n=[];for(let v=0;v<r.length;v+=8)w.push({x:(r[v]-p)/c,y:1-(r[v+1]-b)/u,width:(r[v+2]-r[v])/c,height:(r[v+1]-r[v+5])/u});h.#w(),h.#v(),h.rotate(h.rotation)}else if(o){h.#d=!0;const w=o[0],v={x:w[0]-p,y:u-(w[1]-b)},x=new vo(v,[0,0,c,u],1,h.#p/2,!0,.001);for(let T=0,k=w.length;T<k;T+=2)v.x=w[T]-p,v.y=u-(w[T+1]-b),x.add(v);const{id:E,clipPathId:D}=e.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:h.color,"fill-opacity":h._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:x.toSVGPath()}},!0,!0);h.#y({highlightOutlines:x.getOutlines(),highlightId:E,clipPathId:D}),h.#v(),h.rotate(h.parentRotation)}return h}serialize(t=!1){if(this.isEmpty()||t)return null;if(this.deleted)return this.serializeDeleted();const e=nt._colorManager.convert(this._uiManager.getNonHCMColor(this.color)),i=super.serialize(t);return Object.assign(i,{color:e,opacity:this.opacity,thickness:this.#p,quadPoints:this.#N(),outlines:this.#M(i.rect)}),this.addComment(i),this.annotationElementId&&!this.#R(i)?null:(i.id=this.annotationElementId,i)}#R(t){const{color:e}=this._initialData;return this.hasEditedComment||t.color.some((i,n)=>i!==e[n])}renderAnnotationElement(t){return this.deleted?(t.hide(),null):(t.updateEdited({rect:this.getPDFRect(),popup:this.comment}),null)}static canCreateNewEmptyEditor(){return!1}}class lh{#t=Object.create(null);updateProperty(t,e){this[t]=e,this.updateSVGProperty(t,e)}updateProperties(t){if(t)for(const[e,i]of Object.entries(t))e.startsWith("_")||this.updateProperty(e,i)}updateSVGProperty(t,e){this.#t[t]=e}toSVGProperties(){const t=this.#t;return this.#t=Object.create(null),{root:t}}reset(){this.#t=Object.create(null)}updateAll(t=this){this.updateProperties(t)}clone(){Rt("Not implemented")}}class Dt extends nt{#t=null;#e;_colorPicker=null;_drawId=null;static _currentDrawId=-1;static _currentParent=null;static#n=null;static#i=null;static#o=null;static _INNER_MARGIN=3;constructor(t){super(t),this.#e=t.mustBeCommitted||!1,this._addOutlines(t)}onUpdatedColor(){this._colorPicker?.update(this.color),super.onUpdatedColor()}_addOutlines(t){t.drawOutlines&&(this.#r(t),this.#h())}#r({drawOutlines:t,drawId:e,drawingOptions:i}){this.#t=t,this._drawingOptions||=i,this.annotationElementId||this._uiManager.a11yAlert(`pdfjs-editor-${this.editorType}-added-alert`),e>=0?(this._drawId=e,this.parent.drawLayer.finalizeDraw(e,t.defaultProperties)):this._drawId=this.#s(t,this.parent),this.#d(t.box)}#s(t,e){const{id:i}=e.drawLayer.draw(Dt._mergeSVGProperties(this._drawingOptions.toSVGProperties(),t.defaultSVGProperties),!1,!1);return i}static _mergeSVGProperties(t,e){const i=new Set(Object.keys(t));for(const[n,s]of Object.entries(e))i.has(n)?Object.assign(t[n],s):t[n]=s;return t}static getDefaultDrawingOptions(t){Rt("Not implemented")}static get typesMap(){Rt("Not implemented")}static get isDrawer(){return!0}static get supportMultipleDrawings(){return!1}static updateDefaultParams(t,e){const i=this.typesMap.get(t);i&&this._defaultDrawingOptions.updateProperty(i,e),this._currentParent&&(Dt.#n.updateProperty(i,e),this._currentParent.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}updateParams(t,e){const i=this.constructor.typesMap.get(t);i&&this._updateProperty(t,i,e)}static get defaultPropertiesToUpdate(){const t=[],e=this._defaultDrawingOptions;for(const[i,n]of this.typesMap)t.push([i,e[n]]);return t}get propertiesToUpdate(){const t=[],{_drawingOptions:e}=this;for(const[i,n]of this.constructor.typesMap)t.push([i,e[n]]);return t}_updateProperty(t,e,i){const n=this._drawingOptions,s=n[e],r=o=>{n.updateProperty(e,o);const l=this.#t.updateProperty(e,o);l&&this.#d(l),this.parent?.drawLayer.updateProperties(this._drawId,n.toSVGProperties()),t===this.colorType&&this.onUpdatedColor()};this.addCommands({cmd:r.bind(this,i),undo:r.bind(this,s),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:t,overwriteIfSameType:!0,keepUndo:!0})}_onResizing(){this.parent?.drawLayer.updateProperties(this._drawId,Dt._mergeSVGProperties(this.#t.getPathResizingSVGProperties(this.#u()),{bbox:this.#f()}))}_onResized(){this.parent?.drawLayer.updateProperties(this._drawId,Dt._mergeSVGProperties(this.#t.getPathResizedSVGProperties(this.#u()),{bbox:this.#f()}))}_onTranslating(t,e){this.parent?.drawLayer.updateProperties(this._drawId,{bbox:this.#f()})}_onTranslated(){this.parent?.drawLayer.updateProperties(this._drawId,Dt._mergeSVGProperties(this.#t.getPathTranslatedSVGProperties(this.#u(),this.parentDimensions),{bbox:this.#f()}))}_onStartDragging(){this.parent?.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!0}})}_onStopDragging(){this.parent?.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!1}})}commit(){super.commit(),this.disableEditMode(),this.disableEditing()}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}getBaseTranslation(){return[0,0]}get isResizable(){return!0}onceAdded(t){this.annotationElementId||this.parent.addUndoableEditor(this),this._isDraggable=!0,this.#e&&(this.#e=!1,this.commit(),this.parent.setSelected(this),t&&this.isOnScreen&&this.div.focus())}remove(){this.#a(),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.#h(),this.#d(this.#t.box),this.isAttachedToDOM||this.parent.add(this)))}setParent(t){let e=!1;this.parent&&!t?(this._uiManager.removeShouldRescale(this),this.#a()):t&&(this._uiManager.addShouldRescale(this),this.#h(t),e=!this.parent&&this.div?.classList.contains("selectedEditor")),super.setParent(t),e&&this.select()}#a(){this._drawId===null||!this.parent||(this.parent.drawLayer.remove(this._drawId),this._drawId=null,this._drawingOptions.reset())}#h(t=this.parent){if(!(this._drawId!==null&&this.parent===t)){if(this._drawId!==null){this.parent.drawLayer.updateParent(this._drawId,t.drawLayer);return}this._drawingOptions.updateAll(),this._drawId=this.#s(this.#t,t)}}#l([t,e,i,n]){const{parentDimensions:[s,r],rotation:o}=this;switch(o){case 90:return[e,1-t,i*(r/s),n*(s/r)];case 180:return[1-t,1-e,i,n];case 270:return[1-e,t,i*(r/s),n*(s/r)];default:return[t,e,i,n]}}#u(){const{x:t,y:e,width:i,height:n,parentDimensions:[s,r],rotation:o}=this;switch(o){case 90:return[1-e,t,i*(s/r),n*(r/s)];case 180:return[1-t,1-e,i,n];case 270:return[e,1-t,i*(s/r),n*(r/s)];default:return[t,e,i,n]}}#d(t){[this.x,this.y,this.width,this.height]=this.#l(t),this.div&&(this.fixAndSetPosition(),this.setDims()),this._onResized()}#f(){const{x:t,y:e,width:i,height:n,rotation:s,parentRotation:r,parentDimensions:[o,l]}=this;switch((s*4+r)/90){case 1:return[1-e-n,t,n,i];case 2:return[1-t-i,1-e-n,i,n];case 3:return[e,1-t-i,n,i];case 4:return[t,e-i*(o/l),n*(l/o),i*(o/l)];case 5:return[1-e,t,i*(o/l),n*(l/o)];case 6:return[1-t-n*(l/o),1-e,n*(l/o),i*(o/l)];case 7:return[e-i*(o/l),1-t-n*(l/o),i*(o/l),n*(l/o)];case 8:return[t-i,e-n,i,n];case 9:return[1-e,t-i,n,i];case 10:return[1-t,1-e,i,n];case 11:return[e-n,1-t,n,i];case 12:return[t-n*(l/o),e,n*(l/o),i*(o/l)];case 13:return[1-e-i*(o/l),t-n*(l/o),i*(o/l),n*(l/o)];case 14:return[1-t,1-e-i*(o/l),n*(l/o),i*(o/l)];case 15:return[e,1-t,i*(o/l),n*(l/o)];default:return[t,e,i,n]}}rotate(){this.parent&&this.parent.drawLayer.updateProperties(this._drawId,Dt._mergeSVGProperties({bbox:this.#f()},this.#t.updateRotation((this.parentRotation-this.rotation+360)%360)))}onScaleChanging(){this.parent&&this.#d(this.#t.updateParentDimensions(this.parentDimensions,this.parent.scale))}static onScaleChangingWhenDrawing(){}render(){if(this.div)return this.div;let t,e;this._isCopy&&(t=this.x,e=this.y);const i=super.render();i.classList.add("draw");const n=document.createElement("div");return i.append(n),n.setAttribute("aria-hidden","true"),n.className="internal",this.setDims(),this._uiManager.addShouldRescale(this),this.disableEditing(),this._isCopy&&this._moveAfterPaste(t,e),i}static createDrawerInstance(t,e,i,n,s){Rt("Not implemented")}static startDrawing(t,e,i,n){const{target:s,offsetX:r,offsetY:o,pointerId:l,pointerType:h}=n;if(kt.isInitializedAndDifferentPointerType(h))return;const{viewport:{rotation:c}}=t,{width:u,height:p}=s.getBoundingClientRect(),b=Dt.#i=new AbortController,w=t.combinedSignal(b);if(kt.setPointer(h,l),window.addEventListener("pointerup",v=>{kt.isSamePointerIdOrRemove(v.pointerId)&&this._endDraw(v)},{signal:w}),window.addEventListener("pointercancel",v=>{kt.isSamePointerIdOrRemove(v.pointerId)&&this._currentParent.endDrawingSession()},{signal:w}),window.addEventListener("pointerdown",v=>{kt.isSamePointerType(v.pointerType)&&(kt.initializeAndAddPointerId(v.pointerId),Dt.#n.isCancellable()&&(Dt.#n.removeLastElement(),Dt.#n.isEmpty()?this._currentParent.endDrawingSession(!0):this._endDraw(null)))},{capture:!0,passive:!1,signal:w}),window.addEventListener("contextmenu",si,{signal:w}),s.addEventListener("pointermove",this._drawMove.bind(this),{signal:w}),s.addEventListener("touchmove",v=>{kt.isSameTimeStamp(v.timeStamp)&&Zt(v)},{signal:w}),t.toggleDrawing(),e._editorUndoBar?.hide(),Dt.#n){t.drawLayer.updateProperties(this._currentDrawId,Dt.#n.startNew(r,o,u,p,c));return}e.updateUIForDefaultProperties(this),Dt.#n=this.createDrawerInstance(r,o,u,p,c),Dt.#o=this.getDefaultDrawingOptions(),this._currentParent=t,{id:this._currentDrawId}=t.drawLayer.draw(this._mergeSVGProperties(Dt.#o.toSVGProperties(),Dt.#n.defaultSVGProperties),!0,!1)}static _drawMove(t){if(kt.isSameTimeStamp(t.timeStamp),!Dt.#n)return;const{offsetX:e,offsetY:i,pointerId:n}=t;if(kt.isSamePointerId(n)){if(kt.isUsingMultiplePointers()){this._endDraw(t);return}this._currentParent.drawLayer.updateProperties(this._currentDrawId,Dt.#n.add(e,i)),kt.setTimeStamp(t.timeStamp),Zt(t)}}static _cleanup(t){t&&(this._currentDrawId=-1,this._currentParent=null,Dt.#n=null,Dt.#o=null,kt.clearTimeStamp()),Dt.#i&&(Dt.#i.abort(),Dt.#i=null,kt.clearPointerIds())}static _endDraw(t){const e=this._currentParent;if(e){if(e.toggleDrawing(!0),this._cleanup(!1),t?.target===e.div&&e.drawLayer.updateProperties(this._currentDrawId,Dt.#n.end(t.offsetX,t.offsetY)),this.supportMultipleDrawings){const i=Dt.#n,n=this._currentDrawId,s=i.getLastElement();e.addCommands({cmd:()=>{e.drawLayer.updateProperties(n,i.setLastElement(s))},undo:()=>{e.drawLayer.updateProperties(n,i.removeLastElement())},mustExec:!1,type:Et.DRAW_STEP});return}this.endDrawing(!1)}}static endDrawing(t){const e=this._currentParent;if(!e)return null;if(e.toggleDrawing(!0),e.cleanUndoStack(Et.DRAW_STEP),!Dt.#n.isEmpty()){const{pageDimensions:[i,n],scale:s}=e,r=e.createAndAddNewEditor({offsetX:0,offsetY:0},!1,{drawId:this._currentDrawId,drawOutlines:Dt.#n.getOutlines(i*s,n*s,s,this._INNER_MARGIN),drawingOptions:Dt.#o,mustBeCommitted:!t});return this._cleanup(!0),r}return e.drawLayer.remove(this._currentDrawId),this._cleanup(!0),null}createDrawingOptions(t){}static deserializeDraw(t,e,i,n,s,r){Rt("Not implemented")}static async deserialize(t,e,i){const{rawDims:{pageWidth:n,pageHeight:s,pageX:r,pageY:o}}=e.viewport,l=this.deserializeDraw(r,o,n,s,this._INNER_MARGIN,t),h=await super.deserialize(t,e,i);return h.createDrawingOptions(t),h.#r({drawOutlines:l}),h.#h(),h.onScaleChanging(),h.rotate(),h}serializeDraw(t){const[e,i]=this.pageTranslation,[n,s]=this.pageDimensions;return this.#t.serialize([e,i,n,s],t)}renderAnnotationElement(t){return t.updateEdited({rect:this.getPDFRect()}),null}static canCreateNewEmptyEditor(){return!1}}class ku{#t=new Float64Array(6);#e;#n;#i;#o;#r;#s="";#a=0;#h=new Es;#l;#u;constructor(t,e,i,n,s,r){this.#l=i,this.#u=n,this.#i=s,this.#o=r,[t,e]=this.#d(t,e);const o=this.#e=[NaN,NaN,NaN,NaN,t,e];this.#r=[t,e],this.#n=[{line:o,points:this.#r}],this.#t.set(o,0)}updateProperty(t,e){t==="stroke-width"&&(this.#o=e)}#d(t,e){return tt._normalizePoint(t,e,this.#l,this.#u,this.#i)}isEmpty(){return!this.#n||this.#n.length===0}isCancellable(){return this.#r.length<=10}add(t,e){[t,e]=this.#d(t,e);const[i,n,s,r]=this.#t.subarray(2,6),o=t-s,l=e-r;return Math.hypot(this.#l*o,this.#u*l)<=2?null:(this.#r.push(t,e),isNaN(i)?(this.#t.set([s,r,t,e],2),this.#e.push(NaN,NaN,NaN,NaN,t,e),{path:{d:this.toSVGPath()}}):(isNaN(this.#t[0])&&this.#e.splice(6,6),this.#t.set([i,n,s,r,t,e],0),this.#e.push(...tt.createBezierPoints(i,n,s,r,t,e)),{path:{d:this.toSVGPath()}}))}end(t,e){const i=this.add(t,e);return i||(this.#r.length===2?{path:{d:this.toSVGPath()}}:null)}startNew(t,e,i,n,s){this.#l=i,this.#u=n,this.#i=s,[t,e]=this.#d(t,e);const r=this.#e=[NaN,NaN,NaN,NaN,t,e];this.#r=[t,e];const o=this.#n.at(-1);return o&&(o.line=new Float32Array(o.line),o.points=new Float32Array(o.points)),this.#n.push({line:r,points:this.#r}),this.#t.set(r,0),this.#a=0,this.toSVGPath(),null}getLastElement(){return this.#n.at(-1)}setLastElement(t){return this.#n?(this.#n.push(t),this.#e=t.line,this.#r=t.points,this.#a=0,{path:{d:this.toSVGPath()}}):this.#h.setLastElement(t)}removeLastElement(){if(!this.#n)return this.#h.removeLastElement();this.#n.pop(),this.#s="";for(let t=0,e=this.#n.length;t<e;t++){const{line:i,points:n}=this.#n[t];this.#e=i,this.#r=n,this.#a=0,this.toSVGPath()}return{path:{d:this.#s}}}toSVGPath(){const t=tt.svgRound(this.#e[4]),e=tt.svgRound(this.#e[5]);if(this.#r.length===2)return this.#s=`${this.#s} M ${t} ${e} Z`,this.#s;if(this.#r.length<=6){const n=this.#s.lastIndexOf("M");this.#s=`${this.#s.slice(0,n)} M ${t} ${e}`,this.#a=6}if(this.#r.length===4){const n=tt.svgRound(this.#e[10]),s=tt.svgRound(this.#e[11]);return this.#s=`${this.#s} L ${n} ${s}`,this.#a=12,this.#s}const i=[];this.#a===0&&(i.push(`M ${t} ${e}`),this.#a=6);for(let n=this.#a,s=this.#e.length;n<s;n+=6){const[r,o,l,h,c,u]=this.#e.slice(n,n+6).map(tt.svgRound);i.push(`C${r} ${o} ${l} ${h} ${c} ${u}`)}return this.#s+=i.join(" "),this.#a=this.#e.length,this.#s}getOutlines(t,e,i,n){const s=this.#n.at(-1);return s.line=new Float32Array(s.line),s.points=new Float32Array(s.points),this.#h.build(this.#n,t,e,i,this.#i,this.#o,n),this.#t=null,this.#e=null,this.#n=null,this.#s=null,this.#h}get defaultSVGProperties(){return{root:{viewBox:"0 0 10000 10000"},rootClass:{draw:!0},bbox:[0,0,1,1]}}}class Es extends tt{#t;#e=0;#n;#i;#o;#r;#s;#a;#h;build(t,e,i,n,s,r,o){this.#o=e,this.#r=i,this.#s=n,this.#a=s,this.#h=r,this.#n=o??0,this.#i=t,this.#d()}get thickness(){return this.#h}setLastElement(t){return this.#i.push(t),{path:{d:this.toSVGPath()}}}removeLastElement(){return this.#i.pop(),{path:{d:this.toSVGPath()}}}toSVGPath(){const t=[];for(const{line:e}of this.#i){if(t.push(`M${tt.svgRound(e[4])} ${tt.svgRound(e[5])}`),e.length===6){t.push("Z");continue}if(e.length===12&&isNaN(e[6])){t.push(`L${tt.svgRound(e[10])} ${tt.svgRound(e[11])}`);continue}for(let i=6,n=e.length;i<n;i+=6){const[s,r,o,l,h,c]=e.subarray(i,i+6).map(tt.svgRound);t.push(`C${s} ${r} ${o} ${l} ${h} ${c}`)}}return t.join("")}serialize([t,e,i,n],s){const r=[],o=[],[l,h,c,u]=this.#u();let p,b,w,v,x,E,D,T,k;switch(this.#a){case 0:k=tt._rescale,p=t,b=e+n,w=i,v=-n,x=t+l*i,E=e+(1-h-u)*n,D=t+(l+c)*i,T=e+(1-h)*n;break;case 90:k=tt._rescaleAndSwap,p=t,b=e,w=i,v=n,x=t+h*i,E=e+l*n,D=t+(h+u)*i,T=e+(l+c)*n;break;case 180:k=tt._rescale,p=t+i,b=e,w=-i,v=n,x=t+(1-l-c)*i,E=e+h*n,D=t+(1-l)*i,T=e+(h+u)*n;break;case 270:k=tt._rescaleAndSwap,p=t+i,b=e+n,w=-i,v=-n,x=t+(1-h-u)*i,E=e+(1-l-c)*n,D=t+(1-h)*i,T=e+(1-l)*n;break}for(const{line:F,points:M}of this.#i)r.push(k(F,p,b,w,v,s?new Array(F.length):null)),o.push(k(M,p,b,w,v,s?new Array(M.length):null));return{lines:r,points:o,rect:[x,E,D,T]}}static deserialize(t,e,i,n,s,{paths:{lines:r,points:o},rotation:l,thickness:h}){const c=[];let u,p,b,w,v;switch(l){case 0:v=tt._rescale,u=-t/i,p=e/n+1,b=1/i,w=-1/n;break;case 90:v=tt._rescaleAndSwap,u=-e/n,p=-t/i,b=1/n,w=1/i;break;case 180:v=tt._rescale,u=t/i+1,p=-e/n,b=-1/i,w=1/n;break;case 270:v=tt._rescaleAndSwap,u=e/n+1,p=t/i+1,b=-1/n,w=-1/i;break}if(!r){r=[];for(const E of o){const D=E.length;if(D===2){r.push(new Float32Array([NaN,NaN,NaN,NaN,E[0],E[1]]));continue}if(D===4){r.push(new Float32Array([NaN,NaN,NaN,NaN,E[0],E[1],NaN,NaN,NaN,NaN,E[2],E[3]]));continue}const T=new Float32Array(3*(D-2));r.push(T);let[k,F,M,O]=E.subarray(0,4);T.set([NaN,NaN,NaN,NaN,k,F],0);for(let N=4;N<D;N+=2){const R=E[N],$=E[N+1];T.set(tt.createBezierPoints(k,F,M,O,R,$),(N-2)*3),[k,F,M,O]=[M,O,R,$]}}}for(let E=0,D=r.length;E<D;E++)c.push({line:v(r[E].map(T=>T??NaN),u,p,b,w),points:v(o[E].map(T=>T??NaN),u,p,b,w)});const x=new this.prototype.constructor;return x.build(c,i,n,1,l,h,s),x}#l(t=this.#h){const e=this.#n+t/2*this.#s;return this.#a%180===0?[e/this.#o,e/this.#r]:[e/this.#r,e/this.#o]}#u(){const[t,e,i,n]=this.#t,[s,r]=this.#l(0);return[t+s,e+r,i-2*s,n-2*r]}#d(){const t=this.#t=new Float32Array([1/0,1/0,-1/0,-1/0]);for(const{line:n}of this.#i){if(n.length<=12){for(let o=4,l=n.length;o<l;o+=6)J.pointBoundingBox(n[o],n[o+1],t);continue}let s=n[4],r=n[5];for(let o=6,l=n.length;o<l;o+=6){const[h,c,u,p,b,w]=n.subarray(o,o+6);J.bezierBoundingBox(s,r,h,c,u,p,b,w,t),s=b,r=w}}const[e,i]=this.#l();t[0]=Ie(t[0]-e,0,1),t[1]=Ie(t[1]-i,0,1),t[2]=Ie(t[2]+e,0,1),t[3]=Ie(t[3]+i,0,1),t[2]-=t[0],t[3]-=t[1]}get box(){return this.#t}updateProperty(t,e){return t==="stroke-width"?this.#f(e):null}#f(t){const[e,i]=this.#l();this.#h=t;const[n,s]=this.#l(),[r,o]=[n-e,s-i],l=this.#t;return l[0]-=r,l[1]-=o,l[2]+=2*r,l[3]+=2*o,l}updateParentDimensions([t,e],i){const[n,s]=this.#l();this.#o=t,this.#r=e,this.#s=i;const[r,o]=this.#l(),l=r-n,h=o-s,c=this.#t;return c[0]-=l,c[1]-=h,c[2]+=2*l,c[3]+=2*h,c}updateRotation(t){return this.#e=t,{path:{transform:this.rotationTransform}}}get viewBox(){return this.#t.map(tt.svgRound).join(" ")}get defaultProperties(){const[t,e]=this.#t;return{root:{viewBox:this.viewBox},path:{"transform-origin":`${tt.svgRound(t)} ${tt.svgRound(e)}`}}}get rotationTransform(){const[,,t,e]=this.#t;let i=0,n=0,s=0,r=0,o=0,l=0;switch(this.#e){case 90:n=e/t,s=-t/e,o=t;break;case 180:i=-1,r=-1,o=t,l=e;break;case 270:n=-e/t,s=t/e,l=e;break;default:return""}return`matrix(${i} ${n} ${s} ${r} ${tt.svgRound(o)} ${tt.svgRound(l)})`}getPathResizingSVGProperties([t,e,i,n]){const[s,r]=this.#l(),[o,l,h,c]=this.#t;if(Math.abs(h-s)<=tt.PRECISION||Math.abs(c-r)<=tt.PRECISION){const v=t+i/2-(o+h/2),x=e+n/2-(l+c/2);return{path:{"transform-origin":`${tt.svgRound(t)} ${tt.svgRound(e)}`,transform:`${this.rotationTransform} translate(${v} ${x})`}}}const u=(i-2*s)/(h-2*s),p=(n-2*r)/(c-2*r),b=h/i,w=c/n;return{path:{"transform-origin":`${tt.svgRound(o)} ${tt.svgRound(l)}`,transform:`${this.rotationTransform} scale(${b} ${w}) translate(${tt.svgRound(s)} ${tt.svgRound(r)}) scale(${u} ${p}) translate(${tt.svgRound(-s)} ${tt.svgRound(-r)})`}}}getPathResizedSVGProperties([t,e,i,n]){const[s,r]=this.#l(),o=this.#t,[l,h,c,u]=o;if(o[0]=t,o[1]=e,o[2]=i,o[3]=n,Math.abs(c-s)<=tt.PRECISION||Math.abs(u-r)<=tt.PRECISION){const x=t+i/2-(l+c/2),E=e+n/2-(h+u/2);for(const{line:D,points:T}of this.#i)tt._translate(D,x,E,D),tt._translate(T,x,E,T);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${tt.svgRound(t)} ${tt.svgRound(e)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}const p=(i-2*s)/(c-2*s),b=(n-2*r)/(u-2*r),w=-p*(l+s)+t+s,v=-b*(h+r)+e+r;if(p!==1||b!==1||w!==0||v!==0)for(const{line:x,points:E}of this.#i)tt._rescale(x,w,v,p,b,x),tt._rescale(E,w,v,p,b,E);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${tt.svgRound(t)} ${tt.svgRound(e)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}getPathTranslatedSVGProperties([t,e],i){const[n,s]=i,r=this.#t,o=t-r[0],l=e-r[1];if(this.#o===n&&this.#r===s)for(const{line:h,points:c}of this.#i)tt._translate(h,o,l,h),tt._translate(c,o,l,c);else{const h=this.#o/n,c=this.#r/s;this.#o=n,this.#r=s;for(const{line:u,points:p}of this.#i)tt._rescale(u,o,l,h,c,u),tt._rescale(p,o,l,h,c,p);r[2]*=h,r[3]*=c}return r[0]=t,r[1]=e,{root:{viewBox:this.viewBox},path:{d:this.toSVGPath(),"transform-origin":`${tt.svgRound(t)} ${tt.svgRound(e)}`}}}get defaultSVGProperties(){const t=this.#t;return{root:{viewBox:this.viewBox},rootClass:{draw:!0},path:{d:this.toSVGPath(),"transform-origin":`${tt.svgRound(t[0])} ${tt.svgRound(t[1])}`,transform:this.rotationTransform||null},bbox:t}}}class vr extends lh{constructor(t){super(),this._viewParameters=t,super.updateProperties({fill:"none",stroke:nt._defaultLineColor,"stroke-opacity":1,"stroke-width":1,"stroke-linecap":"round","stroke-linejoin":"round","stroke-miterlimit":10})}updateSVGProperty(t,e){t==="stroke-width"&&(e??=this["stroke-width"],e*=this._viewParameters.realScale),super.updateSVGProperty(t,e)}clone(){const t=new vr(this._viewParameters);return t.updateAll(this),t}}class zo extends Dt{static _type="ink";static _editorType=gt.INK;static _defaultDrawingOptions=null;constructor(t){super({...t,name:"inkEditor"}),this._willKeepAspectRatio=!0,this.defaultL10nId="pdfjs-editor-ink-editor"}static initialize(t,e){nt.initialize(t,e),this._defaultDrawingOptions=new vr(e.viewParameters)}static getDefaultDrawingOptions(t){const e=this._defaultDrawingOptions.clone();return e.updateProperties(t),e}static get supportMultipleDrawings(){return!0}static get typesMap(){return pt(this,"typesMap",new Map([[Et.INK_THICKNESS,"stroke-width"],[Et.INK_COLOR,"stroke"],[Et.INK_OPACITY,"stroke-opacity"]]))}static createDrawerInstance(t,e,i,n,s){return new ku(t,e,i,n,s,this._defaultDrawingOptions["stroke-width"])}static deserializeDraw(t,e,i,n,s,r){return Es.deserialize(t,e,i,n,s,r)}static async deserialize(t,e,i){let n=null;if(t instanceof Ho){const{data:{inkLists:r,rect:o,rotation:l,id:h,color:c,opacity:u,borderStyle:{rawWidth:p},popupRef:b,richText:w,contentsObj:v,creationDate:x,modificationDate:E},parent:{page:{pageNumber:D}}}=t;n=t={annotationType:gt.INK,color:Array.from(c),thickness:p,opacity:u,paths:{points:r},boxes:null,pageIndex:D-1,rect:o.slice(0),rotation:l,annotationElementId:h,id:h,deleted:!1,popupRef:b,richText:w,comment:v?.str||null,creationDate:x,modificationDate:E}}const s=await super.deserialize(t,e,i);return s._initialData=n,t.comment&&s.setCommentData(t),s}get toolbarButtons(){return this._colorPicker||=new us(this),[["colorPicker",this._colorPicker]]}get colorType(){return Et.INK_COLOR}get color(){return this._drawingOptions.stroke}get opacity(){return this._drawingOptions["stroke-opacity"]}onScaleChanging(){if(!this.parent)return;super.onScaleChanging();const{_drawId:t,_drawingOptions:e,parent:i}=this;e.updateSVGProperty("stroke-width"),i.drawLayer.updateProperties(t,e.toSVGProperties())}static onScaleChangingWhenDrawing(){const t=this._currentParent;t&&(super.onScaleChangingWhenDrawing(),this._defaultDrawingOptions.updateSVGProperty("stroke-width"),t.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}createDrawingOptions({color:t,thickness:e,opacity:i}){this._drawingOptions=zo.getDefaultDrawingOptions({stroke:J.makeHexColor(...t),"stroke-width":e,"stroke-opacity":i})}serialize(t=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const{lines:e,points:i}=this.serializeDraw(t),{_drawingOptions:{stroke:n,"stroke-opacity":s,"stroke-width":r}}=this,o=Object.assign(super.serialize(t),{color:nt._colorManager.convert(n),opacity:s,thickness:r,paths:{lines:e,points:i}});return this.addComment(o),t?(o.isCopy=!0,o):this.annotationElementId&&!this.#t(o)?null:(o.id=this.annotationElementId,o)}#t(t){const{color:e,thickness:i,opacity:n,pageIndex:s}=this._initialData;return this.hasEditedComment||this._hasBeenMoved||this._hasBeenResized||t.color.some((r,o)=>r!==e[o])||t.thickness!==i||t.opacity!==n||t.pageIndex!==s}renderAnnotationElement(t){if(this.deleted)return t.hide(),null;const{points:e,rect:i}=this.serializeDraw(!1);return t.updateEdited({rect:i,thickness:this._drawingOptions["stroke-width"],points:e,popup:this.comment}),null}}class Ao extends Es{toSVGPath(){let t=super.toSVGPath();return t.endsWith("Z")||(t+="Z"),t}}const Bs=8,Wn=3;class An{static#t={maxDim:512,sigmaSFactor:.02,sigmaR:25,kernelSize:16};static#e(t,e,i,n){return i-=t,n-=e,i===0?n>0?0:4:i===1?n+6:2-n}static#n=new Int32Array([0,1,-1,1,-1,0,-1,-1,0,-1,1,-1,1,0,1,1]);static#i(t,e,i,n,s,r,o){const l=this.#e(i,n,s,r);for(let h=0;h<8;h++){const c=(-h+l-o+16)%8,u=this.#n[2*c],p=this.#n[2*c+1];if(t[(i+u)*e+(n+p)]!==0)return c}return-1}static#o(t,e,i,n,s,r,o){const l=this.#e(i,n,s,r);for(let h=0;h<8;h++){const c=(h+l+o+16)%8,u=this.#n[2*c],p=this.#n[2*c+1];if(t[(i+u)*e+(n+p)]!==0)return c}return-1}static#r(t,e,i,n){const s=t.length,r=new Int32Array(s);for(let c=0;c<s;c++)r[c]=t[c]<=n?1:0;for(let c=1;c<i-1;c++)r[c*e]=r[c*e+e-1]=0;for(let c=0;c<e;c++)r[c]=r[e*i-1-c]=0;let o=1,l;const h=[];for(let c=1;c<i-1;c++){l=1;for(let u=1;u<e-1;u++){const p=c*e+u,b=r[p];if(b===0)continue;let w=c,v=u;if(b===1&&r[p-1]===0)o+=1,v-=1;else if(b>=1&&r[p+1]===0)o+=1,v+=1,b>1&&(l=b);else{b!==1&&(l=Math.abs(b));continue}const x=[u,c],E=v===u+1,D={isHole:E,points:x,id:o,parent:0};h.push(D);let T;for(const U of h)if(U.id===l){T=U;break}T?T.isHole?D.parent=E?T.parent:l:D.parent=E?l:T.parent:D.parent=E?l:0;const k=this.#i(r,e,c,u,w,v,0);if(k===-1){r[p]=-o,r[p]!==1&&(l=Math.abs(r[p]));continue}let F=this.#n[2*k],M=this.#n[2*k+1];const O=c+F,N=u+M;w=O,v=N;let R=c,$=u;for(;;){const U=this.#o(r,e,R,$,w,v,1);F=this.#n[2*U],M=this.#n[2*U+1];const Q=R+F,V=$+M;x.push(V,Q);const z=R*e+$;if(r[z+1]===0?r[z]=-o:r[z]===1&&(r[z]=o),Q===c&&V===u&&R===O&&$===N){r[p]!==1&&(l=Math.abs(r[p]));break}else w=R,v=$,R=Q,$=V}}}return h}static#s(t,e,i,n){if(i-e<=4){for(let O=e;O<i-2;O+=2)n.push(t[O],t[O+1]);return}const s=t[e],r=t[e+1],o=t[i-4]-s,l=t[i-3]-r,h=Math.hypot(o,l),c=o/h,u=l/h,p=c*r-u*s,b=l/o,w=1/h,v=Math.atan(b),x=Math.cos(v),E=Math.sin(v),D=w*(Math.abs(x)+Math.abs(E)),T=w*(1-D+D**2),k=Math.max(Math.atan(Math.abs(E+x)*T),Math.atan(Math.abs(E-x)*T));let F=0,M=e;for(let O=e+2;O<i-2;O+=2){const N=Math.abs(p-c*t[O+1]+u*t[O]);N>F&&(M=O,F=N)}F>(h*k)**2?(this.#s(t,e,M+2,n),this.#s(t,M,i,n)):n.push(s,r)}static#a(t){const e=[],i=t.length;return this.#s(t,0,i,e),e.push(t[i-2],t[i-1]),e.length<=4?null:e}static#h(t,e,i,n,s,r){const o=new Float32Array(r**2),l=-2*n**2,h=r>>1;for(let v=0;v<r;v++){const x=(v-h)**2;for(let E=0;E<r;E++)o[v*r+E]=Math.exp((x+(E-h)**2)/l)}const c=new Float32Array(256),u=-2*s**2;for(let v=0;v<256;v++)c[v]=Math.exp(v**2/u);const p=t.length,b=new Uint8Array(p),w=new Uint32Array(256);for(let v=0;v<i;v++)for(let x=0;x<e;x++){const E=v*e+x,D=t[E];let T=0,k=0;for(let M=0;M<r;M++){const O=v+M-h;if(!(O<0||O>=i))for(let N=0;N<r;N++){const R=x+N-h;if(R<0||R>=e)continue;const $=t[O*e+R],U=o[M*r+N]*c[Math.abs($-D)];T+=$*U,k+=U}}const F=b[E]=Math.round(T/k);w[F]++}return[b,w]}static#l(t){const e=new Uint32Array(256);for(const i of t)e[i]++;return e}static#u(t){const e=t.length,i=new Uint8ClampedArray(e>>2);let n=-1/0,s=1/0;for(let o=0,l=i.length;o<l;o++){const h=i[o]=t[o<<2];n=Math.max(n,h),s=Math.min(s,h)}const r=255/(n-s);for(let o=0,l=i.length;o<l;o++)i[o]=(i[o]-s)*r;return i}static#d(t){let e,i=-1/0,n=-1/0;const s=t.findIndex(l=>l!==0);let r=s,o=s;for(e=s;e<256;e++){const l=t[e];l>i&&(e-r>n&&(n=e-r,o=e-1),i=l,r=e)}for(e=o-1;e>=0&&!(t[e]>t[e+1]);e--);return e}static#f(t){const e=t,{width:i,height:n}=t,{maxDim:s}=this.#t;let r=i,o=n;if(i>s||n>s){let p=i,b=n,w=Math.log2(Math.max(i,n)/s);const v=Math.floor(w);w=w===v?v-1:v;for(let E=0;E<w;E++){r=Math.ceil(p/2),o=Math.ceil(b/2);const D=new OffscreenCanvas(r,o);D.getContext("2d").drawImage(t,0,0,p,b,0,0,r,o),p=r,b=o,t!==e&&t.close(),t=D.transferToImageBitmap()}const x=Math.min(s/r,s/o);r=Math.round(r*x),o=Math.round(o*x)}const h=new OffscreenCanvas(r,o).getContext("2d",{willReadFrequently:!0});h.fillStyle="white",h.fillRect(0,0,r,o),h.filter="grayscale(1)",h.drawImage(t,0,0,t.width,t.height,0,0,r,o);const c=h.getImageData(0,0,r,o).data;return[this.#u(c),r,o]}static extractContoursFromText(t,{fontFamily:e,fontStyle:i,fontWeight:n},s,r,o,l){let h=new OffscreenCanvas(1,1),c=h.getContext("2d",{alpha:!1});const u=200,p=c.font=`${i} ${n} ${u}px ${e}`,{actualBoundingBoxLeft:b,actualBoundingBoxRight:w,actualBoundingBoxAscent:v,actualBoundingBoxDescent:x,fontBoundingBoxAscent:E,fontBoundingBoxDescent:D,width:T}=c.measureText(t),k=1.5,F=Math.ceil(Math.max(Math.abs(b)+Math.abs(w)||0,T)*k),M=Math.ceil(Math.max(Math.abs(v)+Math.abs(x)||u,Math.abs(E)+Math.abs(D)||u)*k);h=new OffscreenCanvas(F,M),c=h.getContext("2d",{alpha:!0,willReadFrequently:!0}),c.font=p,c.filter="grayscale(1)",c.fillStyle="white",c.fillRect(0,0,F,M),c.fillStyle="black",c.fillText(t,F*(k-1)/2,M*(3-k)/2);const O=this.#u(c.getImageData(0,0,F,M).data),N=this.#l(O),R=this.#d(N),$=this.#r(O,F,M,R);return this.processDrawnLines({lines:{curves:$,width:F,height:M},pageWidth:s,pageHeight:r,rotation:o,innerMargin:l,mustSmooth:!0,areContours:!0})}static process(t,e,i,n,s){const[r,o,l]=this.#f(t),[h,c]=this.#h(r,o,l,Math.hypot(o,l)*this.#t.sigmaSFactor,this.#t.sigmaR,this.#t.kernelSize),u=this.#d(c),p=this.#r(h,o,l,u);return this.processDrawnLines({lines:{curves:p,width:o,height:l},pageWidth:e,pageHeight:i,rotation:n,innerMargin:s,mustSmooth:!0,areContours:!0})}static processDrawnLines({lines:t,pageWidth:e,pageHeight:i,rotation:n,innerMargin:s,mustSmooth:r,areContours:o}){n%180!==0&&([e,i]=[i,e]);const{curves:l,width:h,height:c}=t,u=t.thickness??0,p=[],b=Math.min(e/h,i/c),w=b/e,v=b/i,x=[];for(const{points:D}of l){const T=r?this.#a(D):D;if(!T)continue;x.push(T);const k=T.length,F=new Float32Array(k),M=new Float32Array(3*(k===2?2:k-2));if(p.push({line:M,points:F}),k===2){F[0]=T[0]*w,F[1]=T[1]*v,M.set([NaN,NaN,NaN,NaN,F[0],F[1]],0);continue}let[O,N,R,$]=T;O*=w,N*=v,R*=w,$*=v,F.set([O,N,R,$],0),M.set([NaN,NaN,NaN,NaN,O,N],0);for(let U=4;U<k;U+=2){const Q=F[U]=T[U]*w,V=F[U+1]=T[U+1]*v;M.set(tt.createBezierPoints(O,N,R,$,Q,V),(U-2)*3),[O,N,R,$]=[R,$,Q,V]}}if(p.length===0)return null;const E=o?new Ao:new Es;return E.build(p,e,i,1,n,o?0:u,s),{outline:E,newCurves:x,areContours:o,thickness:u,width:h,height:c}}static async compressSignature({outlines:t,areContours:e,thickness:i,width:n,height:s}){let r=1/0,o=-1/0,l=0;for(const T of t){l+=T.length;for(let k=2,F=T.length;k<F;k++){const M=T[k]-T[k-2];r=Math.min(r,M),o=Math.max(o,M)}}let h;r>=-128&&o<=127?h=Int8Array:r>=-32768&&o<=32767?h=Int16Array:h=Int32Array;const c=t.length,u=Bs+Wn*c,p=new Uint32Array(u);let b=0;p[b++]=u*Uint32Array.BYTES_PER_ELEMENT+(l-2*c)*h.BYTES_PER_ELEMENT,p[b++]=0,p[b++]=n,p[b++]=s,p[b++]=e?0:1,p[b++]=Math.max(0,Math.floor(i??0)),p[b++]=c,p[b++]=h.BYTES_PER_ELEMENT;for(const T of t)p[b++]=T.length-2,p[b++]=T[0],p[b++]=T[1];const w=new CompressionStream("deflate-raw"),v=w.writable.getWriter();await v.ready,v.write(p);const x=h.prototype.constructor;for(const T of t){const k=new x(T.length-2);for(let F=2,M=T.length;F<M;F++)k[F-2]=T[F]-T[F-2];v.write(k)}v.close();const E=await new Response(w.readable).arrayBuffer(),D=new Uint8Array(E);return Il(D)}static async decompressSignature(t){try{const e=Vc(t),{readable:i,writable:n}=new DecompressionStream("deflate-raw"),s=n.getWriter();await s.ready,s.write(e).then(async()=>{await s.ready,await s.close()}).catch(()=>{});let r=null,o=0;for await(const T of i)r||=new Uint8Array(new Uint32Array(T.buffer,0,4)[0]),r.set(T,o),o+=T.length;const l=new Uint32Array(r.buffer,0,r.length>>2),h=l[1];if(h!==0)throw new Error(`Invalid version: ${h}`);const c=l[2],u=l[3],p=l[4]===0,b=l[5],w=l[6],v=l[7],x=[],E=(Bs+Wn*w)*Uint32Array.BYTES_PER_ELEMENT;let D;switch(v){case Int8Array.BYTES_PER_ELEMENT:D=new Int8Array(r.buffer,E);break;case Int16Array.BYTES_PER_ELEMENT:D=new Int16Array(r.buffer,E);break;case Int32Array.BYTES_PER_ELEMENT:D=new Int32Array(r.buffer,E);break}o=0;for(let T=0;T<w;T++){const k=l[Wn*T+Bs],F=new Float32Array(k+2);x.push(F);for(let M=0;M<Wn-1;M++)F[M]=l[Wn*T+Bs+M+1];for(let M=0;M<k;M++)F[M+2]=F[M]+D[o++]}return{areContours:p,thickness:b,outlines:x,width:c,height:u}}catch(e){return ft(`decompressSignature: ${e}`),null}}}class Go extends lh{constructor(){super(),super.updateProperties({fill:nt._defaultLineColor,"stroke-width":0})}clone(){const t=new Go;return t.updateAll(this),t}}class Vo extends vr{constructor(t){super(t),super.updateProperties({stroke:nt._defaultLineColor,"stroke-width":1})}clone(){const t=new Vo(this._viewParameters);return t.updateAll(this),t}}class bi extends Dt{#t=!1;#e=null;#n=null;#i=null;static _type="signature";static _editorType=gt.SIGNATURE;static _defaultDrawingOptions=null;constructor(t){super({...t,mustBeCommitted:!0,name:"signatureEditor"}),this._willKeepAspectRatio=!0,this.#n=t.signatureData||null,this.#e=null,this.defaultL10nId="pdfjs-editor-signature-editor1"}static initialize(t,e){nt.initialize(t,e),this._defaultDrawingOptions=new Go,this._defaultDrawnSignatureOptions=new Vo(e.viewParameters)}static getDefaultDrawingOptions(t){const e=this._defaultDrawingOptions.clone();return e.updateProperties(t),e}static get supportMultipleDrawings(){return!1}static get typesMap(){return pt(this,"typesMap",new Map)}static get isDrawer(){return!1}get telemetryFinalData(){return{type:"signature",hasDescription:!!this.#e}}static computeTelemetryFinalData(t){const e=t.get("hasDescription");return{hasAltText:e.get(!0)??0,hasNoAltText:e.get(!1)??0}}get isResizable(){return!0}onScaleChanging(){this._drawId!==null&&super.onScaleChanging()}render(){if(this.div)return this.div;let t,e;const{_isCopy:i}=this;if(i&&(this._isCopy=!1,t=this.x,e=this.y),super.render(),this._drawId===null)if(this.#n){const{lines:n,mustSmooth:s,areContours:r,description:o,uuid:l,heightInPage:h}=this.#n,{rawDims:{pageWidth:c,pageHeight:u},rotation:p}=this.parent.viewport,b=An.processDrawnLines({lines:n,pageWidth:c,pageHeight:u,rotation:p,innerMargin:bi._INNER_MARGIN,mustSmooth:s,areContours:r});this.addSignature(b,h,o,l)}else this.div.setAttribute("data-l10n-args",JSON.stringify({description:""})),this.div.hidden=!0,this._uiManager.getSignature(this);else this.div.setAttribute("data-l10n-args",JSON.stringify({description:this.#e||""}));return i&&(this._isCopy=!0,this._moveAfterPaste(t,e)),this.div}setUuid(t){this.#i=t,this.addEditToolbar()}getUuid(){return this.#i}get description(){return this.#e}set description(t){this.#e=t,this.div&&(this.div.setAttribute("data-l10n-args",JSON.stringify({description:t})),super.addEditToolbar().then(e=>{e?.updateEditSignatureButton(t)}))}getSignaturePreview(){const{newCurves:t,areContours:e,thickness:i,width:n,height:s}=this.#n,r=Math.max(n,s),o=An.processDrawnLines({lines:{curves:t.map(l=>({points:l})),thickness:i,width:n,height:s},pageWidth:r,pageHeight:r,rotation:0,innerMargin:0,mustSmooth:!1,areContours:e});return{areContours:e,outline:o.outline}}get toolbarButtons(){return this._uiManager.signatureManager?[["editSignature",this._uiManager.signatureManager]]:super.toolbarButtons}addSignature(t,e,i,n){const{x:s,y:r}=this,{outline:o}=this.#n=t;this.#t=o instanceof Ao,this.description=i;let l;this.#t?l=bi.getDefaultDrawingOptions():(l=bi._defaultDrawnSignatureOptions.clone(),l.updateProperties({"stroke-width":o.thickness})),this._addOutlines({drawOutlines:o,drawingOptions:l});const[,h]=this.pageDimensions;let c=e/h;c=c>=1?.5:c,this.width*=c/this.height,this.width>=1&&(c*=.9/this.width,this.width=.9),this.height=c,this.setDims(),this.x=s,this.y=r,this.center(),this._onResized(),this.onScaleChanging(),this.rotate(),this._uiManager.addToAnnotationStorage(this),this.setUuid(n),this._reportTelemetry({action:"pdfjs.signature.inserted",data:{hasBeenSaved:!!n,hasDescription:!!i}}),this.div.hidden=!1}getFromImage(t){const{rawDims:{pageWidth:e,pageHeight:i},rotation:n}=this.parent.viewport;return An.process(t,e,i,n,bi._INNER_MARGIN)}getFromText(t,e){const{rawDims:{pageWidth:i,pageHeight:n},rotation:s}=this.parent.viewport;return An.extractContoursFromText(t,e,i,n,s,bi._INNER_MARGIN)}getDrawnSignature(t){const{rawDims:{pageWidth:e,pageHeight:i},rotation:n}=this.parent.viewport;return An.processDrawnLines({lines:t,pageWidth:e,pageHeight:i,rotation:n,innerMargin:bi._INNER_MARGIN,mustSmooth:!1,areContours:!1})}createDrawingOptions({areContours:t,thickness:e}){t?this._drawingOptions=bi.getDefaultDrawingOptions():(this._drawingOptions=bi._defaultDrawnSignatureOptions.clone(),this._drawingOptions.updateProperties({"stroke-width":e}))}serialize(t=!1){if(this.isEmpty())return null;const{lines:e,points:i}=this.serializeDraw(t),{_drawingOptions:{"stroke-width":n}}=this,s=Object.assign(super.serialize(t),{isSignature:!0,areContours:this.#t,color:[0,0,0],thickness:this.#t?0:n});return this.addComment(s),t?(s.paths={lines:e,points:i},s.uuid=this.#i,s.isCopy=!0):s.lines=e,this.#e&&(s.accessibilityData={type:"Figure",alt:this.#e}),s}static deserializeDraw(t,e,i,n,s,r){return r.areContours?Ao.deserialize(t,e,i,n,s,r):Es.deserialize(t,e,i,n,s,r)}static async deserialize(t,e,i){const n=await super.deserialize(t,e,i);return n.#t=t.areContours,n.description=t.accessibilityData?.alt||"",n.#i=t.uuid,n}}class Fu extends nt{#t=null;#e=null;#n=null;#i=null;#o=null;#r="";#s=null;#a=!1;#h=null;#l=!1;#u=!1;static _type="stamp";static _editorType=gt.STAMP;constructor(t){super({...t,name:"stampEditor"}),this.#i=t.bitmapUrl,this.#o=t.bitmapFile,this.defaultL10nId="pdfjs-editor-stamp-editor"}static initialize(t,e){nt.initialize(t,e)}static isHandlingMimeForPasting(t){return uo.includes(t)}static paste(t,e){e.pasteEditor({mode:gt.STAMP},{bitmapFile:t.getAsFile()})}altTextFinish(){this._uiManager.useNewAltTextFlow&&(this.div.hidden=!1),super.altTextFinish()}get telemetryFinalData(){return{type:"stamp",hasAltText:!!this.altTextData?.altText}}static computeTelemetryFinalData(t){const e=t.get("hasAltText");return{hasAltText:e.get(!0)??0,hasNoAltText:e.get(!1)??0}}#d(t,e=!1){if(!t){this.remove();return}this.#t=t.bitmap,e||(this.#e=t.id,this.#l=t.isSvg),t.file&&(this.#r=t.file.name),this.#g()}#f(){if(this.#n=null,this._uiManager.enableWaiting(!1),!!this.#s){if(this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&this.#t){this.addEditToolbar().then(()=>{this._editToolbar.hide(),this._uiManager.editAltText(this,!0)});return}if(!this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&this.#t){this._reportTelemetry({action:"pdfjs.image.image_added",data:{alt_text_modal:!1,alt_text_type:"empty"}});try{this.mlGuessAltText()}catch{}}this.div.focus()}}async mlGuessAltText(t=null,e=!0){if(this.hasAltTextData())return null;const{mlManager:i}=this._uiManager;if(!i)throw new Error("No ML.");if(!await i.isEnabledFor("altText"))throw new Error("ML isn't enabled for alt text.");const{data:n,width:s,height:r}=t||this.copyCanvas(null,null,!0).imageData,o=await i.guess({name:"altText",request:{data:n,width:s,height:r,channels:n.length/(s*r)}});if(!o)throw new Error("No response from the AI service.");if(o.error)throw new Error("Error from the AI service.");if(o.cancel)return null;if(!o.output)throw new Error("No valid response from the AI service.");const l=o.output;return await this.setGuessedAltText(l),e&&!this.hasAltTextData()&&(this.altTextData={alt:l,decorative:!1}),l}#m(){if(this.#e){this._uiManager.enableWaiting(!0),this._uiManager.imageManager.getFromId(this.#e).then(i=>this.#d(i,!0)).finally(()=>this.#f());return}if(this.#i){const i=this.#i;this.#i=null,this._uiManager.enableWaiting(!0),this.#n=this._uiManager.imageManager.getFromUrl(i).then(n=>this.#d(n)).finally(()=>this.#f());return}if(this.#o){const i=this.#o;this.#o=null,this._uiManager.enableWaiting(!0),this.#n=this._uiManager.imageManager.getFromFile(i).then(n=>this.#d(n)).finally(()=>this.#f());return}const t=document.createElement("input");t.type="file",t.accept=uo.join(",");const e=this._uiManager._signal;this.#n=new Promise(i=>{t.addEventListener("change",async()=>{if(!t.files||t.files.length===0)this.remove();else{this._uiManager.enableWaiting(!0);const n=await this._uiManager.imageManager.getFromFile(t.files[0]);this._reportTelemetry({action:"pdfjs.image.image_selected",data:{alt_text_modal:this._uiManager.useNewAltTextFlow}}),this.#d(n)}i()},{signal:e}),t.addEventListener("cancel",()=>{this.remove(),i()},{signal:e})}).finally(()=>this.#f()),t.click()}remove(){this.#e&&(this.#t=null,this._uiManager.imageManager.deleteId(this.#e),this.#s?.remove(),this.#s=null,this.#h&&(clearTimeout(this.#h),this.#h=null)),super.remove()}rebuild(){if(!this.parent){this.#e&&this.#m();return}super.rebuild(),this.div!==null&&(this.#e&&this.#s===null&&this.#m(),this.isAttachedToDOM||this.parent.add(this))}onceAdded(t){this._isDraggable=!0,t&&this.div.focus()}isEmpty(){return!(this.#n||this.#t||this.#i||this.#o||this.#e||this.#a)}get toolbarButtons(){return[["altText",this.createAltText()]]}get isResizable(){return!0}render(){if(this.div)return this.div;let t,e;return this._isCopy&&(t=this.x,e=this.y),super.render(),this.div.hidden=!0,this.createAltText(),this.#a||(this.#t?this.#g():this.#m()),this._isCopy&&this._moveAfterPaste(t,e),this._uiManager.addShouldRescale(this),this.div}setCanvas(t,e){const{id:i,bitmap:n}=this._uiManager.imageManager.getFromCanvas(t,e);e.remove(),i&&this._uiManager.imageManager.isValidId(i)&&(this.#e=i,n&&(this.#t=n),this.#a=!1,this.#g())}_onResized(){this.onScaleChanging()}onScaleChanging(){if(!this.parent)return;this.#h!==null&&clearTimeout(this.#h);const t=200;this.#h=setTimeout(()=>{this.#h=null,this.#p()},t)}#g(){const{div:t}=this;let{width:e,height:i}=this.#t;const[n,s]=this.pageDimensions,r=.75;if(this.width)e=this.width*n,i=this.height*s;else if(e>r*n||i>r*s){const l=Math.min(r*n/e,r*s/i);e*=l,i*=l}this._uiManager.enableWaiting(!1);const o=this.#s=document.createElement("canvas");o.setAttribute("role","img"),this.addContainer(o),this.width=e/n,this.height=i/s,this.setDims(),this._initialOptions?.isCentered?this.center():this.fixAndSetPosition(),this._initialOptions=null,(!this._uiManager.useNewAltTextWhenAddingImage||!this._uiManager.useNewAltTextFlow||this.annotationElementId)&&(t.hidden=!1),this.#p(),this.#u||(this.parent.addUndoableEditor(this),this.#u=!0),this._reportTelemetry({action:"inserted_image"}),this.#r&&this.div.setAttribute("aria-description",this.#r),this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-stamp-added-alert")}copyCanvas(t,e,i=!1){t||(t=224);const{width:n,height:s}=this.#t,r=new xi;let o=this.#t,l=n,h=s,c=null;if(e){if(n>e||s>e){const M=Math.min(e/n,e/s);l=Math.floor(n*M),h=Math.floor(s*M)}c=document.createElement("canvas");const p=c.width=Math.ceil(l*r.sx),b=c.height=Math.ceil(h*r.sy);this.#l||(o=this.#c(p,b));const w=c.getContext("2d");w.filter=this._uiManager.hcmFilter;let v="white",x="#cfcfd8";this._uiManager.hcmFilter!=="none"?x="black":Jc.isDarkMode&&(v="#8f8f9d",x="#42414d");const E=15,D=E*r.sx,T=E*r.sy,k=new OffscreenCanvas(D*2,T*2),F=k.getContext("2d");F.fillStyle=v,F.fillRect(0,0,D*2,T*2),F.fillStyle=x,F.fillRect(0,0,D,T),F.fillRect(D,T,D,T),w.fillStyle=w.createPattern(k,"repeat"),w.fillRect(0,0,p,b),w.drawImage(o,0,0,o.width,o.height,0,0,p,b)}let u=null;if(i){let p,b;if(r.symmetric&&o.width<t&&o.height<t)p=o.width,b=o.height;else if(o=this.#t,n>t||s>t){const x=Math.min(t/n,t/s);p=Math.floor(n*x),b=Math.floor(s*x),this.#l||(o=this.#c(p,b))}const v=new OffscreenCanvas(p,b).getContext("2d",{willReadFrequently:!0});v.drawImage(o,0,0,o.width,o.height,0,0,p,b),u={width:p,height:b,data:v.getImageData(0,0,p,b).data}}return{canvas:c,width:l,height:h,imageData:u}}#c(t,e){const{width:i,height:n}=this.#t;let s=i,r=n,o=this.#t;for(;s>2*t||r>2*e;){const l=s,h=r;s>2*t&&(s=s>=16384?Math.floor(s/2)-1:Math.ceil(s/2)),r>2*e&&(r=r>=16384?Math.floor(r/2)-1:Math.ceil(r/2));const c=new OffscreenCanvas(s,r);c.getContext("2d").drawImage(o,0,0,l,h,0,0,s,r),o=c.transferToImageBitmap()}return o}#p(){const[t,e]=this.parentDimensions,{width:i,height:n}=this,s=new xi,r=Math.ceil(i*t*s.sx),o=Math.ceil(n*e*s.sy),l=this.#s;if(!l||l.width===r&&l.height===o)return;l.width=r,l.height=o;const h=this.#l?this.#t:this.#c(r,o),c=l.getContext("2d");c.filter=this._uiManager.hcmFilter,c.drawImage(h,0,0,h.width,h.height,0,0,r,o)}#b(t){if(t){if(this.#l){const n=this._uiManager.imageManager.getSvgUrl(this.#e);if(n)return n}const e=document.createElement("canvas");return{width:e.width,height:e.height}=this.#t,e.getContext("2d").drawImage(this.#t,0,0),e.toDataURL()}if(this.#l){const[e,i]=this.pageDimensions,n=Math.round(this.width*e*Ln.PDF_TO_CSS_UNITS),s=Math.round(this.height*i*Ln.PDF_TO_CSS_UNITS),r=new OffscreenCanvas(n,s);return r.getContext("2d").drawImage(this.#t,0,0,this.#t.width,this.#t.height,0,0,n,s),r.transferToImageBitmap()}return structuredClone(this.#t)}static async deserialize(t,e,i){let n=null,s=!1;if(t instanceof oh){const{data:{rect:v,rotation:x,id:E,structParent:D,popupRef:T,richText:k,contentsObj:F,creationDate:M,modificationDate:O},container:N,parent:{page:{pageNumber:R}},canvas:$}=t;let U,Q;$?(delete t.canvas,{id:U,bitmap:Q}=i.imageManager.getFromCanvas(N.id,$),$.remove()):(s=!0,t._hasNoCanvas=!0);const V=(await e._structTree.getAriaAttributes(`${Sn}${E}`))?.get("aria-label")||"";n=t={annotationType:gt.STAMP,bitmapId:U,bitmap:Q,pageIndex:R-1,rect:v.slice(0),rotation:x,annotationElementId:E,id:E,deleted:!1,accessibilityData:{decorative:!1,altText:V},isSvg:!1,structParent:D,popupRef:T,richText:k,comment:F?.str||null,creationDate:M,modificationDate:O}}const r=await super.deserialize(t,e,i),{rect:o,bitmap:l,bitmapUrl:h,bitmapId:c,isSvg:u,accessibilityData:p}=t;s?(i.addMissingCanvas(t.id,r),r.#a=!0):c&&i.imageManager.isValidId(c)?(r.#e=c,l&&(r.#t=l)):r.#i=h,r.#l=u;const[b,w]=r.pageDimensions;return r.width=(o[2]-o[0])/b,r.height=(o[3]-o[1])/w,p&&(r.altTextData=p),r._initialData=n,t.comment&&r.setCommentData(t),r.#u=!!n,r}serialize(t=!1,e=null){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const i=Object.assign(super.serialize(t),{bitmapId:this.#e,isSvg:this.#l});if(this.addComment(i),t)return i.bitmapUrl=this.#b(!0),i.accessibilityData=this.serializeAltText(!0),i.isCopy=!0,i;const{decorative:n,altText:s}=this.serializeAltText(!1);if(!n&&s&&(i.accessibilityData={type:"Figure",alt:s}),this.annotationElementId){const o=this.#w(i);return o.isSame?null:(o.isSameAltText?delete i.accessibilityData:i.accessibilityData.structParent=this._initialData.structParent??-1,i.id=this.annotationElementId,delete i.bitmapId,i)}if(e===null)return i;e.stamps||=new Map;const r=this.#l?(i.rect[2]-i.rect[0])*(i.rect[3]-i.rect[1]):null;if(!e.stamps.has(this.#e))e.stamps.set(this.#e,{area:r,serialized:i}),i.bitmap=this.#b(!1);else if(this.#l){const o=e.stamps.get(this.#e);r>o.area&&(o.area=r,o.serialized.bitmap.close(),o.serialized.bitmap=this.#b(!1))}return i}#w(t){const{pageIndex:e,accessibilityData:{altText:i}}=this._initialData,n=t.pageIndex===e,s=(t.accessibilityData?.alt||"")===i;return{isSame:!this.hasEditedComment&&!this._hasBeenMoved&&!this._hasBeenResized&&n&&s,isSameAltText:s}}renderAnnotationElement(t){return this.deleted?(t.hide(),null):(t.updateEdited({rect:this.getPDFRect(),popup:this.comment}),null)}}class Di{#t;#e=!1;#n=null;#i=null;#o=null;#r=new Map;#s=!1;#a=!1;#h=!1;#l=null;#u=null;#d=null;#f=null;#m=null;#g=-1;#c;static _initialized=!1;static#p=new Map([ge,zo,Fu,ee,bi].map(t=>[t._editorType,t]));constructor({uiManager:t,pageIndex:e,div:i,structTreeLayer:n,accessibilityManager:s,annotationLayer:r,drawLayer:o,textLayer:l,viewport:h,l10n:c}){const u=[...Di.#p.values()];if(!Di._initialized){Di._initialized=!0;for(const p of u)p.initialize(c,t)}t.registerEditorTypes(u),this.#c=t,this.pageIndex=e,this.div=i,this.#t=s,this.#n=r,this.viewport=h,this.#d=l,this.drawLayer=o,this._structTree=n,this.#c.addLayer(this)}get isEmpty(){return this.#r.size===0}get isInvisible(){return this.isEmpty&&this.#c.getMode()===gt.NONE}updateToolbar(t){this.#c.updateToolbar(t)}updateMode(t=this.#c.getMode()){switch(this.#A(),t){case gt.NONE:this.div.classList.toggle("nonEditing",!0),this.disableTextSelection(),this.togglePointerEvents(!1),this.toggleAnnotationLayerPointerEvents(!0),this.disableClick();return;case gt.INK:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick();break;case gt.HIGHLIGHT:this.enableTextSelection(),this.togglePointerEvents(!1),this.disableClick();break;default:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick()}this.toggleAnnotationLayerPointerEvents(!1);const{classList:e}=this.div;if(e.toggle("nonEditing",!1),t===gt.POPUP)e.toggle("commentEditing",!0);else{e.toggle("commentEditing",!1);for(const i of Di.#p.values())e.toggle(`${i._type}Editing`,t===i._editorType)}this.div.hidden=!1}hasTextLayer(t){return t===this.#d?.div}setEditingState(t){this.#c.setEditingState(t)}addCommands(t){this.#c.addCommands(t)}cleanUndoStack(t){this.#c.cleanUndoStack(t)}toggleDrawing(t=!1){this.div.classList.toggle("drawing",!t)}togglePointerEvents(t=!1){this.div.classList.toggle("disabled",!t)}toggleAnnotationLayerPointerEvents(t=!1){this.#n?.togglePointerEvents(t)}get#b(){return this.#r.size!==0?this.#r.values():this.#c.getEditors(this.pageIndex)}async enable(){this.#h=!0,this.div.tabIndex=0,this.togglePointerEvents(!0),this.div.classList.toggle("nonEditing",!1),this.#m?.abort(),this.#m=null;const t=new Set;for(const i of this.#b)i.enableEditing(),i.show(!0),i.annotationElementId&&(this.#c.removeChangedExistingAnnotation(i),t.add(i.annotationElementId));const e=this.#n;if(e)for(const i of e.getEditableAnnotations()){if(i.hide(),this.#c.isDeletedAnnotationElement(i.data.id)||t.has(i.data.id))continue;const n=await this.deserialize(i);n&&(this.addOrRebuild(n),n.enableEditing())}this.#h=!1,this.#c._eventBus.dispatch("editorsrendered",{source:this,pageNumber:this.pageIndex+1})}disable(){if(this.#a=!0,this.div.tabIndex=-1,this.togglePointerEvents(!1),this.div.classList.toggle("nonEditing",!0),this.#d&&!this.#m){this.#m=new AbortController;const n=this.#c.combinedSignal(this.#m);this.#d.div.addEventListener("pointerdown",s=>{const{clientX:o,clientY:l,timeStamp:h}=s,c=this.#g;if(h-c>500){this.#g=h;return}this.#g=-1;const{classList:u}=this.div;u.toggle("getElements",!0);const p=document.elementsFromPoint(o,l);if(u.toggle("getElements",!1),!this.div.contains(p[0]))return;let b;const w=new RegExp(`^${ls}[0-9]+$`);for(const x of p)if(w.test(x.id)){b=x.id;break}if(!b)return;const v=this.#r.get(b);v?.annotationElementId===null&&(s.stopPropagation(),s.preventDefault(),v.dblclick(s))},{signal:n,capture:!0})}const t=this.#n,e=[];if(t){const n=new Map,s=new Map;for(const o of this.#b){if(o.disableEditing(),!o.annotationElementId){e.push(o);continue}if(o.serialize()!==null){n.set(o.annotationElementId,o);continue}else s.set(o.annotationElementId,o);this.getEditableAnnotation(o.annotationElementId)?.show(),o.remove()}const r=t.getEditableAnnotations();for(const o of r){const{id:l}=o.data;if(this.#c.isDeletedAnnotationElement(l)){o.updateEdited({deleted:!0});continue}let h=s.get(l);if(h){h.resetAnnotationElement(o),h.show(!1),o.show();continue}h=n.get(l),h&&(this.#c.addChangedExistingAnnotation(h),h.renderAnnotationElement(o)&&h.show(!1)),o.show()}}this.#A(),this.isEmpty&&(this.div.hidden=!0);const{classList:i}=this.div;for(const n of Di.#p.values())i.remove(`${n._type}Editing`);this.disableTextSelection(),this.toggleAnnotationLayerPointerEvents(!0),t?.updateFakeAnnotations(e),this.#a=!1}getEditableAnnotation(t){return this.#n?.getEditableAnnotation(t)||null}setActiveEditor(t){this.#c.getActive()!==t&&this.#c.setActiveEditor(t)}enableTextSelection(){if(this.div.tabIndex=-1,this.#d?.div&&!this.#f){this.#f=new AbortController;const t=this.#c.combinedSignal(this.#f);this.#d.div.addEventListener("pointerdown",this.#w.bind(this),{signal:t}),this.#d.div.classList.add("highlighting")}}disableTextSelection(){this.div.tabIndex=0,this.#d?.div&&this.#f&&(this.#f.abort(),this.#f=null,this.#d.div.classList.remove("highlighting"))}#w(t){this.#c.unselectAll();const{target:e}=t;if(e===this.#d.div||(e.getAttribute("role")==="img"||e.classList.contains("endOfContent"))&&this.#d.div.contains(e)){const{isMac:i}=fe.platform;if(t.button!==0||t.ctrlKey&&i)return;this.#c.showAllEditors("highlight",!0,!0),this.#d.div.classList.add("free"),this.toggleDrawing(),ee.startHighlighting(this,this.#c.direction==="ltr",{target:this.#d.div,x:t.x,y:t.y}),this.#d.div.addEventListener("pointerup",()=>{this.#d.div.classList.remove("free"),this.toggleDrawing(!0)},{once:!0,signal:this.#c._signal}),t.preventDefault()}}enableClick(){if(this.#i)return;this.#i=new AbortController;const t=this.#c.combinedSignal(this.#i);this.div.addEventListener("pointerdown",this.pointerdown.bind(this),{signal:t});const e=this.pointerup.bind(this);this.div.addEventListener("pointerup",e,{signal:t}),this.div.addEventListener("pointercancel",e,{signal:t})}disableClick(){this.#i?.abort(),this.#i=null}attach(t){this.#r.set(t.id,t);const{annotationElementId:e}=t;e&&this.#c.isDeletedAnnotationElement(e)&&this.#c.removeDeletedAnnotationElement(t)}detach(t){this.#r.delete(t.id),this.#t?.removePointerInTextLayer(t.contentDiv),!this.#a&&t.annotationElementId&&this.#c.addDeletedAnnotationElement(t)}remove(t){this.detach(t),this.#c.removeEditor(t),t.div.remove(),t.isAttachedToDOM=!1}changeParent(t){t.parent!==this&&(t.parent&&t.annotationElementId&&(this.#c.addDeletedAnnotationElement(t),nt.deleteAnnotationElement(t),t.annotationElementId=null),this.attach(t),t.parent?.detach(t),t.setParent(this),t.div&&t.isAttachedToDOM&&(t.div.remove(),this.div.append(t.div)))}add(t){if(!(t.parent===this&&t.isAttachedToDOM)){if(this.changeParent(t),this.#c.addEditor(t),this.attach(t),!t.isAttachedToDOM){const e=t.render();this.div.append(e),t.isAttachedToDOM=!0}t.fixAndSetPosition(),t.onceAdded(!this.#h),this.#c.addToAnnotationStorage(t),t._reportTelemetry(t.telemetryInitialData)}}moveEditorInDOM(t){if(!t.isAttachedToDOM)return;const{activeElement:e}=document;t.div.contains(e)&&!this.#o&&(t._focusEventsAllowed=!1,this.#o=setTimeout(()=>{this.#o=null,t.div.contains(document.activeElement)?t._focusEventsAllowed=!0:(t.div.addEventListener("focusin",()=>{t._focusEventsAllowed=!0},{once:!0,signal:this.#c._signal}),e.focus())},0)),t._structTreeParentId=this.#t?.moveElementInDOM(this.div,t.div,t.contentDiv,!0)}addOrRebuild(t){t.needsToBeRebuilt()?(t.parent||=this,t.rebuild(),t.show()):this.add(t)}addUndoableEditor(t){const e=()=>t._uiManager.rebuild(t),i=()=>{t.remove()};this.addCommands({cmd:e,undo:i,mustExec:!1})}getEditorByUID(t){for(const e of this.#r.values())if(e.uid===t)return e;return null}getNextId(){return this.#c.getId()}get#y(){return Di.#p.get(this.#c.getMode())}combinedSignal(t){return this.#c.combinedSignal(t)}#C(t){const e=this.#y;return e?new e.prototype.constructor(t):null}canCreateNewEmptyEditor(){return this.#y?.canCreateNewEmptyEditor()}async pasteEditor(t,e){this.updateToolbar(t),await this.#c.updateMode(t.mode);const{offsetX:i,offsetY:n}=this.#S(),s=this.getNextId(),r=this.#C({parent:this,id:s,x:i,y:n,uiManager:this.#c,isCentered:!0,...e});r&&this.add(r)}async deserialize(t){return await Di.#p.get(t.annotationType??t.annotationEditorType)?.deserialize(t,this,this.#c)||null}createAndAddNewEditor(t,e,i={}){const n=this.getNextId(),s=this.#C({parent:this,id:n,x:t.offsetX,y:t.offsetY,uiManager:this.#c,isCentered:e,...i});return s&&this.add(s),s}get boundingClientRect(){return this.div.getBoundingClientRect()}#S(){const{x:t,y:e,width:i,height:n}=this.boundingClientRect,s=Math.max(0,t),r=Math.max(0,e),o=Math.min(window.innerWidth,t+i),l=Math.min(window.innerHeight,e+n),h=(s+o)/2-t,c=(r+l)/2-e,[u,p]=this.viewport.rotation%180===0?[h,c]:[c,h];return{offsetX:u,offsetY:p}}addNewEditor(t={}){this.createAndAddNewEditor(this.#S(),!0,t)}setSelected(t){this.#c.setSelected(t)}toggleSelected(t){this.#c.toggleSelected(t)}unselect(t){this.#c.unselect(t)}pointerup(t){const{isMac:e}=fe.platform;if(t.button!==0||t.ctrlKey&&e||t.target!==this.div||!this.#s||(this.#s=!1,this.#y?.isDrawer&&this.#y.supportMultipleDrawings))return;if(!this.#e){this.#e=!0;return}const i=this.#c.getMode();if(i===gt.STAMP||i===gt.SIGNATURE){this.#c.unselectAll();return}this.createAndAddNewEditor(t,!1)}pointerdown(t){if(this.#c.getMode()===gt.HIGHLIGHT&&this.enableTextSelection(),this.#s){this.#s=!1;return}const{isMac:e}=fe.platform;if(t.button!==0||t.ctrlKey&&e||t.target!==this.div)return;if(this.#s=!0,this.#y?.isDrawer){this.startDrawingSession(t);return}const i=this.#c.getActive();this.#e=!i||i.isEmpty()}startDrawingSession(t){if(this.div.focus({preventScroll:!0}),this.#l){this.#y.startDrawing(this,this.#c,!1,t);return}this.#c.setCurrentDrawingSession(this),this.#l=new AbortController;const e=this.#c.combinedSignal(this.#l);this.div.addEventListener("blur",({relatedTarget:i})=>{i&&!this.div.contains(i)&&(this.#u=null,this.commitOrRemove())},{signal:e}),this.#y.startDrawing(this,this.#c,!1,t)}pause(t){if(t){const{activeElement:e}=document;this.div.contains(e)&&(this.#u=e);return}this.#u&&setTimeout(()=>{this.#u?.focus(),this.#u=null},0)}endDrawingSession(t=!1){return this.#l?(this.#c.setCurrentDrawingSession(null),this.#l.abort(),this.#l=null,this.#u=null,this.#y.endDrawing(t)):null}findNewParent(t,e,i){const n=this.#c.findParent(e,i);return n===null||n===this?!1:(n.changeParent(t),!0)}commitOrRemove(){return this.#l?(this.endDrawingSession(),!0):!1}onScaleChanging(){this.#l&&this.#y.onScaleChangingWhenDrawing(this)}destroy(){this.commitOrRemove(),this.#c.getActive()?.parent===this&&(this.#c.commitOrRemove(),this.#c.setActiveEditor(null)),this.#o&&(clearTimeout(this.#o),this.#o=null);for(const t of this.#r.values())this.#t?.removePointerInTextLayer(t.contentDiv),t.setParent(null),t.isAttachedToDOM=!1,t.div.remove();this.div=null,this.#r.clear(),this.#c.removeLayer(this)}#A(){for(const t of this.#r.values())t.isEmpty()&&t.remove()}render({viewport:t}){this.viewport=t,on(this.div,t);for(const e of this.#c.getEditors(this.pageIndex))this.add(e),e.rebuild();this.updateMode()}update({viewport:t}){this.#c.commitOrRemove(),this.#A();const e=this.viewport.rotation,i=t.rotation;if(this.viewport=t,on(this.div,{rotation:i}),e!==i)for(const n of this.#r.values())n.rotate(i)}get pageDimensions(){const{pageWidth:t,pageHeight:e}=this.viewport.rawDims;return[t,e]}get scale(){return this.#c.viewParameters.realScale}}class ve{#t=null;#e=new Map;#n=new Map;static#i=0;constructor({pageIndex:t}){this.pageIndex=t}setParent(t){if(!this.#t){this.#t=t;return}if(this.#t!==t){if(this.#e.size>0)for(const e of this.#e.values())e.remove(),t.append(e);this.#t=t}}static get _svgFactory(){return pt(this,"_svgFactory",new ir)}static#o(t,[e,i,n,s]){const{style:r}=t;r.top=`${100*i}%`,r.left=`${100*e}%`,r.width=`${100*n}%`,r.height=`${100*s}%`}#r(){const t=ve._svgFactory.create(1,1,!0);return this.#t.append(t),t.setAttribute("aria-hidden",!0),t}#s(t,e){const i=ve._svgFactory.createElement("clipPath");t.append(i);const n=`clip_${e}`;i.setAttribute("id",n),i.setAttribute("clipPathUnits","objectBoundingBox");const s=ve._svgFactory.createElement("use");return i.append(s),s.setAttribute("href",`#${e}`),s.classList.add("clip"),n}#a(t,e){for(const[i,n]of Object.entries(e))n===null?t.removeAttribute(i):t.setAttribute(i,n)}draw(t,e=!1,i=!1){const n=ve.#i++,s=this.#r(),r=ve._svgFactory.createElement("defs");s.append(r);const o=ve._svgFactory.createElement("path");r.append(o);const l=`path_p${this.pageIndex}_${n}`;o.setAttribute("id",l),o.setAttribute("vector-effect","non-scaling-stroke"),e&&this.#n.set(n,o);const h=i?this.#s(r,l):null,c=ve._svgFactory.createElement("use");return s.append(c),c.setAttribute("href",`#${l}`),this.updateProperties(s,t),this.#e.set(n,s),{id:n,clipPathId:`url(#${h})`}}drawOutline(t,e){const i=ve.#i++,n=this.#r(),s=ve._svgFactory.createElement("defs");n.append(s);const r=ve._svgFactory.createElement("path");s.append(r);const o=`path_p${this.pageIndex}_${i}`;r.setAttribute("id",o),r.setAttribute("vector-effect","non-scaling-stroke");let l;if(e){const u=ve._svgFactory.createElement("mask");s.append(u),l=`mask_p${this.pageIndex}_${i}`,u.setAttribute("id",l),u.setAttribute("maskUnits","objectBoundingBox");const p=ve._svgFactory.createElement("rect");u.append(p),p.setAttribute("width","1"),p.setAttribute("height","1"),p.setAttribute("fill","white");const b=ve._svgFactory.createElement("use");u.append(b),b.setAttribute("href",`#${o}`),b.setAttribute("stroke","none"),b.setAttribute("fill","black"),b.setAttribute("fill-rule","nonzero"),b.classList.add("mask")}const h=ve._svgFactory.createElement("use");n.append(h),h.setAttribute("href",`#${o}`),l&&h.setAttribute("mask",`url(#${l})`);const c=h.cloneNode();return n.append(c),h.classList.add("mainOutline"),c.classList.add("secondaryOutline"),this.updateProperties(n,t),this.#e.set(i,n),i}finalizeDraw(t,e){this.#n.delete(t),this.updateProperties(t,e)}updateProperties(t,e){if(!e)return;const{root:i,bbox:n,rootClass:s,path:r}=e,o=typeof t=="number"?this.#e.get(t):t;if(o){if(i&&this.#a(o,i),n&&ve.#o(o,n),s){const{classList:l}=o;for(const[h,c]of Object.entries(s))l.toggle(h,c)}if(r){const h=o.firstElementChild.firstElementChild;this.#a(h,r)}}}updateParent(t,e){if(e===this)return;const i=this.#e.get(t);i&&(e.#t.append(i),this.#e.delete(t),e.#e.set(t,i))}remove(t){this.#n.delete(t),this.#t!==null&&(this.#e.get(t).remove(),this.#e.delete(t))}destroy(){this.#t=null;for(const t of this.#e.values())t.remove();this.#e.clear(),this.#n.clear()}}globalThis._pdfjsTestingUtils={HighlightOutliner:wo};globalThis.pdfjsLib={AbortException:Vi,AnnotationEditorLayer:Di,AnnotationEditorParamsType:Et,AnnotationEditorType:gt,AnnotationEditorUIManager:Wi,AnnotationLayer:jo,AnnotationMode:$i,AnnotationType:ae,applyOpacity:Zc,build:au,ColorPicker:ii,createValidAbsoluteUrl:Dl,CSSConstants:Qc,DOMSVGFactory:ir,DrawLayer:ve,FeatureTest:fe,fetchData:bs,findContrastColor:td,getDocument:Ql,getFilenameFromUrl:Wc,getPdfFilenameFromUrl:qc,getRGB:ws,getUuid:Ml,getXfaPageViewport:Yc,GlobalWorkerOptions:Gi,ImageKind:Ws,InvalidPDFException:ho,isDataScheme:br,isPdfFile:Mo,isValidExplicitDest:dd,MathClamp:Ie,noContextMenu:si,normalizeUnicode:zc,OPS:hs,OutputScale:xi,PasswordResponses:Lc,PDFDataRangeTransport:Zl,PDFDateString:co,PDFWorker:ds,PermissionFlag:Ic,PixelsPerInch:Ln,RenderingCancelledException:Fo,renderRichText:Rl,ResponseException:tr,setLayerDimensions:on,shadow:pt,SignatureExtractor:An,stopEvent:Zt,SupportedImageMimeTypes:uo,TextLayer:Xe,TouchManager:yr,updateUrlHash:kl,Util:J,VerbosityLevel:pr,version:ou,XfaLayer:Ll};const Mu={A4:{width:595.28,height:841.89},Letter:{width:612,height:792},Legal:{width:612,height:1008},Tabloid:{width:792,height:1224},A3:{width:841.89,height:1190.55},A5:{width:419.53,height:595.28}};function rp(a,t){for(const[i,n]of Object.entries(Mu))if(Math.abs(a-n.width)<1&&Math.abs(t-n.height)<1||Math.abs(a-n.height)<1&&Math.abs(t-n.width)<1)return i;return"Custom"}function op(a,t){let e=0;switch(t){case"in":e=a/72;break;case"mm":e=a/72*25.4;break;case"px":e=a*(96/72);break;default:e=a;break}return e.toFixed(2)}function ap(a){const t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(a);return t?{r:parseInt(t[1],16)/255,g:parseInt(t[2],16)/255,b:parseInt(t[3],16)/255}:{r:0,g:0,b:0}}const Iu=(a,t=1)=>{if(a===0)return"0 Bytes";const e=1024,i=t<0?0:t,n=["Bytes","KB","MB","GB","TB"],s=Math.floor(Math.log(a)/Math.log(e));return parseFloat((a/Math.pow(e,s)).toFixed(i))+" "+n[s]},lp=(a,t)=>{const e=URL.createObjectURL(a),i=document.createElement("a");i.href=e,i.download=t,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(e)},hp=a=>new Promise((t,e)=>{const i=new FileReader;i.onload=()=>t(i.result),i.onerror=n=>e(n),i.readAsArrayBuffer(a)});function cp(a,t){if(!a||a.trim()==="")return Array.from({length:t},(n,s)=>s);const e=new Set,i=a.split(",");for(const n of i){const s=n.trim();if(s)if(s.includes("-")){const[r,o]=s.split("-").map(Number);if(isNaN(r)||isNaN(o)||r<1||o>t||r>o){console.warn(`Invalid range skipped: ${s}`);continue}for(let l=r;l<=o;l++)e.add(l-1)}else{const r=Number(s);if(isNaN(r)||r<1||r>t){console.warn(`Invalid page number skipped: ${s}`);continue}e.add(r-1)}}return Array.from(e).sort((n,s)=>n-s)}function dp(a){if(!a||typeof a!="string")return a;try{const t=new Date(a);return isNaN(t.getTime())?a:t.toLocaleString()}catch(t){return console.error("Could not parse ISO date:",t),a}}let Us=null;async function up(){if(Us)return Us;Yf("Initializing PDF engine...");try{Us=await Mc({locateFile:()=>"/bentopdf/qpdf.wasm"})}catch(a){throw console.error("Failed to initialize qpdf-wasm:",a),Jf("Initialization Error","Could not load the PDF engine. Please refresh the page and try again."),a}finally{Kf()}return Us}function Lu(a){return a>=1e3?(a/1e3).toFixed(1)+"K":a.toLocaleString()}function fp(a,t=25){if(a.length<=t)return a;const e=a.lastIndexOf("."),i=e!==-1?a.substring(e):"",n=e!==-1?a.substring(0,e):a,s=t-i.length-3;return s<=0?a.substring(0,t-3)+"...":n.substring(0,s)+"..."+i}function Bi(a,t){return a?a.replace("mod",t?"":"Ctrl").replace("ctrl",t?"^":"Ctrl").replace("alt",t?"":"Alt").replace("shift","Shift").split("+").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(t?"":"+"):""}function pp(a){let t=a;return typeof a=="string"?t={url:a}:(a instanceof Uint8Array||a instanceof ArrayBuffer)&&(t={data:a}),(typeof t!="object"||t===null)&&(t={}),Ql({...t,wasmUrl:"/bentopdf/pdfjs-viewer/wasm/"})}function gp(a){const t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return a.replace(/[&<>"']/g,e=>t[e])}function mp(a){const e=[];for(let i=0;i<a.length;i+=32768){const n=a.subarray(i,Math.min(i+32768,a.length));e.push(String.fromCharCode(...n))}return btoa(e.join(""))}function bp(a){if(!a)return a;let t=a;t=t.replace(/<head[^>]*>[\s\S]*?<\/head>/gi,""),t=t.replace(/<style[^>]*>[\s\S]*?<\/style>/gi,""),t=t.replace(/<script[^>]*>[\s\S]*?<\/script>/gi,""),t=t.replace(/<link[^>]*>/gi,""),t=t.replace(/\s+style=["'][^"']*["']/gi,""),t=t.replace(/\s+class=["'][^"']*["']/gi,""),t=t.replace(/\s+data-[a-z-]+=["'][^"']*["']/gi,""),t=t.replace(/<img[^>]*(?:width=["']1["'][^>]*height=["']1["']|height=["']1["'][^>]*width=["']1["'])[^>]*\/?>/gi,""),t=t.replace(/href=["']https?:\/\/[^"']*safelinks\.protection\.outlook\.com[^"']*url=([^&"']+)[^"']*["']/gi,(i,n)=>{try{return`href="${decodeURIComponent(n)}"`}catch{return i}}),t=t.replace(/\s+originalsrc=["'][^"']*["']/gi,""),t=t.replace(/href=["']([^"']{500,})["']/gi,(i,n)=>{const s=n.split("?")[0];return s&&s.length<200?`href="${s}"`:`href="${n.substring(0,200)}"`}),t=t.replace(/\s+(cellpadding|cellspacing|bgcolor|border|valign|align|width|height|role|dir|id)=["'][^"']*["']/gi,""),t=t.replace(/<\/?table[^>]*>/gi,"<div>"),t=t.replace(/<\/?tbody[^>]*>/gi,""),t=t.replace(/<\/?thead[^>]*>/gi,""),t=t.replace(/<\/?tfoot[^>]*>/gi,""),t=t.replace(/<tr[^>]*>/gi,"<div>"),t=t.replace(/<\/tr>/gi,"</div>"),t=t.replace(/<td[^>]*>/gi,"<span> "),t=t.replace(/<\/td>/gi," </span>"),t=t.replace(/<th[^>]*>/gi,"<strong> "),t=t.replace(/<\/th>/gi," </strong>"),t=t.replace(/<div>\s*<\/div>/gi,""),t=t.replace(/<span>\s*<\/span>/gi,""),t=t.replace(/(<div>)+/gi,"<div>"),t=t.replace(/(<\/div>)+/gi,"</div>"),t=t.replace(/<a[^>]*href=["']\s*["'][^>]*>([^<]*)<\/a>/gi,"$1");const e=1e5;if(t.length>e){const i=t.lastIndexOf("</div>",e);i>e/2?t=t.substring(0,i)+"</div></body></html>":t=t.substring(0,e)+"...</body></html>"}return t}function yp(a){try{const t=a.match(/([A-Za-z]{3}),\s+(\d{1,2})\s+([A-Za-z]{3})\s+(\d{4})\s+(\d{2}):(\d{2})(?::(\d{2}))?\s+([+-]\d{4})/);if(t){const[,e,i,n,s,r,o,l,h]=t,c={Sun:"Sunday",Mon:"Monday",Tue:"Tuesday",Wed:"Wednesday",Thu:"Thursday",Fri:"Friday",Sat:"Saturday"},u={Jan:"January",Feb:"February",Mar:"March",Apr:"April",May:"May",Jun:"June",Jul:"July",Aug:"August",Sep:"September",Oct:"October",Nov:"November",Dec:"December"},p=c[e]||e,b=u[n]||n;let w=parseInt(r,10);const v=w>=12?"PM":"AM";w=w%12,w=w||12;const x=h.substring(0,1),E=h.substring(1,3),D=h.substring(3,5),T=`UTC${x}${E}:${D}`;return`${p}, ${b} ${i}, ${s} at ${w}:${o} ${v} (${T})`}}catch{}return a}Gi.workerSrc=new URL("/bentopdf/assets/pdf.worker.min-LyOxJPrg.mjs",import.meta.url).toString();const Lt={observer:null,pendingTasks:new Map,pendingTasksByPageNumber:new Map,isRendering:!1,eagerLoadQueue:[],nextEagerIndex:0};function Ru(a,t){const e=document.createElement("div");e.className="page-thumbnail relative cursor-move flex flex-col items-center gap-1 p-2 border-2 border-gray-600 rounded-lg bg-gray-800 transition-colors",e.dataset.pageNumber=a.toString(),e.dataset.lazyLoad="true";const i=document.createElement("div");i.className="relative w-full h-36 bg-gray-700 rounded-md animate-pulse flex items-center justify-center";const n=document.createElement("span");return n.className="text-gray-500 text-xs",n.textContent="Loading...",i.appendChild(n),e.appendChild(i),e}async function Ou(a,t,e=.5){const i=await a.getPage(t),n=i.getViewport({scale:e}),s=document.createElement("canvas");s.height=n.height,s.width=n.width;const r=s.getContext("2d");return await i.render({canvasContext:r,canvas:s,viewport:n}).promise,s}async function Wo(a,t){for(const e of a)try{const i=await Ou(e.pdfjsDoc,e.pageNumber,e.scale||.5),n=e.createWrapper(i,e.pageNumber,e.fileName);let s=e.placeholderElement||null;if(s||(s=e.container.querySelector(`[data-page-number="${e.pageNumber}"][data-lazy-load="true"]`)),s&&s.parentNode){const r=s.parentNode;r.insertBefore(n,s),r.removeChild(s)}else{const r=Array.from(e.container.children);let o=null;for(const l of r)if(parseInt(l.dataset.pageNumber||"0",10)>e.pageNumber){o=l;break}o?e.container.insertBefore(n,o):e.container.appendChild(n),console.warn(`Placeholder not found for page ${e.pageNumber}, inserted at calculated position`)}}catch(i){console.error(`Error rendering page ${e.pageNumber}:`,i)}}function Nu(a,t){const e={root:a.closest(".overflow-auto")||null,rootMargin:t.lazyLoadMargin||"200px",threshold:.01},i=new IntersectionObserver(n=>{n.forEach(s=>{if(s.isIntersecting){const r=s.target,o=r.dataset.pageNumber;if(!o)return;const l=parseInt(o,10),h=Lt.pendingTasksByPageNumber.get(l);h&&(i.unobserve(r),Lt.pendingTasks.delete(r),Lt.pendingTasksByPageNumber.delete(l),h.placeholderElement=r,Wo([h],t.onProgress).then(()=>{t.onBatchComplete&&t.onBatchComplete(),Lt.pendingTasks.size===0&&Lt.observer&&(Lt.observer.disconnect(),Lt.observer=null)}).catch(c=>{console.error(`Error lazy loading page ${h.pageNumber}:`,c)}))}})},e);return Lt.observer=i,i}function hh(a){"requestIdleCallback"in window?requestIdleCallback(a):setTimeout(a,16)}async function wp(a,t,e,i={}){const{batchSize:n=8,useLazyLoading:s=!0,eagerLoadBatches:r=2,onProgress:o,onBatchComplete:l}=i,h=a.numPages,c=s?Math.min(20,h):h,u=[];for(let w=1;w<=h;w++){const v=Ru(w);t.appendChild(v),u.push(v)}const p=[];for(let w=1;w<=h;w++)p.push({pageNumber:w,pdfjsDoc:a,container:t,scale:i.useLazyLoading?.3:.5,createWrapper:e,placeholderElement:u[w-1]});if(s&&h>c){const w=Nu(t,i);for(let E=c+1;E<=h;E++){const D=u[E-1],T=p[E-1];Lt.pendingTasks.set(D,T),Lt.pendingTasksByPageNumber.set(T.pageNumber,T),w.observe(D)}const v=c,x=Math.min(v+r*n,h);Lt.eagerLoadQueue=p.slice(v,x),Lt.nextEagerIndex=0}const b=p.slice(0,c);for(let w=0;w<b.length;w+=n){if(i.shouldCancel?.())return;const v=b.slice(w,w+n);await new Promise(x=>{hh(async()=>{await Wo(v),o&&o(Math.min(w+n,c),h),l&&l(),x()})})}s&&r>0&&h>c&&ch(i)}function ch(a){const{eagerLoadBatches:t=2,batchSize:e=8}=a;if(t<=0||Lt.eagerLoadQueue.length===0||a.shouldCancel?.())return;const{nextEagerIndex:i,eagerLoadQueue:n}=Lt;if(i>=n.length)return;const s=Math.min(i+e,n.length),r=n.slice(i,s);hh(async()=>{if(a.shouldCancel?.())return;r.forEach(l=>{const h=l.placeholderElement;h&&Lt.observer&&(Lt.observer.unobserve(h),Lt.pendingTasks.delete(h),Lt.pendingTasksByPageNumber.delete(l.pageNumber))}),await Wo(r,a.onProgress),a.onBatchComplete&&a.onBatchComplete(),Lt.nextEagerIndex=s;const o=Math.ceil((n.length-s)/e);o>0&&o<t&&ch(a)})}function vp(){Lt.observer&&(Lt.observer.disconnect(),Lt.observer=null),Lt.pendingTasks.clear(),Lt.pendingTasksByPageNumber.clear(),Lt.isRendering=!1,Lt.eagerLoadQueue=[],Lt.nextEagerIndex=0}function Wa(a,t){var e=Object.keys(a);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(a);t&&(i=i.filter(function(n){return Object.getOwnPropertyDescriptor(a,n).enumerable})),e.push.apply(e,i)}return e}function Ci(a){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?Wa(Object(e),!0).forEach(function(i){Bu(a,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(e)):Wa(Object(e)).forEach(function(i){Object.defineProperty(a,i,Object.getOwnPropertyDescriptor(e,i))})}return a}function Ys(a){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Ys=function(t){return typeof t}:Ys=function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ys(a)}function Bu(a,t,e){return t in a?Object.defineProperty(a,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):a[t]=e,a}function Ii(){return Ii=Object.assign||function(a){for(var t=1;t<arguments.length;t++){var e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(a[i]=e[i])}return a},Ii.apply(this,arguments)}function Uu(a,t){if(a==null)return{};var e={},i=Object.keys(a),n,s;for(s=0;s<i.length;s++)n=i[s],!(t.indexOf(n)>=0)&&(e[n]=a[n]);return e}function $u(a,t){if(a==null)return{};var e=Uu(a,t),i,n;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(a);for(n=0;n<s.length;n++)i=s[n],!(t.indexOf(i)>=0)&&Object.prototype.propertyIsEnumerable.call(a,i)&&(e[i]=a[i])}return e}var Hu="1.15.6";function Mi(a){if(typeof window<"u"&&window.navigator)return!!navigator.userAgent.match(a)}var Ri=Mi(/(?:Trident.*rv[ :]?11\.|msie|iemobile|Windows Phone)/i),Ss=Mi(/Edge/i),qa=Mi(/firefox/i),es=Mi(/safari/i)&&!Mi(/chrome/i)&&!Mi(/android/i),qo=Mi(/iP(ad|od|hone)/i),dh=Mi(/chrome/i)&&Mi(/android/i),uh={capture:!1,passive:!1};function At(a,t,e){a.addEventListener(t,e,!Ri&&uh)}function vt(a,t,e){a.removeEventListener(t,e,!Ri&&uh)}function nr(a,t){if(t){if(t[0]===">"&&(t=t.substring(1)),a)try{if(a.matches)return a.matches(t);if(a.msMatchesSelector)return a.msMatchesSelector(t);if(a.webkitMatchesSelector)return a.webkitMatchesSelector(t)}catch{return!1}return!1}}function fh(a){return a.host&&a!==document&&a.host.nodeType?a.host:a.parentNode}function ci(a,t,e,i){if(a){e=e||document;do{if(t!=null&&(t[0]===">"?a.parentNode===e&&nr(a,t):nr(a,t))||i&&a===e)return a;if(a===e)break}while(a=fh(a))}return null}var Xa=/\s+/g;function Ve(a,t,e){if(a&&t)if(a.classList)a.classList[e?"add":"remove"](t);else{var i=(" "+a.className+" ").replace(Xa," ").replace(" "+t+" "," ");a.className=(i+(e?" "+t:"")).replace(Xa," ")}}function at(a,t,e){var i=a&&a.style;if(i){if(e===void 0)return document.defaultView&&document.defaultView.getComputedStyle?e=document.defaultView.getComputedStyle(a,""):a.currentStyle&&(e=a.currentStyle),t===void 0?e:e[t];!(t in i)&&t.indexOf("webkit")===-1&&(t="-webkit-"+t),i[t]=e+(typeof e=="string"?"":"px")}}function Mn(a,t){var e="";if(typeof a=="string")e=a;else do{var i=at(a,"transform");i&&i!=="none"&&(e=i+" "+e)}while(!t&&(a=a.parentNode));var n=window.DOMMatrix||window.WebKitCSSMatrix||window.CSSMatrix||window.MSCSSMatrix;return n&&new n(e)}function ph(a,t,e){if(a){var i=a.getElementsByTagName(t),n=0,s=i.length;if(e)for(;n<s;n++)e(i[n],n);return i}return[]}function Si(){var a=document.scrollingElement;return a||document.documentElement}function he(a,t,e,i,n){if(!(!a.getBoundingClientRect&&a!==window)){var s,r,o,l,h,c,u;if(a!==window&&a.parentNode&&a!==Si()?(s=a.getBoundingClientRect(),r=s.top,o=s.left,l=s.bottom,h=s.right,c=s.height,u=s.width):(r=0,o=0,l=window.innerHeight,h=window.innerWidth,c=window.innerHeight,u=window.innerWidth),(t||e)&&a!==window&&(n=n||a.parentNode,!Ri))do if(n&&n.getBoundingClientRect&&(at(n,"transform")!=="none"||e&&at(n,"position")!=="static")){var p=n.getBoundingClientRect();r-=p.top+parseInt(at(n,"border-top-width")),o-=p.left+parseInt(at(n,"border-left-width")),l=r+s.height,h=o+s.width;break}while(n=n.parentNode);if(i&&a!==window){var b=Mn(n||a),w=b&&b.a,v=b&&b.d;b&&(r/=v,o/=w,u/=w,c/=v,l=r+c,h=o+u)}return{top:r,left:o,bottom:l,right:h,width:u,height:c}}}function Ya(a,t,e){for(var i=zi(a,!0),n=he(a)[t];i;){var s=he(i)[e],r=void 0;if(r=n>=s,!r)return i;if(i===Si())break;i=zi(i,!1)}return!1}function Rn(a,t,e,i){for(var n=0,s=0,r=a.children;s<r.length;){if(r[s].style.display!=="none"&&r[s]!==ht.ghost&&(i||r[s]!==ht.dragged)&&ci(r[s],e.draggable,a,!1)){if(n===t)return r[s];n++}s++}return null}function Xo(a,t){for(var e=a.lastElementChild;e&&(e===ht.ghost||at(e,"display")==="none"||t&&!nr(e,t));)e=e.previousElementSibling;return e||null}function ni(a,t){var e=0;if(!a||!a.parentNode)return-1;for(;a=a.previousElementSibling;)a.nodeName.toUpperCase()!=="TEMPLATE"&&a!==ht.clone&&(!t||nr(a,t))&&e++;return e}function Ka(a){var t=0,e=0,i=Si();if(a)do{var n=Mn(a),s=n.a,r=n.d;t+=a.scrollLeft*s,e+=a.scrollTop*r}while(a!==i&&(a=a.parentNode));return[t,e]}function ju(a,t){for(var e in a)if(a.hasOwnProperty(e)){for(var i in t)if(t.hasOwnProperty(i)&&t[i]===a[e][i])return Number(e)}return-1}function zi(a,t){if(!a||!a.getBoundingClientRect)return Si();var e=a,i=!1;do if(e.clientWidth<e.scrollWidth||e.clientHeight<e.scrollHeight){var n=at(e);if(e.clientWidth<e.scrollWidth&&(n.overflowX=="auto"||n.overflowX=="scroll")||e.clientHeight<e.scrollHeight&&(n.overflowY=="auto"||n.overflowY=="scroll")){if(!e.getBoundingClientRect||e===document.body)return Si();if(i||t)return e;i=!0}}while(e=e.parentNode);return Si()}function zu(a,t){if(a&&t)for(var e in t)t.hasOwnProperty(e)&&(a[e]=t[e]);return a}function Vr(a,t){return Math.round(a.top)===Math.round(t.top)&&Math.round(a.left)===Math.round(t.left)&&Math.round(a.height)===Math.round(t.height)&&Math.round(a.width)===Math.round(t.width)}var is;function gh(a,t){return function(){if(!is){var e=arguments,i=this;e.length===1?a.call(i,e[0]):a.apply(i,e),is=setTimeout(function(){is=void 0},t)}}}function Gu(){clearTimeout(is),is=void 0}function mh(a,t,e){a.scrollLeft+=t,a.scrollTop+=e}function bh(a){var t=window.Polymer,e=window.jQuery||window.Zepto;return t&&t.dom?t.dom(a).cloneNode(!0):e?e(a).clone(!0)[0]:a.cloneNode(!0)}function yh(a,t,e){var i={};return Array.from(a.children).forEach(function(n){var s,r,o,l;if(!(!ci(n,t.draggable,a,!1)||n.animated||n===e)){var h=he(n);i.left=Math.min((s=i.left)!==null&&s!==void 0?s:1/0,h.left),i.top=Math.min((r=i.top)!==null&&r!==void 0?r:1/0,h.top),i.right=Math.max((o=i.right)!==null&&o!==void 0?o:-1/0,h.right),i.bottom=Math.max((l=i.bottom)!==null&&l!==void 0?l:-1/0,h.bottom)}}),i.width=i.right-i.left,i.height=i.bottom-i.top,i.x=i.left,i.y=i.top,i}var He="Sortable"+new Date().getTime();function Vu(){var a=[],t;return{captureAnimationState:function(){if(a=[],!!this.options.animation){var i=[].slice.call(this.el.children);i.forEach(function(n){if(!(at(n,"display")==="none"||n===ht.ghost)){a.push({target:n,rect:he(n)});var s=Ci({},a[a.length-1].rect);if(n.thisAnimationDuration){var r=Mn(n,!0);r&&(s.top-=r.f,s.left-=r.e)}n.fromRect=s}})}},addAnimationState:function(i){a.push(i)},removeAnimationState:function(i){a.splice(ju(a,{target:i}),1)},animateAll:function(i){var n=this;if(!this.options.animation){clearTimeout(t),typeof i=="function"&&i();return}var s=!1,r=0;a.forEach(function(o){var l=0,h=o.target,c=h.fromRect,u=he(h),p=h.prevFromRect,b=h.prevToRect,w=o.rect,v=Mn(h,!0);v&&(u.top-=v.f,u.left-=v.e),h.toRect=u,h.thisAnimationDuration&&Vr(p,u)&&!Vr(c,u)&&(w.top-u.top)/(w.left-u.left)===(c.top-u.top)/(c.left-u.left)&&(l=qu(w,p,b,n.options)),Vr(u,c)||(h.prevFromRect=c,h.prevToRect=u,l||(l=n.options.animation),n.animate(h,w,u,l)),l&&(s=!0,r=Math.max(r,l),clearTimeout(h.animationResetTimer),h.animationResetTimer=setTimeout(function(){h.animationTime=0,h.prevFromRect=null,h.fromRect=null,h.prevToRect=null,h.thisAnimationDuration=null},l),h.thisAnimationDuration=l)}),clearTimeout(t),s?t=setTimeout(function(){typeof i=="function"&&i()},r):typeof i=="function"&&i(),a=[]},animate:function(i,n,s,r){if(r){at(i,"transition",""),at(i,"transform","");var o=Mn(this.el),l=o&&o.a,h=o&&o.d,c=(n.left-s.left)/(l||1),u=(n.top-s.top)/(h||1);i.animatingX=!!c,i.animatingY=!!u,at(i,"transform","translate3d("+c+"px,"+u+"px,0)"),this.forRepaintDummy=Wu(i),at(i,"transition","transform "+r+"ms"+(this.options.easing?" "+this.options.easing:"")),at(i,"transform","translate3d(0,0,0)"),typeof i.animated=="number"&&clearTimeout(i.animated),i.animated=setTimeout(function(){at(i,"transition",""),at(i,"transform",""),i.animated=!1,i.animatingX=!1,i.animatingY=!1},r)}}}}function Wu(a){return a.offsetWidth}function qu(a,t,e,i){return Math.sqrt(Math.pow(t.top-a.top,2)+Math.pow(t.left-a.left,2))/Math.sqrt(Math.pow(t.top-e.top,2)+Math.pow(t.left-e.left,2))*i.animation}var mn=[],Wr={initializeByDefault:!0},xs={mount:function(t){for(var e in Wr)Wr.hasOwnProperty(e)&&!(e in t)&&(t[e]=Wr[e]);mn.forEach(function(i){if(i.pluginName===t.pluginName)throw"Sortable: Cannot mount plugin ".concat(t.pluginName," more than once")}),mn.push(t)},pluginEvent:function(t,e,i){var n=this;this.eventCanceled=!1,i.cancel=function(){n.eventCanceled=!0};var s=t+"Global";mn.forEach(function(r){e[r.pluginName]&&(e[r.pluginName][s]&&e[r.pluginName][s](Ci({sortable:e},i)),e.options[r.pluginName]&&e[r.pluginName][t]&&e[r.pluginName][t](Ci({sortable:e},i)))})},initializePlugins:function(t,e,i,n){mn.forEach(function(o){var l=o.pluginName;if(!(!t.options[l]&&!o.initializeByDefault)){var h=new o(t,e,t.options);h.sortable=t,h.options=t.options,t[l]=h,Ii(i,h.defaults)}});for(var s in t.options)if(t.options.hasOwnProperty(s)){var r=this.modifyOption(t,s,t.options[s]);typeof r<"u"&&(t.options[s]=r)}},getEventProperties:function(t,e){var i={};return mn.forEach(function(n){typeof n.eventProperties=="function"&&Ii(i,n.eventProperties.call(e[n.pluginName],t))}),i},modifyOption:function(t,e,i){var n;return mn.forEach(function(s){t[s.pluginName]&&s.optionListeners&&typeof s.optionListeners[e]=="function"&&(n=s.optionListeners[e].call(t[s.pluginName],i))}),n}};function Xu(a){var t=a.sortable,e=a.rootEl,i=a.name,n=a.targetEl,s=a.cloneEl,r=a.toEl,o=a.fromEl,l=a.oldIndex,h=a.newIndex,c=a.oldDraggableIndex,u=a.newDraggableIndex,p=a.originalEvent,b=a.putSortable,w=a.extraEventProperties;if(t=t||e&&e[He],!!t){var v,x=t.options,E="on"+i.charAt(0).toUpperCase()+i.substr(1);window.CustomEvent&&!Ri&&!Ss?v=new CustomEvent(i,{bubbles:!0,cancelable:!0}):(v=document.createEvent("Event"),v.initEvent(i,!0,!0)),v.to=r||e,v.from=o||e,v.item=n||e,v.clone=s,v.oldIndex=l,v.newIndex=h,v.oldDraggableIndex=c,v.newDraggableIndex=u,v.originalEvent=p,v.pullMode=b?b.lastPutMode:void 0;var D=Ci(Ci({},w),xs.getEventProperties(i,t));for(var T in D)v[T]=D[T];e&&e.dispatchEvent(v),x[E]&&x[E].call(t,v)}}var Yu=["evt"],Ne=function(t,e){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},n=i.evt,s=$u(i,Yu);xs.pluginEvent.bind(ht)(t,e,Ci({dragEl:X,parentEl:Jt,ghostEl:ut,rootEl:Ht,nextEl:Zi,lastDownEl:Ks,cloneEl:Gt,cloneHidden:Hi,dragStarted:Jn,putSortable:Ae,activeSortable:ht.active,originalEvent:n,oldIndex:_n,oldDraggableIndex:ns,newIndex:We,newDraggableIndex:Ui,hideGhostForTarget:Eh,unhideGhostForTarget:Sh,cloneNowHidden:function(){Hi=!0},cloneNowShown:function(){Hi=!1},dispatchSortableEvent:function(o){Fe({sortable:e,name:o,originalEvent:n})}},s))};function Fe(a){Xu(Ci({putSortable:Ae,cloneEl:Gt,targetEl:X,rootEl:Ht,oldIndex:_n,oldDraggableIndex:ns,newIndex:We,newDraggableIndex:Ui},a))}var X,Jt,ut,Ht,Zi,Ks,Gt,Hi,_n,We,ns,Ui,$s,Ae,En=!1,sr=!1,rr=[],Ji,li,qr,Xr,Ja,Qa,Jn,bn,ss,rs=!1,Hs=!1,Js,_e,Yr=[],Eo=!1,or=[],Ar=typeof document<"u",js=qo,Za=Ss||Ri?"cssFloat":"float",Ku=Ar&&!dh&&!qo&&"draggable"in document.createElement("div"),wh=(function(){if(Ar){if(Ri)return!1;var a=document.createElement("x");return a.style.cssText="pointer-events:auto",a.style.pointerEvents==="auto"}})(),vh=function(t,e){var i=at(t),n=parseInt(i.width)-parseInt(i.paddingLeft)-parseInt(i.paddingRight)-parseInt(i.borderLeftWidth)-parseInt(i.borderRightWidth),s=Rn(t,0,e),r=Rn(t,1,e),o=s&&at(s),l=r&&at(r),h=o&&parseInt(o.marginLeft)+parseInt(o.marginRight)+he(s).width,c=l&&parseInt(l.marginLeft)+parseInt(l.marginRight)+he(r).width;if(i.display==="flex")return i.flexDirection==="column"||i.flexDirection==="column-reverse"?"vertical":"horizontal";if(i.display==="grid")return i.gridTemplateColumns.split(" ").length<=1?"vertical":"horizontal";if(s&&o.float&&o.float!=="none"){var u=o.float==="left"?"left":"right";return r&&(l.clear==="both"||l.clear===u)?"vertical":"horizontal"}return s&&(o.display==="block"||o.display==="flex"||o.display==="table"||o.display==="grid"||h>=n&&i[Za]==="none"||r&&i[Za]==="none"&&h+c>n)?"vertical":"horizontal"},Ju=function(t,e,i){var n=i?t.left:t.top,s=i?t.right:t.bottom,r=i?t.width:t.height,o=i?e.left:e.top,l=i?e.right:e.bottom,h=i?e.width:e.height;return n===o||s===l||n+r/2===o+h/2},Qu=function(t,e){var i;return rr.some(function(n){var s=n[He].options.emptyInsertThreshold;if(!(!s||Xo(n))){var r=he(n),o=t>=r.left-s&&t<=r.right+s,l=e>=r.top-s&&e<=r.bottom+s;if(o&&l)return i=n}}),i},Ah=function(t){function e(s,r){return function(o,l,h,c){var u=o.options.group.name&&l.options.group.name&&o.options.group.name===l.options.group.name;if(s==null&&(r||u))return!0;if(s==null||s===!1)return!1;if(r&&s==="clone")return s;if(typeof s=="function")return e(s(o,l,h,c),r)(o,l,h,c);var p=(r?o:l).options.group.name;return s===!0||typeof s=="string"&&s===p||s.join&&s.indexOf(p)>-1}}var i={},n=t.group;(!n||Ys(n)!="object")&&(n={name:n}),i.name=n.name,i.checkPull=e(n.pull,!0),i.checkPut=e(n.put),i.revertClone=n.revertClone,t.group=i},Eh=function(){!wh&&ut&&at(ut,"display","none")},Sh=function(){!wh&&ut&&at(ut,"display","")};Ar&&!dh&&document.addEventListener("click",function(a){if(sr)return a.preventDefault(),a.stopPropagation&&a.stopPropagation(),a.stopImmediatePropagation&&a.stopImmediatePropagation(),sr=!1,!1},!0);var Qi=function(t){if(X){t=t.touches?t.touches[0]:t;var e=Qu(t.clientX,t.clientY);if(e){var i={};for(var n in t)t.hasOwnProperty(n)&&(i[n]=t[n]);i.target=i.rootEl=e,i.preventDefault=void 0,i.stopPropagation=void 0,e[He]._onDragOver(i)}}},Zu=function(t){X&&X.parentNode[He]._isOutsideThisEl(t.target)};function ht(a,t){if(!(a&&a.nodeType&&a.nodeType===1))throw"Sortable: `el` must be an HTMLElement, not ".concat({}.toString.call(a));this.el=a,this.options=t=Ii({},t),a[He]=this;var e={group:null,sort:!0,disabled:!1,store:null,handle:null,draggable:/^[uo]l$/i.test(a.nodeName)?">li":">*",swapThreshold:1,invertSwap:!1,invertedSwapThreshold:null,removeCloneOnHide:!0,direction:function(){return vh(a,this.options)},ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",ignore:"a, img",filter:null,preventOnFilter:!0,animation:0,easing:null,setData:function(r,o){r.setData("Text",o.textContent)},dropBubble:!1,dragoverBubble:!1,dataIdAttr:"data-id",delay:0,delayOnTouchOnly:!1,touchStartThreshold:(Number.parseInt?Number:window).parseInt(window.devicePixelRatio,10)||1,forceFallback:!1,fallbackClass:"sortable-fallback",fallbackOnBody:!1,fallbackTolerance:0,fallbackOffset:{x:0,y:0},supportPointer:ht.supportPointer!==!1&&"PointerEvent"in window&&(!es||qo),emptyInsertThreshold:5};xs.initializePlugins(this,a,e);for(var i in e)!(i in t)&&(t[i]=e[i]);Ah(t);for(var n in this)n.charAt(0)==="_"&&typeof this[n]=="function"&&(this[n]=this[n].bind(this));this.nativeDraggable=t.forceFallback?!1:Ku,this.nativeDraggable&&(this.options.touchStartThreshold=1),t.supportPointer?At(a,"pointerdown",this._onTapStart):(At(a,"mousedown",this._onTapStart),At(a,"touchstart",this._onTapStart)),this.nativeDraggable&&(At(a,"dragover",this),At(a,"dragenter",this)),rr.push(this.el),t.store&&t.store.get&&this.sort(t.store.get(this)||[]),Ii(this,Vu())}ht.prototype={constructor:ht,_isOutsideThisEl:function(t){!this.el.contains(t)&&t!==this.el&&(bn=null)},_getDirection:function(t,e){return typeof this.options.direction=="function"?this.options.direction.call(this,t,e,X):this.options.direction},_onTapStart:function(t){if(t.cancelable){var e=this,i=this.el,n=this.options,s=n.preventOnFilter,r=t.type,o=t.touches&&t.touches[0]||t.pointerType&&t.pointerType==="touch"&&t,l=(o||t).target,h=t.target.shadowRoot&&(t.path&&t.path[0]||t.composedPath&&t.composedPath()[0])||l,c=n.filter;if(lf(i),!X&&!(/mousedown|pointerdown/.test(r)&&t.button!==0||n.disabled)&&!h.isContentEditable&&!(!this.nativeDraggable&&es&&l&&l.tagName.toUpperCase()==="SELECT")&&(l=ci(l,n.draggable,i,!1),!(l&&l.animated)&&Ks!==l)){if(_n=ni(l),ns=ni(l,n.draggable),typeof c=="function"){if(c.call(this,t,l,this)){Fe({sortable:e,rootEl:h,name:"filter",targetEl:l,toEl:i,fromEl:i}),Ne("filter",e,{evt:t}),s&&t.preventDefault();return}}else if(c&&(c=c.split(",").some(function(u){if(u=ci(h,u.trim(),i,!1),u)return Fe({sortable:e,rootEl:u,name:"filter",targetEl:l,fromEl:i,toEl:i}),Ne("filter",e,{evt:t}),!0}),c)){s&&t.preventDefault();return}n.handle&&!ci(h,n.handle,i,!1)||this._prepareDragStart(t,o,l)}}},_prepareDragStart:function(t,e,i){var n=this,s=n.el,r=n.options,o=s.ownerDocument,l;if(i&&!X&&i.parentNode===s){var h=he(i);if(Ht=s,X=i,Jt=X.parentNode,Zi=X.nextSibling,Ks=i,$s=r.group,ht.dragged=X,Ji={target:X,clientX:(e||t).clientX,clientY:(e||t).clientY},Ja=Ji.clientX-h.left,Qa=Ji.clientY-h.top,this._lastX=(e||t).clientX,this._lastY=(e||t).clientY,X.style["will-change"]="all",l=function(){if(Ne("delayEnded",n,{evt:t}),ht.eventCanceled){n._onDrop();return}n._disableDelayedDragEvents(),!qa&&n.nativeDraggable&&(X.draggable=!0),n._triggerDragStart(t,e),Fe({sortable:n,name:"choose",originalEvent:t}),Ve(X,r.chosenClass,!0)},r.ignore.split(",").forEach(function(c){ph(X,c.trim(),Kr)}),At(o,"dragover",Qi),At(o,"mousemove",Qi),At(o,"touchmove",Qi),r.supportPointer?(At(o,"pointerup",n._onDrop),!this.nativeDraggable&&At(o,"pointercancel",n._onDrop)):(At(o,"mouseup",n._onDrop),At(o,"touchend",n._onDrop),At(o,"touchcancel",n._onDrop)),qa&&this.nativeDraggable&&(this.options.touchStartThreshold=4,X.draggable=!0),Ne("delayStart",this,{evt:t}),r.delay&&(!r.delayOnTouchOnly||e)&&(!this.nativeDraggable||!(Ss||Ri))){if(ht.eventCanceled){this._onDrop();return}r.supportPointer?(At(o,"pointerup",n._disableDelayedDrag),At(o,"pointercancel",n._disableDelayedDrag)):(At(o,"mouseup",n._disableDelayedDrag),At(o,"touchend",n._disableDelayedDrag),At(o,"touchcancel",n._disableDelayedDrag)),At(o,"mousemove",n._delayedDragTouchMoveHandler),At(o,"touchmove",n._delayedDragTouchMoveHandler),r.supportPointer&&At(o,"pointermove",n._delayedDragTouchMoveHandler),n._dragStartTimer=setTimeout(l,r.delay)}else l()}},_delayedDragTouchMoveHandler:function(t){var e=t.touches?t.touches[0]:t;Math.max(Math.abs(e.clientX-this._lastX),Math.abs(e.clientY-this._lastY))>=Math.floor(this.options.touchStartThreshold/(this.nativeDraggable&&window.devicePixelRatio||1))&&this._disableDelayedDrag()},_disableDelayedDrag:function(){X&&Kr(X),clearTimeout(this._dragStartTimer),this._disableDelayedDragEvents()},_disableDelayedDragEvents:function(){var t=this.el.ownerDocument;vt(t,"mouseup",this._disableDelayedDrag),vt(t,"touchend",this._disableDelayedDrag),vt(t,"touchcancel",this._disableDelayedDrag),vt(t,"pointerup",this._disableDelayedDrag),vt(t,"pointercancel",this._disableDelayedDrag),vt(t,"mousemove",this._delayedDragTouchMoveHandler),vt(t,"touchmove",this._delayedDragTouchMoveHandler),vt(t,"pointermove",this._delayedDragTouchMoveHandler)},_triggerDragStart:function(t,e){e=e||t.pointerType=="touch"&&t,!this.nativeDraggable||e?this.options.supportPointer?At(document,"pointermove",this._onTouchMove):e?At(document,"touchmove",this._onTouchMove):At(document,"mousemove",this._onTouchMove):(At(X,"dragend",this),At(Ht,"dragstart",this._onDragStart));try{document.selection?Qs(function(){document.selection.empty()}):window.getSelection().removeAllRanges()}catch{}},_dragStarted:function(t,e){if(En=!1,Ht&&X){Ne("dragStarted",this,{evt:e}),this.nativeDraggable&&At(document,"dragover",Zu);var i=this.options;!t&&Ve(X,i.dragClass,!1),Ve(X,i.ghostClass,!0),ht.active=this,t&&this._appendGhost(),Fe({sortable:this,name:"start",originalEvent:e})}else this._nulling()},_emulateDragOver:function(){if(li){this._lastX=li.clientX,this._lastY=li.clientY,Eh();for(var t=document.elementFromPoint(li.clientX,li.clientY),e=t;t&&t.shadowRoot&&(t=t.shadowRoot.elementFromPoint(li.clientX,li.clientY),t!==e);)e=t;if(X.parentNode[He]._isOutsideThisEl(t),e)do{if(e[He]){var i=void 0;if(i=e[He]._onDragOver({clientX:li.clientX,clientY:li.clientY,target:t,rootEl:e}),i&&!this.options.dragoverBubble)break}t=e}while(e=fh(e));Sh()}},_onTouchMove:function(t){if(Ji){var e=this.options,i=e.fallbackTolerance,n=e.fallbackOffset,s=t.touches?t.touches[0]:t,r=ut&&Mn(ut,!0),o=ut&&r&&r.a,l=ut&&r&&r.d,h=js&&_e&&Ka(_e),c=(s.clientX-Ji.clientX+n.x)/(o||1)+(h?h[0]-Yr[0]:0)/(o||1),u=(s.clientY-Ji.clientY+n.y)/(l||1)+(h?h[1]-Yr[1]:0)/(l||1);if(!ht.active&&!En){if(i&&Math.max(Math.abs(s.clientX-this._lastX),Math.abs(s.clientY-this._lastY))<i)return;this._onDragStart(t,!0)}if(ut){r?(r.e+=c-(qr||0),r.f+=u-(Xr||0)):r={a:1,b:0,c:0,d:1,e:c,f:u};var p="matrix(".concat(r.a,",").concat(r.b,",").concat(r.c,",").concat(r.d,",").concat(r.e,",").concat(r.f,")");at(ut,"webkitTransform",p),at(ut,"mozTransform",p),at(ut,"msTransform",p),at(ut,"transform",p),qr=c,Xr=u,li=s}t.cancelable&&t.preventDefault()}},_appendGhost:function(){if(!ut){var t=this.options.fallbackOnBody?document.body:Ht,e=he(X,!0,js,!0,t),i=this.options;if(js){for(_e=t;at(_e,"position")==="static"&&at(_e,"transform")==="none"&&_e!==document;)_e=_e.parentNode;_e!==document.body&&_e!==document.documentElement?(_e===document&&(_e=Si()),e.top+=_e.scrollTop,e.left+=_e.scrollLeft):_e=Si(),Yr=Ka(_e)}ut=X.cloneNode(!0),Ve(ut,i.ghostClass,!1),Ve(ut,i.fallbackClass,!0),Ve(ut,i.dragClass,!0),at(ut,"transition",""),at(ut,"transform",""),at(ut,"box-sizing","border-box"),at(ut,"margin",0),at(ut,"top",e.top),at(ut,"left",e.left),at(ut,"width",e.width),at(ut,"height",e.height),at(ut,"opacity","0.8"),at(ut,"position",js?"absolute":"fixed"),at(ut,"zIndex","100000"),at(ut,"pointerEvents","none"),ht.ghost=ut,t.appendChild(ut),at(ut,"transform-origin",Ja/parseInt(ut.style.width)*100+"% "+Qa/parseInt(ut.style.height)*100+"%")}},_onDragStart:function(t,e){var i=this,n=t.dataTransfer,s=i.options;if(Ne("dragStart",this,{evt:t}),ht.eventCanceled){this._onDrop();return}Ne("setupClone",this),ht.eventCanceled||(Gt=bh(X),Gt.removeAttribute("id"),Gt.draggable=!1,Gt.style["will-change"]="",this._hideClone(),Ve(Gt,this.options.chosenClass,!1),ht.clone=Gt),i.cloneId=Qs(function(){Ne("clone",i),!ht.eventCanceled&&(i.options.removeCloneOnHide||Ht.insertBefore(Gt,X),i._hideClone(),Fe({sortable:i,name:"clone"}))}),!e&&Ve(X,s.dragClass,!0),e?(sr=!0,i._loopId=setInterval(i._emulateDragOver,50)):(vt(document,"mouseup",i._onDrop),vt(document,"touchend",i._onDrop),vt(document,"touchcancel",i._onDrop),n&&(n.effectAllowed="move",s.setData&&s.setData.call(i,n,X)),At(document,"drop",i),at(X,"transform","translateZ(0)")),En=!0,i._dragStartId=Qs(i._dragStarted.bind(i,e,t)),At(document,"selectstart",i),Jn=!0,window.getSelection().removeAllRanges(),es&&at(document.body,"user-select","none")},_onDragOver:function(t){var e=this.el,i=t.target,n,s,r,o=this.options,l=o.group,h=ht.active,c=$s===l,u=o.sort,p=Ae||h,b,w=this,v=!1;if(Eo)return;function x(Z,xt){Ne(Z,w,Ci({evt:t,isOwner:c,axis:b?"vertical":"horizontal",revert:r,dragRect:n,targetRect:s,canSort:u,fromSortable:p,target:i,completed:D,onMove:function(it,ot){return zs(Ht,e,X,n,it,he(it),t,ot)},changed:T},xt))}function E(){x("dragOverAnimationCapture"),w.captureAnimationState(),w!==p&&p.captureAnimationState()}function D(Z){return x("dragOverCompleted",{insertion:Z}),Z&&(c?h._hideClone():h._showClone(w),w!==p&&(Ve(X,Ae?Ae.options.ghostClass:h.options.ghostClass,!1),Ve(X,o.ghostClass,!0)),Ae!==w&&w!==ht.active?Ae=w:w===ht.active&&Ae&&(Ae=null),p===w&&(w._ignoreWhileAnimating=i),w.animateAll(function(){x("dragOverAnimationComplete"),w._ignoreWhileAnimating=null}),w!==p&&(p.animateAll(),p._ignoreWhileAnimating=null)),(i===X&&!X.animated||i===e&&!i.animated)&&(bn=null),!o.dragoverBubble&&!t.rootEl&&i!==document&&(X.parentNode[He]._isOutsideThisEl(t.target),!Z&&Qi(t)),!o.dragoverBubble&&t.stopPropagation&&t.stopPropagation(),v=!0}function T(){We=ni(X),Ui=ni(X,o.draggable),Fe({sortable:w,name:"change",toEl:e,newIndex:We,newDraggableIndex:Ui,originalEvent:t})}if(t.preventDefault!==void 0&&t.cancelable&&t.preventDefault(),i=ci(i,o.draggable,e,!0),x("dragOver"),ht.eventCanceled)return v;if(X.contains(t.target)||i.animated&&i.animatingX&&i.animatingY||w._ignoreWhileAnimating===i)return D(!1);if(sr=!1,h&&!o.disabled&&(c?u||(r=Jt!==Ht):Ae===this||(this.lastPutMode=$s.checkPull(this,h,X,t))&&l.checkPut(this,h,X,t))){if(b=this._getDirection(t,i)==="vertical",n=he(X),x("dragOverValid"),ht.eventCanceled)return v;if(r)return Jt=Ht,E(),this._hideClone(),x("revert"),ht.eventCanceled||(Zi?Ht.insertBefore(X,Zi):Ht.appendChild(X)),D(!0);var k=Xo(e,o.draggable);if(!k||sf(t,b,this)&&!k.animated){if(k===X)return D(!1);if(k&&e===t.target&&(i=k),i&&(s=he(i)),zs(Ht,e,X,n,i,s,t,!!i)!==!1)return E(),k&&k.nextSibling?e.insertBefore(X,k.nextSibling):e.appendChild(X),Jt=e,T(),D(!0)}else if(k&&nf(t,b,this)){var F=Rn(e,0,o,!0);if(F===X)return D(!1);if(i=F,s=he(i),zs(Ht,e,X,n,i,s,t,!1)!==!1)return E(),e.insertBefore(X,F),Jt=e,T(),D(!0)}else if(i.parentNode===e){s=he(i);var M=0,O,N=X.parentNode!==e,R=!Ju(X.animated&&X.toRect||n,i.animated&&i.toRect||s,b),$=b?"top":"left",U=Ya(i,"top","top")||Ya(X,"top","top"),Q=U?U.scrollTop:void 0;bn!==i&&(O=s[$],rs=!1,Hs=!R&&o.invertSwap||N),M=rf(t,i,s,b,R?1:o.swapThreshold,o.invertedSwapThreshold==null?o.swapThreshold:o.invertedSwapThreshold,Hs,bn===i);var V;if(M!==0){var z=ni(X);do z-=M,V=Jt.children[z];while(V&&(at(V,"display")==="none"||V===ut))}if(M===0||V===i)return D(!1);bn=i,ss=M;var st=i.nextElementSibling,G=!1;G=M===1;var W=zs(Ht,e,X,n,i,s,t,G);if(W!==!1)return(W===1||W===-1)&&(G=W===1),Eo=!0,setTimeout(ef,30),E(),G&&!st?e.appendChild(X):i.parentNode.insertBefore(X,G?st:i),U&&mh(U,0,Q-U.scrollTop),Jt=X.parentNode,O!==void 0&&!Hs&&(Js=Math.abs(O-he(i)[$])),T(),D(!0)}if(e.contains(X))return D(!1)}return!1},_ignoreWhileAnimating:null,_offMoveEvents:function(){vt(document,"mousemove",this._onTouchMove),vt(document,"touchmove",this._onTouchMove),vt(document,"pointermove",this._onTouchMove),vt(document,"dragover",Qi),vt(document,"mousemove",Qi),vt(document,"touchmove",Qi)},_offUpEvents:function(){var t=this.el.ownerDocument;vt(t,"mouseup",this._onDrop),vt(t,"touchend",this._onDrop),vt(t,"pointerup",this._onDrop),vt(t,"pointercancel",this._onDrop),vt(t,"touchcancel",this._onDrop),vt(document,"selectstart",this)},_onDrop:function(t){var e=this.el,i=this.options;if(We=ni(X),Ui=ni(X,i.draggable),Ne("drop",this,{evt:t}),Jt=X&&X.parentNode,We=ni(X),Ui=ni(X,i.draggable),ht.eventCanceled){this._nulling();return}En=!1,Hs=!1,rs=!1,clearInterval(this._loopId),clearTimeout(this._dragStartTimer),So(this.cloneId),So(this._dragStartId),this.nativeDraggable&&(vt(document,"drop",this),vt(e,"dragstart",this._onDragStart)),this._offMoveEvents(),this._offUpEvents(),es&&at(document.body,"user-select",""),at(X,"transform",""),t&&(Jn&&(t.cancelable&&t.preventDefault(),!i.dropBubble&&t.stopPropagation()),ut&&ut.parentNode&&ut.parentNode.removeChild(ut),(Ht===Jt||Ae&&Ae.lastPutMode!=="clone")&&Gt&&Gt.parentNode&&Gt.parentNode.removeChild(Gt),X&&(this.nativeDraggable&&vt(X,"dragend",this),Kr(X),X.style["will-change"]="",Jn&&!En&&Ve(X,Ae?Ae.options.ghostClass:this.options.ghostClass,!1),Ve(X,this.options.chosenClass,!1),Fe({sortable:this,name:"unchoose",toEl:Jt,newIndex:null,newDraggableIndex:null,originalEvent:t}),Ht!==Jt?(We>=0&&(Fe({rootEl:Jt,name:"add",toEl:Jt,fromEl:Ht,originalEvent:t}),Fe({sortable:this,name:"remove",toEl:Jt,originalEvent:t}),Fe({rootEl:Jt,name:"sort",toEl:Jt,fromEl:Ht,originalEvent:t}),Fe({sortable:this,name:"sort",toEl:Jt,originalEvent:t})),Ae&&Ae.save()):We!==_n&&We>=0&&(Fe({sortable:this,name:"update",toEl:Jt,originalEvent:t}),Fe({sortable:this,name:"sort",toEl:Jt,originalEvent:t})),ht.active&&((We==null||We===-1)&&(We=_n,Ui=ns),Fe({sortable:this,name:"end",toEl:Jt,originalEvent:t}),this.save()))),this._nulling()},_nulling:function(){Ne("nulling",this),Ht=X=Jt=ut=Zi=Gt=Ks=Hi=Ji=li=Jn=We=Ui=_n=ns=bn=ss=Ae=$s=ht.dragged=ht.ghost=ht.clone=ht.active=null,or.forEach(function(t){t.checked=!0}),or.length=qr=Xr=0},handleEvent:function(t){switch(t.type){case"drop":case"dragend":this._onDrop(t);break;case"dragenter":case"dragover":X&&(this._onDragOver(t),tf(t));break;case"selectstart":t.preventDefault();break}},toArray:function(){for(var t=[],e,i=this.el.children,n=0,s=i.length,r=this.options;n<s;n++)e=i[n],ci(e,r.draggable,this.el,!1)&&t.push(e.getAttribute(r.dataIdAttr)||af(e));return t},sort:function(t,e){var i={},n=this.el;this.toArray().forEach(function(s,r){var o=n.children[r];ci(o,this.options.draggable,n,!1)&&(i[s]=o)},this),e&&this.captureAnimationState(),t.forEach(function(s){i[s]&&(n.removeChild(i[s]),n.appendChild(i[s]))}),e&&this.animateAll()},save:function(){var t=this.options.store;t&&t.set&&t.set(this)},closest:function(t,e){return ci(t,e||this.options.draggable,this.el,!1)},option:function(t,e){var i=this.options;if(e===void 0)return i[t];var n=xs.modifyOption(this,t,e);typeof n<"u"?i[t]=n:i[t]=e,t==="group"&&Ah(i)},destroy:function(){Ne("destroy",this);var t=this.el;t[He]=null,vt(t,"mousedown",this._onTapStart),vt(t,"touchstart",this._onTapStart),vt(t,"pointerdown",this._onTapStart),this.nativeDraggable&&(vt(t,"dragover",this),vt(t,"dragenter",this)),Array.prototype.forEach.call(t.querySelectorAll("[draggable]"),function(e){e.removeAttribute("draggable")}),this._onDrop(),this._disableDelayedDragEvents(),rr.splice(rr.indexOf(this.el),1),this.el=t=null},_hideClone:function(){if(!Hi){if(Ne("hideClone",this),ht.eventCanceled)return;at(Gt,"display","none"),this.options.removeCloneOnHide&&Gt.parentNode&&Gt.parentNode.removeChild(Gt),Hi=!0}},_showClone:function(t){if(t.lastPutMode!=="clone"){this._hideClone();return}if(Hi){if(Ne("showClone",this),ht.eventCanceled)return;X.parentNode==Ht&&!this.options.group.revertClone?Ht.insertBefore(Gt,X):Zi?Ht.insertBefore(Gt,Zi):Ht.appendChild(Gt),this.options.group.revertClone&&this.animate(X,Gt),at(Gt,"display",""),Hi=!1}}};function tf(a){a.dataTransfer&&(a.dataTransfer.dropEffect="move"),a.cancelable&&a.preventDefault()}function zs(a,t,e,i,n,s,r,o){var l,h=a[He],c=h.options.onMove,u;return window.CustomEvent&&!Ri&&!Ss?l=new CustomEvent("move",{bubbles:!0,cancelable:!0}):(l=document.createEvent("Event"),l.initEvent("move",!0,!0)),l.to=t,l.from=a,l.dragged=e,l.draggedRect=i,l.related=n||t,l.relatedRect=s||he(t),l.willInsertAfter=o,l.originalEvent=r,a.dispatchEvent(l),c&&(u=c.call(h,l,r)),u}function Kr(a){a.draggable=!1}function ef(){Eo=!1}function nf(a,t,e){var i=he(Rn(e.el,0,e.options,!0)),n=yh(e.el,e.options,ut),s=10;return t?a.clientX<n.left-s||a.clientY<i.top&&a.clientX<i.right:a.clientY<n.top-s||a.clientY<i.bottom&&a.clientX<i.left}function sf(a,t,e){var i=he(Xo(e.el,e.options.draggable)),n=yh(e.el,e.options,ut),s=10;return t?a.clientX>n.right+s||a.clientY>i.bottom&&a.clientX>i.left:a.clientY>n.bottom+s||a.clientX>i.right&&a.clientY>i.top}function rf(a,t,e,i,n,s,r,o){var l=i?a.clientY:a.clientX,h=i?e.height:e.width,c=i?e.top:e.left,u=i?e.bottom:e.right,p=!1;if(!r){if(o&&Js<h*n){if(!rs&&(ss===1?l>c+h*s/2:l<u-h*s/2)&&(rs=!0),rs)p=!0;else if(ss===1?l<c+Js:l>u-Js)return-ss}else if(l>c+h*(1-n)/2&&l<u-h*(1-n)/2)return of(t)}return p=p||r,p&&(l<c+h*s/2||l>u-h*s/2)?l>c+h/2?1:-1:0}function of(a){return ni(X)<ni(a)?1:-1}function af(a){for(var t=a.tagName+a.className+a.src+a.href+a.textContent,e=t.length,i=0;e--;)i+=t.charCodeAt(e);return i.toString(36)}function lf(a){or.length=0;for(var t=a.getElementsByTagName("input"),e=t.length;e--;){var i=t[e];i.checked&&or.push(i)}}function Qs(a){return setTimeout(a,0)}function So(a){return clearTimeout(a)}Ar&&At(document,"touchmove",function(a){(ht.active||En)&&a.cancelable&&a.preventDefault()});ht.utils={on:At,off:vt,css:at,find:ph,is:function(t,e){return!!ci(t,e,t,!1)},extend:zu,throttle:gh,closest:ci,toggleClass:Ve,clone:bh,index:ni,nextTick:Qs,cancelNextTick:So,detectDirection:vh,getChild:Rn,expando:He};ht.get=function(a){return a[He]};ht.mount=function(){for(var a=arguments.length,t=new Array(a),e=0;e<a;e++)t[e]=arguments[e];t[0].constructor===Array&&(t=t[0]),t.forEach(function(i){if(!i.prototype||!i.prototype.constructor)throw"Sortable: Mounted plugin must be a constructor function, not ".concat({}.toString.call(i));i.utils&&(ht.utils=Ci(Ci({},ht.utils),i.utils)),xs.mount(i)})};ht.create=function(a,t){return new ht(a,t)};ht.version=Hu;var le=[],Qn,xo,Co=!1,Jr,Qr,ar,Zn;function hf(){function a(){this.defaults={scroll:!0,forceAutoScrollFallback:!1,scrollSensitivity:30,scrollSpeed:10,bubbleScroll:!0};for(var t in this)t.charAt(0)==="_"&&typeof this[t]=="function"&&(this[t]=this[t].bind(this))}return a.prototype={dragStarted:function(e){var i=e.originalEvent;this.sortable.nativeDraggable?At(document,"dragover",this._handleAutoScroll):this.options.supportPointer?At(document,"pointermove",this._handleFallbackAutoScroll):i.touches?At(document,"touchmove",this._handleFallbackAutoScroll):At(document,"mousemove",this._handleFallbackAutoScroll)},dragOverCompleted:function(e){var i=e.originalEvent;!this.options.dragOverBubble&&!i.rootEl&&this._handleAutoScroll(i)},drop:function(){this.sortable.nativeDraggable?vt(document,"dragover",this._handleAutoScroll):(vt(document,"pointermove",this._handleFallbackAutoScroll),vt(document,"touchmove",this._handleFallbackAutoScroll),vt(document,"mousemove",this._handleFallbackAutoScroll)),tl(),Zs(),Gu()},nulling:function(){ar=xo=Qn=Co=Zn=Jr=Qr=null,le.length=0},_handleFallbackAutoScroll:function(e){this._handleAutoScroll(e,!0)},_handleAutoScroll:function(e,i){var n=this,s=(e.touches?e.touches[0]:e).clientX,r=(e.touches?e.touches[0]:e).clientY,o=document.elementFromPoint(s,r);if(ar=e,i||this.options.forceAutoScrollFallback||Ss||Ri||es){Zr(e,this.options,o,i);var l=zi(o,!0);Co&&(!Zn||s!==Jr||r!==Qr)&&(Zn&&tl(),Zn=setInterval(function(){var h=zi(document.elementFromPoint(s,r),!0);h!==l&&(l=h,Zs()),Zr(e,n.options,h,i)},10),Jr=s,Qr=r)}else{if(!this.options.bubbleScroll||zi(o,!0)===Si()){Zs();return}Zr(e,this.options,zi(o,!1),!1)}}},Ii(a,{pluginName:"scroll",initializeByDefault:!0})}function Zs(){le.forEach(function(a){clearInterval(a.pid)}),le=[]}function tl(){clearInterval(Zn)}var Zr=gh(function(a,t,e,i){if(t.scroll){var n=(a.touches?a.touches[0]:a).clientX,s=(a.touches?a.touches[0]:a).clientY,r=t.scrollSensitivity,o=t.scrollSpeed,l=Si(),h=!1,c;xo!==e&&(xo=e,Zs(),Qn=t.scroll,c=t.scrollFn,Qn===!0&&(Qn=zi(e,!0)));var u=0,p=Qn;do{var b=p,w=he(b),v=w.top,x=w.bottom,E=w.left,D=w.right,T=w.width,k=w.height,F=void 0,M=void 0,O=b.scrollWidth,N=b.scrollHeight,R=at(b),$=b.scrollLeft,U=b.scrollTop;b===l?(F=T<O&&(R.overflowX==="auto"||R.overflowX==="scroll"||R.overflowX==="visible"),M=k<N&&(R.overflowY==="auto"||R.overflowY==="scroll"||R.overflowY==="visible")):(F=T<O&&(R.overflowX==="auto"||R.overflowX==="scroll"),M=k<N&&(R.overflowY==="auto"||R.overflowY==="scroll"));var Q=F&&(Math.abs(D-n)<=r&&$+T<O)-(Math.abs(E-n)<=r&&!!$),V=M&&(Math.abs(x-s)<=r&&U+k<N)-(Math.abs(v-s)<=r&&!!U);if(!le[u])for(var z=0;z<=u;z++)le[z]||(le[z]={});(le[u].vx!=Q||le[u].vy!=V||le[u].el!==b)&&(le[u].el=b,le[u].vx=Q,le[u].vy=V,clearInterval(le[u].pid),(Q!=0||V!=0)&&(h=!0,le[u].pid=setInterval((function(){i&&this.layer===0&&ht.active._onTouchMove(ar);var st=le[this.layer].vy?le[this.layer].vy*o:0,G=le[this.layer].vx?le[this.layer].vx*o:0;typeof c=="function"&&c.call(ht.dragged.parentNode[He],G,st,a,ar,le[this.layer].el)!=="continue"||mh(le[this.layer].el,G,st)}).bind({layer:u}),24))),u++}while(t.bubbleScroll&&p!==l&&(p=zi(p,!1)));Co=h}},30),xh=function(t){var e=t.originalEvent,i=t.putSortable,n=t.dragEl,s=t.activeSortable,r=t.dispatchSortableEvent,o=t.hideGhostForTarget,l=t.unhideGhostForTarget;if(e){var h=i||s;o();var c=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:e,u=document.elementFromPoint(c.clientX,c.clientY);l(),h&&!h.el.contains(u)&&(r("spill"),this.onSpill({dragEl:n,putSortable:i}))}};function Yo(){}Yo.prototype={startIndex:null,dragStart:function(t){var e=t.oldDraggableIndex;this.startIndex=e},onSpill:function(t){var e=t.dragEl,i=t.putSortable;this.sortable.captureAnimationState(),i&&i.captureAnimationState();var n=Rn(this.sortable.el,this.startIndex,this.options);n?this.sortable.el.insertBefore(e,n):this.sortable.el.appendChild(e),this.sortable.animateAll(),i&&i.animateAll()},drop:xh};Ii(Yo,{pluginName:"revertOnSpill"});function Ko(){}Ko.prototype={onSpill:function(t){var e=t.dragEl,i=t.putSortable,n=i||this.sortable;n.captureAnimationState(),e.parentNode&&e.parentNode.removeChild(e),n.animateAll()},drop:xh};Ii(Ko,{pluginName:"removeOnSpill"});ht.mount(new hf);ht.mount(Ko,Yo);const ct=a=>typeof a=="string",qn=()=>{let a,t;const e=new Promise((i,n)=>{a=i,t=n});return e.resolve=a,e.reject=t,e},el=a=>a==null?"":""+a,cf=(a,t,e)=>{a.forEach(i=>{t[i]&&(e[i]=t[i])})},df=/###/g,il=a=>a&&a.indexOf("###")>-1?a.replace(df,"."):a,nl=a=>!a||ct(a),os=(a,t,e)=>{const i=ct(t)?t.split("."):t;let n=0;for(;n<i.length-1;){if(nl(a))return{};const s=il(i[n]);!a[s]&&e&&(a[s]=new e),Object.prototype.hasOwnProperty.call(a,s)?a=a[s]:a={},++n}return nl(a)?{}:{obj:a,k:il(i[n])}},sl=(a,t,e)=>{const{obj:i,k:n}=os(a,t,Object);if(i!==void 0||t.length===1){i[n]=e;return}let s=t[t.length-1],r=t.slice(0,t.length-1),o=os(a,r,Object);for(;o.obj===void 0&&r.length;)s=`${r[r.length-1]}.${s}`,r=r.slice(0,r.length-1),o=os(a,r,Object),o?.obj&&typeof o.obj[`${o.k}.${s}`]<"u"&&(o.obj=void 0);o.obj[`${o.k}.${s}`]=e},uf=(a,t,e,i)=>{const{obj:n,k:s}=os(a,t,Object);n[s]=n[s]||[],n[s].push(e)},lr=(a,t)=>{const{obj:e,k:i}=os(a,t);if(e&&Object.prototype.hasOwnProperty.call(e,i))return e[i]},ff=(a,t,e)=>{const i=lr(a,e);return i!==void 0?i:lr(t,e)},Ch=(a,t,e)=>{for(const i in t)i!=="__proto__"&&i!=="constructor"&&(i in a?ct(a[i])||a[i]instanceof String||ct(t[i])||t[i]instanceof String?e&&(a[i]=t[i]):Ch(a[i],t[i],e):a[i]=t[i]);return a},yn=a=>a.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");var pf={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};const gf=a=>ct(a)?a.replace(/[&<>"'\/]/g,t=>pf[t]):a;class mf{constructor(t){this.capacity=t,this.regExpMap=new Map,this.regExpQueue=[]}getRegExp(t){const e=this.regExpMap.get(t);if(e!==void 0)return e;const i=new RegExp(t);return this.regExpQueue.length===this.capacity&&this.regExpMap.delete(this.regExpQueue.shift()),this.regExpMap.set(t,i),this.regExpQueue.push(t),i}}const bf=[" ",",","?","!",";"],yf=new mf(20),wf=(a,t,e)=>{t=t||"",e=e||"";const i=bf.filter(r=>t.indexOf(r)<0&&e.indexOf(r)<0);if(i.length===0)return!0;const n=yf.getRegExp(`(${i.map(r=>r==="?"?"\\?":r).join("|")})`);let s=!n.test(a);if(!s){const r=a.indexOf(e);r>0&&!n.test(a.substring(0,r))&&(s=!0)}return s},_o=(a,t,e=".")=>{if(!a)return;if(a[t])return Object.prototype.hasOwnProperty.call(a,t)?a[t]:void 0;const i=t.split(e);let n=a;for(let s=0;s<i.length;){if(!n||typeof n!="object")return;let r,o="";for(let l=s;l<i.length;++l)if(l!==s&&(o+=e),o+=i[l],r=n[o],r!==void 0){if(["string","number","boolean"].indexOf(typeof r)>-1&&l<i.length-1)continue;s+=l-s+1;break}n=r}return n},fs=a=>a?.replace("_","-"),vf={type:"logger",log(a){this.output("log",a)},warn(a){this.output("warn",a)},error(a){this.output("error",a)},output(a,t){console?.[a]?.apply?.(console,t)}};class hr{constructor(t,e={}){this.init(t,e)}init(t,e={}){this.prefix=e.prefix||"i18next:",this.logger=t||vf,this.options=e,this.debug=e.debug}log(...t){return this.forward(t,"log","",!0)}warn(...t){return this.forward(t,"warn","",!0)}error(...t){return this.forward(t,"error","")}deprecate(...t){return this.forward(t,"warn","WARNING DEPRECATED: ",!0)}forward(t,e,i,n){return n&&!this.debug?null:(ct(t[0])&&(t[0]=`${i}${this.prefix} ${t[0]}`),this.logger[e](t))}create(t){return new hr(this.logger,{prefix:`${this.prefix}:${t}:`,...this.options})}clone(t){return t=t||this.options,t.prefix=t.prefix||this.prefix,new hr(this.logger,t)}}var Ei=new hr;class Er{constructor(){this.observers={}}on(t,e){return t.split(" ").forEach(i=>{this.observers[i]||(this.observers[i]=new Map);const n=this.observers[i].get(e)||0;this.observers[i].set(e,n+1)}),this}off(t,e){if(this.observers[t]){if(!e){delete this.observers[t];return}this.observers[t].delete(e)}}emit(t,...e){this.observers[t]&&Array.from(this.observers[t].entries()).forEach(([n,s])=>{for(let r=0;r<s;r++)n(...e)}),this.observers["*"]&&Array.from(this.observers["*"].entries()).forEach(([n,s])=>{for(let r=0;r<s;r++)n.apply(n,[t,...e])})}}class rl extends Er{constructor(t,e={ns:["translation"],defaultNS:"translation"}){super(),this.data=t||{},this.options=e,this.options.keySeparator===void 0&&(this.options.keySeparator="."),this.options.ignoreJSONStructure===void 0&&(this.options.ignoreJSONStructure=!0)}addNamespaces(t){this.options.ns.indexOf(t)<0&&this.options.ns.push(t)}removeNamespaces(t){const e=this.options.ns.indexOf(t);e>-1&&this.options.ns.splice(e,1)}getResource(t,e,i,n={}){const s=n.keySeparator!==void 0?n.keySeparator:this.options.keySeparator,r=n.ignoreJSONStructure!==void 0?n.ignoreJSONStructure:this.options.ignoreJSONStructure;let o;t.indexOf(".")>-1?o=t.split("."):(o=[t,e],i&&(Array.isArray(i)?o.push(...i):ct(i)&&s?o.push(...i.split(s)):o.push(i)));const l=lr(this.data,o);return!l&&!e&&!i&&t.indexOf(".")>-1&&(t=o[0],e=o[1],i=o.slice(2).join(".")),l||!r||!ct(i)?l:_o(this.data?.[t]?.[e],i,s)}addResource(t,e,i,n,s={silent:!1}){const r=s.keySeparator!==void 0?s.keySeparator:this.options.keySeparator;let o=[t,e];i&&(o=o.concat(r?i.split(r):i)),t.indexOf(".")>-1&&(o=t.split("."),n=e,e=o[1]),this.addNamespaces(e),sl(this.data,o,n),s.silent||this.emit("added",t,e,i,n)}addResources(t,e,i,n={silent:!1}){for(const s in i)(ct(i[s])||Array.isArray(i[s]))&&this.addResource(t,e,s,i[s],{silent:!0});n.silent||this.emit("added",t,e,i)}addResourceBundle(t,e,i,n,s,r={silent:!1,skipCopy:!1}){let o=[t,e];t.indexOf(".")>-1&&(o=t.split("."),n=i,i=e,e=o[1]),this.addNamespaces(e);let l=lr(this.data,o)||{};r.skipCopy||(i=JSON.parse(JSON.stringify(i))),n?Ch(l,i,s):l={...l,...i},sl(this.data,o,l),r.silent||this.emit("added",t,e,i)}removeResourceBundle(t,e){this.hasResourceBundle(t,e)&&delete this.data[t][e],this.removeNamespaces(e),this.emit("removed",t,e)}hasResourceBundle(t,e){return this.getResource(t,e)!==void 0}getResourceBundle(t,e){return e||(e=this.options.defaultNS),this.getResource(t,e)}getDataByLanguage(t){return this.data[t]}hasLanguageSomeTranslations(t){const e=this.getDataByLanguage(t);return!!(e&&Object.keys(e)||[]).find(n=>e[n]&&Object.keys(e[n]).length>0)}toJSON(){return this.data}}var _h={processors:{},addPostProcessor(a){this.processors[a.name]=a},handle(a,t,e,i,n){return a.forEach(s=>{t=this.processors[s]?.process(t,e,i,n)??t}),t}};const Ph=Symbol("i18next/PATH_KEY");function Af(){const a=[],t=Object.create(null);let e;return t.get=(i,n)=>(e?.revoke?.(),n===Ph?a:(a.push(n),e=Proxy.revocable(i,t),e.proxy)),Proxy.revocable(Object.create(null),t).proxy}function Po(a,t){const{[Ph]:e}=a(Af());return e.join(t?.keySeparator??".")}const ol={},to=a=>!ct(a)&&typeof a!="boolean"&&typeof a!="number";class cr extends Er{constructor(t,e={}){super(),cf(["resourceStore","languageUtils","pluralResolver","interpolator","backendConnector","i18nFormat","utils"],t,this),this.options=e,this.options.keySeparator===void 0&&(this.options.keySeparator="."),this.logger=Ei.create("translator")}changeLanguage(t){t&&(this.language=t)}exists(t,e={interpolation:{}}){const i={...e};if(t==null)return!1;const n=this.resolve(t,i);if(n?.res===void 0)return!1;const s=to(n.res);return!(i.returnObjects===!1&&s)}extractFromKey(t,e){let i=e.nsSeparator!==void 0?e.nsSeparator:this.options.nsSeparator;i===void 0&&(i=":");const n=e.keySeparator!==void 0?e.keySeparator:this.options.keySeparator;let s=e.ns||this.options.defaultNS||[];const r=i&&t.indexOf(i)>-1,o=!this.options.userDefinedKeySeparator&&!e.keySeparator&&!this.options.userDefinedNsSeparator&&!e.nsSeparator&&!wf(t,i,n);if(r&&!o){const l=t.match(this.interpolator.nestingRegexp);if(l&&l.length>0)return{key:t,namespaces:ct(s)?[s]:s};const h=t.split(i);(i!==n||i===n&&this.options.ns.indexOf(h[0])>-1)&&(s=h.shift()),t=h.join(n)}return{key:t,namespaces:ct(s)?[s]:s}}translate(t,e,i){let n=typeof e=="object"?{...e}:e;if(typeof n!="object"&&this.options.overloadTranslationOptionHandler&&(n=this.options.overloadTranslationOptionHandler(arguments)),typeof n=="object"&&(n={...n}),n||(n={}),t==null)return"";typeof t=="function"&&(t=Po(t,{...this.options,...n})),Array.isArray(t)||(t=[String(t)]);const s=n.returnDetails!==void 0?n.returnDetails:this.options.returnDetails,r=n.keySeparator!==void 0?n.keySeparator:this.options.keySeparator,{key:o,namespaces:l}=this.extractFromKey(t[t.length-1],n),h=l[l.length-1];let c=n.nsSeparator!==void 0?n.nsSeparator:this.options.nsSeparator;c===void 0&&(c=":");const u=n.lng||this.language,p=n.appendNamespaceToCIMode||this.options.appendNamespaceToCIMode;if(u?.toLowerCase()==="cimode")return p?s?{res:`${h}${c}${o}`,usedKey:o,exactUsedKey:o,usedLng:u,usedNS:h,usedParams:this.getUsedParamsDetails(n)}:`${h}${c}${o}`:s?{res:o,usedKey:o,exactUsedKey:o,usedLng:u,usedNS:h,usedParams:this.getUsedParamsDetails(n)}:o;const b=this.resolve(t,n);let w=b?.res;const v=b?.usedKey||o,x=b?.exactUsedKey||o,E=["[object Number]","[object Function]","[object RegExp]"],D=n.joinArrays!==void 0?n.joinArrays:this.options.joinArrays,T=!this.i18nFormat||this.i18nFormat.handleAsObject,k=n.count!==void 0&&!ct(n.count),F=cr.hasDefaultValue(n),M=k?this.pluralResolver.getSuffix(u,n.count,n):"",O=n.ordinal&&k?this.pluralResolver.getSuffix(u,n.count,{ordinal:!1}):"",N=k&&!n.ordinal&&n.count===0,R=N&&n[`defaultValue${this.options.pluralSeparator}zero`]||n[`defaultValue${M}`]||n[`defaultValue${O}`]||n.defaultValue;let $=w;T&&!w&&F&&($=R);const U=to($),Q=Object.prototype.toString.apply($);if(T&&$&&U&&E.indexOf(Q)<0&&!(ct(D)&&Array.isArray($))){if(!n.returnObjects&&!this.options.returnObjects){this.options.returnedObjectHandler||this.logger.warn("accessing an object - but returnObjects options is not enabled!");const V=this.options.returnedObjectHandler?this.options.returnedObjectHandler(v,$,{...n,ns:l}):`key '${o} (${this.language})' returned an object instead of string.`;return s?(b.res=V,b.usedParams=this.getUsedParamsDetails(n),b):V}if(r){const V=Array.isArray($),z=V?[]:{},st=V?x:v;for(const G in $)if(Object.prototype.hasOwnProperty.call($,G)){const W=`${st}${r}${G}`;F&&!w?z[G]=this.translate(W,{...n,defaultValue:to(R)?R[G]:void 0,joinArrays:!1,ns:l}):z[G]=this.translate(W,{...n,joinArrays:!1,ns:l}),z[G]===W&&(z[G]=$[G])}w=z}}else if(T&&ct(D)&&Array.isArray(w))w=w.join(D),w&&(w=this.extendTranslation(w,t,n,i));else{let V=!1,z=!1;!this.isValidLookup(w)&&F&&(V=!0,w=R),this.isValidLookup(w)||(z=!0,w=o);const G=(n.missingKeyNoValueFallbackToKey||this.options.missingKeyNoValueFallbackToKey)&&z?void 0:w,W=F&&R!==w&&this.options.updateMissing;if(z||V||W){if(this.logger.log(W?"updateKey":"missingKey",u,h,o,W?R:w),r){const it=this.resolve(o,{...n,keySeparator:!1});it&&it.res&&this.logger.warn("Seems the loaded translations were in flat JSON format instead of nested. Either set keySeparator: false on init or make sure your translations are published in nested format.")}let Z=[];const xt=this.languageUtils.getFallbackCodes(this.options.fallbackLng,n.lng||this.language);if(this.options.saveMissingTo==="fallback"&&xt&&xt[0])for(let it=0;it<xt.length;it++)Z.push(xt[it]);else this.options.saveMissingTo==="all"?Z=this.languageUtils.toResolveHierarchy(n.lng||this.language):Z.push(n.lng||this.language);const Ft=(it,ot,mt)=>{const dt=F&&mt!==w?mt:G;this.options.missingKeyHandler?this.options.missingKeyHandler(it,h,ot,dt,W,n):this.backendConnector?.saveMissing&&this.backendConnector.saveMissing(it,h,ot,dt,W,n),this.emit("missingKey",it,h,ot,w)};this.options.saveMissing&&(this.options.saveMissingPlurals&&k?Z.forEach(it=>{const ot=this.pluralResolver.getSuffixes(it,n);N&&n[`defaultValue${this.options.pluralSeparator}zero`]&&ot.indexOf(`${this.options.pluralSeparator}zero`)<0&&ot.push(`${this.options.pluralSeparator}zero`),ot.forEach(mt=>{Ft([it],o+mt,n[`defaultValue${mt}`]||R)})}):Ft(Z,o,R))}w=this.extendTranslation(w,t,n,b,i),z&&w===o&&this.options.appendNamespaceToMissingKey&&(w=`${h}${c}${o}`),(z||V)&&this.options.parseMissingKeyHandler&&(w=this.options.parseMissingKeyHandler(this.options.appendNamespaceToMissingKey?`${h}${c}${o}`:o,V?w:void 0,n))}return s?(b.res=w,b.usedParams=this.getUsedParamsDetails(n),b):w}extendTranslation(t,e,i,n,s){if(this.i18nFormat?.parse)t=this.i18nFormat.parse(t,{...this.options.interpolation.defaultVariables,...i},i.lng||this.language||n.usedLng,n.usedNS,n.usedKey,{resolved:n});else if(!i.skipInterpolation){i.interpolation&&this.interpolator.init({...i,interpolation:{...this.options.interpolation,...i.interpolation}});const l=ct(t)&&(i?.interpolation?.skipOnVariables!==void 0?i.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables);let h;if(l){const u=t.match(this.interpolator.nestingRegexp);h=u&&u.length}let c=i.replace&&!ct(i.replace)?i.replace:i;if(this.options.interpolation.defaultVariables&&(c={...this.options.interpolation.defaultVariables,...c}),t=this.interpolator.interpolate(t,c,i.lng||this.language||n.usedLng,i),l){const u=t.match(this.interpolator.nestingRegexp),p=u&&u.length;h<p&&(i.nest=!1)}!i.lng&&n&&n.res&&(i.lng=this.language||n.usedLng),i.nest!==!1&&(t=this.interpolator.nest(t,(...u)=>s?.[0]===u[0]&&!i.context?(this.logger.warn(`It seems you are nesting recursively key: ${u[0]} in key: ${e[0]}`),null):this.translate(...u,e),i)),i.interpolation&&this.interpolator.reset()}const r=i.postProcess||this.options.postProcess,o=ct(r)?[r]:r;return t!=null&&o?.length&&i.applyPostProcessor!==!1&&(t=_h.handle(o,t,e,this.options&&this.options.postProcessPassResolved?{i18nResolved:{...n,usedParams:this.getUsedParamsDetails(i)},...i}:i,this)),t}resolve(t,e={}){let i,n,s,r,o;return ct(t)&&(t=[t]),t.forEach(l=>{if(this.isValidLookup(i))return;const h=this.extractFromKey(l,e),c=h.key;n=c;let u=h.namespaces;this.options.fallbackNS&&(u=u.concat(this.options.fallbackNS));const p=e.count!==void 0&&!ct(e.count),b=p&&!e.ordinal&&e.count===0,w=e.context!==void 0&&(ct(e.context)||typeof e.context=="number")&&e.context!=="",v=e.lngs?e.lngs:this.languageUtils.toResolveHierarchy(e.lng||this.language,e.fallbackLng);u.forEach(x=>{this.isValidLookup(i)||(o=x,!ol[`${v[0]}-${x}`]&&this.utils?.hasLoadedNamespace&&!this.utils?.hasLoadedNamespace(o)&&(ol[`${v[0]}-${x}`]=!0,this.logger.warn(`key "${n}" for languages "${v.join(", ")}" won't get resolved as namespace "${o}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!")),v.forEach(E=>{if(this.isValidLookup(i))return;r=E;const D=[c];if(this.i18nFormat?.addLookupKeys)this.i18nFormat.addLookupKeys(D,c,E,x,e);else{let k;p&&(k=this.pluralResolver.getSuffix(E,e.count,e));const F=`${this.options.pluralSeparator}zero`,M=`${this.options.pluralSeparator}ordinal${this.options.pluralSeparator}`;if(p&&(e.ordinal&&k.indexOf(M)===0&&D.push(c+k.replace(M,this.options.pluralSeparator)),D.push(c+k),b&&D.push(c+F)),w){const O=`${c}${this.options.contextSeparator||"_"}${e.context}`;D.push(O),p&&(e.ordinal&&k.indexOf(M)===0&&D.push(O+k.replace(M,this.options.pluralSeparator)),D.push(O+k),b&&D.push(O+F))}}let T;for(;T=D.pop();)this.isValidLookup(i)||(s=T,i=this.getResource(E,x,T,e))}))})}),{res:i,usedKey:n,exactUsedKey:s,usedLng:r,usedNS:o}}isValidLookup(t){return t!==void 0&&!(!this.options.returnNull&&t===null)&&!(!this.options.returnEmptyString&&t==="")}getResource(t,e,i,n={}){return this.i18nFormat?.getResource?this.i18nFormat.getResource(t,e,i,n):this.resourceStore.getResource(t,e,i,n)}getUsedParamsDetails(t={}){const e=["defaultValue","ordinal","context","replace","lng","lngs","fallbackLng","ns","keySeparator","nsSeparator","returnObjects","returnDetails","joinArrays","postProcess","interpolation"],i=t.replace&&!ct(t.replace);let n=i?t.replace:t;if(i&&typeof t.count<"u"&&(n.count=t.count),this.options.interpolation.defaultVariables&&(n={...this.options.interpolation.defaultVariables,...n}),!i){n={...n};for(const s of e)delete n[s]}return n}static hasDefaultValue(t){const e="defaultValue";for(const i in t)if(Object.prototype.hasOwnProperty.call(t,i)&&e===i.substring(0,e.length)&&t[i]!==void 0)return!0;return!1}}class al{constructor(t){this.options=t,this.supportedLngs=this.options.supportedLngs||!1,this.logger=Ei.create("languageUtils")}getScriptPartFromCode(t){if(t=fs(t),!t||t.indexOf("-")<0)return null;const e=t.split("-");return e.length===2||(e.pop(),e[e.length-1].toLowerCase()==="x")?null:this.formatLanguageCode(e.join("-"))}getLanguagePartFromCode(t){if(t=fs(t),!t||t.indexOf("-")<0)return t;const e=t.split("-");return this.formatLanguageCode(e[0])}formatLanguageCode(t){if(ct(t)&&t.indexOf("-")>-1){let e;try{e=Intl.getCanonicalLocales(t)[0]}catch{}return e&&this.options.lowerCaseLng&&(e=e.toLowerCase()),e||(this.options.lowerCaseLng?t.toLowerCase():t)}return this.options.cleanCode||this.options.lowerCaseLng?t.toLowerCase():t}isSupportedCode(t){return(this.options.load==="languageOnly"||this.options.nonExplicitSupportedLngs)&&(t=this.getLanguagePartFromCode(t)),!this.supportedLngs||!this.supportedLngs.length||this.supportedLngs.indexOf(t)>-1}getBestMatchFromCodes(t){if(!t)return null;let e;return t.forEach(i=>{if(e)return;const n=this.formatLanguageCode(i);(!this.options.supportedLngs||this.isSupportedCode(n))&&(e=n)}),!e&&this.options.supportedLngs&&t.forEach(i=>{if(e)return;const n=this.getScriptPartFromCode(i);if(this.isSupportedCode(n))return e=n;const s=this.getLanguagePartFromCode(i);if(this.isSupportedCode(s))return e=s;e=this.options.supportedLngs.find(r=>{if(r===s)return r;if(!(r.indexOf("-")<0&&s.indexOf("-")<0)&&(r.indexOf("-")>0&&s.indexOf("-")<0&&r.substring(0,r.indexOf("-"))===s||r.indexOf(s)===0&&s.length>1))return r})}),e||(e=this.getFallbackCodes(this.options.fallbackLng)[0]),e}getFallbackCodes(t,e){if(!t)return[];if(typeof t=="function"&&(t=t(e)),ct(t)&&(t=[t]),Array.isArray(t))return t;if(!e)return t.default||[];let i=t[e];return i||(i=t[this.getScriptPartFromCode(e)]),i||(i=t[this.formatLanguageCode(e)]),i||(i=t[this.getLanguagePartFromCode(e)]),i||(i=t.default),i||[]}toResolveHierarchy(t,e){const i=this.getFallbackCodes((e===!1?[]:e)||this.options.fallbackLng||[],t),n=[],s=r=>{r&&(this.isSupportedCode(r)?n.push(r):this.logger.warn(`rejecting language code not found in supportedLngs: ${r}`))};return ct(t)&&(t.indexOf("-")>-1||t.indexOf("_")>-1)?(this.options.load!=="languageOnly"&&s(this.formatLanguageCode(t)),this.options.load!=="languageOnly"&&this.options.load!=="currentOnly"&&s(this.getScriptPartFromCode(t)),this.options.load!=="currentOnly"&&s(this.getLanguagePartFromCode(t))):ct(t)&&s(this.formatLanguageCode(t)),i.forEach(r=>{n.indexOf(r)<0&&s(this.formatLanguageCode(r))}),n}}const ll={zero:0,one:1,two:2,few:3,many:4,other:5},hl={select:a=>a===1?"one":"other",resolvedOptions:()=>({pluralCategories:["one","other"]})};class Ef{constructor(t,e={}){this.languageUtils=t,this.options=e,this.logger=Ei.create("pluralResolver"),this.pluralRulesCache={}}addRule(t,e){this.rules[t]=e}clearCache(){this.pluralRulesCache={}}getRule(t,e={}){const i=fs(t==="dev"?"en":t),n=e.ordinal?"ordinal":"cardinal",s=JSON.stringify({cleanedCode:i,type:n});if(s in this.pluralRulesCache)return this.pluralRulesCache[s];let r;try{r=new Intl.PluralRules(i,{type:n})}catch{if(!Intl)return this.logger.error("No Intl support, please use an Intl polyfill!"),hl;if(!t.match(/-|_/))return hl;const l=this.languageUtils.getLanguagePartFromCode(t);r=this.getRule(l,e)}return this.pluralRulesCache[s]=r,r}needsPlural(t,e={}){let i=this.getRule(t,e);return i||(i=this.getRule("dev",e)),i?.resolvedOptions().pluralCategories.length>1}getPluralFormsOfKey(t,e,i={}){return this.getSuffixes(t,i).map(n=>`${e}${n}`)}getSuffixes(t,e={}){let i=this.getRule(t,e);return i||(i=this.getRule("dev",e)),i?i.resolvedOptions().pluralCategories.sort((n,s)=>ll[n]-ll[s]).map(n=>`${this.options.prepend}${e.ordinal?`ordinal${this.options.prepend}`:""}${n}`):[]}getSuffix(t,e,i={}){const n=this.getRule(t,i);return n?`${this.options.prepend}${i.ordinal?`ordinal${this.options.prepend}`:""}${n.select(e)}`:(this.logger.warn(`no plural rule found for: ${t}`),this.getSuffix("dev",e,i))}}const cl=(a,t,e,i=".",n=!0)=>{let s=ff(a,t,e);return!s&&n&&ct(e)&&(s=_o(a,e,i),s===void 0&&(s=_o(t,e,i))),s},eo=a=>a.replace(/\$/g,"$$$$");class dl{constructor(t={}){this.logger=Ei.create("interpolator"),this.options=t,this.format=t?.interpolation?.format||(e=>e),this.init(t)}init(t={}){t.interpolation||(t.interpolation={escapeValue:!0});const{escape:e,escapeValue:i,useRawValueToEscape:n,prefix:s,prefixEscaped:r,suffix:o,suffixEscaped:l,formatSeparator:h,unescapeSuffix:c,unescapePrefix:u,nestingPrefix:p,nestingPrefixEscaped:b,nestingSuffix:w,nestingSuffixEscaped:v,nestingOptionsSeparator:x,maxReplaces:E,alwaysFormat:D}=t.interpolation;this.escape=e!==void 0?e:gf,this.escapeValue=i!==void 0?i:!0,this.useRawValueToEscape=n!==void 0?n:!1,this.prefix=s?yn(s):r||"{{",this.suffix=o?yn(o):l||"}}",this.formatSeparator=h||",",this.unescapePrefix=c?"":u||"-",this.unescapeSuffix=this.unescapePrefix?"":c||"",this.nestingPrefix=p?yn(p):b||yn("$t("),this.nestingSuffix=w?yn(w):v||yn(")"),this.nestingOptionsSeparator=x||",",this.maxReplaces=E||1e3,this.alwaysFormat=D!==void 0?D:!1,this.resetRegExp()}reset(){this.options&&this.init(this.options)}resetRegExp(){const t=(e,i)=>e?.source===i?(e.lastIndex=0,e):new RegExp(i,"g");this.regexp=t(this.regexp,`${this.prefix}(.+?)${this.suffix}`),this.regexpUnescape=t(this.regexpUnescape,`${this.prefix}${this.unescapePrefix}(.+?)${this.unescapeSuffix}${this.suffix}`),this.nestingRegexp=t(this.nestingRegexp,`${this.nestingPrefix}((?:[^()"']+|"[^"]*"|'[^']*'|\\((?:[^()]|"[^"]*"|'[^']*')*\\))*?)${this.nestingSuffix}`)}interpolate(t,e,i,n){let s,r,o;const l=this.options&&this.options.interpolation&&this.options.interpolation.defaultVariables||{},h=b=>{if(b.indexOf(this.formatSeparator)<0){const E=cl(e,l,b,this.options.keySeparator,this.options.ignoreJSONStructure);return this.alwaysFormat?this.format(E,void 0,i,{...n,...e,interpolationkey:b}):E}const w=b.split(this.formatSeparator),v=w.shift().trim(),x=w.join(this.formatSeparator).trim();return this.format(cl(e,l,v,this.options.keySeparator,this.options.ignoreJSONStructure),x,i,{...n,...e,interpolationkey:v})};this.resetRegExp();const c=n?.missingInterpolationHandler||this.options.missingInterpolationHandler,u=n?.interpolation?.skipOnVariables!==void 0?n.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables;return[{regex:this.regexpUnescape,safeValue:b=>eo(b)},{regex:this.regexp,safeValue:b=>this.escapeValue?eo(this.escape(b)):eo(b)}].forEach(b=>{for(o=0;s=b.regex.exec(t);){const w=s[1].trim();if(r=h(w),r===void 0)if(typeof c=="function"){const x=c(t,s,n);r=ct(x)?x:""}else if(n&&Object.prototype.hasOwnProperty.call(n,w))r="";else if(u){r=s[0];continue}else this.logger.warn(`missed to pass in variable ${w} for interpolating ${t}`),r="";else!ct(r)&&!this.useRawValueToEscape&&(r=el(r));const v=b.safeValue(r);if(t=t.replace(s[0],v),u?(b.regex.lastIndex+=r.length,b.regex.lastIndex-=s[0].length):b.regex.lastIndex=0,o++,o>=this.maxReplaces)break}}),t}nest(t,e,i={}){let n,s,r;const o=(l,h)=>{const c=this.nestingOptionsSeparator;if(l.indexOf(c)<0)return l;const u=l.split(new RegExp(`${c}[ ]*{`));let p=`{${u[1]}`;l=u[0],p=this.interpolate(p,r);const b=p.match(/'/g),w=p.match(/"/g);((b?.length??0)%2===0&&!w||w.length%2!==0)&&(p=p.replace(/'/g,'"'));try{r=JSON.parse(p),h&&(r={...h,...r})}catch(v){return this.logger.warn(`failed parsing options string in nesting for key ${l}`,v),`${l}${c}${p}`}return r.defaultValue&&r.defaultValue.indexOf(this.prefix)>-1&&delete r.defaultValue,l};for(;n=this.nestingRegexp.exec(t);){let l=[];r={...i},r=r.replace&&!ct(r.replace)?r.replace:r,r.applyPostProcessor=!1,delete r.defaultValue;const h=/{.*}/.test(n[1])?n[1].lastIndexOf("}")+1:n[1].indexOf(this.formatSeparator);if(h!==-1&&(l=n[1].slice(h).split(this.formatSeparator).map(c=>c.trim()).filter(Boolean),n[1]=n[1].slice(0,h)),s=e(o.call(this,n[1].trim(),r),r),s&&n[0]===t&&!ct(s))return s;ct(s)||(s=el(s)),s||(this.logger.warn(`missed to resolve ${n[1]} for nesting ${t}`),s=""),l.length&&(s=l.reduce((c,u)=>this.format(c,u,i.lng,{...i,interpolationkey:n[1].trim()}),s.trim())),t=t.replace(n[0],s),this.regexp.lastIndex=0}return t}}const Sf=a=>{let t=a.toLowerCase().trim();const e={};if(a.indexOf("(")>-1){const i=a.split("(");t=i[0].toLowerCase().trim();const n=i[1].substring(0,i[1].length-1);t==="currency"&&n.indexOf(":")<0?e.currency||(e.currency=n.trim()):t==="relativetime"&&n.indexOf(":")<0?e.range||(e.range=n.trim()):n.split(";").forEach(r=>{if(r){const[o,...l]=r.split(":"),h=l.join(":").trim().replace(/^'+|'+$/g,""),c=o.trim();e[c]||(e[c]=h),h==="false"&&(e[c]=!1),h==="true"&&(e[c]=!0),isNaN(h)||(e[c]=parseInt(h,10))}})}return{formatName:t,formatOptions:e}},ul=a=>{const t={};return(e,i,n)=>{let s=n;n&&n.interpolationkey&&n.formatParams&&n.formatParams[n.interpolationkey]&&n[n.interpolationkey]&&(s={...s,[n.interpolationkey]:void 0});const r=i+JSON.stringify(s);let o=t[r];return o||(o=a(fs(i),n),t[r]=o),o(e)}},xf=a=>(t,e,i)=>a(fs(e),i)(t);class Cf{constructor(t={}){this.logger=Ei.create("formatter"),this.options=t,this.init(t)}init(t,e={interpolation:{}}){this.formatSeparator=e.interpolation.formatSeparator||",";const i=e.cacheInBuiltFormats?ul:xf;this.formats={number:i((n,s)=>{const r=new Intl.NumberFormat(n,{...s});return o=>r.format(o)}),currency:i((n,s)=>{const r=new Intl.NumberFormat(n,{...s,style:"currency"});return o=>r.format(o)}),datetime:i((n,s)=>{const r=new Intl.DateTimeFormat(n,{...s});return o=>r.format(o)}),relativetime:i((n,s)=>{const r=new Intl.RelativeTimeFormat(n,{...s});return o=>r.format(o,s.range||"day")}),list:i((n,s)=>{const r=new Intl.ListFormat(n,{...s});return o=>r.format(o)})}}add(t,e){this.formats[t.toLowerCase().trim()]=e}addCached(t,e){this.formats[t.toLowerCase().trim()]=ul(e)}format(t,e,i,n={}){const s=e.split(this.formatSeparator);if(s.length>1&&s[0].indexOf("(")>1&&s[0].indexOf(")")<0&&s.find(o=>o.indexOf(")")>-1)){const o=s.findIndex(l=>l.indexOf(")")>-1);s[0]=[s[0],...s.splice(1,o)].join(this.formatSeparator)}return s.reduce((o,l)=>{const{formatName:h,formatOptions:c}=Sf(l);if(this.formats[h]){let u=o;try{const p=n?.formatParams?.[n.interpolationkey]||{},b=p.locale||p.lng||n.locale||n.lng||i;u=this.formats[h](o,b,{...c,...n,...p})}catch(p){this.logger.warn(p)}return u}else this.logger.warn(`there was no format function for ${h}`);return o},t)}}const _f=(a,t)=>{a.pending[t]!==void 0&&(delete a.pending[t],a.pendingCount--)};class Pf extends Er{constructor(t,e,i,n={}){super(),this.backend=t,this.store=e,this.services=i,this.languageUtils=i.languageUtils,this.options=n,this.logger=Ei.create("backendConnector"),this.waitingReads=[],this.maxParallelReads=n.maxParallelReads||10,this.readingCalls=0,this.maxRetries=n.maxRetries>=0?n.maxRetries:5,this.retryTimeout=n.retryTimeout>=1?n.retryTimeout:350,this.state={},this.queue=[],this.backend?.init?.(i,n.backend,n)}queueLoad(t,e,i,n){const s={},r={},o={},l={};return t.forEach(h=>{let c=!0;e.forEach(u=>{const p=`${h}|${u}`;!i.reload&&this.store.hasResourceBundle(h,u)?this.state[p]=2:this.state[p]<0||(this.state[p]===1?r[p]===void 0&&(r[p]=!0):(this.state[p]=1,c=!1,r[p]===void 0&&(r[p]=!0),s[p]===void 0&&(s[p]=!0),l[u]===void 0&&(l[u]=!0)))}),c||(o[h]=!0)}),(Object.keys(s).length||Object.keys(r).length)&&this.queue.push({pending:r,pendingCount:Object.keys(r).length,loaded:{},errors:[],callback:n}),{toLoad:Object.keys(s),pending:Object.keys(r),toLoadLanguages:Object.keys(o),toLoadNamespaces:Object.keys(l)}}loaded(t,e,i){const n=t.split("|"),s=n[0],r=n[1];e&&this.emit("failedLoading",s,r,e),!e&&i&&this.store.addResourceBundle(s,r,i,void 0,void 0,{skipCopy:!0}),this.state[t]=e?-1:2,e&&i&&(this.state[t]=0);const o={};this.queue.forEach(l=>{uf(l.loaded,[s],r),_f(l,t),e&&l.errors.push(e),l.pendingCount===0&&!l.done&&(Object.keys(l.loaded).forEach(h=>{o[h]||(o[h]={});const c=l.loaded[h];c.length&&c.forEach(u=>{o[h][u]===void 0&&(o[h][u]=!0)})}),l.done=!0,l.errors.length?l.callback(l.errors):l.callback())}),this.emit("loaded",o),this.queue=this.queue.filter(l=>!l.done)}read(t,e,i,n=0,s=this.retryTimeout,r){if(!t.length)return r(null,{});if(this.readingCalls>=this.maxParallelReads){this.waitingReads.push({lng:t,ns:e,fcName:i,tried:n,wait:s,callback:r});return}this.readingCalls++;const o=(h,c)=>{if(this.readingCalls--,this.waitingReads.length>0){const u=this.waitingReads.shift();this.read(u.lng,u.ns,u.fcName,u.tried,u.wait,u.callback)}if(h&&c&&n<this.maxRetries){setTimeout(()=>{this.read.call(this,t,e,i,n+1,s*2,r)},s);return}r(h,c)},l=this.backend[i].bind(this.backend);if(l.length===2){try{const h=l(t,e);h&&typeof h.then=="function"?h.then(c=>o(null,c)).catch(o):o(null,h)}catch(h){o(h)}return}return l(t,e,o)}prepareLoading(t,e,i={},n){if(!this.backend)return this.logger.warn("No backend was added via i18next.use. Will not load resources."),n&&n();ct(t)&&(t=this.languageUtils.toResolveHierarchy(t)),ct(e)&&(e=[e]);const s=this.queueLoad(t,e,i,n);if(!s.toLoad.length)return s.pending.length||n(),null;s.toLoad.forEach(r=>{this.loadOne(r)})}load(t,e,i){this.prepareLoading(t,e,{},i)}reload(t,e,i){this.prepareLoading(t,e,{reload:!0},i)}loadOne(t,e=""){const i=t.split("|"),n=i[0],s=i[1];this.read(n,s,"read",void 0,void 0,(r,o)=>{r&&this.logger.warn(`${e}loading namespace ${s} for language ${n} failed`,r),!r&&o&&this.logger.log(`${e}loaded namespace ${s} for language ${n}`,o),this.loaded(t,r,o)})}saveMissing(t,e,i,n,s,r={},o=()=>{}){if(this.services?.utils?.hasLoadedNamespace&&!this.services?.utils?.hasLoadedNamespace(e)){this.logger.warn(`did not save key "${i}" as the namespace "${e}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!");return}if(!(i==null||i==="")){if(this.backend?.create){const l={...r,isUpdate:s},h=this.backend.create.bind(this.backend);if(h.length<6)try{let c;h.length===5?c=h(t,e,i,n,l):c=h(t,e,i,n),c&&typeof c.then=="function"?c.then(u=>o(null,u)).catch(o):o(null,c)}catch(c){o(c)}else h(t,e,i,n,o,l)}!t||!t[0]||this.store.addResource(t[0],e,i,n)}}}const fl=()=>({debug:!1,initAsync:!0,ns:["translation"],defaultNS:["translation"],fallbackLng:["dev"],fallbackNS:!1,supportedLngs:!1,nonExplicitSupportedLngs:!1,load:"all",preload:!1,simplifyPluralSuffix:!0,keySeparator:".",nsSeparator:":",pluralSeparator:"_",contextSeparator:"_",partialBundledLanguages:!1,saveMissing:!1,updateMissing:!1,saveMissingTo:"fallback",saveMissingPlurals:!0,missingKeyHandler:!1,missingInterpolationHandler:!1,postProcess:!1,postProcessPassResolved:!1,returnNull:!1,returnEmptyString:!0,returnObjects:!1,joinArrays:!1,returnedObjectHandler:!1,parseMissingKeyHandler:!1,appendNamespaceToMissingKey:!1,appendNamespaceToCIMode:!1,overloadTranslationOptionHandler:a=>{let t={};if(typeof a[1]=="object"&&(t=a[1]),ct(a[1])&&(t.defaultValue=a[1]),ct(a[2])&&(t.tDescription=a[2]),typeof a[2]=="object"||typeof a[3]=="object"){const e=a[3]||a[2];Object.keys(e).forEach(i=>{t[i]=e[i]})}return t},interpolation:{escapeValue:!0,format:a=>a,prefix:"{{",suffix:"}}",formatSeparator:",",unescapePrefix:"-",nestingPrefix:"$t(",nestingSuffix:")",nestingOptionsSeparator:",",maxReplaces:1e3,skipOnVariables:!0},cacheInBuiltFormats:!0}),pl=a=>(ct(a.ns)&&(a.ns=[a.ns]),ct(a.fallbackLng)&&(a.fallbackLng=[a.fallbackLng]),ct(a.fallbackNS)&&(a.fallbackNS=[a.fallbackNS]),a.supportedLngs?.indexOf?.("cimode")<0&&(a.supportedLngs=a.supportedLngs.concat(["cimode"])),typeof a.initImmediate=="boolean"&&(a.initAsync=a.initImmediate),a),Gs=()=>{},Tf=a=>{Object.getOwnPropertyNames(Object.getPrototypeOf(a)).forEach(e=>{typeof a[e]=="function"&&(a[e]=a[e].bind(a))})};class as extends Er{constructor(t={},e){if(super(),this.options=pl(t),this.services={},this.logger=Ei,this.modules={external:[]},Tf(this),e&&!this.isInitialized&&!t.isClone){if(!this.options.initAsync)return this.init(t,e),this;setTimeout(()=>{this.init(t,e)},0)}}init(t={},e){this.isInitializing=!0,typeof t=="function"&&(e=t,t={}),t.defaultNS==null&&t.ns&&(ct(t.ns)?t.defaultNS=t.ns:t.ns.indexOf("translation")<0&&(t.defaultNS=t.ns[0]));const i=fl();this.options={...i,...this.options,...pl(t)},this.options.interpolation={...i.interpolation,...this.options.interpolation},t.keySeparator!==void 0&&(this.options.userDefinedKeySeparator=t.keySeparator),t.nsSeparator!==void 0&&(this.options.userDefinedNsSeparator=t.nsSeparator),typeof this.options.overloadTranslationOptionHandler!="function"&&(this.options.overloadTranslationOptionHandler=i.overloadTranslationOptionHandler);const n=h=>h?typeof h=="function"?new h:h:null;if(!this.options.isClone){this.modules.logger?Ei.init(n(this.modules.logger),this.options):Ei.init(null,this.options);let h;this.modules.formatter?h=this.modules.formatter:h=Cf;const c=new al(this.options);this.store=new rl(this.options.resources,this.options);const u=this.services;u.logger=Ei,u.resourceStore=this.store,u.languageUtils=c,u.pluralResolver=new Ef(c,{prepend:this.options.pluralSeparator,simplifyPluralSuffix:this.options.simplifyPluralSuffix}),this.options.interpolation.format&&this.options.interpolation.format!==i.interpolation.format&&this.logger.deprecate("init: you are still using the legacy format function, please use the new approach: https://www.i18next.com/translation-function/formatting"),h&&(!this.options.interpolation.format||this.options.interpolation.format===i.interpolation.format)&&(u.formatter=n(h),u.formatter.init&&u.formatter.init(u,this.options),this.options.interpolation.format=u.formatter.format.bind(u.formatter)),u.interpolator=new dl(this.options),u.utils={hasLoadedNamespace:this.hasLoadedNamespace.bind(this)},u.backendConnector=new Pf(n(this.modules.backend),u.resourceStore,u,this.options),u.backendConnector.on("*",(b,...w)=>{this.emit(b,...w)}),this.modules.languageDetector&&(u.languageDetector=n(this.modules.languageDetector),u.languageDetector.init&&u.languageDetector.init(u,this.options.detection,this.options)),this.modules.i18nFormat&&(u.i18nFormat=n(this.modules.i18nFormat),u.i18nFormat.init&&u.i18nFormat.init(this)),this.translator=new cr(this.services,this.options),this.translator.on("*",(b,...w)=>{this.emit(b,...w)}),this.modules.external.forEach(b=>{b.init&&b.init(this)})}if(this.format=this.options.interpolation.format,e||(e=Gs),this.options.fallbackLng&&!this.services.languageDetector&&!this.options.lng){const h=this.services.languageUtils.getFallbackCodes(this.options.fallbackLng);h.length>0&&h[0]!=="dev"&&(this.options.lng=h[0])}!this.services.languageDetector&&!this.options.lng&&this.logger.warn("init: no languageDetector is used and no lng is defined"),["getResource","hasResourceBundle","getResourceBundle","getDataByLanguage"].forEach(h=>{this[h]=(...c)=>this.store[h](...c)}),["addResource","addResources","addResourceBundle","removeResourceBundle"].forEach(h=>{this[h]=(...c)=>(this.store[h](...c),this)});const o=qn(),l=()=>{const h=(c,u)=>{this.isInitializing=!1,this.isInitialized&&!this.initializedStoreOnce&&this.logger.warn("init: i18next is already initialized. You should call init just once!"),this.isInitialized=!0,this.options.isClone||this.logger.log("initialized",this.options),this.emit("initialized",this.options),o.resolve(u),e(c,u)};if(this.languages&&!this.isInitialized)return h(null,this.t.bind(this));this.changeLanguage(this.options.lng,h)};return this.options.resources||!this.options.initAsync?l():setTimeout(l,0),o}loadResources(t,e=Gs){let i=e;const n=ct(t)?t:this.language;if(typeof t=="function"&&(i=t),!this.options.resources||this.options.partialBundledLanguages){if(n?.toLowerCase()==="cimode"&&(!this.options.preload||this.options.preload.length===0))return i();const s=[],r=o=>{if(!o||o==="cimode")return;this.services.languageUtils.toResolveHierarchy(o).forEach(h=>{h!=="cimode"&&s.indexOf(h)<0&&s.push(h)})};n?r(n):this.services.languageUtils.getFallbackCodes(this.options.fallbackLng).forEach(l=>r(l)),this.options.preload?.forEach?.(o=>r(o)),this.services.backendConnector.load(s,this.options.ns,o=>{!o&&!this.resolvedLanguage&&this.language&&this.setResolvedLanguage(this.language),i(o)})}else i(null)}reloadResources(t,e,i){const n=qn();return typeof t=="function"&&(i=t,t=void 0),typeof e=="function"&&(i=e,e=void 0),t||(t=this.languages),e||(e=this.options.ns),i||(i=Gs),this.services.backendConnector.reload(t,e,s=>{n.resolve(),i(s)}),n}use(t){if(!t)throw new Error("You are passing an undefined module! Please check the object you are passing to i18next.use()");if(!t.type)throw new Error("You are passing a wrong module! Please check the object you are passing to i18next.use()");return t.type==="backend"&&(this.modules.backend=t),(t.type==="logger"||t.log&&t.warn&&t.error)&&(this.modules.logger=t),t.type==="languageDetector"&&(this.modules.languageDetector=t),t.type==="i18nFormat"&&(this.modules.i18nFormat=t),t.type==="postProcessor"&&_h.addPostProcessor(t),t.type==="formatter"&&(this.modules.formatter=t),t.type==="3rdParty"&&this.modules.external.push(t),this}setResolvedLanguage(t){if(!(!t||!this.languages)&&!(["cimode","dev"].indexOf(t)>-1)){for(let e=0;e<this.languages.length;e++){const i=this.languages[e];if(!(["cimode","dev"].indexOf(i)>-1)&&this.store.hasLanguageSomeTranslations(i)){this.resolvedLanguage=i;break}}!this.resolvedLanguage&&this.languages.indexOf(t)<0&&this.store.hasLanguageSomeTranslations(t)&&(this.resolvedLanguage=t,this.languages.unshift(t))}}changeLanguage(t,e){this.isLanguageChangingTo=t;const i=qn();this.emit("languageChanging",t);const n=o=>{this.language=o,this.languages=this.services.languageUtils.toResolveHierarchy(o),this.resolvedLanguage=void 0,this.setResolvedLanguage(o)},s=(o,l)=>{l?this.isLanguageChangingTo===t&&(n(l),this.translator.changeLanguage(l),this.isLanguageChangingTo=void 0,this.emit("languageChanged",l),this.logger.log("languageChanged",l)):this.isLanguageChangingTo=void 0,i.resolve((...h)=>this.t(...h)),e&&e(o,(...h)=>this.t(...h))},r=o=>{!t&&!o&&this.services.languageDetector&&(o=[]);const l=ct(o)?o:o&&o[0],h=this.store.hasLanguageSomeTranslations(l)?l:this.services.languageUtils.getBestMatchFromCodes(ct(o)?[o]:o);h&&(this.language||n(h),this.translator.language||this.translator.changeLanguage(h),this.services.languageDetector?.cacheUserLanguage?.(h)),this.loadResources(h,c=>{s(c,h)})};return!t&&this.services.languageDetector&&!this.services.languageDetector.async?r(this.services.languageDetector.detect()):!t&&this.services.languageDetector&&this.services.languageDetector.async?this.services.languageDetector.detect.length===0?this.services.languageDetector.detect().then(r):this.services.languageDetector.detect(r):r(t),i}getFixedT(t,e,i){const n=(s,r,...o)=>{let l;typeof r!="object"?l=this.options.overloadTranslationOptionHandler([s,r].concat(o)):l={...r},l.lng=l.lng||n.lng,l.lngs=l.lngs||n.lngs,l.ns=l.ns||n.ns,l.keyPrefix!==""&&(l.keyPrefix=l.keyPrefix||i||n.keyPrefix);const h=this.options.keySeparator||".";let c;return l.keyPrefix&&Array.isArray(s)?c=s.map(u=>(typeof u=="function"&&(u=Po(u,{...this.options,...r})),`${l.keyPrefix}${h}${u}`)):(typeof s=="function"&&(s=Po(s,{...this.options,...r})),c=l.keyPrefix?`${l.keyPrefix}${h}${s}`:s),this.t(c,l)};return ct(t)?n.lng=t:n.lngs=t,n.ns=e,n.keyPrefix=i,n}t(...t){return this.translator?.translate(...t)}exists(...t){return this.translator?.exists(...t)}setDefaultNamespace(t){this.options.defaultNS=t}hasLoadedNamespace(t,e={}){if(!this.isInitialized)return this.logger.warn("hasLoadedNamespace: i18next was not initialized",this.languages),!1;if(!this.languages||!this.languages.length)return this.logger.warn("hasLoadedNamespace: i18n.languages were undefined or empty",this.languages),!1;const i=e.lng||this.resolvedLanguage||this.languages[0],n=this.options?this.options.fallbackLng:!1,s=this.languages[this.languages.length-1];if(i.toLowerCase()==="cimode")return!0;const r=(o,l)=>{const h=this.services.backendConnector.state[`${o}|${l}`];return h===-1||h===0||h===2};if(e.precheck){const o=e.precheck(this,r);if(o!==void 0)return o}return!!(this.hasResourceBundle(i,t)||!this.services.backendConnector.backend||this.options.resources&&!this.options.partialBundledLanguages||r(i,t)&&(!n||r(s,t)))}loadNamespaces(t,e){const i=qn();return this.options.ns?(ct(t)&&(t=[t]),t.forEach(n=>{this.options.ns.indexOf(n)<0&&this.options.ns.push(n)}),this.loadResources(n=>{i.resolve(),e&&e(n)}),i):(e&&e(),Promise.resolve())}loadLanguages(t,e){const i=qn();ct(t)&&(t=[t]);const n=this.options.preload||[],s=t.filter(r=>n.indexOf(r)<0&&this.services.languageUtils.isSupportedCode(r));return s.length?(this.options.preload=n.concat(s),this.loadResources(r=>{i.resolve(),e&&e(r)}),i):(e&&e(),Promise.resolve())}dir(t){if(t||(t=this.resolvedLanguage||(this.languages?.length>0?this.languages[0]:this.language)),!t)return"rtl";try{const n=new Intl.Locale(t);if(n&&n.getTextInfo){const s=n.getTextInfo();if(s&&s.direction)return s.direction}}catch{}const e=["ar","shu","sqr","ssh","xaa","yhd","yud","aao","abh","abv","acm","acq","acw","acx","acy","adf","ads","aeb","aec","afb","ajp","apc","apd","arb","arq","ars","ary","arz","auz","avl","ayh","ayl","ayn","ayp","bbz","pga","he","iw","ps","pbt","pbu","pst","prp","prd","ug","ur","ydd","yds","yih","ji","yi","hbo","men","xmn","fa","jpr","peo","pes","prs","dv","sam","ckb"],i=this.services?.languageUtils||new al(fl());return t.toLowerCase().indexOf("-latn")>1?"ltr":e.indexOf(i.getLanguagePartFromCode(t))>-1||t.toLowerCase().indexOf("-arab")>1?"rtl":"ltr"}static createInstance(t={},e){const i=new as(t,e);return i.createInstance=as.createInstance,i}cloneInstance(t={},e=Gs){const i=t.forkResourceStore;i&&delete t.forkResourceStore;const n={...this.options,...t,isClone:!0},s=new as(n);if((t.debug!==void 0||t.prefix!==void 0)&&(s.logger=s.logger.clone(t)),["store","services","language"].forEach(o=>{s[o]=this[o]}),s.services={...this.services},s.services.utils={hasLoadedNamespace:s.hasLoadedNamespace.bind(s)},i){const o=Object.keys(this.store.data).reduce((l,h)=>(l[h]={...this.store.data[h]},l[h]=Object.keys(l[h]).reduce((c,u)=>(c[u]={...l[h][u]},c),l[h]),l),{});s.store=new rl(o,n),s.services.resourceStore=s.store}return t.interpolation&&(s.services.interpolator=new dl(n)),s.translator=new cr(s.services,n),s.translator.on("*",(o,...l)=>{s.emit(o,...l)}),s.init(n,e),s.translator.options=n,s.translator.backendConnector.services.utils={hasLoadedNamespace:s.hasLoadedNamespace.bind(s)},s}toJSON(){return{options:this.options,store:this.store,language:this.language,languages:this.languages,resolvedLanguage:this.resolvedLanguage}}}const ie=as.createInstance();ie.createInstance;ie.dir;ie.init;ie.loadResources;ie.reloadResources;ie.use;ie.changeLanguage;ie.getFixedT;ie.t;ie.exists;ie.setDefaultNamespace;ie.hasLoadedNamespace;ie.loadNamespaces;ie.loadLanguages;function To(a){"@babel/helpers - typeof";return To=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},To(a)}function Th(){return typeof XMLHttpRequest=="function"||(typeof XMLHttpRequest>"u"?"undefined":To(XMLHttpRequest))==="object"}function Df(a){return!!a&&typeof a.then=="function"}function kf(a){return Df(a)?a:Promise.resolve(a)}const Ff="modulepreload",Mf=function(a){return"/bentopdf/"+a},gl={},If=function(t,e,i){let n=Promise.resolve();if(e&&e.length>0){let l=function(h){return Promise.all(h.map(c=>Promise.resolve(c).then(u=>({status:"fulfilled",value:u}),u=>({status:"rejected",reason:u}))))};document.getElementsByTagName("link");const r=document.querySelector("meta[property=csp-nonce]"),o=r?.nonce||r?.getAttribute("nonce");n=l(e.map(h=>{if(h=Mf(h),h in gl)return;gl[h]=!0;const c=h.endsWith(".css"),u=c?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${h}"]${u}`))return;const p=document.createElement("link");if(p.rel=c?"stylesheet":Ff,c||(p.as="script"),p.crossOrigin="",p.href=h,o&&p.setAttribute("nonce",o),document.head.appendChild(p),c)return new Promise((b,w)=>{p.addEventListener("load",b),p.addEventListener("error",()=>w(new Error(`Unable to preload CSS for ${h}`)))})}))}function s(r){const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=r,window.dispatchEvent(o),!o.defaultPrevented)throw r}return n.then(r=>{for(const o of r||[])o.status==="rejected"&&s(o.reason);return t().catch(s)})},Pe=globalThis||void 0||self;function ml(a,t){var e=Object.keys(a);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(a);t&&(i=i.filter(function(n){return Object.getOwnPropertyDescriptor(a,n).enumerable})),e.push.apply(e,i)}return e}function bl(a){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?ml(Object(e),!0).forEach(function(i){Lf(a,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(e)):ml(Object(e)).forEach(function(i){Object.defineProperty(a,i,Object.getOwnPropertyDescriptor(e,i))})}return a}function Lf(a,t,e){return(t=Rf(t))in a?Object.defineProperty(a,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):a[t]=e,a}function Rf(a){var t=Of(a,"string");return ln(t)=="symbol"?t:t+""}function Of(a,t){if(ln(a)!="object"||!a)return a;var e=a[Symbol.toPrimitive];if(e!==void 0){var i=e.call(a,t);if(ln(i)!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(a)}function ln(a){"@babel/helpers - typeof";return ln=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ln(a)}var qi=typeof fetch=="function"?fetch:void 0;typeof Pe<"u"&&Pe.fetch?qi=Pe.fetch:typeof window<"u"&&window.fetch&&(qi=window.fetch);var ps;Th()&&(typeof Pe<"u"&&Pe.XMLHttpRequest?ps=Pe.XMLHttpRequest:typeof window<"u"&&window.XMLHttpRequest&&(ps=window.XMLHttpRequest));var dr;typeof ActiveXObject=="function"&&(typeof Pe<"u"&&Pe.ActiveXObject?dr=Pe.ActiveXObject:typeof window<"u"&&window.ActiveXObject&&(dr=window.ActiveXObject));typeof qi!="function"&&(qi=void 0);if(!qi&&!ps&&!dr)try{If(()=>import("./browser-ponyfill-u364IFQ-.js").then(a=>a.b),[]).then(function(a){qi=a.default}).catch(function(){})}catch{}var Do=function(t,e){if(e&&ln(e)==="object"){var i="";for(var n in e)i+="&"+encodeURIComponent(n)+"="+encodeURIComponent(e[n]);if(!i)return t;t=t+(t.indexOf("?")!==-1?"&":"?")+i.slice(1)}return t},yl=function(t,e,i,n){var s=function(l){if(!l.ok)return i(l.statusText||"Error",{status:l.status});l.text().then(function(h){i(null,{status:l.status,data:h})}).catch(i)};if(n){var r=n(t,e);if(r instanceof Promise){r.then(s).catch(i);return}}typeof fetch=="function"?fetch(t,e).then(s).catch(i):qi(t,e).then(s).catch(i)},wl=!1,Nf=function(t,e,i,n){t.queryStringParams&&(e=Do(e,t.queryStringParams));var s=bl({},typeof t.customHeaders=="function"?t.customHeaders():t.customHeaders);typeof window>"u"&&typeof Pe<"u"&&typeof Pe.process<"u"&&Pe.process.versions&&Pe.process.versions.node&&(s["User-Agent"]="i18next-http-backend (node/".concat(Pe.process.version,"; ").concat(Pe.process.platform," ").concat(Pe.process.arch,")")),i&&(s["Content-Type"]="application/json");var r=typeof t.requestOptions=="function"?t.requestOptions(i):t.requestOptions,o=bl({method:i?"POST":"GET",body:i?t.stringify(i):void 0,headers:s},wl?{}:r),l=typeof t.alternateFetch=="function"&&t.alternateFetch.length>=1?t.alternateFetch:void 0;try{yl(e,o,n,l)}catch(h){if(!r||Object.keys(r).length===0||!h.message||h.message.indexOf("not implemented")<0)return n(h);try{Object.keys(r).forEach(function(c){delete o[c]}),yl(e,o,n,l),wl=!0}catch(c){n(c)}}},Bf=function(t,e,i,n){i&&ln(i)==="object"&&(i=Do("",i).slice(1)),t.queryStringParams&&(e=Do(e,t.queryStringParams));try{var s=ps?new ps:new dr("MSXML2.XMLHTTP.3.0");s.open(i?"POST":"GET",e,1),t.crossDomain||s.setRequestHeader("X-Requested-With","XMLHttpRequest"),s.withCredentials=!!t.withCredentials,i&&s.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),s.overrideMimeType&&s.overrideMimeType("application/json");var r=t.customHeaders;if(r=typeof r=="function"?r():r,r)for(var o in r)s.setRequestHeader(o,r[o]);s.onreadystatechange=function(){s.readyState>3&&n(s.status>=400?s.statusText:null,{status:s.status,data:s.responseText})},s.send(i)}catch(l){console&&console.log(l)}},Uf=function(t,e,i,n){if(typeof i=="function"&&(n=i,i=void 0),n=n||function(){},qi&&e.indexOf("file:")!==0)return Nf(t,e,i,n);if(Th()||typeof ActiveXObject=="function")return Bf(t,e,i,n);n(new Error("No fetch and no xhr implementation found!"))};function On(a){"@babel/helpers - typeof";return On=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},On(a)}function vl(a,t){var e=Object.keys(a);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(a);t&&(i=i.filter(function(n){return Object.getOwnPropertyDescriptor(a,n).enumerable})),e.push.apply(e,i)}return e}function io(a){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?vl(Object(e),!0).forEach(function(i){Dh(a,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(e)):vl(Object(e)).forEach(function(i){Object.defineProperty(a,i,Object.getOwnPropertyDescriptor(e,i))})}return a}function $f(a,t){if(!(a instanceof t))throw new TypeError("Cannot call a class as a function")}function Hf(a,t){for(var e=0;e<t.length;e++){var i=t[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(a,kh(i.key),i)}}function jf(a,t,e){return t&&Hf(a.prototype,t),Object.defineProperty(a,"prototype",{writable:!1}),a}function Dh(a,t,e){return(t=kh(t))in a?Object.defineProperty(a,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):a[t]=e,a}function kh(a){var t=zf(a,"string");return On(t)=="symbol"?t:t+""}function zf(a,t){if(On(a)!="object"||!a)return a;var e=a[Symbol.toPrimitive];if(e!==void 0){var i=e.call(a,t);if(On(i)!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(a)}var Gf=function(){return{loadPath:"/locales/{{lng}}/{{ns}}.json",addPath:"/locales/add/{{lng}}/{{ns}}",parse:function(e){return JSON.parse(e)},stringify:JSON.stringify,parsePayload:function(e,i,n){return Dh({},i,n||"")},parseLoadPayload:function(e,i){},request:Uf,reloadInterval:typeof window<"u"?!1:3600*1e3,customHeaders:{},queryStringParams:{},crossDomain:!1,withCredentials:!1,overrideMimeType:!1,requestOptions:{mode:"cors",credentials:"same-origin",cache:"default"}}},Fh=(function(){function a(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};$f(this,a),this.services=t,this.options=e,this.allOptions=i,this.type="backend",this.init(t,e,i)}return jf(a,[{key:"init",value:function(e){var i=this,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(this.services=e,this.options=io(io(io({},Gf()),this.options||{}),n),this.allOptions=s,this.services&&this.options.reloadInterval){var r=setInterval(function(){return i.reload()},this.options.reloadInterval);On(r)==="object"&&typeof r.unref=="function"&&r.unref()}}},{key:"readMulti",value:function(e,i,n){this._readAny(e,e,i,i,n)}},{key:"read",value:function(e,i,n){this._readAny([e],e,[i],i,n)}},{key:"_readAny",value:function(e,i,n,s,r){var o=this,l=this.options.loadPath;typeof this.options.loadPath=="function"&&(l=this.options.loadPath(e,n)),l=kf(l),l.then(function(h){if(!h)return r(null,{});var c=o.services.interpolator.interpolate(h,{lng:e.join("+"),ns:n.join("+")});o.loadUrl(c,r,i,s)})}},{key:"loadUrl",value:function(e,i,n,s){var r=this,o=typeof n=="string"?[n]:n,l=typeof s=="string"?[s]:s,h=this.options.parseLoadPayload(o,l);this.options.request(this.options,e,h,function(c,u){if(u&&(u.status>=500&&u.status<600||!u.status))return i("failed loading "+e+"; status code: "+u.status,!0);if(u&&u.status>=400&&u.status<500)return i("failed loading "+e+"; status code: "+u.status,!1);if(!u&&c&&c.message){var p=c.message.toLowerCase(),b=["failed","fetch","network","load"].find(function(x){return p.indexOf(x)>-1});if(b)return i("failed loading "+e+": "+c.message,!0)}if(c)return i(c,!1);var w,v;try{typeof u.data=="string"?w=r.options.parse(u.data,n,s):w=u.data}catch{v="failed parsing "+e+" to json"}if(v)return i(v,!1);i(null,w)})}},{key:"create",value:function(e,i,n,s,r){var o=this;if(this.options.addPath){typeof e=="string"&&(e=[e]);var l=this.options.parsePayload(i,n,s),h=0,c=[],u=[];e.forEach(function(p){var b=o.options.addPath;typeof o.options.addPath=="function"&&(b=o.options.addPath(p,i));var w=o.services.interpolator.interpolate(b,{lng:p,ns:i});o.options.request(o.options,w,l,function(v,x){h+=1,c.push(v),u.push(x),h===e.length&&typeof r=="function"&&r(c,u)})})}}},{key:"reload",value:function(){var e=this,i=this.services,n=i.backendConnector,s=i.languageUtils,r=i.logger,o=n.language;if(!(o&&o.toLowerCase()==="cimode")){var l=[],h=function(u){var p=s.toResolveHierarchy(u);p.forEach(function(b){l.indexOf(b)<0&&l.push(b)})};h(o),this.allOptions.preload&&this.allOptions.preload.forEach(function(c){return h(c)}),l.forEach(function(c){e.allOptions.ns.forEach(function(u){n.read(c,u,"read",null,null,function(p,b){p&&r.warn("loading namespace ".concat(u," for language ").concat(c," failed"),p),!p&&b&&r.log("loaded namespace ".concat(u," for language ").concat(c),b),n.loaded("".concat(c,"|").concat(u),p,b)})})})}}}])})();Fh.type="backend";const gs=["en","ar","be","fr","de","es","zh","zh-TW","vi","tr","id","it","pt","nl","da"],Al={en:"English",ar:"",be:"",fr:"Franais",de:"Deutsch",es:"Espaol",zh:"","zh-TW":"",vi:"Ting Vit",tr:"Trke",id:"Bahasa Indonesia",it:"Italiano",pt:"Portugus",nl:"Nederlands",da:"Dansk"},Jo=()=>{const a="/bentopdf/".replace(/\/$/,"");let t=window.location.pathname;a&&a!=="/"&&t.startsWith(a)&&(t=t.slice(a.length)||"/"),t.startsWith("/")||(t="/"+t);const e=t.match(/^\/(en|ar|fr|es|de|zh|zh-TW|vi|tr|id|it|pt|nl|be|da)(?:\/|$)/);if(e&&gs.includes(e[1]))return e[1];const i=localStorage.getItem("i18nextLng");return i&&gs.includes(i)?i:"en"};let El=!1;const Vf=async()=>{if(El)return ie;const a=Jo();return localStorage.setItem("i18nextLng",a),await ie.use(Fh).init({lng:a,fallbackLng:"en",supportedLngs:gs,ns:["common","tools"],defaultNS:"common",preload:[a],backend:{loadPath:`${"/bentopdf/".replace(/\/?$/,"/")}locales/{{lng}}/{{ns}}.json`},interpolation:{escapeValue:!1}}),await ie.loadNamespaces("tools"),El=!0,ie},Bt=(a,t)=>ie.t(a,t),Wf=a=>{if(!gs.includes(a))return;localStorage.setItem("i18nextLng",a);const t="/bentopdf/".replace(/\/$/,"");let e=window.location.pathname;t&&t!=="/"&&e.startsWith(t)&&(e=e.slice(t.length)||"/"),e.startsWith("/")||(e="/"+e);let i=e;const n=e.match(/^\/(en|ar|fr|es|de|zh|zh-TW|vi|tr|id|it|pt|nl|be|da)(\/.*)?$/);n&&(i=n[2]||"/"),i.startsWith("/")||(i="/"+i);let s;a==="en"?s=i:s=`/${a}${i}`;let r;t&&t!=="/"?r=t+s:r=s,r=r.replace(/\/+/g,"/");const o=r+window.location.search+window.location.hash;window.location.href=o},qf=()=>{document.querySelectorAll("[data-i18n]").forEach(a=>{const t=a.getAttribute("data-i18n");if(t){const e=Bt(t);e&&e!==t&&(a.textContent=e)}}),document.querySelectorAll("[data-i18n-placeholder]").forEach(a=>{const t=a.getAttribute("data-i18n-placeholder");if(t&&a instanceof HTMLInputElement){const e=Bt(t);e&&e!==t&&(a.placeholder=e)}}),document.querySelectorAll("[data-i18n-title]").forEach(a=>{const t=a.getAttribute("data-i18n-title");if(t){const e=Bt(t);e&&e!==t&&(a.title=e)}}),document.documentElement.lang=ie.language,document.documentElement.dir=ie.language==="ar"?"rtl":"ltr"},Xf=()=>{const a=Jo();if(a==="en")return;const t="/bentopdf/".replace(/\/$/,"");document.querySelectorAll("a[href]").forEach(i=>{const n=i.getAttribute("href");if(!n||n.startsWith("http")||n.startsWith("//")||n.startsWith("mailto:")||n.startsWith("tel:")||n.startsWith("#")||n.startsWith("javascript:")||n.includes("/assets/")||new RegExp(`^(${t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")})?/?(en|ar|fr|es|de|zh|zh-TW|vi|tr|id|it|pt|nl|be|da)(/|$)`).test(n))return;let r;if(t&&t!=="/"&&n.startsWith(t)){const o=n.slice(t.length);r=`${t}/${a}${o}`}else n.startsWith("/")?t&&t!=="/"?r=`${t}/${a}${n}`:r=`/${a}${n}`:n===""||n==="index.html"?t&&t!=="/"?r=`${t}/${a}/`:r=`/${a}/`:r=`/${a}/${n}`;r=r.replace(/([^:])\/+/g,"$1/"),i.setAttribute("href",r)})};Gi.workerSrc=new URL("/bentopdf/assets/pdf.worker.min-LyOxJPrg.mjs",import.meta.url).toString();const Y={gridView:document.getElementById("grid-view"),toolGrid:document.getElementById("tool-grid"),toolInterface:document.getElementById("tool-interface"),toolContent:document.getElementById("tool-content"),backToGridBtn:document.getElementById("back-to-grid"),loaderModal:document.getElementById("loader-modal"),loaderText:document.getElementById("loader-text"),alertModal:document.getElementById("alert-modal"),alertTitle:document.getElementById("alert-title"),alertMessage:document.getElementById("alert-message"),alertOkBtn:document.getElementById("alert-ok"),heroSection:document.getElementById("hero-section"),featuresSection:document.getElementById("features-section"),toolsHeader:document.getElementById("tools-header"),dividers:document.querySelectorAll(".section-divider"),hideSections:document.querySelectorAll(".hide-section"),shortcutsModal:document.getElementById("shortcuts-modal"),closeShortcutsModalBtn:document.getElementById("close-shortcuts-modal"),shortcutsList:document.getElementById("shortcuts-list"),shortcutSearch:document.getElementById("shortcut-search"),resetShortcutsBtn:document.getElementById("reset-shortcuts-btn"),importShortcutsBtn:document.getElementById("import-shortcuts-btn"),exportShortcutsBtn:document.getElementById("export-shortcuts-btn"),openShortcutsBtn:document.getElementById("open-shortcuts-btn"),warningModal:document.getElementById("warning-modal"),warningTitle:document.getElementById("warning-title"),warningMessage:document.getElementById("warning-message"),warningCancelBtn:document.getElementById("warning-cancel-btn"),warningConfirmBtn:document.getElementById("warning-confirm-btn")},Yf=(a=Bt("common.loading"),t)=>{Y.loaderText&&(Y.loaderText.textContent=a);const e=Y.loaderModal;if(e){let i=e.querySelector(".loader-progress-bar"),n=e.querySelector(".loader-progress-container");if(t!==void 0&&t>=0){n||(n=document.createElement("div"),n.className="loader-progress-container w-64 mt-4",n.innerHTML=`
                    <div class="bg-gray-700 rounded-full h-2 overflow-hidden">
                        <div class="loader-progress-bar bg-indigo-500 h-full transition-all duration-300" style="width: 0%"></div>
                    </div>
                    <p class="loader-progress-text text-xs text-gray-400 mt-1 text-center">0%</p>
                `,e.querySelector(".bg-gray-800")?.appendChild(n),i=n.querySelector(".loader-progress-bar")),i&&(i.style.width=`${t}%`);const s=n.querySelector(".loader-progress-text");s&&(s.textContent=`${Math.round(t)}%`),n.classList.remove("hidden")}else n&&n.classList.add("hidden");e.classList.remove("hidden")}},Kf=()=>{Y.loaderModal&&Y.loaderModal.classList.add("hidden")},Jf=(a,t,e="error",i)=>{if(Y.alertTitle&&(Y.alertTitle.textContent=a),Y.alertMessage&&(Y.alertMessage.textContent=t),Y.alertModal&&Y.alertModal.classList.remove("hidden"),Y.alertOkBtn){const n=Y.alertOkBtn.cloneNode(!0);Y.alertOkBtn.replaceWith(n),Y.alertOkBtn=n,n.addEventListener("click",()=>{Mh(),i&&i()})}},Mh=()=>{Y.alertModal&&Y.alertModal.classList.add("hidden")},Qf=a=>{Y.gridView.classList.remove("hidden"),Y.toolInterface.classList.add("hidden"),Y.heroSection.classList.remove("hidden"),Y.featuresSection.classList.remove("hidden"),Y.toolsHeader.classList.remove("hidden"),Y.dividers.forEach(t=>{t.classList.remove("hidden")}),Y.hideSections.forEach(t=>{t.classList.remove("hidden")}),fc()},Ap=(a,t)=>{a.textContent="",t.length>0&&t.forEach(e=>{const i=document.createElement("div");i.className="flex items-center justify-between bg-gray-700 p-3 rounded-lg text-sm";const n=document.createElement("span");n.className="truncate font-medium text-gray-200",n.textContent=e.name;const s=document.createElement("span");s.className="flex-shrink-0 ml-4 text-gray-400",s.textContent=Iu(e.size),i.append(n,s),a.appendChild(i)})};class Be{static STORAGE_KEY="bentopdf_shortcuts";static shortcuts=new Map;static defaultShortcuts=new Map;static getToolId(t){if(t.id)return t.id;if(t.href){const e=t.href.match(/\/([^/]+)\.html$/);return e?e[1]:t.href}return"unknown"}static init(){this.loadDefaults(),this.loadFromStorage(),this.setupGlobalListener()}static loadDefaults(){this.defaultShortcuts.set("merge","mod+shift+m"),this.defaultShortcuts.set("split","mod+shift+s"),this.defaultShortcuts.set("compress","mod+shift+c")}static loadFromStorage(){const t=localStorage.getItem(this.STORAGE_KEY);if(t)try{const e=JSON.parse(t);this.shortcuts=new Map(Object.entries(e));const n=Pn.flatMap(s=>s.tools).map(s=>this.getToolId(s));for(const[s,r]of this.shortcuts.entries())n.includes(s)||this.shortcuts.delete(s);this.shortcuts.size!==Object.keys(e).length&&this.save()}catch(e){console.error("Failed to parse shortcuts from local storage",e),this.shortcuts=new Map(this.defaultShortcuts)}else this.shortcuts=new Map(this.defaultShortcuts)}static save(){const t=Object.fromEntries(this.shortcuts);localStorage.setItem(this.STORAGE_KEY,JSON.stringify(t))}static reset(){this.shortcuts=new Map(this.defaultShortcuts),this.save(),window.dispatchEvent(new CustomEvent("shortcuts-updated"))}static getShortcut(t){return this.shortcuts.get(t)}static findToolByShortcut(t){for(const[e,i]of this.shortcuts.entries())if(i===t)return e}static setShortcut(t,e){e?this.shortcuts.set(t,e):this.shortcuts.delete(t),this.save(),window.dispatchEvent(new CustomEvent("shortcuts-updated"))}static getAllShortcuts(){return this.shortcuts}static exportSettings(){const t={};Pn.flatMap(s=>s.tools).forEach(s=>{const r=this.getToolId(s);t[r]=this.shortcuts.get(r)||""});const i="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(t,null,2)),n=document.createElement("a");n.setAttribute("href",i),n.setAttribute("download","bentopdf_shortcuts.json"),document.body.appendChild(n),n.click(),n.remove()}static importSettings(t){try{const e=JSON.parse(t);for(const i in e)if(typeof e[i]!="string")throw new Error("Invalid shortcut format");return this.shortcuts=new Map(Object.entries(e)),this.save(),window.dispatchEvent(new CustomEvent("shortcuts-updated")),!0}catch(e){return console.error("Import failed",e),!1}}static setupGlobalListener(){window.addEventListener("keydown",t=>{const e=t.target;if(e.tagName==="INPUT"||e.tagName==="TEXTAREA"||e.isContentEditable)return;const i=[];navigator.userAgent.toUpperCase().includes("MAC")?(t.metaKey&&i.push("mod"),t.ctrlKey&&i.push("ctrl")):(t.ctrlKey||t.metaKey)&&i.push("mod"),t.altKey&&i.push("alt"),t.shiftKey&&i.push("shift");let s=t.key.toLowerCase();t.altKey&&t.code&&(t.code.startsWith("Key")?s=t.code.slice(3).toLowerCase():t.code.startsWith("Digit")&&(s=t.code.slice(5))),["control","shift","alt","meta"].includes(s)||i.push(s);const r=i.join("+");for(const[o,l]of this.shortcuts.entries())if(l===r){t.preventDefault(),t.stopPropagation();const c=Pn.flatMap(u=>u.tools).find(u=>this.getToolId(u)===o);if(c&&c.href){const u=c.href;window.location.href=u.startsWith("/")?u:`/${u}`}return}},{capture:!0})}}const no=()=>{const a=Jo(),t=document.createElement("div");t.className="relative",t.id="language-switcher";const e=document.createElement("button");e.className=`
    inline-flex items-center gap-1.5 text-sm font-medium
    bg-gray-800 text-gray-200 border border-gray-600
    px-3 py-1.5 rounded-full transition-colors duration-200
    shadow-sm hover:shadow-md hover:bg-gray-700
  `.trim(),e.setAttribute("aria-haspopup","true"),e.setAttribute("aria-expanded","false");const i=document.createElement("span");i.className="font-medium",i.textContent=Al[a];const n=document.createElement("svg");n.className="w-4 h-4",n.setAttribute("fill","none"),n.setAttribute("stroke","currentColor"),n.setAttribute("viewBox","0 0 24 24"),n.innerHTML='<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>',e.appendChild(i),e.appendChild(n);const s=document.createElement("div");return s.className=`
    hidden absolute right-0 mt-2 w-40 rounded-lg
    bg-gray-800 border border-gray-700 shadow-xl
    py-1 z-50
  `.trim(),s.setAttribute("role","menu"),gs.forEach(r=>{const o=document.createElement("button");o.className=`
      w-full px-4 py-2 text-left text-sm text-gray-200
      hover:bg-gray-700 flex items-center gap-2
      ${r===a?"bg-gray-700":""}
    `.trim(),o.setAttribute("role","menuitem");const l=document.createElement("span");l.textContent=Al[r],o.appendChild(l),o.addEventListener("click",()=>{r!==a&&Wf(r)}),s.appendChild(o)}),t.appendChild(e),t.appendChild(s),e.addEventListener("click",r=>{r.stopPropagation();const o=e.getAttribute("aria-expanded")==="true";e.setAttribute("aria-expanded",(!o).toString()),s.classList.toggle("hidden")}),document.addEventListener("click",()=>{e.setAttribute("aria-expanded","false"),s.classList.add("hidden")}),t},Zf=()=>{const a=document.getElementById("simple-mode-language-switcher");if(a){const n=no();a.appendChild(n);return}const t=document.querySelector("footer");if(!t)return;const e=t.querySelectorAll("h3");let i=null;if(e.forEach(n=>{(n.textContent?.trim()==="Follow Us"||n.textContent?.trim()==="Folgen Sie uns"||n.textContent?.trim()==="Theo di chng ti")&&(i=n.parentElement)}),i){const n=i.querySelector(".space-x-4");if(n){const s=document.createElement("div");s.className="inline-flex flex-col gap-4",n.parentNode?.insertBefore(s,n),s.appendChild(n);const r=no();r.className="relative w-full";const o=r.querySelector("button");o&&(o.className=`
                    flex items-center justify-between w-full text-sm font-medium
                    bg-gray-800 text-gray-400 border border-gray-700
                    px-3 py-2 rounded-lg transition-colors duration-200
                    hover:text-white hover:border-gray-600
                `.trim());const l=r.querySelector('div[role="menu"]');l&&(l.classList.remove("mt-2","w-40"),l.classList.add("bottom-full","mb-2","w-full")),s.appendChild(r)}else{const s=document.createElement("div");s.className="mt-4 w-full";const r=no();s.appendChild(r),i.appendChild(s)}}},tp=async()=>{await Vf(),Zf(),qf(),Gi.workerSrc=new URL("/bentopdf/assets/pdf.worker.min-LyOxJPrg.mjs",import.meta.url).toString();const a=/Android|iPhone|iPod/i.test(navigator.userAgent),t=document.getElementById("shortcut"),e=document.getElementById("open-shortcuts-btn");a?(t&&(t.style.display="none"),e&&(e.style.display="none")):t&&(t.textContent=navigator.userAgent.toUpperCase().includes("MAC")?" + K":"Ctrl + K");const i={"Popular Tools":"tools:categories.popularTools","Edit & Annotate":"tools:categories.editAnnotate","Convert to PDF":"tools:categories.convertToPdf","Convert from PDF":"tools:categories.convertFromPdf","Organize & Manage":"tools:categories.organizeManage","Optimize & Repair":"tools:categories.optimizeRepair","Secure PDF":"tools:categories.securePdf"},n={"PDF Multi Tool":"tools:pdfMultiTool","Merge PDF":"tools:mergePdf","Split PDF":"tools:splitPdf","Compress PDF":"tools:compressPdf","PDF Editor":"tools:pdfEditor","JPG to PDF":"tools:jpgToPdf","Sign PDF":"tools:signPdf","Crop PDF":"tools:cropPdf","Extract Pages":"tools:extractPages","Duplicate & Organize":"tools:duplicateOrganize","Delete Pages":"tools:deletePages","Edit Bookmarks":"tools:editBookmarks","Table of Contents":"tools:tableOfContents","Page Numbers":"tools:pageNumbers","Add Watermark":"tools:addWatermark","Header & Footer":"tools:headerFooter","Invert Colors":"tools:invertColors","Background Color":"tools:backgroundColor","Change Text Color":"tools:changeTextColor","Add Stamps":"tools:addStamps","Remove Annotations":"tools:removeAnnotations","PDF Form Filler":"tools:pdfFormFiller","Create PDF Form":"tools:createPdfForm","Remove Blank Pages":"tools:removeBlankPages","Images to PDF":"tools:imageToPdf","PNG to PDF":"tools:pngToPdf","WebP to PDF":"tools:webpToPdf","SVG to PDF":"tools:svgToPdf","BMP to PDF":"tools:bmpToPdf","HEIC to PDF":"tools:heicToPdf","TIFF to PDF":"tools:tiffToPdf","Text to PDF":"tools:textToPdf","JSON to PDF":"tools:jsonToPdf","PDF to JPG":"tools:pdfToJpg","PDF to PNG":"tools:pdfToPng","PDF to WebP":"tools:pdfToWebp","PDF to BMP":"tools:pdfToBmp","PDF to TIFF":"tools:pdfToTiff","PDF to Greyscale":"tools:pdfToGreyscale","PDF to JSON":"tools:pdfToJson","OCR PDF":"tools:ocrPdf","Alternate & Mix Pages":"tools:alternateMix","Organize & Duplicate":"tools:duplicateOrganize","Add Attachments":"tools:addAttachments","Extract Attachments":"tools:extractAttachments","Edit Attachments":"tools:editAttachments","Divide Pages":"tools:dividePages","Add Blank Page":"tools:addBlankPage","Reverse Pages":"tools:reversePages","Rotate PDF":"tools:rotatePdf","Rotate by Custom Degrees":"tools:rotateCustom","N-Up PDF":"tools:nUpPdf","Combine to Single Page":"tools:combineToSinglePage","View Metadata":"tools:viewMetadata","Edit Metadata":"tools:editMetadata","PDFs to ZIP":"tools:pdfsToZip","Compare PDFs":"tools:comparePdfs","Posterize PDF":"tools:posterizePdf","Fix Page Size":"tools:fixPageSize","Linearize PDF":"tools:linearizePdf","Page Dimensions":"tools:pageDimensions","Remove Restrictions":"tools:removeRestrictions","Repair PDF":"tools:repairPdf","Encrypt PDF":"tools:encryptPdf","Sanitize PDF":"tools:sanitizePdf","Decrypt PDF":"tools:decryptPdf","Flatten PDF":"tools:flattenPdf","Remove Metadata":"tools:removeMetadata","Change Permissions":"tools:changePermissions","Email to PDF":"tools:emailToPdf","Font to Outline":"tools:fontToOutline","Deskew PDF":"tools:deskewPdf","Digital Signature":"tools:digitalSignPdf","Validate Signature":"tools:validateSignaturePdf","Scanner Effect":"tools:scannerEffect","Adjust Colors":"tools:adjustColors","Markdown to PDF":"tools:markdownToPdf","PDF Booklet":"tools:pdfBooklet","Word to PDF":"tools:wordToPdf","Excel to PDF":"tools:excelToPdf","PowerPoint to PDF":"tools:powerpointToPdf","XPS to PDF":"tools:xpsToPdf","MOBI to PDF":"tools:mobiToPdf","EPUB to PDF":"tools:epubToPdf","FB2 to PDF":"tools:fb2ToPdf","CBZ to PDF":"tools:cbzToPdf","WPD to PDF":"tools:wpdToPdf","WPS to PDF":"tools:wpsToPdf","XML to PDF":"tools:xmlToPdf","Pages to PDF":"tools:pagesToPdf","ODG to PDF":"tools:odgToPdf","ODS to PDF":"tools:odsToPdf","ODP to PDF":"tools:odpToPdf","PUB to PDF":"tools:pubToPdf","VSD to PDF":"tools:vsdToPdf","PSD to PDF":"tools:psdToPdf","ODT to PDF":"tools:odtToPdf","CSV to PDF":"tools:csvToPdf","RTF to PDF":"tools:rtfToPdf","PDF to SVG":"tools:pdfToSvg","PDF to CSV":"tools:pdfToCsv","PDF to Excel":"tools:pdfToExcel","PDF to Text":"tools:pdfToText","Extract Tables":"tools:extractTables","PDF to Word":"tools:pdfToWord","Extract Images":"tools:extractImages","PDF to Markdown":"tools:pdfToMarkdown","Prepare PDF for AI":"tools:preparePdfForAi","PDF OCG":"tools:pdfOcg","PDF to PDF/A":"tools:pdfToPdfa","Rasterize PDF":"tools:rasterizePdf"};if(Y.toolGrid){Y.toolGrid.textContent="",Pn.forEach(U=>{const Q=document.createElement("div");Q.className="category-group col-span-full";const V=document.createElement("h2");V.className="text-xl font-bold text-indigo-400 mb-4 mt-8 first:mt-0 text-white";const z=i[U.name];V.textContent=z?Bt(z):U.name;const st=document.createElement("div");st.className="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4 md:gap-6",U.tools.forEach(G=>{let W;G.href?(W=document.createElement("a"),W.href=G.href,W.className="tool-card block bg-gray-800 rounded-xl p-4 cursor-pointer flex flex-col items-center justify-center text-center no-underline hover:shadow-lg transition duration-200"):(W=document.createElement("div"),W.className="tool-card bg-gray-800 rounded-xl p-4 cursor-pointer flex flex-col items-center justify-center text-center hover:shadow-lg transition duration-200",W.dataset.toolId=F(G));const Z=document.createElement("i");Z.className="w-10 h-10 mb-3 text-indigo-400",G.icon.startsWith("ph-")?Z.className=`ph ${G.icon} text-4xl mb-3 text-indigo-400`:Z.setAttribute("data-lucide",G.icon);const xt=document.createElement("h3");xt.className="font-semibold text-white";const Ft=n[G.name];if(xt.textContent=Ft?Bt(`${Ft}.name`):G.name,W.append(Z,xt),G.subtitle){const it=document.createElement("p");it.className="text-xs text-gray-400 mt-1 px-2",it.textContent=Ft?Bt(`${Ft}.subtitle`):G.subtitle,W.appendChild(it)}st.appendChild(W)}),Q.append(V,st),Y.toolGrid.appendChild(Q)});const N=document.getElementById("search-bar"),R=Y.toolGrid.querySelectorAll(".category-group"),$=document.createElement("div");$.id="search-results",$.className="hidden grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4 md:gap-6 col-span-full",Y.toolGrid.insertBefore($,Y.toolGrid.firstChild),N.addEventListener("input",()=>{const U=N.value.toLowerCase().trim();if(!U){$.classList.add("hidden"),$.innerHTML="",R.forEach(z=>{z.style.display="",z.querySelectorAll(".tool-card").forEach(G=>{G.style.display=""})});return}R.forEach(z=>{z.style.display="none"}),$.innerHTML="",$.classList.remove("hidden");const Q=new Set,V=[];R.forEach(z=>{Array.from(z.querySelectorAll(".tool-card")).forEach(G=>{const W=(G.querySelector("h3")?.textContent||"").toLowerCase(),Z=(G.querySelector("p")?.textContent||"").toLowerCase(),Ft=(G.href||G.dataset.toolId||"").split("/").pop()?.replace(".html","")||W,it=W.includes(U)||Z.includes(U),ot=Q.has(Ft);it&&!ot&&(Q.add(Ft),V.push(G.cloneNode(!0)))})}),V.forEach(z=>{$.appendChild(z)}),Mr({icons:Ir})}),window.addEventListener("keydown",function(U){const Q=U.key.toLowerCase(),V=navigator.userAgent.toUpperCase().includes("MAC"),z=U.ctrlKey&&Q==="k",st=V&&U.metaKey&&Q==="k";(z||st)&&(U.preventDefault(),N.focus())}),Y.toolGrid.addEventListener("click",U=>{})}Y.backToGridBtn&&Y.backToGridBtn.addEventListener("click",()=>Qf()),Y.alertOkBtn&&Y.alertOkBtn.addEventListener("click",Mh);const s=document.getElementById("faq-accordion");s&&s.addEventListener("click",N=>{const R=N.target.closest(".faq-question");if(!R)return;const $=R.parentElement,U=$.querySelector(".faq-answer");$.classList.toggle("open"),$.classList.contains("open")?U.style.maxHeight=U.scrollHeight+"px":U.style.maxHeight="0px"}),Mr({icons:Ir}),console.log("Please share our tool and share the love!");const r=[document.getElementById("github-stars-desktop"),document.getElementById("github-stars-mobile")];r.some(N=>N)&&fetch("https://api.github.com/repos/alam00000/bentopdf").then(N=>N.json()).then(N=>{if(N.stargazers_count!==void 0){const R=Lu(N.stargazers_count);r.forEach($=>{$&&($.textContent=R)})}}).catch(()=>{r.forEach(N=>{N&&(N.textContent="-")})}),Be.init();const o=document.getElementById("shortcuts-tab-btn"),l=document.getElementById("preferences-tab-btn"),h=document.getElementById("shortcuts-tab-content"),c=document.getElementById("preferences-tab-content"),u=document.getElementById("shortcuts-tab-footer"),p=document.getElementById("preferences-tab-footer"),b=document.getElementById("reset-shortcuts-btn");o&&l&&(o.addEventListener("click",()=>{o.classList.add("bg-indigo-600","text-white"),o.classList.remove("text-gray-300"),l.classList.remove("bg-indigo-600","text-white"),l.classList.add("text-gray-300"),h?.classList.remove("hidden"),c?.classList.add("hidden"),u?.classList.remove("hidden"),p?.classList.add("hidden"),b?.classList.remove("hidden")}),l.addEventListener("click",()=>{l.classList.add("bg-indigo-600","text-white"),l.classList.remove("text-gray-300"),o.classList.remove("bg-indigo-600","text-white"),o.classList.add("text-gray-300"),c?.classList.remove("hidden"),h?.classList.add("hidden"),p?.classList.remove("hidden"),u?.classList.add("hidden"),b?.classList.add("hidden")}));const w=document.getElementById("full-width-toggle"),v=document.getElementById("tool-interface"),x=localStorage.getItem("fullWidthMode")!=="false";w&&(w.checked=x,E(x));function E(N){v&&(N?v.classList.remove("max-w-4xl"):v.classList.add("max-w-4xl")),document.querySelectorAll("#tool-uploader").forEach($=>{N?$.classList.remove("max-w-2xl","max-w-5xl"):!$.classList.contains("max-w-2xl")&&!$.classList.contains("max-w-5xl")&&$.classList.add("max-w-2xl")})}w&&w.addEventListener("change",N=>{const R=N.target.checked;localStorage.setItem("fullWidthMode",R.toString()),E(R)}),Y.openShortcutsBtn&&Y.openShortcutsBtn.addEventListener("click",()=>{M(),Y.shortcutsModal.classList.remove("hidden")}),Y.closeShortcutsModalBtn&&Y.closeShortcutsModalBtn.addEventListener("click",()=>{Y.shortcutsModal.classList.add("hidden")}),Y.shortcutsModal&&Y.shortcutsModal.addEventListener("click",N=>{N.target===Y.shortcutsModal&&Y.shortcutsModal.classList.add("hidden")}),Y.resetShortcutsBtn&&Y.resetShortcutsBtn.addEventListener("click",async()=>{await k(Bt("settings.warnings.resetTitle"),Bt("settings.warnings.resetMessage"),!0)&&(Be.reset(),M())}),Y.exportShortcutsBtn&&Y.exportShortcutsBtn.addEventListener("click",()=>{Be.exportSettings()}),Y.importShortcutsBtn&&Y.importShortcutsBtn.addEventListener("click",()=>{const N=document.createElement("input");N.type="file",N.accept=".json",N.onchange=R=>{const $=R.target.files?.[0];if($){const U=new FileReader;U.onload=async Q=>{const V=Q.target?.result;Be.importSettings(V)?(M(),await k(Bt("settings.warnings.importSuccessTitle"),Bt("settings.warnings.importSuccessMessage"),!1)):await k(Bt("settings.warnings.importFailTitle"),Bt("settings.warnings.importFailMessage"),!1)},U.readAsText($)}},N.click()}),Y.shortcutSearch&&Y.shortcutSearch.addEventListener("input",N=>{const R=N.target.value.toLowerCase();Y.shortcutsList.querySelectorAll(".category-section").forEach(U=>{const Q=U.querySelectorAll(".shortcut-item");let V=0;Q.forEach(z=>{(z.textContent?.toLowerCase()||"").includes(R)?(z.classList.remove("hidden"),V++):z.classList.add("hidden")}),V===0?U.classList.add("hidden"):U.classList.remove("hidden")})});const D={"mod+w":{mac:"Closes tab",windows:"Closes tab"},"mod+t":{mac:"Opens new tab",windows:"Opens new tab"},"mod+n":{mac:"Opens new window",windows:"Opens new window"},"mod+shift+n":{mac:"Opens incognito window",windows:"Opens incognito window"},"mod+q":{mac:"Quits application (cannot be overridden)"},"mod+m":{mac:"Minimizes window"},"mod+h":{mac:"Hides window"},"mod+r":{mac:"Reloads page",windows:"Reloads page"},"mod+shift+r":{mac:"Hard reloads page",windows:"Hard reloads page"},"mod+l":{mac:"Focuses address bar",windows:"Focuses address bar"},"mod+d":{mac:"Bookmarks page",windows:"Bookmarks page"},"mod+shift+t":{mac:"Reopens closed tab",windows:"Reopens closed tab"},"mod+shift+w":{mac:"Closes window",windows:"Closes window"},"mod+tab":{mac:"Switches tabs",windows:"Switches apps"},"alt+f4":{windows:"Closes window"},"ctrl+tab":{mac:"Switches tabs",windows:"Switches tabs"}};function T(N,R){const $=D[N];if(!$)return null;const U=R?$.mac:$.windows;return U||null}function k(N,R,$=!0){return new Promise(U=>{if(!Y.warningModal||!Y.warningTitle||!Y.warningMessage||!Y.warningCancelBtn||!Y.warningConfirmBtn){U($?confirm(R):(alert(R),!0));return}Y.warningTitle.textContent=N,Y.warningMessage.innerHTML=R,Y.warningModal.classList.remove("hidden"),Y.warningModal.classList.add("flex"),$?(Y.warningCancelBtn.style.display="",Y.warningConfirmBtn.textContent="Proceed"):(Y.warningCancelBtn.style.display="none",Y.warningConfirmBtn.textContent="OK");const Q=()=>{z(),U(!0)},V=()=>{z(),U(!1)},z=()=>{Y.warningModal?.classList.add("hidden"),Y.warningModal?.classList.remove("flex"),Y.warningConfirmBtn?.removeEventListener("click",Q),Y.warningCancelBtn?.removeEventListener("click",V)};Y.warningConfirmBtn.addEventListener("click",Q),Y.warningCancelBtn.addEventListener("click",V),Y.warningModal.addEventListener("click",st=>{st.target===Y.warningModal&&($?V():Q())},{once:!0})})}function F(N){if(N.id)return N.id;if(N.href){const R=N.href.match(/\/([^/]+)\.html$/);return R?R[1]:N.href}return"unknown"}function M(){if(!Y.shortcutsList)return;Y.shortcutsList.innerHTML="";const N=Be.getAllShortcuts(),R=navigator.userAgent.toUpperCase().includes("MAC"),$=Pn.flatMap(U=>U.tools);Pn.forEach(U=>{const Q=document.createElement("div");Q.className="category-section mb-6 last:mb-0";const V=document.createElement("h3");V.className="text-gray-400 text-xs font-bold uppercase tracking-wider mb-3 pl-1";const z=i[U.name];V.textContent=z?Bt(z):U.name,Q.appendChild(V);const st=document.createElement("div");st.className="space-y-2",Q.appendChild(st);let G=!1;U.tools.forEach(W=>{G=!0;const Z=F(W),xt=N.get(Z)||"",Ft=document.createElement("div");Ft.className="shortcut-item flex items-center justify-between p-3 bg-gray-900 rounded-lg border border-gray-700 hover:border-gray-600 transition-colors";const it=document.createElement("div");it.className="flex items-center gap-3";const ot=document.createElement("i");ot.className="w-5 h-5 text-indigo-400",ot.setAttribute("data-lucide",W.icon);const mt=document.createElement("span");mt.className="text-gray-200 font-medium";const dt=n[W.name];mt.textContent=dt?Bt(`${dt}.name`):W.name,it.append(ot,mt);const Ct=document.createElement("div");Ct.className="relative";const yt=document.createElement("input");yt.type="text",yt.className="shortcut-input w-32 bg-gray-800 border border-gray-600 text-white text-center text-sm rounded px-2 py-1 focus:ring-2 focus:ring-indigo-500 focus:border-transparent outline-none transition-all",yt.placeholder=Bt("settings.clickToSet"),yt.value=Bi(xt,R),yt.readOnly=!0;const Pt=document.createElement("button");Pt.className="absolute -right-2 -top-2 bg-gray-700 hover:bg-red-600 text-white rounded-full p-0.5 hidden group-hover:block shadow-sm",Pt.innerHTML='<i data-lucide="x" class="w-3 h-3"></i>',xt&&Ct.classList.add("group"),Pt.onclick=_t=>{_t.stopPropagation(),Be.setShortcut(Z,""),M()},yt.onkeydown=async _t=>{if(_t.preventDefault(),_t.stopPropagation(),_t.key==="Backspace"||_t.key==="Delete"){Be.setShortcut(Z,""),M();return}const se=[];R?(_t.metaKey&&se.push("mod"),_t.ctrlKey&&se.push("ctrl")):(_t.ctrlKey||_t.metaKey)&&se.push("mod"),_t.altKey&&se.push("alt"),_t.shiftKey&&se.push("shift");let je=_t.key.toLowerCase();_t.altKey&&_t.code&&(_t.code.startsWith("Key")?je=_t.code.slice(3).toLowerCase():_t.code.startsWith("Digit")&&(je=_t.code.slice(5)));const Se=["control","shift","alt","meta"].includes(je);if(je==="dead"||je.startsWith("dead")){yt.value=Bi(Be.getShortcut(Z)||"",R);return}Se||se.push(je);const Te=se.join("+");if(yt.value=Bi(Te,R),!Se){const qt=Be.findToolByShortcut(Te);if(qt&&qt!==Z){const me=$.find(dn=>F(dn)===qt),be=me?.name||qt,Xi=Bi(Te,R),Oi=me?n[me.name]:null,De=Oi?Bt(`${Oi}.name`):be;await k(Bt("settings.warnings.alreadyInUse"),`<strong>${Xi}</strong> ${Bt("settings.warnings.assignedTo")}<br><br><em>"${De}"</em><br><br>`+Bt("settings.warnings.chooseDifferent"),!1),yt.value=Bi(Be.getShortcut(Z)||"",R),yt.classList.remove("border-indigo-500","text-indigo-400"),yt.blur();return}const di=T(Te,R);if(di){const me=Bi(Te,R);if(!await k(Bt("settings.warnings.reserved"),`<strong>${me}</strong> ${Bt("settings.warnings.commonlyUsed")}<br><br>"<em>${di}</em>"<br><br>${Bt("settings.warnings.unreliable")}<br><br>`+Bt("settings.warnings.useAnyway"))){yt.value=Bi(Be.getShortcut(Z)||"",R),yt.classList.remove("border-indigo-500","text-indigo-400"),yt.blur();return}}Be.setShortcut(Z,Te),M()}},yt.onkeyup=_t=>{const se=_t.key.toLowerCase();["control","shift","alt","meta"].includes(se)&&Be.getShortcut(Z)},yt.onfocus=()=>{yt.value=Bt("settings.pressKeys"),yt.classList.add("border-indigo-500","text-indigo-400")},yt.onblur=()=>{yt.value=Bi(Be.getShortcut(Z)||"",R),yt.classList.remove("border-indigo-500","text-indigo-400")},Ct.append(yt),xt&&Ct.append(Pt),Ft.append(it,Ct),st.appendChild(Ft)}),G&&Y.shortcutsList.appendChild(Q)}),Mr({icons:Ir})}const O=document.getElementById("scroll-to-top-btn");if(O){let N=window.scrollY;window.addEventListener("scroll",()=>{const R=window.scrollY;R<N&&R>300?O.classList.add("visible"):O.classList.remove("visible"),N=R}),O.addEventListener("click",()=>{window.scrollTo({top:0,behavior:"instant"})})}Xf()};window.addEventListener("load",tp);export{gp as A,oo as B,gc as C,ya as D,bp as E,yp as F,Gi as G,mp as H,qf as I,Be as S,If as _,Jf as a,Yf as b,pp as c,lp as d,Ap as e,Iu as f,Pe as g,Kf as h,up as i,ht as j,vp as k,wp as l,cp as m,ap as n,Ql as o,Qt as p,dp as q,hp as r,Hn as s,rp as t,op as u,Bt as v,Ou as w,np as x,pc as y,fp as z};
