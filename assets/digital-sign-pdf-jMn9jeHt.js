import{c as D,i as P}from"./style-BMqLG_Qf.js";import"./lucide-init-Css57rKe.js";import"./simple-mode-footer-WbVs9YeG.js";import"./version-Cc_uNslJ.js";import{a as y,r as C,c as H,b as G,d as Y,h as T,f as E}from"./main-DSprMeGA.js";import{p as $,a as Z,g as A,s as q}from"./digital-sign-pdf-DWteif_A.js";import"./mobileMenu-BoMunYmR.js";import"./index-ml082Wzs.js";import"./PDFButton-BowUC9ah.js";import"./index-YkV0U4e7.js";import"./index-KBzziK6T.js";const s={pdfFile:null,pdfBytes:null,certFile:null,certData:null,sigImageData:null,sigImageType:null};function J(){s.pdfFile=null,s.pdfBytes=null,s.certFile=null,s.certData=null,s.sigImageData=null,s.sigImageType=null;const e=t("file-display-area");e&&(e.innerHTML="");const i=t("cert-display-area");i&&(i.innerHTML="");const c=t("file-input");c&&(c.value="");const a=t("cert-input");a&&(a.value="");const n=t("sig-image-input");n&&(n.value="");const r=t("sig-image-preview");r&&r.classList.add("hidden");const o=t("certificate-section");o&&o.classList.add("hidden"),j(),I(),U(),w()}function t(e){return document.getElementById(e)}function k(){D({icons:P});const e=t("file-input"),i=t("drop-zone"),c=t("cert-input"),a=t("cert-drop-zone"),n=t("cert-password"),r=t("process-btn"),o=t("back-to-tools");e&&(e.addEventListener("change",K),e.addEventListener("click",()=>{e.value=""})),i&&(i.addEventListener("dragover",d=>{d.preventDefault(),i.classList.add("bg-gray-700")}),i.addEventListener("dragleave",()=>{i.classList.remove("bg-gray-700")}),i.addEventListener("drop",d=>{d.preventDefault(),i.classList.remove("bg-gray-700");const l=d.dataTransfer?.files;l&&l.length>0&&O(l[0])})),c&&(c.addEventListener("change",ee),c.addEventListener("click",()=>{c.value=""})),a&&(a.addEventListener("dragover",d=>{d.preventDefault(),a.classList.add("bg-gray-700")}),a.addEventListener("dragleave",()=>{a.classList.remove("bg-gray-700")}),a.addEventListener("drop",d=>{d.preventDefault(),a.classList.remove("bg-gray-700");const l=d.dataTransfer?.files;l&&l.length>0&&z(l[0])})),n&&(n.addEventListener("input",M),n.addEventListener("keypress",d=>{d.key==="Enter"&&M()})),r&&r.addEventListener("click",ie),o&&o.addEventListener("click",()=>{window.location.href="/"});const f=t("enable-visible-sig"),x=t("visible-sig-options"),m=t("sig-page"),p=t("custom-page-wrapper"),g=t("sig-image-input"),u=t("sig-image-preview"),F=t("sig-image-thumb"),v=t("remove-sig-image"),b=t("enable-sig-text"),L=t("sig-text-options");f&&x&&f.addEventListener("change",()=>{f.checked?x.classList.remove("hidden"):x.classList.add("hidden")}),m&&p&&m.addEventListener("change",()=>{m.value==="custom"?p.classList.remove("hidden"):p.classList.add("hidden")}),g&&g.addEventListener("change",async d=>{const l=d.target;if(l.files&&l.files.length>0){const h=l.files[0];if(!["image/png","image/jpeg","image/webp"].includes(h.type)){y("Invalid Image","Please select a PNG, JPG, or WebP image.");return}if(s.sigImageData=await C(h),s.sigImageType=h.type.replace("image/",""),F&&u){const S=URL.createObjectURL(h);F.src=S,u.classList.remove("hidden")}}}),v&&u&&v.addEventListener("click",()=>{s.sigImageData=null,s.sigImageType=null,u.classList.add("hidden"),g&&(g.value="")}),b&&L&&b.addEventListener("change",()=>{b.checked?L.classList.remove("hidden"):L.classList.add("hidden")})}function K(e){const i=e.target;i.files&&i.files.length>0&&O(i.files[0])}async function O(e){if(e.type!=="application/pdf"&&!e.name.toLowerCase().endsWith(".pdf")){y("Invalid File","Please select a PDF file.");return}s.pdfFile=e,s.pdfBytes=new Uint8Array(await C(e)),X(),_()}async function X(){const e=t("file-display-area");if(!e||!s.pdfFile)return;e.innerHTML="";const i=document.createElement("div");i.className="flex items-center justify-between bg-gray-700 p-3 rounded-lg";const c=document.createElement("div");c.className="flex flex-col flex-1 min-w-0";const a=document.createElement("div");a.className="truncate font-medium text-gray-200 text-sm mb-1",a.textContent=s.pdfFile.name;const n=document.createElement("div");n.className="text-xs text-gray-400",n.textContent=`${E(s.pdfFile.size)} • Loading pages...`,c.append(a,n);const r=document.createElement("button");r.className="ml-4 text-red-400 hover:text-red-300 flex-shrink-0",r.innerHTML='<i data-lucide="trash-2" class="w-4 h-4"></i>',r.onclick=()=>{s.pdfFile=null,s.pdfBytes=null,e.innerHTML="",Q(),w()},i.append(c,r),e.appendChild(i),D({icons:P});try{if(s.pdfBytes){const o=await H({data:s.pdfBytes.slice()}).promise;n.textContent=`${E(s.pdfFile.size)} • ${o.numPages} pages`}}catch(o){console.error("Error loading PDF:",o),n.textContent=`${E(s.pdfFile.size)}`}}function _(){const e=t("certificate-section");e&&e.classList.remove("hidden")}function Q(){const e=t("certificate-section"),i=t("signature-options");e&&e.classList.add("hidden"),i&&i.classList.add("hidden"),s.certFile=null,s.certData=null;const c=t("cert-display-area");c&&(c.innerHTML="");const a=t("cert-info");a&&a.classList.add("hidden");const n=t("cert-password-section");n&&n.classList.add("hidden")}function ee(e){const i=e.target;i.files&&i.files.length>0&&z(i.files[0])}async function z(e){if(![".pfx",".p12",".pem"].some(n=>e.name.toLowerCase().endsWith(n))){y("Invalid Certificate","Please select a .pfx, .p12, or .pem certificate file.");return}if(s.certFile=e,s.certData=null,te(),e.name.toLowerCase().endsWith(".pem"))try{const n=await e.text();if(n.includes("ENCRYPTED"))B(),N("Private Key Password");else{s.certData=$(n),V(),W();const o=t("cert-status");o&&(o.innerHTML='Certificate loaded <i data-lucide="check" class="inline w-4 h-4"></i>',D({icons:P}),o.className="text-xs text-green-400")}}catch{const r=t("cert-status");r&&(r.textContent="Failed to parse PEM file",r.className="text-xs text-red-400")}else B(),N("Certificate Password");I(),w()}function te(){const e=t("cert-display-area");if(!e||!s.certFile)return;e.innerHTML="";const i=document.createElement("div");i.className="flex items-center justify-between bg-gray-700 p-3 rounded-lg";const c=document.createElement("div");c.className="flex flex-col flex-1 min-w-0";const a=document.createElement("div");a.className="truncate font-medium text-gray-200 text-sm mb-1",a.textContent=s.certFile.name;const n=document.createElement("div");n.className="text-xs text-gray-400",n.id="cert-status",n.textContent="Enter password to unlock",c.append(a,n);const r=document.createElement("button");r.className="ml-4 text-red-400 hover:text-red-300 flex-shrink-0",r.innerHTML='<i data-lucide="trash-2" class="w-4 h-4"></i>',r.onclick=()=>{s.certFile=null,s.certData=null,e.innerHTML="",j(),U(),I(),w()},i.append(c,r),e.appendChild(i),D({icons:P})}function B(){const e=t("cert-password-section");e&&e.classList.remove("hidden");const i=t("cert-password");i&&(i.value="",i.focus())}function N(e){const i=document.querySelector('label[for="cert-password"]');i&&(i.textContent=e)}function j(){const e=t("cert-password-section");e&&e.classList.add("hidden")}function W(){const e=t("signature-options");e&&e.classList.remove("hidden");const i=t("visible-signature-section");i&&i.classList.remove("hidden")}function I(){const e=t("signature-options");e&&e.classList.add("hidden");const i=t("visible-signature-section");i&&i.classList.add("hidden")}function U(){const e=t("cert-info");e&&e.classList.add("hidden")}async function M(){const i=t("cert-password")?.value??"";if(!(!s.certFile||!i))try{if(s.certFile.name.toLowerCase().endsWith(".pem")){const n=await s.certFile.text();s.certData=$(n,i)}else{const n=await C(s.certFile);s.certData=Z(n,i)}V(),W(),w();const a=t("cert-status");a&&(a.innerHTML='Certificate unlocked <i data-lucide="check-circle" class="inline w-4 h-4"></i>',D({icons:P}),a.className="text-xs text-green-400")}catch(c){s.certData=null,I(),w();const a=t("cert-status");if(a){const n=c instanceof Error?c.message:"Invalid password or certificate";a.textContent=n.includes("password")?"Incorrect password":"Failed to parse certificate",a.className="text-xs text-red-400"}}}function V(){if(!s.certData)return;const e=t("cert-info"),i=t("cert-subject"),c=t("cert-issuer"),a=t("cert-validity");if(!e)return;const n=A(s.certData.certificate);if(i&&(i.textContent=n.subject),c&&(c.textContent=n.issuer),a){const r=o=>o.toLocaleDateString();a.textContent=`${r(n.validFrom)} - ${r(n.validTo)}`}e.classList.remove("hidden")}function w(){const e=t("process-btn");if(!e)return;s.pdfBytes!==null&&s.certData!==null?e.style.display="":e.style.display="none"}async function ie(){if(!s.pdfBytes||!s.certData){y("Missing Data","Please upload both a PDF and a valid certificate.");return}const e=t("sign-reason")?.value??"",i=t("sign-location")?.value??"",c=t("sign-contact")?.value??"",a={};e&&(a.reason=e),i&&(a.location=i),c&&(a.contactInfo=c);let n;if(t("enable-visible-sig")?.checked){const o=parseInt(t("sig-x")?.value??"25",10),f=parseInt(t("sig-y")?.value??"700",10),x=parseInt(t("sig-width")?.value??"150",10),m=parseInt(t("sig-height")?.value??"70",10),p=t("sig-page");let g=0,u=1;try{u=(await H({data:s.pdfBytes.slice()}).promise).numPages}catch(l){console.error("Error getting PDF page count:",l)}p&&(p.value==="last"?g=(u-1).toString():p.value==="all"?u===1?g="0":g=`0-${u-1}`:p.value==="custom"?g=parseInt(t("sig-custom-page")?.value??"1",10)-1:g=parseInt(p.value,10));let v=t("enable-sig-text")?.checked?t("sig-text")?.value:void 0;const b=t("sig-text-color")?.value??"#000000",L=parseInt(t("sig-text-size")?.value??"12",10);if(!s.sigImageData&&!v&&s.certData){const l=A(s.certData.certificate),h=new Date().toLocaleDateString();v=`Digitally signed by ${l.subject}
${h}`}let d=m;if(v&&!s.sigImageData){const l=(v.match(/\n/g)||[]).length+1,S=Math.ceil(l*L*1.4+16);d=Math.max(S,m)}n={enabled:!0,x:o,y:f,width:x,height:d,page:g,imageData:s.sigImageData??void 0,imageType:s.sigImageType??void 0,text:v,textColor:b,textSize:L}}G("Applying digital signature...");try{const o=await q(s.pdfBytes,s.certData,{signatureInfo:a,visibleSignature:n}),f=new Blob([o.slice().buffer],{type:"application/pdf"}),m=(s.pdfFile?.name??"document.pdf").replace(/\.pdf$/i,"_signed.pdf");Y(f,m),T(),y("Success","PDF signed successfully! The signature can be verified in any PDF reader.","success",()=>{J()})}catch(o){T(),console.error("Signing error:",o);const f=o instanceof Error?o.message:"Unknown error occurred";f.includes("Failed to fetch")||f.includes("CORS")||f.includes("NetworkError")?y("Signing Failed","Failed to fetch certificate chain. This may be due to network issues or the certificate proxy being unavailable. Please check your internet connection and try again. If the issue persists, contact support."):y("Signing Failed",`Failed to sign PDF: ${f}`)}}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",k):k();
