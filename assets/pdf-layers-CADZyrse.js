import{c as T,i as H}from"./style-DHqpffR4.js";import"./lucide-init-b51_Izr7.js";import"./simple-mode-footer-CTXl6sKe.js";import"./version-Cc_uNslJ.js";import{a as m,b as I,h as w,f as F,r as X,c as z,d as G}from"./main-X9THBjap.js";import{l as q}from"./pymupdf-loader-DSwOn04P.js";import"./mobileMenu-BoMunYmR.js";import"./wasm-provider-C9fvsoLq.js";let c=null,u=null;const p=new Map;let g=0;document.addEventListener("DOMContentLoaded",()=>{const L=document.getElementById("file-input"),i=document.getElementById("drop-zone"),h=document.getElementById("process-btn"),v=document.getElementById("process-btn-container"),x=document.getElementById("file-display-area"),b=document.getElementById("layers-container"),f=document.getElementById("layers-list"),D=document.getElementById("back-to-tools");D&&D.addEventListener("click",()=>{window.location.href="/bentopdf/"});const O=async()=>{if(!(!x||!v||!h))if(c){x.innerHTML="";const t=document.createElement("div");t.className="flex items-center justify-between bg-gray-700 p-3 rounded-lg text-sm";const o=document.createElement("div");o.className="flex flex-col overflow-hidden";const e=document.createElement("div");e.className="truncate font-medium text-gray-200 text-sm mb-1",e.textContent=c.name;const n=document.createElement("div");n.className="text-xs text-gray-400",n.textContent=`${F(c.size)} â€¢ Loading pages...`,o.append(e,n);const r=document.createElement("button");r.className="ml-4 text-red-400 hover:text-red-300 flex-shrink-0",r.innerHTML='<i data-lucide="trash-2" class="w-4 h-4"></i>',r.onclick=()=>{$()},t.append(o,r),x.appendChild(t);try{const s=await X(c),d=await z({data:s}).promise;n.textContent=`${F(c.size)} â€¢ ${d.numPages} pages`}catch(s){console.error("Error loading PDF:",s),n.textContent=`${F(c.size)} â€¢ Could not load page count`}T({icons:H}),v.classList.remove("hidden"),h.disabled=!1}else x.innerHTML="",v.classList.add("hidden"),h.disabled=!0},$=()=>{c=null,u=null,p.clear(),g=0,i&&(i.style.display="flex"),b&&b.classList.add("hidden"),O()},M=(t,o,e="")=>new Promise(n=>{const r=document.getElementById("input-modal"),s=document.getElementById("input-title"),d=document.getElementById("input-message"),a=document.getElementById("input-value"),l=document.getElementById("input-confirm"),y=document.getElementById("input-cancel");if(!r||!s||!d||!a||!l||!y){console.error("Input modal elements not found"),n(null);return}s.textContent=t,d.textContent=o,a.value=e;const E=()=>{r.classList.add("hidden"),l.onclick=null,y.onclick=null,a.onkeydown=null},P=()=>{const B=a.value.trim();E(),n(B)},A=()=>{E(),n(null)};l.onclick=P,y.onclick=A,a.onkeydown=B=>{B.key==="Enter"&&P(),B.key==="Escape"&&A()},r.classList.remove("hidden"),a.focus()}),k=()=>{if(!f)return;const t=Array.from(p.values());if(t.length===0){f.innerHTML=`
                <div class="layers-empty">
                    <p>This PDF has no layers (OCG).</p>
                    <p>Add a new layer to get started!</p>
                </div>
            `;return}const o=t.sort((e,n)=>e.displayOrder-n.displayOrder);f.innerHTML=o.map(e=>`
            <div class="layer-item" data-number="${e.number}" style="padding-left: ${e.depth*24+8}px;">
                <label class="layer-toggle">
                    <input type="checkbox" ${e.on?"checked":""} ${e.locked?"disabled":""} data-xref="${e.xref}" />
                    <span class="layer-name">${e.depth>0?"â”” ":""}${e.text||`Layer ${e.number}`}</span>
                    ${e.locked?'<span class="layer-locked">ðŸ”’</span>':""}
                </label>
                <div class="layer-actions">
                    ${e.locked?"":`<button class="layer-add-child" data-xref="${e.xref}" title="Add child layer">+</button>`}
                    ${e.locked?"":`<button class="layer-delete" data-xref="${e.xref}" title="Delete layer">âœ•</button>`}
                </div>
            </div>
        `).join(""),f.querySelectorAll('input[type="checkbox"]').forEach(e=>{e.addEventListener("change",n=>{const r=n.target,s=parseInt(r.dataset.xref||"0"),d=r.checked;try{u.setLayerVisibility(s,d);const a=Array.from(p.values()).find(l=>l.xref===s);a&&(a.on=d)}catch(a){console.error("Failed to set layer visibility:",a),r.checked=!d,m("Error","Failed to toggle layer visibility")}})}),f.querySelectorAll(".layer-delete").forEach(e=>{e.addEventListener("click",n=>{const r=n.target,s=parseInt(r.dataset.xref||"0"),d=Array.from(p.values()).find(a=>a.xref===s);if(!d){m("Error","Layer not found");return}try{u.deleteOCG(d.number),p.delete(d.number),k()}catch(a){console.error("Failed to delete layer:",a),m("Error","Failed to delete layer")}})}),f.querySelectorAll(".layer-add-child").forEach(e=>{e.addEventListener("click",async n=>{const r=n.target,s=parseInt(r.dataset.xref||"0"),d=Array.from(p.values()).find(l=>l.xref===s),a=await M("Add Child Layer",`Enter name for child layer under "${d?.text||"Layer"}":`);if(!(!a||!a.trim()))try{const l=u.addOCGWithParent(a.trim(),s),y=d?.displayOrder||0;p.forEach(E=>{E.displayOrder>y&&(E.displayOrder+=1)}),p.set(l,{number:l,xref:l,text:a.trim(),on:!0,locked:!1,depth:(d?.depth||0)+1,parentXref:s,displayOrder:y+1}),k()}catch(l){console.error("Failed to add child layer:",l),m("Error","Failed to add child layer")}})})},N=async()=>{if(!c){m("No File","Please select a PDF file.");return}try{I("Loading engine...");const t=await q();I(`Loading layers from ${c.name}...`),u=await t.open(c),I("Reading layer configuration...");const o=u.getLayerConfig();p.clear(),g=0,o.forEach(e=>{p.set(e.number,{number:e.number,xref:e.xref??e.number,text:e.text,on:e.on,locked:e.locked,depth:e.depth??0,parentXref:e.parentXref??0,displayOrder:e.displayOrder??g++}),(e.displayOrder??-1)>=g&&(g=e.displayOrder+1)}),w(),i&&(i.style.display="none"),v&&v.classList.add("hidden"),b&&b.classList.remove("hidden"),k(),S()}catch(t){w(),m("Error",t.message||"Failed to load PDF layers"),console.error("Layers error:",t)}},S=()=>{const t=document.getElementById("add-layer-btn"),o=document.getElementById("new-layer-name"),e=document.getElementById("save-layers-btn");t&&o&&(t.onclick=()=>{const n=o.value.trim();if(!n){m("Invalid Name","Please enter a layer name");return}try{const r=u.addOCG(n);o.value="";const s=g++;p.set(r,{number:r,xref:r,text:n,on:!0,locked:!1,depth:0,parentXref:0,displayOrder:s}),k()}catch(r){m("Error","Failed to add layer: "+r.message)}}),e&&(e.onclick=()=>{try{I("Saving PDF with layer changes...");const n=u.save(),r=new Blob([new Uint8Array(n)],{type:"application/pdf"}),s=c.name.replace(/\.pdf$/i,"")+"_layers.pdf";G(r,s),w(),$(),m("Success","PDF with layer changes saved!","success")}catch(n){w(),m("Error","Failed to save PDF: "+n.message)}})},C=t=>{if(t&&t.length>0){const o=t[0];o.type==="application/pdf"||o.name.toLowerCase().endsWith(".pdf")?(c=o,O()):m("Invalid File","Please select a PDF file.")}};L&&i&&(L.addEventListener("change",t=>{C(t.target.files)}),i.addEventListener("dragover",t=>{t.preventDefault(),i.classList.add("bg-gray-700")}),i.addEventListener("dragleave",t=>{t.preventDefault(),i.classList.remove("bg-gray-700")}),i.addEventListener("drop",t=>{t.preventDefault(),i.classList.remove("bg-gray-700"),C(t.dataTransfer?.files??null)}),L.addEventListener("click",()=>{L.value=""})),h&&h.addEventListener("click",N)});
