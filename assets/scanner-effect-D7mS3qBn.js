import{c as j,i as N}from"./style-DHqpffR4.js";import"./lucide-init-b51_Izr7.js";import"./simple-mode-footer-CTXl6sKe.js";import"./version-Cc_uNslJ.js";import{G as $,a as u,b as w,r as E,c as I,h as L,d as U,f as v}from"./main-X9THBjap.js";import{P as z}from"./PDFButton-B7ekbw-1.js";import{b as M}from"./image-effects-Lmx2y_xU.js";import"./mobileMenu-BoMunYmR.js";import"./index-YkV0U4e7.js";$.workerSrc=new URL("/bentopdf/assets/pdf.worker.min-LyOxJPrg.mjs",import.meta.url).toString();let c=[],m=null,P=0,D=0,f=null;function C(){return{grayscale:document.getElementById("setting-grayscale")?.checked??!1,border:document.getElementById("setting-border")?.checked??!1,rotate:parseFloat(document.getElementById("setting-rotate")?.value??"0"),rotateVariance:parseFloat(document.getElementById("setting-rotate-variance")?.value??"0"),brightness:parseInt(document.getElementById("setting-brightness")?.value??"0"),contrast:parseInt(document.getElementById("setting-contrast")?.value??"0"),blur:parseFloat(document.getElementById("setting-blur")?.value??"0"),noise:parseInt(document.getElementById("setting-noise")?.value??"10"),yellowish:parseInt(document.getElementById("setting-yellowish")?.value??"0"),resolution:parseInt(document.getElementById("setting-resolution")?.value??"150")}}const k=M;function p(){if(!m)return;const t=document.getElementById("preview-canvas");if(!t)return;const n=C(),e=new ImageData(new Uint8ClampedArray(m.data),P,D);k(e,t,n,n.rotate)}async function T(){if(!f)return;const t=await f.getPage(1),n=t.getViewport({scale:1}),e=document.createElement("canvas"),s=e.getContext("2d");e.width=n.width,e.height=n.height,await t.render({canvasContext:s,viewport:n,canvas:e}).promise,m=s.getImageData(0,0,e.width,e.height),P=e.width,D=e.height,p()}const B=()=>{const t=document.getElementById("file-display-area"),n=document.getElementById("options-panel");!t||!n||(t.innerHTML="",c.length>0?(n.classList.remove("hidden"),c.forEach(e=>{const s=document.createElement("div");s.className="flex items-center justify-between bg-gray-700 p-3 rounded-lg text-sm";const r=document.createElement("div");r.className="flex flex-col overflow-hidden";const a=document.createElement("div");a.className="truncate font-medium text-gray-200 text-sm mb-1",a.textContent=e.name;const i=document.createElement("div");i.className="text-xs text-gray-400",i.textContent=`${v(e.size)} • Loading pages...`,r.append(a,i);const o=document.createElement("button");o.className="ml-4 text-red-400 hover:text-red-300 flex-shrink-0",o.innerHTML='<i data-lucide="trash-2" class="w-4 h-4"></i>',o.onclick=()=>{c=[],f=null,m=null,B()},s.append(r,o),t.appendChild(s),E(e).then(l=>I(l).promise).then(l=>{i.textContent=`${v(e.size)} • ${l.numPages} page${l.numPages!==1?"s":""}`}).catch(()=>{i.textContent=v(e.size)})}),j({icons:N})):n.classList.add("hidden"))},H=()=>{c=[],f=null,m=null;const t=document.getElementById("file-input");t&&(t.value=""),B()};async function O(){if(c.length===0){u("No File","Please upload a PDF file first.");return}w("Applying scanner effect...");try{const t=C(),n=await E(c[0]),e=await I({data:n}).promise,s=await z.create(),r=t.resolution/72;for(let i=1;i<=e.numPages;i++){w(`Processing page ${i} of ${e.numPages}...`);const o=await e.getPage(i),l=o.getViewport({scale:r}),d=document.createElement("canvas"),b=d.getContext("2d");d.width=l.width,d.height=l.height,await o.render({canvasContext:b,viewport:l,canvas:d}).promise;const h=b.getImageData(0,0,d.width,d.height),S=new ImageData(new Uint8ClampedArray(h.data),h.width,h.height),g=document.createElement("canvas"),V=t.rotate+(t.rotateVariance>0?(Math.random()-.5)*2*t.rotateVariance:0);k(S,g,t,V,r);const x=await new Promise(y=>g.toBlob(y,"image/jpeg",.85));if(x){const y=await x.arrayBuffer(),A=await s.embedJpg(y);s.addPage([g.width,g.height]).drawImage(A,{x:0,y:0,width:g.width,height:g.height})}}const a=await s.save();U(new Blob([new Uint8Array(a)],{type:"application/pdf"}),"scanned.pdf"),u("Success","Scanner effect applied successfully!","success",()=>{H()})}catch(t){console.error(t),u("Error","Failed to apply scanner effect. The file might be corrupted.")}finally{L()}}const F=[{id:"setting-rotate",display:"rotate-value",suffix:"°",defaultValue:"0"},{id:"setting-rotate-variance",display:"rotate-variance-value",suffix:"°",defaultValue:"0"},{id:"setting-brightness",display:"brightness-value",suffix:"",defaultValue:"0"},{id:"setting-contrast",display:"contrast-value",suffix:"",defaultValue:"0"},{id:"setting-blur",display:"blur-value",suffix:"px",defaultValue:"0"},{id:"setting-noise",display:"noise-value",suffix:"",defaultValue:"10"},{id:"setting-yellowish",display:"yellowish-value",suffix:"",defaultValue:"0"},{id:"setting-resolution",display:"resolution-value",suffix:" DPI",defaultValue:"150"}];function G(){F.forEach(({id:e,display:s,suffix:r,defaultValue:a})=>{const i=document.getElementById(e),o=document.getElementById(s);i&&(i.value=a),o&&(o.textContent=a+r)});const t=document.getElementById("setting-grayscale"),n=document.getElementById("setting-border");t&&(t.checked=!1),n&&(n.checked=!1),p()}function J(){F.forEach(({id:e,display:s,suffix:r})=>{const a=document.getElementById(e),i=document.getElementById(s);a&&i&&a.addEventListener("input",()=>{i.textContent=a.value+r,e!=="setting-resolution"&&p()})}),["setting-grayscale","setting-border"].forEach(e=>{const s=document.getElementById(e);s&&s.addEventListener("change",p)});const n=document.getElementById("reset-settings-btn");n&&n.addEventListener("click",G)}document.addEventListener("DOMContentLoaded",()=>{const t=document.getElementById("file-input"),n=document.getElementById("drop-zone"),e=document.getElementById("process-btn"),s=document.getElementById("back-to-tools");s&&s.addEventListener("click",()=>{window.location.href="/bentopdf/"});const r=async a=>{if(!a||a.length===0)return;const i=Array.from(a).filter(o=>o.type==="application/pdf");if(i.length===0){u("Invalid File","Please upload a PDF file.");return}c=[i[0]],B(),w("Loading preview...");try{const o=await E(i[0]);f=await I({data:o}).promise,await T()}catch(o){console.error(o),u("Error","Failed to load PDF for preview.")}finally{L()}};t&&n&&(t.addEventListener("change",a=>{r(a.target.files)}),n.addEventListener("dragover",a=>{a.preventDefault(),n.classList.add("bg-gray-700")}),n.addEventListener("dragleave",a=>{a.preventDefault(),n.classList.remove("bg-gray-700")}),n.addEventListener("drop",a=>{a.preventDefault(),n.classList.remove("bg-gray-700"),r(a.dataTransfer?.files??null)}),t.addEventListener("click",()=>{t.value=""})),e&&e.addEventListener("click",O),J()});
