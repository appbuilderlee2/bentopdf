import{P as F,a as e}from"./PDFButton-B7ekbw-1.js";function p(o){const s=o.getInfoDict();s.keys().forEach(a=>{s.delete(a)}),o.setTitle(""),o.setAuthor(""),o.setSubject(""),o.setKeywords([]),o.setCreator(""),o.setProducer("");try{const a=o.catalog.dict;a.has(e.of("Metadata"))&&a.delete(e.of("Metadata"))}catch(a){console.warn("Could not remove XMP metadata:",a.message)}try{const a=o.context;a.trailerInfo&&delete a.trailerInfo.ID}catch(a){console.warn("Could not remove document IDs:",a.message)}try{const a=o.catalog.dict;a.has(e.of("PieceInfo"))&&a.delete(e.of("PieceInfo"))}catch(a){console.warn("Could not remove PieceInfo:",a.message)}}function C(o){const s=o.getPages();for(const n of s)try{n.node.delete(e.of("Annots"))}catch(a){console.warn("Could not remove annotations from page:",a.message)}}function w(o){o.getForm().flatten()}function k(o){o.javaScripts&&o.javaScripts.length>0&&(o.javaScripts=[]);const s=o.catalog.dict,n=s.get(e.of("Names"));if(n)try{const t=o.context.lookup(n);t.has(e.of("JavaScript"))&&t.delete(e.of("JavaScript"))}catch(t){console.warn("Could not access Names/JavaScript:",t.message)}s.has(e.of("OpenAction"))&&s.delete(e.of("OpenAction")),s.has(e.of("AA"))&&s.delete(e.of("AA"));const a=o.getPages();for(const t of a)try{const c=t.node;c.has(e.of("AA"))&&c.delete(e.of("AA"));const r=c.Annots()?.asArray()||[];for(const l of r)try{const i=o.context.lookup(l);if(i.has(e.of("A"))){const g=i.get(e.of("A"));try{o.context.lookup(g).get(e.of("S"))?.toString().substring(1)==="JavaScript"&&i.delete(e.of("A"))}catch(f){console.warn("Could not read action:",f.message)}}i.has(e.of("AA"))&&i.delete(e.of("AA"))}catch(i){console.warn("Could not process annotation for JS:",i.message)}}catch(c){console.warn("Could not remove page actions:",c.message)}try{const t=s.get(e.of("AcroForm"));if(t){const r=o.context.lookup(t).get(e.of("Fields"));if(r){const i=o.context.lookup(r).asArray();for(const g of i)try{const f=o.context.lookup(g);f.has(e.of("A"))&&f.delete(e.of("A")),f.has(e.of("AA"))&&f.delete(e.of("AA"))}catch(f){console.warn("Could not process field for JS:",f.message)}}}}catch(t){console.warn("Could not process form fields for JS:",t.message)}}function P(o){const s=o.catalog.dict,n=s.get(e.of("Names"));if(n)try{const t=o.context.lookup(n);t.has(e.of("EmbeddedFiles"))&&t.delete(e.of("EmbeddedFiles"))}catch(t){console.warn("Could not access Names/EmbeddedFiles:",t.message)}s.has(e.of("EmbeddedFiles"))&&s.delete(e.of("EmbeddedFiles"));const a=o.getPages();for(const t of a)try{const c=t.node.Annots()?.asArray()||[],r=[];for(const l of c)try{o.context.lookup(l).get(e.of("Subtype"))?.toString().substring(1)!=="FileAttachment"&&r.push(l)}catch{r.push(l)}if(r.length!==c.length)if(r.length>0){const l=o.context.obj(r);t.node.set(e.of("Annots"),l)}else t.node.delete(e.of("Annots"))}catch(c){console.warn(`Could not process page for attachments: ${c.message}`)}o.embeddedFiles&&o.embeddedFiles.length>0&&(o.embeddedFiles=[]),s.has(e.of("Collection"))&&s.delete(e.of("Collection"))}function R(o){const s=o.catalog.dict;s.has(e.of("OCProperties"))&&s.delete(e.of("OCProperties"));const n=o.getPages();for(const a of n)try{const t=a.node;t.has(e.of("OCProperties"))&&t.delete(e.of("OCProperties"));const c=t.get(e.of("Resources"));if(c)try{const r=o.context.lookup(c);r.has(e.of("Properties"))&&r.delete(e.of("Properties"))}catch(r){console.warn("Could not access Resources:",r.message)}}catch(t){console.warn("Could not remove page layers:",t.message)}}function S(o){const s=o.getPages();for(let n=0;n<s.length;n++)try{const t=s[n].node,c=t.get(e.of("Annots"));if(!c)continue;const l=o.context.lookup(c).asArray();if(l.length===0)continue;const i=[];let g=0;for(const f of l)try{const m=o.context.lookup(f),y=m.get(e.of("Subtype"))?.toString().substring(1);let d=!1;if(y==="Link")d=!0,g++;else{const u=m.get(e.of("A"));if(u)try{const A=o.context.lookup(u).get(e.of("S"))?.toString().substring(1);(A==="URI"||A==="Launch"||A==="GoTo"||A==="GoToR")&&(d=!0,g++)}catch(h){console.warn("Could not read action:",h.message)}m.get(e.of("Dest"))&&!d&&(d=!0,g++)}d||i.push(f)}catch(m){console.warn("Could not process annotation:",m.message),i.push(f)}if(g>0)if(i.length>0){const f=o.context.obj(i);t.set(e.of("Annots"),f)}else t.delete(e.of("Annots"))}catch(a){console.warn(`Could not process page ${n+1} for links: ${a.message}`)}try{const n=o.catalog.dict,a=n.get(e.of("Names"));if(a)try{const t=o.context.lookup(a);t.has(e.of("Dests"))&&t.delete(e.of("Dests"))}catch(t){console.warn("Could not access Names/Dests:",t.message)}n.has(e.of("Dests"))&&n.delete(e.of("Dests"))}catch(n){console.warn("Could not remove named destinations:",n.message)}}function b(o){const s=o.catalog.dict;s.has(e.of("StructTreeRoot"))&&s.delete(e.of("StructTreeRoot"));const n=o.getPages();for(const a of n)try{const t=a.node;t.has(e.of("StructParents"))&&t.delete(e.of("StructParents"))}catch(t){console.warn("Could not remove page StructParents:",t.message)}s.has(e.of("ParentTree"))&&s.delete(e.of("ParentTree"))}function x(o){const s=o.catalog.dict;s.has(e.of("MarkInfo"))&&s.delete(e.of("MarkInfo")),s.has(e.of("Marked"))&&s.delete(e.of("Marked"))}function I(o){const s=o.getPages();for(let n=0;n<s.length;n++)try{const c=s[n].node.get(e.of("Resources"));if(c)try{const r=o.context.lookup(c);if(r.has(e.of("Font"))){const l=r.get(e.of("Font"));try{const i=o.context.lookup(l),g=i.keys();for(const f of g)try{const m=i.get(f),y=o.context.lookup(m);if(y.has(e.of("FontDescriptor"))){const d=y.get(e.of("FontDescriptor")),u=o.context.lookup(d),v=["FontFile","FontFile2","FontFile3"];for(const h of v)u.has(e.of(h))&&u.delete(e.of(h))}}catch(m){console.warn(`Could not process font ${f}:`,m.message)}}catch(i){console.warn("Could not access font dictionary:",i.message)}}}catch(r){console.warn("Could not access Resources for fonts:",r.message)}}catch(a){console.warn(`Could not remove fonts from page ${n+1}:`,a.message)}o.fonts&&o.fonts.length>0&&(o.fonts=[])}async function $(o,s){const n=await F.load(o);if(s.flattenForms)try{w(n)}catch(t){console.warn(`Could not flatten forms: ${t.message}`);try{const c=n.catalog.dict;c.has(e.of("AcroForm"))&&c.delete(e.of("AcroForm"))}catch(c){console.warn("Could not remove AcroForm:",c.message)}}if(s.removeMetadata&&p(n),s.removeAnnotations&&C(n),s.removeJavascript)try{k(n)}catch(t){console.warn(`Could not remove JavaScript: ${t.message}`)}if(s.removeEmbeddedFiles)try{P(n)}catch(t){console.warn(`Could not remove embedded files: ${t.message}`)}if(s.removeLayers)try{R(n)}catch(t){console.warn(`Could not remove layers: ${t.message}`)}if(s.removeLinks)try{S(n)}catch(t){console.warn(`Could not remove links: ${t.message}`)}if(s.removeStructureTree)try{b(n)}catch(t){console.warn(`Could not remove structure tree: ${t.message}`)}if(s.removeMarkInfo)try{x(n)}catch(t){console.warn(`Could not remove MarkInfo: ${t.message}`)}if(s.removeFonts)try{I(n)}catch(t){console.warn(`Could not remove fonts: ${t.message}`)}const a=await n.save();return{pdfDoc:n,bytes:new Uint8Array(a)}}export{$ as s};
